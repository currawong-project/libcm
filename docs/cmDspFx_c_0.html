<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>cmDspFx.c</title>
    <link href="cdg_code.css"    rel="stylesheet" type="text/css" media="screen" />
  </head>
  <body>
    <div class="highlight">

      <div class="license">
	<p>
	  Copyright (C) Kevin Larke 2009-2020
	</p>

	<p>
	  This file is part of libcm.
	</p>

	<p>
	  libcm is free software: you can redistribute it and/or modify it under
	  the terms of the GNU General Public License as published by the Free
	  Software Foundation, either version 3 of the License, or (at your
	  option) any later version.
	</p>

	<p>
	  libcm is distributed in the hope that it will be useful, but WITHOUT
	  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
	  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
	  for more details.
	</p>

	<p>
	  See the GNU General Public License distributed with the libcm
	  package or look here: <https://www.gnu.org/licenses/>.
	</p>


      </div>

      <hr>
<a name="cmDspFx.c"></a><!-- Begin nodes -->
<div class="cod"><div class="blk_title">cmDspFx : 'snap' audio effects processor units.</div><pre><a name="cmDspFx_c_code_0"></a>
<span class="m">#include &quot<a href="cmPrefix_h_0.html#cmPrefix.h">cmPrefix.h</a>&quot</span>
<span class="m">#include &quot<a href="cmGlobal_h_0.html#cmGlobal.h">cmGlobal.h</a>&quot</span>
<span class="m">#include &quot<a href="cmFloatTypes_h_0.html#cmFloatTypes.h">cmFloatTypes.h</a>&quot</span>
<span class="m">#include &quot<a href="cmComplexTypes_h_0.html#cmComplexTypes.h">cmComplexTypes.h</a>&quot</span>
<span class="m">#include &quot<a href="cmRpt_h_0.html#cmRpt.h">cmRpt.h</a>&quot</span>
<span class="m">#include &quot<a href="cmErr_h_0.html#cmErr.h">cmErr.h</a>&quot</span>
<span class="m">#include &quot<a href="cmCtx_h_0.html#cmCtx.h">cmCtx.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMem_h_0.html#cmMem.h">cmMem.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMallocDebug_h_0.html#cmMallocDebug.h">cmMallocDebug.h</a>&quot</span>
<span class="m">#include &quot<a href="cmLinkedHeap_h_0.html#cmLinkedHeap.h">cmLinkedHeap.h</a>&quot</span>
<span class="m">#include &quot<a href="cmText_h_0.html#cmText.h">cmText.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMath_h_0.html#cmMath.h">cmMath.h</a>&quot</span>
<span class="m">#include &quot<a href="cmFile_h_0.html#cmFile.h">cmFile.h</a>&quot</span>
<span class="m">#include &quot<a href="cmFileSys_h_0.html#cmFileSys.h">cmFileSys.h</a>&quot</span>
<span class="m">#include &quot<a href="cmSymTbl_h_0.html#cmSymTbl.h">cmSymTbl.h</a>&quot</span>
<span class="m">#include &quot<a href="cmJson_h_0.html#cmJson.h">cmJson.h</a>&quot</span>
<span class="m">#include &quot<a href="cmPrefs_h_0.html#cmPrefs.h">cmPrefs.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspValue_h_0.html#cmDspValue.h">cmDspValue.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMsgProtocol_h_0.html#cmMsgProtocol.h">cmMsgProtocol.h</a>&quot</span>
<span class="m">#include &quot<a href="cmThread_h_0.html#cmThread.h">cmThread.h</a>&quot </span>
<span class="m">#include &quot<a href="cmUdpPort_h_0.html#cmUdpPort.h">cmUdpPort.h</a>&quot</span>
<span class="m">#include &quot<a href="cmUdpNet_h_0.html#cmUdpNet.h">cmUdpNet.h</a>&quot</span>
<span class="m">#include &quot<a href="cmSerialPort_h_0.html#cmSerialPort.h">cmSerialPort.h</a>&quot</span>
<span class="m">#include &quot<a href="cmTime_h_0.html#cmTime.h">cmTime.h</a>&quot</span>
<span class="m">#include &quot<a href="cmAudioSys_h_0.html#cmAudioSys.h">cmAudioSys.h</a>&quot</span>
<span class="m">#include &quot<a href="cmProcObj_h_0.html#cmProcObj.h">cmProcObj.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspCtx_h_0.html#cmDspCtx.h">cmDspCtx.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspClass_h_0.html#cmDspClass.h">cmDspClass.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspUi_h_0.html#cmDspUi.h">cmDspUi.h</a>&quot</span>
<span class="m">#include &quot<a href="cmAudioFile_h_0.html#cmAudioFile.h">cmAudioFile.h</a>&quot</span>

<span class="m">#include &quot<a href="cmProcObj_h_0.html#cmProcObj.h">cmProcObj.h</a>&quot</span>
<span class="m">#include &quotcmProcTemplateMain.h&quot</span>
<span class="m">#include &quot<a href="cmProc_h_0.html#cmProc.h">cmProc.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMidi_h_0.html#cmMidi.h">cmMidi.h</a>&quot</span>
<span class="m">#include &quot<a href="cmProc2_h_0.html#cmProc2.h">cmProc2.h</a>&quot</span>
<span class="m">#include &quot<a href="cmProc3_h_0.html#cmProc3.h">cmProc3.h</a>&quot</span>
<span class="m">#include &quotcmVectOpsTemplateMain.h&quot</span>

<span class="m">#include &quotapp/<a href="cmPickup_h_0.html#cmPickup.h">cmPickup.h</a>&quot</span>

<span class="m">#include &quot<a href="cmDspSys_h_0.html#cmDspSys.h">cmDspSys.h</a>&quot</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspDelay : Simple audio delay with feedback.</div><pre><a name="cmDspDelay"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassDyId"></a><span class="e">kBypassDyId</span><span class="p">,</span>
  <a name="kTimeDyId"></a><span class="e">kTimeDyId</span><span class="p">,</span>
  <a name="kFbDyId"></a><span class="e">kFbDyId</span><span class="p">,</span>
  <a name="kInDyId"></a><span class="e">kInDyId</span><span class="p">,</span>
  <a name="kOutDyId"></a><span class="e">kOutDyId</span>
  
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmDelayDC<span class="p">;</span>

<a name="cmDspDelay_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspDelay_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc2_h_0.html#cmMDelay">cmMDelay</a><span class="p">*</span>    <a name="cmDspDelay_t.delay"></a><span class="i">delay</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspDelay_t">cmDspDelay_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspDelayAlloc_defn"></a><a name="_cmDspDelayAlloc"></a><span class="f">_cmDspDelayAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> chs <span class="p">=</span> <span class="l">1</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassDyId">kBypassDyId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotBypass enable flag.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quottime&quot</span><span class="p">,</span>  <a href="#kTimeDyId">kTimeDyId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMax delay time in milliseconds&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfb&quot</span><span class="p">,</span>    <a href="#kFbDyId">kFbDyId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotFeedback&quot</span>  <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInDyId">kInDyId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutDyId">kOutDyId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> chs<span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set default values for the parameters that were not explicitely set in the va_arg list</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBypassDyId">kBypassDyId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span>   <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTimeDyId">kTimeDyId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>   <span class="l">1000</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst <span class="p">,</span><a href="#kFbDyId">kFbDyId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> dtimeMs <span class="p">=</span>  <a href="cmDspClass_h_0.html#cmDspDefaultUInt">cmDspDefaultUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kTimeDyId">kTimeDyId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> fbCoeff <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDefaultDouble">cmDspDefaultDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFbDyId">kFbDyId</a><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>delay <span class="p">=</span> <a href="cmProc2_h_0.html#cmMDelayAlloc">cmMDelayAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> fbCoeff<span class="p">,</span>  <span class="l">1</span><span class="p">,</span> <span class="p">&amp</span>dtimeMs<span class="p">,</span> NULL  <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDelayFree_defn"></a><a name="_cmDspDelayFree"></a><span class="f">_cmDspDelayFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmProc2_h_0.html#cmMDelayFree">cmMDelayFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>delay<span class="p">)</span><span class="p">;</span>
  
  <span class="c">//<a href="cmProcObj_h_0.html#cmCtxFree">cmCtxFree</a>(&ampampp-&ampgtctx);</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDelayReset_defn"></a><a name="_cmDspDelayReset"></a><span class="f">_cmDspDelayReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDelayExec_defn"></a><a name="_cmDspDelayExec"></a><span class="f">_cmDspDelayExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInDyId">kInDyId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInDyId">kInDyId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>          oChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutDyId">kOutDyId</a><span class="p">,</span>oChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          oSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutDyId">kOutDyId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">bool</span>              bypassFl<span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassDyId">kBypassDyId</a><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc2_h_0.html#cmMDelayExec">cmMDelayExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>delay<span class="p">,</span>ip<span class="p">,</span>op<span class="p">,</span><a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span>iSmpCnt<span class="p">,</span>oSmpCnt<span class="p">)</span><span class="p">,</span>bypassFl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDelayRecv_defn"></a><a name="_cmDspDelayRecv"></a><span class="f">_cmDspDelayRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspDelay_t">cmDspDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc<span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kBypassDyId">kBypassDyId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kTimeDyId">kTimeDyId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>delay<span class="p">-</span><span class="p">&gt</span>delayArray<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">.</span>delayMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kTimeDyId">kTimeDyId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kFbDyId">kFbDyId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>delay<span class="p">-</span><span class="p">&gt</span>fbCoeff  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFbDyId">kFbDyId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmDelayClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmDelayClassCons">cmDelayClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmDelayDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotDelay&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspDelayAlloc">_cmDspDelayAlloc</a><span class="p">,</span>
  <a href="#_cmDspDelayFree">_cmDspDelayFree</a><span class="p">,</span>
  <a href="#_cmDspDelayReset">_cmDspDelayReset</a><span class="p">,</span>
  <a href="#_cmDspDelayExec">_cmDspDelayExec</a><span class="p">,</span>
  <a href="#_cmDspDelayRecv">_cmDspDelayRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotSimple delay.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmDelayDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspMtDelay : Multi-tap audio delay with feedback.</div><pre><a name="cmDspMtDelay"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassMtId"></a><span class="e">kBypassMtId</span><span class="p">,</span>
  <a name="kScaleMtId"></a><span class="e">kScaleMtId</span><span class="p">,</span>
  <a name="kFbMtId"></a><span class="e">kFbMtId</span><span class="p">,</span>
  <span class="e"><a href="cmDspBuiltIn_c_0.html#kInMtId">kInMtId</a></span><span class="p">,</span>
  <a name="kOutMtId"></a><span class="e">kOutMtId</span><span class="p">,</span>
  <a name="kBaseMsMtId"></a><span class="e">kBaseMsMtId</span>
  
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmMtDelayDC<span class="p">;</span>

<a name="cmDspMtDelay_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspMtDelay_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc2_h_0.html#cmMDelay">cmMDelay</a><span class="p">*</span>    <a name="cmDspMtDelay_t.p"></a><span class="i">p</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspMtDelay_t.baseGainMtId"></a><span class="i">baseGainMtId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspMtDelay_t.tapCnt"></a><span class="i">tapCnt</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>    <a name="cmDspMtDelay_t.msV"></a><span class="i">msV</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>    <a name="cmDspMtDelay_t.gainV"></a><span class="i">gainV</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspMtDelay_t.printSymId"></a><span class="i">printSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspMtDelay_t">cmDspMtDelay_t</a></span><span class="p">;</span>

<span class="c">// args: bypassFl, time_scale, feedback, tap_ms0, tap_gain0, tapms1, tap_gain1, ....</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspMtDelayAlloc_defn"></a><a name="_cmDspMtDelayAlloc"></a><span class="f">_cmDspMtDelayAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_list vl1<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassMtId">kBypassMtId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotBypass enable flag.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotscale&quot</span><span class="p">,</span> <a href="#kScaleMtId">kScaleMtId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotScale tap times. (0.0 - 1.0)&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfb&quot</span><span class="p">,</span>    <a href="#kFbMtId">kFbMtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotFeedback&quot</span>  <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="cmDspBuiltIn_c_0.html#kInMtId">kInMtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutMtId">kOutMtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output.&quot</span> <span class="p">}</span><span class="p">,</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="c">// verify that at least one var arg exists</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">5</span> <span class="p">|</span><span class="p">|</span> <a href="cmMath_h_0.html#cmIsEvenU">cmIsEvenU</a><span class="p">(</span>va_cnt<span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe 'multi-tap delay requires at least 5 arguments. Three fixed arguments and groups of two tap specification arguments.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>    
  
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      reqArgCnt    <span class="p">=</span> <span class="l">3</span><span class="p">;</span>
  <span class="k">unsigned</span>      fixArgCnt    <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>      tapCnt       <span class="p">=</span> <span class="p">(</span>va_cnt <span class="p">-</span> reqArgCnt<span class="p">)</span><span class="p">/</span><span class="l">2</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>     msV          <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">,</span>tapCnt<span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>     gainV        <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">,</span>tapCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      argCnt       <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="l">2</span> <span class="p">*</span> tapCnt<span class="p">;</span>
  <span class="k">unsigned</span>      baseGainMtId <span class="p">=</span> <a href="#kBaseMsMtId">kBaseMsMtId</a> <span class="p">+</span> tapCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span>      i<span class="p">;</span>
  
  <span class="c">// Get the taps and gains</span>
  va_arg<span class="p">(</span>vl1<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>    <span class="c"> // enable</span>
  va_arg<span class="p">(</span>vl1<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>  <span class="c"> // time scale</span>
  va_arg<span class="p">(</span>vl1<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>  <span class="c"> // feedback</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>tapCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    msV<span class="p">[</span>i<span class="p">]</span>   <span class="p">=</span> va_arg<span class="p">(</span>vl1<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>
    gainV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> va_arg<span class="p">(</span>vl1<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="c">// setup the output gain args </span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>       a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kBaseMsMtId">kBaseMsMtId</a><span class="p">,</span>  tapCnt<span class="p">,</span> <span class="l">&quotms&quot</span><span class="p">,</span>   <a href="#kBaseMsMtId">kBaseMsMtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotTap delay times in milliseconds.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> baseGainMtId<span class="p">,</span> tapCnt<span class="p">,</span> <span class="l">&quotgain&quot</span><span class="p">,</span> baseGainMtId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotTap delay linear gain.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span>  a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>reqArgCnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  
  p<span class="p">-</span><span class="p">&gt</span>p            <span class="p">=</span> <a href="cmProc2_h_0.html#cmMDelayAlloc">cmMDelayAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> NULL<span class="p">,</span> NULL  <span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseGainMtId <span class="p">=</span> baseGainMtId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>tapCnt       <span class="p">=</span> tapCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>msV          <span class="p">=</span> msV<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gainV        <span class="p">=</span> gainV<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>printSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quot_print&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>tapCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kBaseMsMtId">kBaseMsMtId</a><span class="p">+</span>i<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> msV<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>baseGainMtId<span class="p">+</span>i<span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> gainV<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMtDelayFree_defn"></a><a name="_cmDspMtDelayFree"></a><span class="f">_cmDspMtDelayFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>msV<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gainV<span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc2_h_0.html#cmMDelayFree">cmMDelayFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMtDelayReset_defn"></a><a name="_cmDspMtDelayReset"></a><span class="f">_cmDspMtDelayReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmProc2_h_0.html#cmMDelayInit">cmMDelayInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFbMtId">kFbMtId</a><span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>tapCnt<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>msV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>gainV  <span class="p">)</span><span class="p">;</span>    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMtDelayExec_defn"></a><a name="_cmDspMtDelayExec"></a><span class="f">_cmDspMtDelayExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspBuiltIn_c_0.html#kInMtId">kInMtId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="cmDspBuiltIn_c_0.html#kInMtId">kInMtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>          oChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutMtId">kOutMtId</a><span class="p">,</span>oChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          oSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutMtId">kOutMtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">bool</span>              bypassFl<span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassMtId">kBypassMtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> ip <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <a href="cmProc2_h_0.html#cmMDelayExec">cmMDelayExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>ip<span class="p">,</span>op<span class="p">,</span><a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span>iSmpCnt<span class="p">,</span>oSmpCnt<span class="p">)</span><span class="p">,</span>bypassFl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMtDelayRecv_defn"></a><a name="_cmDspMtDelayRecv"></a><span class="f">_cmDspMtDelayRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc<span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set tap times</span>
  <span class="k">if</span><span class="p">(</span> <a href="#kBaseMsMtId">kBaseMsMtId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kBaseMsMtId">kBaseMsMtId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>delayCnt <span class="p">)</span>
    <a href="cmProc2_h_0.html#cmMDelaySetTapMs">cmMDelaySetTapMs</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kBaseMsMtId">kBaseMsMtId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="c">// set tap gains</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseGainMtId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseGainMtId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>delayCnt <span class="p">)</span>
    <a href="cmProc2_h_0.html#cmMDelaySetTapGain">cmMDelaySetTapGain</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>baseGainMtId<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kScaleMtId">kScaleMtId</a><span class="p">:</span>
      <span class="c">//<a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a>(inst,<a href="#kScaleMtId">kScaleMtId</a>);</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kFbMtId">kFbMtId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>fbCoeff  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFbMtId">kFbMtId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspMtDelayRecvFunc_defn"></a><a name="_cmDspMtDelayRecvFunc"></a><span class="f">_cmDspMtDelayRecvFunc</span><span class="p">(</span>   <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  inst<span class="p">,</span>  <span class="k">unsigned</span> attrSymId<span class="p">,</span> <span class="k">const</span> <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a><span class="p">*</span> value <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspMtDelay_t">cmDspMtDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvIsSymbol">cmDsvIsSymbol</a><span class="p">(</span>value<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span><a href="cmDspValue_h_0.html#cmDsvSymbol">cmDsvSymbol</a><span class="p">(</span>value<span class="p">)</span><span class="p">=</span><span class="p">=</span>p<span class="p">-</span><span class="p">&gt</span>printSymId<span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">int</span> i<span class="p">;</span>
    <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quottaps:%i\n&quot</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>tapCnt<span class="p">)</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>tapCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot%f %f\n&quot</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>msV<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gainV<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
    
    <a href="cmProc2_h_0.html#cmMDelayReport">cmMDelayReport</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> ctx<span class="p">-</span><span class="p">&gt</span>rpt <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmMtDelayClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmMtDelayClassCons">cmMtDelayClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmMtDelayDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotMtDelay&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMtDelayAlloc">_cmDspMtDelayAlloc</a><span class="p">,</span>
  <a href="#_cmDspMtDelayFree">_cmDspMtDelayFree</a><span class="p">,</span>
  <a href="#_cmDspMtDelayReset">_cmDspMtDelayReset</a><span class="p">,</span>
  <a href="#_cmDspMtDelayExec">_cmDspMtDelayExec</a><span class="p">,</span>
  <a href="#_cmDspMtDelayRecv">_cmDspMtDelayRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMtDelayRecvFunc">_cmDspMtDelayRecvFunc</a><span class="p">,</span>
  <span class="l">&quotMulti-tap delay.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmMtDelayDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspPShift : Time-domain pitch shifter.</div><pre><a name="cmDspPShift"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassPsId"></a><span class="e">kBypassPsId</span><span class="p">,</span>
  <a name="kRatioPsId"></a><span class="e">kRatioPsId</span><span class="p">,</span>
  <a name="kInPsId"></a><span class="e">kInPsId</span><span class="p">,</span>
  <a name="kOutPsId"></a><span class="e">kOutPsId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmPShiftDC<span class="p">;</span>

<a name="cmDspPShift_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspPShift_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="c">//<a href="cmProcObj_h_0.html#cmCtx">cmCtx</a>*        ctx;</span>
  <a href="cmProc3_h_0.html#cmPitchShift">cmPitchShift</a><span class="p">*</span> <a name="cmDspPShift_t.pshift"></a><span class="i">pshift</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspPShift_t">cmDspPShift_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspPShiftAlloc_defn"></a><a name="_cmDspPShiftAlloc"></a><span class="f">_cmDspPShiftAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> chs <span class="p">=</span> <span class="l">1</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassPsId">kBypassPsId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotBypass enable flag.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotratio&quot</span><span class="p">,</span> <a href="#kRatioPsId">kRatioPsId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotRatio&quot</span>  <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInPsId">kInPsId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutPsId">kOutPsId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> chs<span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspPShift_t">cmDspPShift_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspPShift_t">cmDspPShift_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set default values for the parameters that were not explicitely set in the va_arg list</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBypassPsId">kBypassPsId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>     <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst <span class="p">,</span><a href="#kRatioPsId">kRatioPsId</a><span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>pshift <span class="p">=</span> <a href="cmProc3_h_0.html#cmPitchShiftAlloc">cmPitchShiftAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span>  <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPShiftFree_defn"></a><a name="_cmDspPShiftFree"></a><span class="f">_cmDspPShiftFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspPShift_t">cmDspPShift_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspPShift_t">cmDspPShift_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmPitchShiftFree">cmPitchShiftFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>pshift<span class="p">)</span><span class="p">;</span>
  
  <span class="c">//<a href="cmProcObj_h_0.html#cmCtxFree">cmCtxFree</a>(&ampampp-&ampgtctx);</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPShiftReset_defn"></a><a name="_cmDspPShiftReset"></a><span class="f">_cmDspPShiftReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPShiftExec_defn"></a><a name="_cmDspPShiftExec"></a><span class="f">_cmDspPShiftExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspPShift_t">cmDspPShift_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspPShift_t">cmDspPShift_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInPsId">kInPsId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInPsId">kInPsId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>          oChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutPsId">kOutPsId</a><span class="p">,</span>oChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          oSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutPsId">kOutPsId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">bool</span>              bypassFl<span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassPsId">kBypassPsId</a><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmPitchShiftExec">cmPitchShiftExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>pshift<span class="p">,</span>ip<span class="p">,</span>op<span class="p">,</span><a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span>iSmpCnt<span class="p">,</span>oSmpCnt<span class="p">)</span><span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kRatioPsId">kRatioPsId</a><span class="p">)</span><span class="p">,</span>bypassFl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPShiftRecv_defn"></a><a name="_cmDspPShiftRecv"></a><span class="f">_cmDspPShiftRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmPShiftClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmPShiftClassCons">cmPShiftClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmPShiftDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotPShift&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPShiftAlloc">_cmDspPShiftAlloc</a><span class="p">,</span>
  <a href="#_cmDspPShiftFree">_cmDspPShiftFree</a><span class="p">,</span>
  <a href="#_cmDspPShiftReset">_cmDspPShiftReset</a><span class="p">,</span>
  <a href="#_cmDspPShiftExec">_cmDspPShiftExec</a><span class="p">,</span>
  <a href="#_cmDspPShiftRecv">_cmDspPShiftRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotPitch Shifter.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmPShiftDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspLoopRecd : Loop recorder.</div><pre><a name="cmDspLoopRecd"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kTimeLrId"></a><span class="e">kTimeLrId</span><span class="p">,</span>
  <a name="kPGainLrId"></a><span class="e">kPGainLrId</span><span class="p">,</span>
  <a name="kRGainLrId"></a><span class="e">kRGainLrId</span><span class="p">,</span>
  <a name="kBypassLrId"></a><span class="e">kBypassLrId</span><span class="p">,</span>
  <a name="kPlayLrId"></a><span class="e">kPlayLrId</span><span class="p">,</span>
  <a name="kRecdLrId"></a><span class="e">kRecdLrId</span><span class="p">,</span>
  <a name="kRatioLrId"></a><span class="e">kRatioLrId</span><span class="p">,</span>
  <a name="kInLrId"></a><span class="e">kInLrId</span><span class="p">,</span>
  <a name="kOutLrId"></a><span class="e">kOutLrId</span>
  
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmLoopRecdDC<span class="p">;</span>

<a name="cmDspLoopRecd_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>     <a name="cmDspLoopRecd_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="c">//<a href="cmProcObj_h_0.html#cmCtx">cmCtx</a>*          ctx;</span>
  <span class="k">bool</span>            <a name="cmDspLoopRecd_t.playFl"></a><span class="i">playFl</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmLoopRecord">cmLoopRecord</a><span class="p">*</span>   <a name="cmDspLoopRecd_t.lrp"></a><span class="i">lrp</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspLoopRecdAlloc_defn"></a><a name="_cmDspLoopRecdAlloc"></a><span class="f">_cmDspLoopRecdAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> chs <span class="p">=</span> <span class="l">1</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quottime&quot</span><span class="p">,</span>  <a href="#kTimeLrId">kTimeLrId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMax record time in seconds&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotpgain&quot</span><span class="p">,</span> <a href="#kPGainLrId">kPGainLrId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotPass-through gain.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotrgain&quot</span><span class="p">,</span> <a href="#kRGainLrId">kRGainLrId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotRecorder out gain.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassLrId">kBypassLrId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                   <span class="l">&quotBypass flag&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotplay&quot</span><span class="p">,</span>  <a href="#kPlayLrId">kPlayLrId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                   <span class="l">&quotPlay gate flag&quot</span>  <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotrecd&quot</span><span class="p">,</span>  <a href="#kRecdLrId">kRecdLrId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                   <span class="l">&quotRecd gate flag&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotratio&quot</span><span class="p">,</span> <a href="#kRatioLrId">kRatioLrId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                 <span class="l">&quotPlayback speed ratio&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInLrId">kInLrId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutLrId">kOutLrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> chs<span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set default values for the parameters that were not explicitely set in the va_arg list</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTimeLrId">kTimeLrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   <span class="l">10</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kPGainLrId">kPGainLrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>  <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRGainLrId">kRGainLrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>  <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>     ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBypassLrId">kBypassLrId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>    <span class="l">0</span> <span class="p">)</span><span class="p">;</span> 
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>     ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kPlayLrId">kPlayLrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>    <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>     ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRecdLrId">kRecdLrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>    <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRatioLrId">kRatioLrId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>   <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>lrp   <span class="p">=</span> <a href="cmProc3_h_0.html#cmLoopRecordAlloc">cmLoopRecordAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span>   <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLoopRecdFree_defn"></a><a name="_cmDspLoopRecdFree"></a><span class="f">_cmDspLoopRecdFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmLoopRecordFree">cmLoopRecordFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>lrp<span class="p">)</span><span class="p">;</span>
  
  <span class="c">//<a href="cmProcObj_h_0.html#cmCtxFree">cmCtxFree</a>(&ampampp-&ampgtctx);</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLoopRecdReset_defn"></a><a name="_cmDspLoopRecdReset"></a><span class="f">_cmDspLoopRecdReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>   maxRecdTimeSecs  <span class="p">=</span>  <a href="cmDspClass_h_0.html#cmDspDefaultDouble">cmDspDefaultDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kTimeLrId">kTimeLrId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>   maxRecdTimeSmps  <span class="p">=</span> floor<span class="p">(</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">*</span> maxRecdTimeSecs<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>   xfadeTimeSmps    <span class="p">=</span> floor<span class="p">(</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">*</span> <span class="l">50.0</span><span class="p">/</span><span class="l">1000.0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> maxRecdTimeSmps <span class="p">!</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>lrp<span class="p">-</span><span class="p">&gt</span>maxRecdSmpCnt <span class="p">|</span><span class="p">|</span> xfadeTimeSmps <span class="p">!</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>lrp<span class="p">-</span><span class="p">&gt</span>xfadeSmpCnt <span class="p">)</span>
    <a href="cmProc3_h_0.html#cmLoopRecordInit">cmLoopRecordInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>lrp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span>maxRecdTimeSmps<span class="p">,</span>xfadeTimeSmps<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLoopRecdExec_defn"></a><a name="_cmDspLoopRecdExec"></a><span class="f">_cmDspLoopRecdExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInLrId">kInLrId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInLrId">kInLrId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>          oChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutLrId">kOutLrId</a><span class="p">,</span>oChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          oSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutLrId">kOutLrId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">bool</span>               recdFl   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kRecdLrId">kRecdLrId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">bool</span>               bypassFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassLrId">kBypassLrId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>             ratio    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kRatioLrId">kRatioLrId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">double</span>           rgain    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kRGainLrId">kRGainLrId</a><span class="p">)</span><span class="p">;</span> <span class="c"> // recorder output gain</span>
  <span class="k">double</span>           pgain    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kPGainLrId">kPGainLrId</a><span class="p">)</span><span class="p">;</span> <span class="c"> // pass through gain</span>
  
  <span class="k">if</span><span class="p">(</span> ip <span class="p">!</span><span class="p">=</span> NULL <span class="p">&amp</span><span class="p">&amp</span> op <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <a href="cmProc3_h_0.html#cmLoopRecordExec">cmLoopRecordExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>lrp<span class="p">,</span>ip<span class="p">,</span>op<span class="p">,</span><a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span>iSmpCnt<span class="p">,</span>oSmpCnt<span class="p">)</span><span class="p">,</span> bypassFl<span class="p">,</span> recdFl<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>playFl<span class="p">,</span> ratio<span class="p">,</span> pgain<span class="p">,</span> rgain <span class="p">)</span><span class="p">;</span>
  
  
  p<span class="p">-</span><span class="p">&gt</span>playFl <span class="p">=</span> false<span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLoopRecdRecv_defn"></a><a name="_cmDspLoopRecdRecv"></a><span class="f">_cmDspLoopRecdRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspLoopRecd_t">cmDspLoopRecd_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">switch</span><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kPlayLrId">kPlayLrId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>playFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kPlayLrId">kPlayLrId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmLoopRecdClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmLoopRecdClassCons">cmLoopRecdClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmLoopRecdDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotLoopRecd&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspLoopRecdAlloc">_cmDspLoopRecdAlloc</a><span class="p">,</span>
  <a href="#_cmDspLoopRecdFree">_cmDspLoopRecdFree</a><span class="p">,</span>
  <a href="#_cmDspLoopRecdReset">_cmDspLoopRecdReset</a><span class="p">,</span>
  <a href="#_cmDspLoopRecdExec">_cmDspLoopRecdExec</a><span class="p">,</span>
  <a href="#_cmDspLoopRecdRecv">_cmDspLoopRecdRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotLoop recorder.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmLoopRecdDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspRectify : Full-wave rectifier.</div><pre><a name="cmDspRectify"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassRcId"></a><span class="e">kBypassRcId</span><span class="p">,</span>
  <a name="kCoeffRcId"></a><span class="e">kCoeffRcId</span><span class="p">,</span>
  <span class="e"><a href="cmDspKr_c_0.html#kInRcId">kInRcId</a></span><span class="p">,</span>
  <span class="e"><a href="cmDspKr_c_0.html#kOutRcId">kOutRcId</a></span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmRectifyDC<span class="p">;</span>

<a name="cmDspRectify_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspRectify_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspRectify_t">cmDspRectify_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspRectifyAlloc_defn"></a><a name="_cmDspRectifyAlloc"></a><span class="f">_cmDspRectifyAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> chs <span class="p">=</span> <span class="l">1</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassRcId">kBypassRcId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotBypass enable flag.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotcoeff&quot</span><span class="p">,</span> <a href="#kCoeffRcId">kCoeffRcId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotCoefficient&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="cmDspKr_c_0.html#kInRcId">kInRcId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="cmDspKr_c_0.html#kOutRcId">kOutRcId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> chs<span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspRectify_t">cmDspRectify_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspRectify_t">cmDspRectify_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set default values for the parameters that were not explicitely set in the va_arg list</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBypassRcId">kBypassRcId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span>    <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kCoeffRcId">kCoeffRcId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRectifyFree_defn"></a><a name="_cmDspRectifyFree"></a><span class="f">_cmDspRectifyFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRectifyReset_defn"></a><a name="_cmDspRectifyReset"></a><span class="f">_cmDspRectifyReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRectifyExec_defn"></a><a name="_cmDspRectifyExec"></a><span class="f">_cmDspRectifyExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspKr_c_0.html#kInRcId">kInRcId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="cmDspKr_c_0.html#kInRcId">kInRcId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>          oChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspKr_c_0.html#kOutRcId">kOutRcId</a><span class="p">,</span>oChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          oSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="cmDspKr_c_0.html#kOutRcId">kOutRcId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">bool</span>              bypassFl<span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassRcId">kBypassRcId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          n       <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span>iSmpCnt<span class="p">,</span>oSmpCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>          i<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> bypassFl <span class="p">)</span>
    memcpy<span class="p">(</span>op<span class="p">,</span>ip<span class="p">,</span>n<span class="p">*</span><span class="k">sizeof</span><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
  <span class="p">{</span>    
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>n<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      op<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> ip<span class="p">[</span>i<span class="p">]</span> <span class="p">&gt</span> <span class="l">0</span> <span class="p">?</span> ip<span class="p">[</span>i<span class="p">]</span> <span class="p">:</span> <span class="l">0</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRectifyRecv_defn"></a><a name="_cmDspRectifyRecv"></a><span class="f">_cmDspRectifyRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmRectifyClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmRectifyClassCons">cmRectifyClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmRectifyDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotRectify&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspRectifyAlloc">_cmDspRectifyAlloc</a><span class="p">,</span>
  <a href="#_cmDspRectifyFree">_cmDspRectifyFree</a><span class="p">,</span>
  <a href="#_cmDspRectifyReset">_cmDspRectifyReset</a><span class="p">,</span>
  <a href="#_cmDspRectifyExec">_cmDspRectifyExec</a><span class="p">,</span>
  <a href="#_cmDspRectifyRecv">_cmDspRectifyRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotHalf-wave rectifier.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmRectifyDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspGateDetect : Track the onset and offset of an incoming signal.</div><pre><a name="cmDspGateDetect"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kWndMsGdId"></a><span class="e">kWndMsGdId</span><span class="p">,</span>
  <a name="kOnThreshPctGdId"></a><span class="e">kOnThreshPctGdId</span><span class="p">,</span>
  <a name="kOnThreshDbGdId"></a><span class="e">kOnThreshDbGdId</span><span class="p">,</span>
  <a name="kOffThreshDbGdId"></a><span class="e">kOffThreshDbGdId</span><span class="p">,</span>
  <a name="kInGdId"></a><span class="e">kInGdId</span><span class="p">,</span>
  <a name="kGateGdId"></a><span class="e">kGateGdId</span><span class="p">,</span>
  <a name="kRmsGdId"></a><span class="e">kRmsGdId</span><span class="p">,</span>
  <a name="kMeanGdId"></a><span class="e">kMeanGdId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmGateDetectDC<span class="p">;</span>

<a name="cmDspGateDetect_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspGateDetect_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="c">//<a href="cmProcObj_h_0.html#cmCtx">cmCtx</a>*        ctx;</span>
  <a href="cmProc_h_0.html#cmShiftBuf">cmShiftBuf</a><span class="p">*</span>   <a name="cmDspGateDetect_t.sbp"></a><span class="i">sbp</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmGateDetect">cmGateDetect</a><span class="p">*</span> <a name="cmDspGateDetect_t.gdp"></a><span class="i">gdp</span><span class="p">;</span>
  
  
<span class="p">}</span> <span class="t"><a href="#cmDspGateDetect_t">cmDspGateDetect_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspGateDetectAlloc_defn"></a><a name="_cmDspGateDetectAlloc"></a><span class="f">_cmDspGateDetectAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotwnd&quot</span><span class="p">,</span>   <a href="#kWndMsGdId">kWndMsGdId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotWindow length in milliseconds.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotonpct&quot</span><span class="p">,</span> <a href="#kOnThreshPctGdId">kOnThreshPctGdId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotOnset slope threshold [0.0 - 1.0].&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotondb&quot</span><span class="p">,</span>  <a href="#kOnThreshDbGdId">kOnThreshDbGdId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotOnset threshold dB [-Inf to 0]&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoffdb&quot</span><span class="p">,</span> <a href="#kOffThreshDbGdId">kOffThreshDbGdId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotOffset threshold dB [-Inf to 0]&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInGdId">kInGdId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>                 <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgate&quot</span><span class="p">,</span>  <a href="#kGateGdId">kGateGdId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                     <span class="l">&quotGate state output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotrms&quot</span><span class="p">,</span>   <a href="#kRmsGdId">kRmsGdId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                   <span class="l">&quotSignal level RMS&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmean&quot</span><span class="p">,</span>  <a href="#kMeanGdId">kMeanGdId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                   <span class="l">&quotDerr mean.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>sbp   <span class="p">=</span> <a href="cmProc_h_0.html#cmShiftBufAlloc">cmShiftBufAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gdp   <span class="p">=</span> <a href="cmProc3_h_0.html#cmGateDetectAlloc">cmGateDetectAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set default values for the parameters that were not explicitely set in the va_arg list</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kWndMsGdId">kWndMsGdId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span>    <span class="l">42</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOnThreshPctGdId">kOnThreshPctGdId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>    <span class="l">0.8</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOnThreshDbGdId">kOnThreshDbGdId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <span class="l">-30.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOffThreshDbGdId">kOffThreshDbGdId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">-60.0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGateDetectFree_defn"></a><a name="_cmDspGateDetectFree"></a><span class="f">_cmDspGateDetectFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmGateDetectFree">cmGateDetectFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">)</span><span class="p">;</span>
  <a href="cmProc_h_0.html#cmShiftBufFree">cmShiftBufFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">)</span><span class="p">;</span>
  <span class="c">//<a href="cmProcObj_h_0.html#cmCtxFree">cmCtxFree</a>(&ampampp-&ampgtctx);</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGateDetectReset_defn"></a><a name="_cmDspGateDetectReset"></a><span class="f">_cmDspGateDetectReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">double</span>   wndMs     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kWndMsGdId">kWndMsGdId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>   sr        <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> wndSmpCnt <span class="p">=</span> floor<span class="p">(</span>wndMs <span class="p">*</span> sr <span class="p">/</span> <span class="l">1000.0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmProc_h_0.html#cmShiftBufInit">cmShiftBufInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> wndSmpCnt<span class="p">,</span> wndSmpCnt<span class="p">/</span><span class="l">4</span> <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInstResetFailDspRC">kInstResetFailDspRC</a><span class="p">,</span><span class="l">&quotThe gate detector shift buffer initialization failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmProc3_h_0.html#cmGateDetectInit">cmGateDetectInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOnThreshPctGdId">kOnThreshPctGdId</a><span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOnThreshDbGdId">kOnThreshDbGdId</a><span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOffThreshDbGdId">kOffThreshDbGdId</a><span class="p">)</span> <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInstResetFailDspRC">kInstResetFailDspRC</a><span class="p">,</span><span class="l">&quotThe gate detector shift buffer initialization failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGateDetectExec_defn"></a><a name="_cmDspGateDetectExec"></a><span class="f">_cmDspGateDetectExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspGateDetect_t">cmDspGateDetect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInGdId">kInGdId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInGdId">kInGdId</a><span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">while</span><span class="p">(</span> <a href="cmProc_h_0.html#cmShiftBufExec">cmShiftBufExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">,</span> ip<span class="p">,</span> iSmpCnt <span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmProc3_h_0.html#cmGateDetectExec">cmGateDetectExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>outV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>outN <span class="p">)</span><span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kRmsGdId">kRmsGdId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>rms<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kMeanGdId">kMeanGdId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>mean<span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>deltaFl <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>  ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kGateGdId">kGateGdId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>gateFl<span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGateDetectRecv_defn"></a><a name="_cmDspGateDetectRecv"></a><span class="f">_cmDspGateDetectRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kWndMsGdId">kWndMsGdId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <a href="#kOnThreshPctGdId">kOnThreshPctGdId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <a href="#kOnThreshDbGdId">kOnThreshDbGdId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <a href="#kOffThreshDbGdId">kOffThreshDbGdId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <a href="#kInGdId">kInGdId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmGateDetectClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmGateDetectClassCons">cmGateDetectClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmGateDetectDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotGateDetect&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspGateDetectAlloc">_cmDspGateDetectAlloc</a><span class="p">,</span>
  <a href="#_cmDspGateDetectFree">_cmDspGateDetectFree</a><span class="p">,</span>
  <a href="#_cmDspGateDetectReset">_cmDspGateDetectReset</a><span class="p">,</span>
  <a href="#_cmDspGateDetectExec">_cmDspGateDetectExec</a><span class="p">,</span>
  <a href="#_cmDspGateDetectRecv">_cmDspGateDetectRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotGate detector.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmGateDetectDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAutoGain : Normalize a set of audio input signals to acheive a consistent level.</div><pre><a name="cmDspAutoGain"></a><span class="c">// The purpose of this object is to calculate, store and retrieve gain coefficents
// for a set of audio channels.  The gain coefficients are designed to balance the
// volume of each channel relative to the others.  During gain calibration
// a sample of each channel is taken and it's average volume is determined.  
// After an example of all channels has been received a new set of gain coefficients
// is calculated which decreases the volume of loud channels and increases the
// volume of quiet channels.
//
//  The gain coefficents are made available via a set of 'gain-###' output ports.
//
//  This object acts as an interface to the <a href="cmProc3_h_0.html#cmAutoGain">cmAutoGain</a> processor.  
//
//  As input it takes a channel configuration JSON file of the form:
//  {
//    ch_array : 
//    [ [&ampquotch&ampquot,&ampquotssi&ampquot,&ampquotpitch&ampquot,&ampquotmidi&ampquot,&ampquotgain&ampquot]
//      [ 0,    0,    &ampquotC4&ampquot,   60,    1.0 ]
//               ....
//      [ n     0,    &ampquotC5&ampquot,   72,    1.0 ]
//    ] 
//  }      
//
//  Each array in 'ch_array' gives the configuration of a channel.
//  
//
//  It also requires a JSON resource object of the form
//    gdParms: 
//    {
//      medCnt: 5                   
//      avgCnt: 9       
//      suprCnt: 6       
//      offCnt: 3       
//      suprCoeff: 1.400000       
//      onThreshDb: -53.000000       
//      offThreshDb: -80.000000       
//    }    
//
//    These arguments are used to configure the <a href="cmProc3_h_0.html#cmAutoGain">cmAutoGain</a> Proessor gate detector function.
//
//  During runtime the object accepts the following action selector symbol id's:
//    a. start  - begin a new calibration  session 
//    b. proc   - end a calibration session and calculate new gain coeff's
//    c. cancel - cancel a calibration session   
//    d. write  - write the channel configuration file 
//    e. <a href="cmMain_c_0.html#print">print</a>  - <a href="cmMain_c_0.html#print">print</a> the current auto gain calibration state
//
//  After a 'start' msg the object accepts channel id's throught its 'id' input port.
//  Each 'id' identifies the channel which it will process next.
//  Upon reception of a channel id the object routes subsequent audio to its
//  internal <a href="cmProc3_h_0.html#cmAutoGain">cmAutoGain</a> processor until it receives the next channel id 
//  or a 'proc' or 'cancel' symbol.</span>


<span class="c"><hr id="hr2"></span> <span class="k">enum</span>
<span class="p">{</span>
  <a name="kChCntAgId"></a><span class="e">kChCntAgId</span><span class="p">,</span>
  <a name="kHopAgId"></a><span class="e">kHopAgId</span><span class="p">,</span>
  <a name="kMedNAgId"></a><span class="e">kMedNAgId</span><span class="p">,</span>
  <a name="kAvgNAgId"></a><span class="e">kAvgNAgId</span><span class="p">,</span>
  <a name="kSupNAgId"></a><span class="e">kSupNAgId</span><span class="p">,</span>
  <a name="kOffNAgId"></a><span class="e">kOffNAgId</span><span class="p">,</span>
  <a name="kSupCoefAgId"></a><span class="e">kSupCoefAgId</span><span class="p">,</span>
  <a name="kOnThrAgId"></a><span class="e">kOnThrAgId</span><span class="p">,</span>
  <a name="kOffThrAgId"></a><span class="e">kOffThrAgId</span><span class="p">,</span>
  <a name="kSelAgId"></a><span class="e">kSelAgId</span><span class="p">,</span>
  <a name="kIdAgId"></a><span class="e">kIdAgId</span><span class="p">,</span>
  <a name="kInBaseAgId"></a><span class="e">kInBaseAgId</span>
<span class="p">}</span><span class="p">;</span>

<a name="cmDspAutoGain_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>        <a name="cmDspAutoGain_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmAutoGain">cmAutoGain</a><span class="p">*</span>        <a name="cmDspAutoGain_t.agp"></a><span class="i">agp</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.gainBaseAgId"></a><span class="i">gainBaseAgId</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.chCnt"></a><span class="i">chCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.chIdx"></a><span class="i">chIdx</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.startSymId"></a><span class="i">startSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.procSymId"></a><span class="i">procSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.cancelSymId"></a><span class="i">cancelSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.writeSymId"></a><span class="i">writeSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>           <a name="cmDspAutoGain_t.printSymId"></a><span class="i">printSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAutoGain_t">cmDspAutoGain_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAutoGainDC<span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAutoGainAlloc_defn"></a><a name="_cmDspAutoGainAlloc"></a><span class="f">_cmDspAutoGainAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotchCnt&quot</span><span class="p">,</span><a href="#kChCntAgId">kChCntAgId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotAudio channel count.&quot</span><span class="p">}</span><span class="p">,</span>  
    <span class="p">{</span> <span class="l">&quothop&quot</span><span class="p">,</span>  <a href="#kHopAgId">kHopAgId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotRMS hop in milliseconds.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmed&quot</span><span class="p">,</span>  <a href="#kMedNAgId">kMedNAgId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotMedian filter hop count.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotavg&quot</span><span class="p">,</span>  <a href="#kAvgNAgId">kAvgNAgId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotAverage filter hop count.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsup&quot</span><span class="p">,</span>  <a href="#kSupNAgId">kSupNAgId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotSupression filter hop count.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoff&quot</span><span class="p">,</span>  <a href="#kOffNAgId">kOffNAgId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotOffset filter hop count.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsupC&quot</span><span class="p">,</span> <a href="#kSupCoefAgId">kSupCoefAgId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotSuppression coefficent.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotonThr&quot</span><span class="p">,</span><a href="#kOnThrAgId">kOnThrAgId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotOnset threshold in dB.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoffThr&quot</span><span class="p">,</span><a href="#kOffThrAgId">kOffThrAgId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotOffset threshold in dB.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsel&quot</span><span class="p">,</span>  <a href="#kSelAgId">kSelAgId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kNoArgDsvFl">kNoArgDsvFl</a><span class="p">,</span>  <span class="l">&quotAction Selector: start | proc | cancel.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotid&quot</span><span class="p">,</span>   <a href="#kIdAgId">kIdAgId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kNoArgDsvFl">kNoArgDsvFl</a><span class="p">,</span>  <span class="l">&quotChannel id input.&quot</span><span class="p">}</span><span class="p">,</span>
  <span class="p">}</span><span class="p">;</span>
  
  va_list             vl1<span class="p">;</span>
  <span class="k">unsigned</span>            i<span class="p">;</span>
  
  
  <span class="c">// verify that at least one var arg exists</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe AutoGain constructor must be given the audio channel count as its first argument.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>    
  <span class="c">// copy the va_list so that it can be used again in <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a>()</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// get the first var arg which should be a filename</span>
  <span class="k">unsigned</span> chCnt <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">unsigned</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> chCnt <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe AutoGain constructor requires at least 1 audio channel.&quot</span><span class="p">)</span><span class="p">;</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">unsigned</span> fixArgCnt    <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> argCnt       <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="l">2</span> <span class="p">*</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> gainBaseAgId <span class="p">=</span> <a href="#kInBaseAgId">kInBaseAgId</a> <span class="p">+</span> chCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  
  assert<span class="p">(</span> fixArgCnt <span class="p">=</span><span class="p">=</span> <a href="#kInBaseAgId">kInBaseAgId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// setup the output gain args </span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>       a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kInBaseAgId">kInBaseAgId</a><span class="p">,</span>  chCnt<span class="p">,</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInBaseAgId">kInBaseAgId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotaudio in&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> gainBaseAgId<span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgain&quot</span><span class="p">,</span> gainBaseAgId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>   <span class="l">&quotcalibrated channel gain&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span>  a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <span class="c">// instantiate the object</span>
  <a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// assign the current gain coefficients</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> gainBaseAgId <span class="p">+</span> i<span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  
  
  <span class="c">// allocate the auto gain calculation proc</span>
  p<span class="p">-</span><span class="p">&gt</span>agp         <span class="p">=</span> <a href="cmProc3_h_0.html#cmAutoGainAlloc">cmAutoGainAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span>NULL<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chCnt       <span class="p">=</span> chCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chIdx       <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gainBaseAgId<span class="p">=</span> gainBaseAgId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>startSymId  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotstart&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>procSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotproc&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>cancelSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotcancel&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>printSymId  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotprint&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSelAgId">kSelAgId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>cancelSymId <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultInt">cmDspSetDefaultInt</a><span class="p">(</span>    ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kIdAgId">kIdAgId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAutoGainFree_defn"></a><a name="_cmDspAutoGainFree"></a><span class="f">_cmDspAutoGainFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmAutoGainFree">cmAutoGainFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>agp<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAutoGainReset_defn"></a><a name="_cmDspAutoGainReset"></a><span class="f">_cmDspAutoGainReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAutoGainExec_defn"></a><a name="_cmDspAutoGainExec"></a><span class="f">_cmDspAutoGainExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">unsigned</span> curInChIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kIdAgId">kIdAgId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kSelAgId">kSelAgId</a> <span class="p">)</span> <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>startSymId <span class="p">&amp</span><span class="p">&amp</span> curInChIdx <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span>          inChVarId  <span class="p">=</span> <a href="#kInBaseAgId">kInBaseAgId</a><span class="p">+</span>curInChIdx<span class="p">;</span>
    <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>inChVarId<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span>inChVarId<span class="p">)</span><span class="p">;</span>
    
    <a href="cmProc3_h_0.html#cmAutoGainProcCh">cmAutoGainProcCh</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>agp<span class="p">,</span> ip<span class="p">,</span> iSmpCnt <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAutoGainInit_defn"></a><a name="_cmDspAutoGainInit"></a><span class="f">_cmDspAutoGainInit</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>  
  <a href="cmProc3_h_0.html#cmGateDetectParams">cmGateDetectParams</a> gd<span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  
  <span class="c">// collect the params into a <a href="cmProc3_h_0.html#cmGateDetectParams">cmGateDetectParams</a> recd</span>
  gd<span class="p">.</span>medCnt      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kMedNAgId">kMedNAgId</a> <span class="p">)</span><span class="p">;</span>
  gd<span class="p">.</span>avgCnt      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kAvgNAgId">kAvgNAgId</a> <span class="p">)</span><span class="p">;</span>
  gd<span class="p">.</span>suprCnt     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kSupNAgId">kSupNAgId</a> <span class="p">)</span><span class="p">;</span>
  gd<span class="p">.</span>offCnt      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kOffNAgId">kOffNAgId</a> <span class="p">)</span><span class="p">;</span>
  gd<span class="p">.</span>suprCoeff   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kSupCoefAgId">kSupCoefAgId</a> <span class="p">)</span><span class="p">;</span>
  gd<span class="p">.</span>onThreshDb  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kOnThrAgId">kOnThrAgId</a> <span class="p">)</span><span class="p">;</span>
  gd<span class="p">.</span>offThreshDb <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kOffThrAgId">kOffThrAgId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// setup the internal auto-gain object</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmProc3_h_0.html#cmAutoGainInit">cmAutoGainInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>agp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kHopAgId">kHopAgId</a><span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">,</span> <span class="p">&amp</span>gd <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kSubSysFailDspRC">kSubSysFailDspRC</a><span class="p">,</span><span class="l">&quotThe internal auto-gain instance could not be initialized.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// send out gain's of 1.0 so that the input audio is not 
  // biased by any existing scaling.</span>  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>gainBaseAgId<span class="p">+</span>i<span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAutoGainRecv_defn"></a><a name="_cmDspAutoGainRecv"></a><span class="f">_cmDspAutoGainRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAutoGain_t">cmDspAutoGain_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>          rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kSelAgId">kSelAgId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="c">// store the current 'sel' state</span>
      <span class="k">unsigned</span> prvSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSelAgId">kSelAgId</a><span class="p">)</span><span class="p">;</span>
      
      <span class="c">// update it 'sel' to the new state</span>
      <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// get the new state</span>
      <span class="k">unsigned</span> newSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSelAgId">kSelAgId</a><span class="p">)</span><span class="p">;</span>
      
      <span class="c">//
      // if PRINTing was requested
      //</span>      
      <span class="k">if</span><span class="p">(</span> newSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>printSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotAuto-Gain Report\n&quot</span><span class="p">)</span><span class="p">;</span>
        <a href="cmProc3_h_0.html#cmAutoGainPrint">cmAutoGainPrint</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>agp<span class="p">,</span> <span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt <span class="p">)</span><span class="p">;</span>
        goto doneLabel<span class="p">;</span>
      <span class="p">}</span>
      
      
      <span class="c">//
      // if calibration was CANCELLED
      //</span>      
      <span class="k">if</span><span class="p">(</span> newSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>cancelSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="cmDspClass_h_0.html#cmDspSetInt">cmDspSetInt</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kIdAgId">kIdAgId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotcancelled\n&quot</span><span class="p">)</span><span class="p">;</span>
        goto doneLabel<span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c">//
      // if calibration STARTup was requested - initialize the autogain proc 
      //</span>      
      <span class="k">if</span><span class="p">(</span> newSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>startSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="#_cmDspAutoGainInit">_cmDspAutoGainInit</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotstarted\n&quot</span><span class="p">)</span><span class="p">;</span>
        goto doneLabel<span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c">//
      // if calibration PROCessing was requested
      //</span>      
      <span class="k">if</span><span class="p">(</span> newSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>procSymId <span class="p">&amp</span><span class="p">&amp</span> prvSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>startSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotproc\n&quot</span><span class="p">)</span><span class="p">;</span>
        
        <span class="c">// set the current channel id to '<a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a>' to stop calls to 
        // <a href="cmProc3_h_0.html#cmAutoGainProcCh">cmAutoGainProcCh</a>() in <a href="#_cmDspAutoGainExec">_cmDspAutoGainExec</a>()</span>        
        <a href="cmDspClass_h_0.html#cmDspSetInt">cmDspSetInt</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kIdAgId">kIdAgId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
        
        <span class="c">// update the auto gain coefficients</span>
        <span class="k">if</span><span class="p">(</span> <a href="cmProc3_h_0.html#cmAutoGainCalcGains">cmAutoGainCalcGains</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>agp<span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
        <span class="p">{</span>
          <span class="c">// send the new auto gain coefficients to the output ports</span>
          <span class="k">unsigned</span> i<span class="p">;</span>
          <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
            <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>gainBaseAgId<span class="p">+</span>i<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>agp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>gain<span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
        
        goto doneLabel<span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kIdAgId">kIdAgId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSelAgId">kSelAgId</a><span class="p">)</span> <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>startSymId <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotid:%i\n&quot</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kIdAgId">kIdAgId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <a href="cmProc3_h_0.html#cmAutoGainStartCh">cmAutoGainStartCh</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>agp<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kIdAgId">kIdAgId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  
  doneLabel<span class="p">:</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmAutoGainClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmAutoGainClassCons">cmAutoGainClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAutoGainDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAutoGain&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAutoGainAlloc">_cmDspAutoGainAlloc</a><span class="p">,</span>
  <a href="#_cmDspAutoGainFree">_cmDspAutoGainFree</a><span class="p">,</span>
  <a href="#_cmDspAutoGainReset">_cmDspAutoGainReset</a><span class="p">,</span>
  <a href="#_cmDspAutoGainExec">_cmDspAutoGainExec</a><span class="p">,</span>
  <a href="#_cmDspAutoGainRecv">_cmDspAutoGainRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAuto-gain calibrator.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAutoGainDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspEnvFollow : Generate a control signal from by analyzing the power envelope of an incoming audio signal.</div><pre><a name="cmDspEnvFollow"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kHopMsEfId"></a><span class="e">kHopMsEfId</span><span class="p">,</span>     <span class="c"> // RMS window length in milliseconds</span>
  <a name="kMedCntEfId"></a><span class="e">kMedCntEfId</span><span class="p">,</span>    <span class="c"> </span>
  <a name="kAvgCntEfId"></a><span class="e">kAvgCntEfId</span><span class="p">,</span>    <span class="c"> </span>
  <a name="kSuprCntEfId"></a><span class="e">kSuprCntEfId</span><span class="p">,</span>   <span class="c"> </span>
  <a name="kOffCntEfId"></a><span class="e">kOffCntEfId</span><span class="p">,</span>    <span class="c"> </span>
  <a name="kSuprCoefEfId"></a><span class="e">kSuprCoefEfId</span><span class="p">,</span> <span class="c"> </span>
  <a name="kOnThrDbEfId"></a><span class="e">kOnThrDbEfId</span><span class="p">,</span>   <span class="c"> </span>
  <a name="kOffThrDbEfId"></a><span class="e">kOffThrDbEfId</span><span class="p">,</span>  <span class="c"> </span>
  <a name="kMaxDbEfId"></a><span class="e">kMaxDbEfId</span><span class="p">,</span>
  <a name="kInEfId"></a><span class="e">kInEfId</span><span class="p">,</span>     
  <a name="kGateEfId"></a><span class="e">kGateEfId</span><span class="p">,</span>
  <a name="kRmsEfId"></a><span class="e">kRmsEfId</span><span class="p">,</span>
  <a name="kLevelEfId"></a><span class="e">kLevelEfId</span><span class="p">,</span>
  <a name="kOnEfId"></a><span class="e">kOnEfId</span><span class="p">,</span>
  <a name="kOffEfId"></a><span class="e">kOffEfId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmEnvFollowDC<span class="p">;</span>

<a name="cmDspEnvFollow_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspEnvFollow_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc_h_0.html#cmShiftBuf">cmShiftBuf</a><span class="p">*</span>    <a name="cmDspEnvFollow_t.sbp"></a><span class="i">sbp</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmGateDetect2">cmGateDetect2</a><span class="p">*</span> <a name="cmDspEnvFollow_t.gdp"></a><span class="i">gdp</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspEnvFollowAlloc_defn"></a><a name="_cmDspEnvFollowAlloc"></a><span class="f">_cmDspEnvFollowAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotwnd&quot</span><span class="p">,</span>   <a href="#kHopMsEfId">kHopMsEfId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotRMS Window length&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmed&quot</span><span class="p">,</span>   <a href="#kMedCntEfId">kMedCntEfId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMedian filter length.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotavg&quot</span><span class="p">,</span>   <a href="#kAvgCntEfId">kAvgCntEfId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotAveraging filter length.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsup&quot</span><span class="p">,</span>   <a href="#kSuprCntEfId">kSuprCntEfId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotSupression filter length.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoff&quot</span><span class="p">,</span>   <a href="#kOffCntEfId">kOffCntEfId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotOffset detection window length&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsupc&quot</span><span class="p">,</span>  <a href="#kSuprCoefEfId">kSuprCoefEfId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotSuppression shape coefficient&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotondb&quot</span><span class="p">,</span>  <a href="#kOnThrDbEfId">kOnThrDbEfId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotOnset threshold dB.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoffdb&quot</span><span class="p">,</span> <a href="#kOffThrDbEfId">kOffThrDbEfId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotOffset threshold dB&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmaxdb&quot</span><span class="p">,</span> <a href="#kMaxDbEfId">kMaxDbEfId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMax reference dB&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInEfId">kInEfId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>                 <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgate&quot</span><span class="p">,</span>  <a href="#kGateEfId">kGateEfId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                     <span class="l">&quotGate state output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotrms&quot</span><span class="p">,</span>   <a href="#kRmsEfId">kRmsEfId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                   <span class="l">&quotSignal level RMS&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotlevel&quot</span><span class="p">,</span> <a href="#kLevelEfId">kLevelEfId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                   <span class="l">&quotSignal level 0.0-1.0 as scale between offset thresh dB and max dB&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotons&quot</span><span class="p">,</span>   <a href="#kOnEfId">kOnEfId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                     <span class="l">&quotOnset counter&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoffs&quot</span><span class="p">,</span>  <a href="#kOffEfId">kOffEfId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                     <span class="l">&quotOffset counter&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>sbp   <span class="p">=</span> <a href="cmProc_h_0.html#cmShiftBufAlloc">cmShiftBufAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gdp   <span class="p">=</span> <a href="cmProc3_h_0.html#cmGateDetectAlloc2">cmGateDetectAlloc2</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span>NULL<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set default values for the parameters that were not explicitely set in the va_arg list</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kHopMsEfId">kHopMsEfId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span>     <span class="l">12</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMedCntEfId">kMedCntEfId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span>      <span class="l">5</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAvgCntEfId">kAvgCntEfId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span>      <span class="l">9</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSuprCntEfId">kSuprCntEfId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span>      <span class="l">6</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOffCntEfId">kOffCntEfId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span>      <span class="l">3</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSuprCoefEfId">kSuprCoefEfId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>    <span class="l">1.4</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOnThrDbEfId">kOnThrDbEfId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span>    <span class="l">-45</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOffThrDbEfId">kOffThrDbEfId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>    <span class="l">-80</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxDbEfId">kMaxDbEfId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span>    <span class="l">-10.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOnEfId">kOnEfId</a><span class="p">,</span>          <span class="l">0</span><span class="p">,</span>      <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOffEfId">kOffEfId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span>      <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspEnvFollowFree_defn"></a><a name="_cmDspEnvFollowFree"></a><span class="f">_cmDspEnvFollowFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmGateDetectFree2">cmGateDetectFree2</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">)</span><span class="p">;</span>
  <a href="cmProc_h_0.html#cmShiftBufFree">cmShiftBufFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspEnvFollowReset_defn"></a><a name="_cmDspEnvFollowReset"></a><span class="f">_cmDspEnvFollowReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmGateDetectParams">cmGateDetectParams</a> r<span class="p">;</span>
  r<span class="p">.</span>medCnt      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kMedCntEfId">kMedCntEfId</a> <span class="p">)</span><span class="p">;</span>
  r<span class="p">.</span>avgCnt      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kAvgCntEfId">kAvgCntEfId</a> <span class="p">)</span><span class="p">;</span>
  r<span class="p">.</span>suprCnt     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kSuprCntEfId">kSuprCntEfId</a> <span class="p">)</span><span class="p">;</span>
  r<span class="p">.</span>offCnt      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kOffCntEfId">kOffCntEfId</a> <span class="p">)</span><span class="p">;</span>
  r<span class="p">.</span>suprCoeff   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kSuprCoefEfId">kSuprCoefEfId</a> <span class="p">)</span><span class="p">;</span>
  r<span class="p">.</span>onThreshDb  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kOnThrDbEfId">kOnThrDbEfId</a> <span class="p">)</span><span class="p">;</span>
  r<span class="p">.</span>offThreshDb <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kOffThrDbEfId">kOffThrDbEfId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">double</span>   sr        <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>   hopSmpCnt <span class="p">=</span> floor<span class="p">(</span>sr <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kHopMsEfId">kHopMsEfId</a><span class="p">)</span> <span class="p">/</span> <span class="l">1000</span> <span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> wndSmpCnt <span class="p">=</span> floor<span class="p">(</span>r<span class="p">.</span>medCnt <span class="p">*</span> hopSmpCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmProc_h_0.html#cmShiftBufInit">cmShiftBufInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> wndSmpCnt<span class="p">,</span> hopSmpCnt <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInstResetFailDspRC">kInstResetFailDspRC</a><span class="p">,</span><span class="l">&quotThe gate detector shift buffer initialization failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmProc3_h_0.html#cmGateDetectInit2">cmGateDetectInit2</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <span class="p">&amp</span>r <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInstResetFailDspRC">kInstResetFailDspRC</a><span class="p">,</span><span class="l">&quotThe gate detector shift buffer initialization failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspEnvFollowExec_defn"></a><a name="_cmDspEnvFollowExec"></a><span class="f">_cmDspEnvFollowExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span> p       <span class="p">=</span> <span class="p">(</span><a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInEfId">kInEfId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInEfId">kInEfId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            maxDb   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMaxDbEfId">kMaxDbEfId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            offDb   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOffThrDbEfId">kOffThrDbEfId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">while</span><span class="p">(</span> <a href="cmProc_h_0.html#cmShiftBufExec">cmShiftBufExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">,</span> ip<span class="p">,</span> iSmpCnt <span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmProc3_h_0.html#cmGateDetectExec2">cmGateDetectExec2</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>outV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>outN <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// RMS is going out at the audio rate - maybe there should be an option
    // to send it only when the gate changes - this could significantly 
    // cut down on unnecessary transmission if the RMS is only used 
    // when the gate changes</span>    
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kRmsEfId">kRmsEfId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>rms <span class="p">)</span><span class="p">;</span>
    
    <span class="k">double</span> rmsDb <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>rms <span class="p">&lt</span>  <span class="l">0.00001</span> <span class="p">?</span> <span class="l">-100.0</span> <span class="p">:</span> <span class="l">20.0</span> <span class="p">*</span> log10<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>rms<span class="p">)</span><span class="p">;</span>
    <span class="k">double</span> level <span class="p">=</span> maxDb       <span class="p">&lt</span><span class="p">=</span> offDb   <span class="p">?</span>      <span class="l">0</span> <span class="p">:</span> fabs<span class="p">(</span><span class="p">(</span>offDb <span class="p">-</span> <a href="cmGlobal_h_0.html#cmMax">cmMax</a><span class="p">(</span> offDb<span class="p">,</span> <a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span> maxDb<span class="p">,</span> rmsDb <span class="p">)</span><span class="p">)</span><span class="p">)</span> <span class="p">/</span> <span class="p">(</span>maxDb <span class="p">-</span> offDb<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kLevelEfId">kLevelEfId</a><span class="p">,</span> level <span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>offFl <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kGateEfId">kGateEfId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>gateFl<span class="p">)</span><span class="p">;</span>    
      
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOnEfId">kOnEfId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOnEfId">kOnEfId</a><span class="p">)</span> <span class="p">+</span> <span class="l">1</span> <span class="p">)</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">-</span><span class="p">&gt</span>offFl <span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOffEfId">kOffEfId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOffEfId">kOffEfId</a><span class="p">)</span> <span class="p">+</span> <span class="l">1</span> <span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspEnvFollowRecv_defn"></a><a name="_cmDspEnvFollowRecv"></a><span class="f">_cmDspEnvFollowRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  <a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspEnvFollow_t">cmDspEnvFollow_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kOnThrDbEfId">kOnThrDbEfId</a><span class="p">:</span>
      <a href="cmProc3_h_0.html#cmGateDetectSetOnThreshDb2">cmGateDetectSetOnThreshDb2</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOnThrDbEfId">kOnThrDbEfId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kOffThrDbEfId">kOffThrDbEfId</a><span class="p">:</span>
      <a href="cmProc3_h_0.html#cmGateDetectSetOffThreshDb2">cmGateDetectSetOffThreshDb2</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gdp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOffThrDbEfId">kOffThrDbEfId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmEnvFollowClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmEnvFollowClassCons">cmEnvFollowClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmEnvFollowDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotEnvFollow&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspEnvFollowAlloc">_cmDspEnvFollowAlloc</a><span class="p">,</span>
  <a href="#_cmDspEnvFollowFree">_cmDspEnvFollowFree</a><span class="p">,</span>
  <a href="#_cmDspEnvFollowReset">_cmDspEnvFollowReset</a><span class="p">,</span>
  <a href="#_cmDspEnvFollowExec">_cmDspEnvFollowExec</a><span class="p">,</span>
  <a href="#_cmDspEnvFollowRecv">_cmDspEnvFollowRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotEnvelope follower and gate detector.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmEnvFollowDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspXfader : Gate controlled fader bank.</div><pre><a name="cmDspXfader"></a><span class="c">// Fade in and out an arbitrary number of audio signals based on gate signals.
// When the gate is high the signal fades in and when the gate is low the signal fades out.
// Constructor Args:
//    Required: Count of input and output channels.
//    Optional: Fade time in milliseconds.
//
// Inputs:
//    bool   Control gates
//    audio  Input audio.
// Outputs:
//    audio  Output audio
//    double Channel gains.</span>

<span class="k">enum</span>
<span class="p">{</span>
  <a name="kChCntXfId"></a><span class="e">kChCntXfId</span><span class="p">,</span>
  <a name="kFadeTimeMsXfId"></a><span class="e">kFadeTimeMsXfId</span><span class="p">,</span>
  <a name="kMstrGateXfId"></a><span class="e">kMstrGateXfId</span><span class="p">,</span>
  <a name="kFadeInTimeMsXfId"></a><span class="e">kFadeInTimeMsXfId</span><span class="p">,</span>
  <a name="kFadeOutTimeMsXfId"></a><span class="e">kFadeOutTimeMsXfId</span><span class="p">,</span>
  <a name="kResetXfId"></a><span class="e">kResetXfId</span><span class="p">,</span>
  <a name="kOnXfId"></a><span class="e">kOnXfId</span><span class="p">,</span>
  <a name="kOffXfId"></a><span class="e">kOffXfId</span><span class="p">,</span>
  <a name="kGateBaseXfId"></a><span class="e">kGateBaseXfId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmXfaderDC<span class="p">;</span>

<a name="cmDspXfader_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspXfader_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmXfader">cmXfader</a><span class="p">*</span>    <a name="cmDspXfader_t.xfdp"></a><span class="i">xfdp</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspXfader_t.inBaseXfId"></a><span class="i">inBaseXfId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspXfader_t.outBaseXfId"></a><span class="i">outBaseXfId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspXfader_t.stateBaseXfId"></a><span class="i">stateBaseXfId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspXfader_t.gainBaseXfId"></a><span class="i">gainBaseXfId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspXfader_t.chCnt"></a><span class="i">chCnt</span><span class="p">;</span>
  <span class="k">bool</span><span class="p">*</span>        <a name="cmDspXfader_t.chGateV"></a><span class="i">chGateV</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspXfader_t.onSymId"></a><span class="i">onSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspXfader_t.offSymId"></a><span class="i">offSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspXfader_t">cmDspXfader_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspXfaderAlloc_defn"></a><a name="_cmDspXfaderAlloc"></a><span class="f">_cmDspXfaderAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotchs&quot</span><span class="p">,</span>   <a href="#kChCntXfId">kChCntXfId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>               <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput and Output channel count&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotms&quot</span><span class="p">,</span>    <a href="#kFadeTimeMsXfId">kFadeTimeMsXfId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotFade time in milliseonds.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmgate&quot</span><span class="p">,</span> <a href="#kMstrGateXfId">kMstrGateXfId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotMaster gate - can be used to set all gates.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotims&quot</span><span class="p">,</span>   <a href="#kFadeInTimeMsXfId">kFadeInTimeMsXfId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotFade in time in milliseonds.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoms&quot</span><span class="p">,</span>   <a href="#kFadeOutTimeMsXfId">kFadeOutTimeMsXfId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotFade out time in milliseonds.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotreset&quot</span><span class="p">,</span> <a href="#kResetXfId">kResetXfId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                  <span class="l">&quotJump to gate states rather than fade.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quoton&quot</span><span class="p">,</span>    <a href="#kOnXfId">kOnXfId</a><span class="p">,</span>            <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                   <span class="l">&quotSend 'on' when all ch's transition from off to on.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotoff&quot</span><span class="p">,</span>   <a href="#kOffXfId">kOffXfId</a><span class="p">,</span>           <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                   <span class="l">&quotSend 'off' when all ch's transition from on to off.&quot</span><span class="p">}</span><span class="p">,</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe Xfader object must be given a channel count argument.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> chCnt         <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> fixArgCnt     <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> argCnt        <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="l">5</span><span class="p">*</span>chCnt<span class="p">;</span>
  <span class="k">unsigned</span> inBaseXfId    <span class="p">=</span> <a href="#kGateBaseXfId">kGateBaseXfId</a> <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> outBaseXfId   <span class="p">=</span> inBaseXfId <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> stateBaseXfId <span class="p">=</span> outBaseXfId <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> gainBaseXfId  <span class="p">=</span> stateBaseXfId <span class="p">+</span> chCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  
  
  <span class="c">// setup the input gate detectors and the output gain args </span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>  a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kGateBaseXfId">kGateBaseXfId</a><span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate&quot</span><span class="p">,</span> <a href="#kGateBaseXfId">kGateBaseXfId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>     <span class="l">&quotgate flags&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> inBaseXfId<span class="p">,</span>    chCnt<span class="p">,</span> <span class="l">&quotin&quot</span><span class="p">,</span>   inBaseXfId<span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotaudio input&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> outBaseXfId<span class="p">,</span>   chCnt<span class="p">,</span> <span class="l">&quotout&quot</span><span class="p">,</span>  outBaseXfId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotaudio output&quot</span><span class="p">)</span><span class="p">;</span> 
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> stateBaseXfId<span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotstate&quot</span><span class="p">,</span>stateBaseXfId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>     <span class="l">&quotcurrent fader state&quot</span><span class="p">)</span><span class="p">;</span> 
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> gainBaseXfId<span class="p">,</span>  chCnt<span class="p">,</span> <span class="l">&quotgain&quot</span><span class="p">,</span> gainBaseXfId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>   <span class="l">&quotgain output&quot</span><span class="p">)</span><span class="p">;</span> 
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span> p  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">double</span> fadeTimeMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFadeTimeMsXfId">kFadeTimeMsXfId</a> <span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>xfdp           <span class="p">=</span> <a href="cmProc3_h_0.html#cmXfaderAlloc">cmXfaderAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> chCnt<span class="p">,</span> fadeTimeMs<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>inBaseXfId     <span class="p">=</span> inBaseXfId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>outBaseXfId    <span class="p">=</span> outBaseXfId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>stateBaseXfId  <span class="p">=</span> stateBaseXfId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gainBaseXfId   <span class="p">=</span> gainBaseXfId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chCnt          <span class="p">=</span> chCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chGateV        <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">bool</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>onSymId        <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quoton&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>offSymId       <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotoff&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// set default values for the parameters that were not explicitely set in the va_arg list</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFadeTimeMsXfId">kFadeTimeMsXfId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>     <span class="l">100</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMstrGateXfId">kMstrGateXfId</a><span class="p">,</span>    false<span class="p">,</span> false<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOnXfId">kOnXfId</a><span class="p">,</span>    p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOffXfId">kOffXfId</a><span class="p">,</span>   p<span class="p">-</span><span class="p">&gt</span>offSymId <span class="p">)</span><span class="p">;</span>  
  
  <span class="k">int</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> stateBaseXfId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspXfaderFree_defn"></a><a name="_cmDspXfaderFree"></a><span class="f">_cmDspXfaderFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">)</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmXfaderFree">cmXfaderFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspXfaderReset_defn"></a><a name="_cmDspXfaderReset"></a><span class="f">_cmDspXfaderReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="c">// TODO: zeroing of output audio buffers should be built into <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a>().</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>outBaseXfId <span class="p">+</span> i<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspXfaderExec_defn"></a><a name="_cmDspXfaderExec"></a><span class="f">_cmDspXfaderExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a><span class="p">;</span>
  <a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>       i<span class="p">;</span>
  
  <span class="c">// update the internal cross fader by providing it with new gate settings and generate new gain values</span>
  <a href="cmProc3_h_0.html#cmXfaderExec">cmXfaderExec</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span>          n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>outBaseXfId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>outBaseXfId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>inBaseXfId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a>        gain <span class="p">=</span> <span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span>p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>ep_gain<span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> op <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> ip <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
        cmVOS_Zero<span class="p">(</span>op<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
      <span class="k">else</span>
        cmVOS_MultVVS<span class="p">(</span>op<span class="p">,</span>n<span class="p">,</span>ip<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>onFl <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>stateBaseXfId<span class="p">+</span>i<span class="p">,</span>true<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>offFl <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>stateBaseXfId<span class="p">+</span>i<span class="p">,</span>false<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c">// send the gain output</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gainBaseXfId<span class="p">+</span>i<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOnXfId">kOnXfId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>onSymId<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">-</span><span class="p">&gt</span>offFl <span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOffXfId">kOffXfId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>offSymId<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspXfaderRecv_defn"></a><a name="_cmDspXfaderRecv"></a><span class="f">_cmDspXfaderRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  <a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspXfader_t">cmDspXfader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kFadeTimeMsXfId">kFadeTimeMsXfId</a><span class="p">:</span>
    <span class="c">// if this is an xfade time event then transfer the new xfade time to the xfade proc</span>
    <a href="cmProc3_h_0.html#cmXfaderSetXfadeTime">cmXfaderSetXfadeTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFadeTimeMsXfId">kFadeTimeMsXfId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kMstrGateXfId">kMstrGateXfId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">bool</span> fl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMstrGateXfId">kMstrGateXfId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">unsigned</span> i<span class="p">;</span>
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
        p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> fl<span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kFadeInTimeMsXfId">kFadeInTimeMsXfId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmXfaderSetXfadeInTime">cmXfaderSetXfadeInTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFadeInTimeMsXfId">kFadeInTimeMsXfId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kFadeOutTimeMsXfId">kFadeOutTimeMsXfId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmXfaderSetXfadeOutTime">cmXfaderSetXfadeOutTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFadeOutTimeMsXfId">kFadeOutTimeMsXfId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kResetXfId">kResetXfId</a><span class="p">:</span>
    <span class="p">{</span>
      <a href="cmProc3_h_0.html#cmXfaderExec">cmXfaderExec</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span><span class="p">;</span>
      <a href="cmProc3_h_0.html#cmXfaderJumpToDestinationGain">cmXfaderJumpToDestinationGain</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">)</span><span class="p">;</span>
      <span class="c">// force the chGateV[] to match the xfaders state</span>
      <span class="k">int</span> i<span class="p">;</span>
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <span class="k">bool</span> gateFl <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>xfdp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>gateFl<span class="p">;</span>
        p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> gateFl<span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>  ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>stateBaseXfId <span class="p">+</span> i<span class="p">,</span> gateFl<span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gainBaseXfId  <span class="p">+</span> i<span class="p">,</span> gateFl <span class="p">?</span> <span class="l">1.0</span> <span class="p">:</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>          
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="c">// record gate changes into p-&ampgtchGateV[] for later use in <a href="#_cmDspXfaderExec">_cmDspXfaderExec</a>().</span>
  <span class="k">if</span><span class="p">(</span> <a href="#kGateBaseXfId">kGateBaseXfId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kGateBaseXfId">kGateBaseXfId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kGateBaseXfId">kGateBaseXfId</a> <span class="p">]</span> <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span> inst<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmXfaderClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmXfaderClassCons">cmXfaderClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmXfaderDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotXfader&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspXfaderAlloc">_cmDspXfaderAlloc</a><span class="p">,</span>
  <a href="#_cmDspXfaderFree">_cmDspXfaderFree</a><span class="p">,</span>
  <a href="#_cmDspXfaderReset">_cmDspXfaderReset</a><span class="p">,</span>
  <a href="#_cmDspXfaderExec">_cmDspXfaderExec</a><span class="p">,</span>
  <a href="#_cmDspXfaderRecv">_cmDspXfaderRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotCross fade gain generator.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmXfaderDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspChCfg : Configure a 'fluxo' channel.</div><pre><a name="cmDspChCfg"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kFnCcId"></a><span class="e">kFnCcId</span><span class="p">,</span>
  <a name="kSelCcId"></a><span class="e">kSelCcId</span><span class="p">,</span>
  <a name="kDoneCcId"></a><span class="e">kDoneCcId</span><span class="p">,</span>
  <a name="kGainBaseCcId"></a><span class="e">kGainBaseCcId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmChCfgDC<span class="p">;</span>

<a name="cmDspChCfg_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspChCfg_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmChCfg">cmChCfg</a><span class="p">*</span>     <a name="cmDspChCfg_t.ccp"></a><span class="i">ccp</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.midiBaseCcId"></a><span class="i">midiBaseCcId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.hzBaseCcId"></a><span class="i">hzBaseCcId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.chBaseCcId"></a><span class="i">chBaseCcId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.nsflBaseCcId"></a><span class="i">nsflBaseCcId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.nshzBaseCcId"></a><span class="i">nshzBaseCcId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.printSymId"></a><span class="i">printSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.writeSymId"></a><span class="i">writeSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.nsCmdSymId"></a><span class="i">nsCmdSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.hzCmdSymId"></a><span class="i">hzCmdSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspChCfg_t.resetSymId"></a><span class="i">resetSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspChCfg_t">cmDspChCfg_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspChCfgAlloc_defn"></a><a name="_cmDspChCfgAlloc"></a><span class="f">_cmDspChCfgAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotfn&quot</span><span class="p">,</span>   <a href="#kFnCcId">kFnCcId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>               <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotChannel configuration JSON file name.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsel&quot</span><span class="p">,</span>  <a href="#kSelCcId">kSelCcId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                <span class="l">&quotAction selector: print | write | ns | reset&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotdone&quot</span><span class="p">,</span> <a href="#kDoneCcId">kDoneCcId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                <span class="l">&quotTrigger following action.&quot</span><span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe channel configuration object must be given a file name argument.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> chCfgFn <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmChCfg">cmChCfg</a><span class="p">*</span> ccp <span class="p">=</span> <a href="cmProc3_h_0.html#cmChCfgAlloc">cmChCfgAlloc</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">,</span> chCfgFn <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> ccp <span class="p">=</span><span class="p">=</span> NULL <span class="p">|</span><span class="p">|</span> ccp<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe channel configuration object could not be initialized with the file name '%s'.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>chCfgFn<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">unsigned</span>       chCnt         <span class="p">=</span> ccp<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span>
  <span class="k">unsigned</span>       nsChCnt       <span class="p">=</span> ccp<span class="p">-</span><span class="p">&gt</span>nsChCnt<span class="p">;</span>
  <span class="k">unsigned</span>       fixArgCnt     <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>       argCnt        <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="l">5</span><span class="p">*</span>chCnt <span class="p">+</span> nsChCnt<span class="p">;</span>
  <span class="k">unsigned</span>       midiBaseCcId  <span class="p">=</span> <a href="#kGainBaseCcId">kGainBaseCcId</a> <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span>       hzBaseCcId    <span class="p">=</span> midiBaseCcId  <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span>       chBaseCcId    <span class="p">=</span> hzBaseCcId    <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span>       nsflBaseCcId  <span class="p">=</span> chBaseCcId    <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span>       nshzBaseCcId  <span class="p">=</span> nsflBaseCcId  <span class="p">+</span> chCnt<span class="p">;</span>
  <a href="#cmDspChCfg_t">cmDspChCfg_t</a><span class="p">*</span>  p             <span class="p">=</span> NULL<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>  a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span>       i<span class="p">,</span>j<span class="p">;</span>
  
  <span class="c">// setup the input gate detectors and the output gain args </span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>  a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kGainBaseCcId">kGainBaseCcId</a><span class="p">,</span> chCnt<span class="p">,</span>   <span class="l">&quotgain&quot</span><span class="p">,</span>  <a href="#kGainBaseCcId">kGainBaseCcId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotGain input and output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> midiBaseCcId<span class="p">,</span>  chCnt<span class="p">,</span>   <span class="l">&quotmidi&quot</span><span class="p">,</span>  midiBaseCcId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                <span class="l">&quotMIDI pitch output&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> hzBaseCcId<span class="p">,</span>    chCnt<span class="p">,</span>   <span class="l">&quothz&quot</span><span class="p">,</span>    hzBaseCcId<span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>              <span class="l">&quotpitch output in Hz&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> chBaseCcId<span class="p">,</span>    chCnt<span class="p">,</span>   <span class="l">&quotch&quot</span><span class="p">,</span>    chBaseCcId<span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>  <span class="p">,</span>              <span class="l">&quotAudio channel index&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> nsflBaseCcId<span class="p">,</span>  chCnt<span class="p">,</span>   <span class="l">&quotnsfl&quot</span><span class="p">,</span>  nsflBaseCcId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>                  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                <span class="l">&quotnoise shaper enables&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> nshzBaseCcId<span class="p">,</span>  nsChCnt<span class="p">,</span> <span class="l">&quotnshz&quot</span><span class="p">,</span>  nshzBaseCcId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>                  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>              <span class="l">&quotnoise-shaper pitch output in Hz&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspChCfg_t">cmDspChCfg_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>ccp           <span class="p">=</span> ccp<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>midiBaseCcId  <span class="p">=</span> midiBaseCcId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>hzBaseCcId    <span class="p">=</span> hzBaseCcId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chBaseCcId    <span class="p">=</span> chBaseCcId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nsflBaseCcId  <span class="p">=</span> nsflBaseCcId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nshzBaseCcId  <span class="p">=</span> nshzBaseCcId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>writeSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotwrite&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>printSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotprint&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nsCmdSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotns&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>hzCmdSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quothz&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>resetSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotreset&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">,</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">double</span> hz <span class="p">=</span> <a href="cmMath_h_0.html#cmMidiToHz">cmMidiToHz</a><span class="p">(</span>ccp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>midi<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGainBaseCcId">kGainBaseCcId</a>   <span class="p">+</span> i<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> ccp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>gain<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>midiBaseCcId <span class="p">+</span> i<span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   ccp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>midi <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>hzBaseCcId   <span class="p">+</span> i<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> hz <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chBaseCcId   <span class="p">+</span> i<span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   ccp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>ch <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>nsflBaseCcId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> ccp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>nsFl <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>nshzBaseCcId<span class="p">+</span>j<span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> hz<span class="p">)</span><span class="p">;</span>
      <span class="p">+</span><span class="p">+</span>j<span class="p">;</span>
    <span class="p">}</span>
    
  <span class="p">}</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDoneCcId">kDoneCcId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSelCcId">kSelCcId</a><span class="p">,</span>  <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspChCfgFree_defn"></a><a name="_cmDspChCfgFree"></a><span class="f">_cmDspChCfgFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspChCfg_t">cmDspChCfg_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspChCfg_t">cmDspChCfg_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmChCfgFree">cmChCfgFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspChCfgReset_defn"></a><a name="_cmDspChCfgReset"></a><span class="f">_cmDspChCfgReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspChCfgRecv_defn"></a><a name="_cmDspChCfgRecv"></a><span class="f">_cmDspChCfgRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc<span class="p">;</span>
  <a href="#cmDspChCfg_t">cmDspChCfg_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspChCfg_t">cmDspChCfg_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kSelCcId">kSelCcId</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> selId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSelCcId">kSelCcId</a><span class="p">)</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> selId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="#_cmDspChCfgReset">_cmDspChCfgReset</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
        <span class="k">if</span><span class="p">(</span> selId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>hzCmdSymId <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">unsigned</span> i<span class="p">;</span>
        <span class="c">// snd the  hz</span>
        <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>hzBaseCcId<span class="p">+</span>i<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>hzBaseCcId<span class="p">+</span>i<span class="p">)</span><span class="p">)</span><span class="p">;</span>
        
      <span class="p">}</span>
      <span class="k">else</span>
        <span class="k">if</span><span class="p">(</span> selId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>nsCmdSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotChCfg:NS\n&quot</span><span class="p">)</span><span class="p">;</span>
        
        <span class="k">unsigned</span> i<span class="p">;</span>
        <span class="c">// send the ns flags</span>
        <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nsflBaseCcId<span class="p">+</span>i<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>nsFl<span class="p">)</span><span class="p">;</span>
        
        <span class="c">// snd the ns hz</span>
        <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">-</span><span class="p">&gt</span>nsChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nshzBaseCcId<span class="p">+</span>i<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nshzBaseCcId<span class="p">+</span>i<span class="p">)</span><span class="p">)</span><span class="p">;</span>
        
        <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kDoneCcId">kDoneCcId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nsCmdSymId<span class="p">)</span><span class="p">;</span>
        
      <span class="p">}</span>
      <span class="k">else</span>
        
      <span class="k">if</span><span class="p">(</span> selId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>printSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotChannel Cfg Report\n&quot</span><span class="p">)</span><span class="p">;</span>
        <a href="cmProc3_h_0.html#cmChCfgPrint">cmChCfgPrint</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">,</span> ctx<span class="p">-</span><span class="p">&gt</span>rpt <span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> selId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>writeSymId <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">unsigned</span> i<span class="p">;</span>
          
          <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span><span class="p">&amp</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotwriting\n&quot</span><span class="p">)</span><span class="p">;</span>
          
          <span class="c">// copy the gain values into the internal chCfg object ...</span>
          <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
            p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>gain <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGainBaseCcId">kGainBaseCcId</a><span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
          
          <span class="c">// ... and write the object</span>
          <a href="cmProc3_h_0.html#cmChCfgWrite">cmChCfgWrite</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>ccp<span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmChCfgClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmChCfgClassCons">cmChCfgClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmChCfgDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotChCfg&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspChCfgAlloc">_cmDspChCfgAlloc</a><span class="p">,</span>
  <a href="#_cmDspChCfgFree">_cmDspChCfgFree</a><span class="p">,</span>
  <a href="#_cmDspChCfgReset">_cmDspChCfgReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspChCfgRecv">_cmDspChCfgRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotPP Channel Configuration Object.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmChCfgDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspChordDetect : Detect a predefined chord based on signal gates.</div><pre><a name="cmDspChordDetect"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kRsrcCdId"></a><span class="e">kRsrcCdId</span><span class="p">,</span>
  <a name="kMaxTimeSpanCdId"></a><span class="e">kMaxTimeSpanCdId</span><span class="p">,</span>
  <a name="kMinNoteCntCdId"></a><span class="e">kMinNoteCntCdId</span><span class="p">,</span>
  <a name="kDetectCdId"></a><span class="e">kDetectCdId</span><span class="p">,</span>
  <a name="kCountCdId"></a><span class="e">kCountCdId</span><span class="p">,</span>
  <a name="kGateBaseCdId"></a><span class="e">kGateBaseCdId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmChordDetectDC<span class="p">;</span>

<a name="cmDspChordDetect_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspChordDetect_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmChordDetect">cmChordDetect</a><span class="p">*</span> <a name="cmDspChordDetect_t.cdp"></a><span class="i">cdp</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspChordDetect_t.rmsBaseCdId"></a><span class="i">rmsBaseCdId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspChordDetect_t.chCnt"></a><span class="i">chCnt</span><span class="p">;</span> 
  <span class="k">bool</span><span class="p">*</span>          <a name="cmDspChordDetect_t.chGateV"></a><span class="i">chGateV</span><span class="p">;</span>    <span class="c"> // chGateV[ chCnt ]</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>      <a name="cmDspChordDetect_t.chRmsV"></a><span class="i">chRmsV</span><span class="p">;</span>     <span class="c"> // chRmsV[ chCnt ]</span>
  <span class="k">unsigned</span><span class="p">*</span>      <a name="cmDspChordDetect_t.chEnaV"></a><span class="i">chEnaV</span><span class="p">;</span>     <span class="c"> // chEnaV[ chCnt ]</span>
  <span class="k">unsigned</span>       <a name="cmDspChordDetect_t.count"></a><span class="i">count</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspChordDetect_t">cmDspChordDetect_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspChordDetectAlloc_defn"></a><a name="_cmDspChordDetectAlloc"></a><span class="f">_cmDspChordDetectAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotrsrc&quot</span><span class="p">,</span>    <a href="#kRsrcCdId">kRsrcCdId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>              <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotChannel enable flag array.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotspan&quot</span><span class="p">,</span>    <a href="#kMaxTimeSpanCdId">kMaxTimeSpanCdId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotMax. onset time span.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotnotes&quot</span><span class="p">,</span>   <a href="#kMinNoteCntCdId">kMinNoteCntCdId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotMin. note count per chord.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotdetect&quot</span><span class="p">,</span>  <a href="#kDetectCdId">kDetectCdId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                  <span class="l">&quotChord detect flag.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotcount&quot</span><span class="p">,</span>   <a href="#kCountCdId">kCountCdId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                  <span class="l">&quotCount of chords detected since last reset.&quot</span><span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe chord detector must be given a channel enable flags array resource argument .&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> rsrc  <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>       enaV  <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">unsigned</span>        chCnt   <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcUIntArray">cmDspRsrcUIntArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>chCnt<span class="p">,</span> <span class="p">&amp</span>enaV<span class="p">,</span> rsrc<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe chord detector channel index resource '%s' could not be read.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>rsrc<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">//<a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a>(ctx-&ampgtrpt,&ampquotcd %s chs:%i\n&ampquot,rsrc,chCnt);</span>
  
  <span class="k">unsigned</span>            fixArgCnt   <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>            argCnt      <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="l">2</span><span class="p">*</span>chCnt<span class="p">;</span>
  <span class="k">unsigned</span>            rmsBaseCdId <span class="p">=</span> <a href="#kGateBaseCdId">kGateBaseCdId</a> <span class="p">+</span> chCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>       a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span>            i<span class="p">;</span>
  <a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">*</span> p<span class="p">;</span>
  
  <span class="c">// setup the input gate detectors and the output gain args </span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>       a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kGateBaseCdId">kGateBaseCdId</a><span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate&quot</span><span class="p">,</span> <a href="#kGateBaseCdId">kGateBaseCdId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate input and output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> rmsBaseCdId<span class="p">,</span>   chCnt<span class="p">,</span> <span class="l">&quotrms&quot</span><span class="p">,</span>  rmsBaseCdId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotChannel RMS input and output&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <span class="k">double</span>   dfltMaxTimeSpanMs <span class="p">=</span> <span class="l">50.0</span><span class="p">;</span>
  <span class="k">unsigned</span> dfltMinNoteCnt    <span class="p">=</span> <span class="l">2</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxTimeSpanCdId">kMaxTimeSpanCdId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span>   dfltMaxTimeSpanMs <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMinNoteCntCdId">kMinNoteCntCdId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>     dfltMinNoteCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDetectCdId">kDetectCdId</a><span class="p">,</span>      false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kCountCdId">kCountCdId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span>     <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGateBaseCdId">kGateBaseCdId</a>  <span class="p">+</span> i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> rmsBaseCdId    <span class="p">+</span> i<span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>cdp           <span class="p">=</span> <a href="cmProc3_h_0.html#cmChordDetectAlloc">cmChordDetectAlloc</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> chCnt<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMaxTimeSpanCdId">kMaxTimeSpanCdId</a><span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMinNoteCntCdId">kMinNoteCntCdId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>rmsBaseCdId   <span class="p">=</span> rmsBaseCdId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chCnt         <span class="p">=</span> chCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chGateV       <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">bool</span><span class="p">,</span>     chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chRmsV        <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">,</span> chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chEnaV        <span class="p">=</span> enaV<span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspChordDetectFree_defn"></a><a name="_cmDspChordDetectFree"></a><span class="f">_cmDspChordDetectFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmChordDetectFree">cmChordDetectFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>cdp<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspChordDetectReset_defn"></a><a name="_cmDspChordDetectReset"></a><span class="f">_cmDspChordDetectReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspChordDetectExec_defn"></a><a name="_cmDspChordDetectExec"></a><span class="f">_cmDspChordDetectExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>           rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmChordDetectExec">cmChordDetectExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>cdp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>cdp<span class="p">-</span><span class="p">&gt</span>detectFl <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> i<span class="p">;</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="p">{</span>
      <span class="k">bool</span> fl <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>cdp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>chordFl<span class="p">;</span>
      
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>   ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kGateBaseCdId">kGateBaseCdId</a>  <span class="p">+</span> i<span class="p">,</span> fl <span class="p">)</span><span class="p">;</span>
      <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseCdId <span class="p">+</span> i<span class="p">,</span> fl <span class="p">?</span> p<span class="p">-</span><span class="p">&gt</span>cdp<span class="p">-</span><span class="p">&gt</span>chArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>candRMS <span class="p">:</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    
    <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kDetectCdId">kDetectCdId</a><span class="p">,</span> true<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kCountCdId">kCountCdId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kCountCdId">kCountCdId</a><span class="p">)</span> <span class="p">+</span> <span class="l">1</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  cmVOB_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span><span class="p">;</span>
  cmVOR_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspChordDetectRecv_defn"></a><a name="_cmDspChordDetectRecv"></a><span class="f">_cmDspChordDetectRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>           rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspChordDetect_t">cmDspChordDetect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="#kGateBaseCdId">kGateBaseCdId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kGateBaseCdId">kGateBaseCdId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> idx <span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kGateBaseCdId">kGateBaseCdId</a><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>chEnaV<span class="p">[</span>idx<span class="p">]</span> <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span> idx <span class="p">]</span> <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetBool">cmDsvGetBool</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    
    <span class="c">//<a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a>(ctx-&ampgtrpt,&ampquotcd gate:%i e:%i v:%i\n&ampquot,idx,p-&ampgtchEnaV[idx],p-&ampgtchGateV[idx]);</span>
    
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseCdId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseCdId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> idx <span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseCdId<span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>chEnaV<span class="p">[</span>idx<span class="p">]</span> <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">[</span> idx <span class="p">]</span> <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetReal">cmDsvGetReal</a><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>valuePtr <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
      <span class="p">{</span>
      <span class="k">case</span> <a href="#kMaxTimeSpanCdId">kMaxTimeSpanCdId</a><span class="p">:</span>
        <a href="cmProc3_h_0.html#cmChordDetectSetSpanMs">cmChordDetectSetSpanMs</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>cdp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMaxTimeSpanCdId">kMaxTimeSpanCdId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">case</span> <a href="#kMinNoteCntCdId">kMinNoteCntCdId</a><span class="p">:</span>
        p<span class="p">-</span><span class="p">&gt</span>cdp<span class="p">-</span><span class="p">&gt</span>minNotesPerChord <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMinNoteCntCdId">kMinNoteCntCdId</a><span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmChordDetectClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmChordDetectClassCons">cmChordDetectClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmChordDetectDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotChordDetect&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspChordDetectAlloc">_cmDspChordDetectAlloc</a><span class="p">,</span>
  <a href="#_cmDspChordDetectFree">_cmDspChordDetectFree</a><span class="p">,</span>
  <a href="#_cmDspChordDetectReset">_cmDspChordDetectReset</a><span class="p">,</span>
  <a href="#_cmDspChordDetectExec">_cmDspChordDetectExec</a><span class="p">,</span>
  <a href="#_cmDspChordDetectRecv">_cmDspChordDetectRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotChord detector.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmChordDetectDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspFader : Single channel gate controlled fader.</div><pre><a name="cmDspFader"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kTimeFaId"></a><span class="e">kTimeFaId</span><span class="p">,</span>
  <a name="kGateFaId"></a><span class="e">kGateFaId</span><span class="p">,</span>
  <a name="kInFaId"></a><span class="e">kInFaId</span><span class="p">,</span>
  <a name="kGainFaId"></a><span class="e">kGainFaId</span><span class="p">,</span>
  <a name="kOutFaId"></a><span class="e">kOutFaId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmFaderDC<span class="p">;</span>

<a name="cmDspFader_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspFader_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmFader">cmFader</a><span class="p">*</span>       <a name="cmDspFader_t.fdp"></a><span class="i">fdp</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspFader_t">cmDspFader_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspFaderAlloc_defn"></a><a name="_cmDspFaderAlloc"></a><span class="f">_cmDspFaderAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quottime&quot</span><span class="p">,</span> <a href="#kTimeFaId">kTimeFaId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quotFade time in milliseconds.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgate&quot</span><span class="p">,</span> <a href="#kGateFaId">kGateFaId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>     <span class="l">&quotGate control signal.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInFaId">kInFaId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotAudio input.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgain&quot</span><span class="p">,</span> <a href="#kGainFaId">kGainFaId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>   <span class="l">&quotgain output.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutFaId">kOutFaId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotAudio out.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span>   <span class="l">0</span><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> NULL <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span> p<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspFader_t">cmDspFader_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <span class="k">double</span> dfltFadeTimeMs <span class="p">=</span> <span class="l">100.0</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTimeFaId">kTimeFaId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span>   dfltFadeTimeMs <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>fdp <span class="p">=</span> <a href="cmProc3_h_0.html#cmFaderAlloc">cmFaderAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> dfltFadeTimeMs <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspFaderFree_defn"></a><a name="_cmDspFaderFree"></a><span class="f">_cmDspFaderFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmFaderFree">cmFaderFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>fdp<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspFaderReset_defn"></a><a name="_cmDspFaderReset"></a><span class="f">_cmDspFaderReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  rc               <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutFaId">kOutFaId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmFaderSetFadeTime">cmFaderSetFadeTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fdp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kTimeFaId">kTimeFaId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspFaderExec_defn"></a><a name="_cmDspFaderExec"></a><span class="f">_cmDspFaderExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span>     p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">unsigned</span>          n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutFaId">kOutFaId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutFaId">kOutFaId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInFaId">kInFaId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmFaderExec">cmFaderExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fdp<span class="p">,</span>n<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGateFaId">kGateFaId</a><span class="p">)</span><span class="p">,</span>false<span class="p">,</span>ip<span class="p">,</span>op<span class="p">)</span><span class="p">;</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kGainFaId">kGainFaId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>fdp<span class="p">-</span><span class="p">&gt</span>gain<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspFaderRecv_defn"></a><a name="_cmDspFaderRecv"></a><span class="f">_cmDspFaderRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspFader_t">cmDspFader_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kTimeFaId">kTimeFaId</a> <span class="p">)</span>
      <a href="cmProc3_h_0.html#cmFaderSetFadeTime">cmFaderSetFadeTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fdp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kTimeFaId">kTimeFaId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmFaderClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmFaderClassCons">cmFaderClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmFaderDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotFader&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspFaderAlloc">_cmDspFaderAlloc</a><span class="p">,</span>
  <a href="#_cmDspFaderFree">_cmDspFaderFree</a><span class="p">,</span>
  <a href="#_cmDspFaderReset">_cmDspFaderReset</a><span class="p">,</span>
  <a href="#_cmDspFaderExec">_cmDspFaderExec</a><span class="p">,</span>
  <a href="#_cmDspFaderRecv">_cmDspFaderRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAudio fade in/out controller.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmFaderDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspNoteSelect : 'fluxo' gate based logic controller.</div><pre><a name="cmDspNoteSelect"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kChCntNsId"></a><span class="e">kChCntNsId</span><span class="p">,</span>
  <a name="kTrigNsId"></a><span class="e">kTrigNsId</span><span class="p">,</span>
  <a name="kDoneNsId"></a><span class="e">kDoneNsId</span><span class="p">,</span>
  <a name="kGateBaseNsId"></a><span class="e">kGateBaseNsId</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">enum</span>
<span class="p">{</span>
  <a name="kGroupNonNsId"></a><span class="e">kGroupNonNsId</span><span class="p">,</span>
  <a name="kGroup0NsId"></a><span class="e">kGroup0NsId</span><span class="p">,</span>
  <a name="kGroup1NsId"></a><span class="e">kGroup1NsId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmNoteSelectDC<span class="p">;</span>

<a name="cmDspNoteSelect_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspNoteSelect_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.chCnt"></a><span class="i">chCnt</span><span class="p">;</span> 
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.rmsBaseNsId"></a><span class="i">rmsBaseNsId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.gate0BaseNsId"></a><span class="i">gate0BaseNsId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.gate1BaseNsId"></a><span class="i">gate1BaseNsId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.gate2BaseNsId"></a><span class="i">gate2BaseNsId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.gate3BaseNsId"></a><span class="i">gate3BaseNsId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.gate4BaseNsId"></a><span class="i">gate4BaseNsId</span><span class="p">;</span>
  <span class="k">bool</span><span class="p">*</span>          <a name="cmDspNoteSelect_t.chGateV"></a><span class="i">chGateV</span><span class="p">;</span>    <span class="c"> // chGateV[chCnt]</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>      <a name="cmDspNoteSelect_t.chRmsV"></a><span class="i">chRmsV</span><span class="p">;</span>     <span class="c"> // chRmsV[ chCnt ];</span>
  <span class="k">unsigned</span><span class="p">*</span>      <a name="cmDspNoteSelect_t.chGroupV"></a><span class="i">chGroupV</span><span class="p">;</span>   <span class="c"> // chGroupV[ chCnt ] (0=non-chord 1=low/high 2=middle)</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.count"></a><span class="i">count</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNoteSelect_t.doneSymId"></a><span class="i">doneSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspNoteSelectAlloc_defn"></a><a name="_cmDspNoteSelectAlloc"></a><span class="f">_cmDspNoteSelectAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotch_cnt&quot</span><span class="p">,</span>  <a href="#kChCntNsId">kChCntNsId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>             <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotChannel count.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quottrig&quot</span><span class="p">,</span>    <a href="#kTrigNsId">kTrigNsId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                  <span class="l">&quotTrigger note selection.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotdone&quot</span><span class="p">,</span>    <a href="#kDoneNsId">kDoneNsId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                  <span class="l">&quotSends 'done' after new set of outputs have been sent.&quot</span><span class="p">}</span><span class="p">,</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe note selector must be given a channel count argument .&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  
  <span class="k">unsigned</span>        CD0chanN <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">unsigned</span>        CD1chanN <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>       CD0chan  <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>       CD1chan  <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> CD0rsrc  <span class="p">=</span> <span class="l">&quotCD0chan&quot</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> CD1rsrc  <span class="p">=</span> <span class="l">&quotCD1chan&quot</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcUIntArray">cmDspRsrcUIntArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>CD0chanN<span class="p">,</span> <span class="p">&amp</span>CD0chan<span class="p">,</span> CD0rsrc<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe chord detector channel index resource '%s' could not be read.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>CD0rsrc<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcUIntArray">cmDspRsrcUIntArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>CD1chanN<span class="p">,</span> <span class="p">&amp</span>CD1chan<span class="p">,</span> CD1rsrc<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe chord detector channel index resource '%s' could not be read.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>CD1rsrc<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> chCnt         <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">unsigned</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> fixArgCnt     <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> argCnt        <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="l">7</span><span class="p">*</span>chCnt<span class="p">;</span>
  <span class="k">unsigned</span> rmsBaseNsId   <span class="p">=</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">+</span> <span class="l">1</span> <span class="p">*</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> gate0BaseNsId <span class="p">=</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">+</span> <span class="l">2</span> <span class="p">*</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> gate1BaseNsId <span class="p">=</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">+</span> <span class="l">3</span> <span class="p">*</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> gate2BaseNsId <span class="p">=</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">+</span> <span class="l">4</span> <span class="p">*</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> gate3BaseNsId <span class="p">=</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">+</span> <span class="l">5</span> <span class="p">*</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span> gate4BaseNsId <span class="p">=</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">+</span> <span class="l">6</span> <span class="p">*</span> chCnt<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>       a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span>            i<span class="p">;</span>
  <a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">*</span> p<span class="p">;</span>
  
  <span class="c">// setup the input gate detectors and the output gain args </span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>  a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kGateBaseNsId">kGateBaseNsId</a><span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate&quot</span><span class="p">,</span>   <a href="#kGateBaseNsId">kGateBaseNsId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate input.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> rmsBaseNsId<span class="p">,</span>   chCnt<span class="p">,</span> <span class="l">&quotrms&quot</span><span class="p">,</span>    rmsBaseNsId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotChannel RMS input&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> gate0BaseNsId<span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate-0&quot</span><span class="p">,</span> gate0BaseNsId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 0 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> gate1BaseNsId<span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate-1&quot</span><span class="p">,</span> gate1BaseNsId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 1 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> gate2BaseNsId<span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate-2&quot</span><span class="p">,</span> gate2BaseNsId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 2 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> gate3BaseNsId<span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate-3&quot</span><span class="p">,</span> gate3BaseNsId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 3 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> gate4BaseNsId<span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate-4&quot</span><span class="p">,</span> gate4BaseNsId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 4 output.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTrigNsId">kTrigNsId</a><span class="p">,</span>      false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDoneNsId">kDoneNsId</a><span class="p">,</span>  <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  
  
  p<span class="p">-</span><span class="p">&gt</span>rmsBaseNsId   <span class="p">=</span> rmsBaseNsId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gate0BaseNsId <span class="p">=</span> gate0BaseNsId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gate1BaseNsId <span class="p">=</span> gate1BaseNsId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gate2BaseNsId <span class="p">=</span> gate2BaseNsId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gate3BaseNsId <span class="p">=</span> gate3BaseNsId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gate4BaseNsId <span class="p">=</span> gate4BaseNsId<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>chCnt         <span class="p">=</span> chCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chGateV       <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">bool</span><span class="p">,</span>chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chRmsV        <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">,</span>chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chGroupV      <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">unsigned</span><span class="p">,</span>chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>doneSymId     <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotdone&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>CD0chanN<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> CD0chan<span class="p">[</span>i<span class="p">]</span> <span class="p">&gt</span><span class="p">=</span> chCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe chord detector resource array '%s' value  %i is out of range %i.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>CD0rsrc<span class="p">)</span><span class="p">,</span>CD0chan<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>chCnt<span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">[</span> CD0chan<span class="p">[</span>i<span class="p">]</span> <span class="p">]</span> <span class="p">=</span> <a href="#kGroup0NsId">kGroup0NsId</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>CD1chanN<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> CD1chan<span class="p">[</span>i<span class="p">]</span> <span class="p">&gt</span><span class="p">=</span> chCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe chord detector resource array '%s' value  %i is out of range %i.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>CD1rsrc<span class="p">)</span><span class="p">,</span>CD1chan<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>chCnt<span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">[</span> CD1chan<span class="p">[</span>i<span class="p">]</span> <span class="p">]</span> <span class="p">=</span> <a href="#kGroup1NsId">kGroup1NsId</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> rmsBaseNsId<span class="p">+</span>i<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span>   <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> gate0BaseNsId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> gate1BaseNsId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> gate2BaseNsId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>   
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> gate3BaseNsId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <span class="c">// the non-chord channel selections should always be on</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> gate4BaseNsId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <a href="#kGroupNonNsId">kGroupNonNsId</a> <span class="p">)</span><span class="p">;</span>   
  <span class="p">}</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNoteSelectFree_defn"></a><a name="_cmDspNoteSelectFree"></a><span class="f">_cmDspNoteSelectFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNoteSelectReset_defn"></a><a name="_cmDspNoteSelectReset"></a><span class="f">_cmDspNoteSelectReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  cmVOR_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNoteSelectRecv_defn"></a><a name="_cmDspNoteSelectRecv"></a><span class="f">_cmDspNoteSelectRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>           rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNoteSelect_t">cmDspNoteSelect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="c">// store incoming gate  values</span>
  <span class="k">if</span><span class="p">(</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span>
    p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kGateBaseNsId">kGateBaseNsId</a> <span class="p">]</span> <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetBool">cmDsvGetBool</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="c">// store incoming RMS values</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseNsId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseNsId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span>
    p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">[</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseNsId <span class="p">]</span> <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetReal">cmDsvGetReal</a><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>valuePtr <span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c">// if a chord detection was triggered</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kTrigNsId">kTrigNsId</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> i<span class="p">;</span>
      <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> maxRms <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      <span class="k">unsigned</span> maxIdx <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">1</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <span class="c">// if this channel had an onset and is a possible chord note and is the max RMS chord note</span>
        <span class="k">if</span><span class="p">(</span>  p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">[</span>i<span class="p">]</span> <span class="p">!</span><span class="p">=</span> <a href="#kGroupNonNsId">kGroupNonNsId</a> <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span>i<span class="p">]</span> <span class="p">&amp</span><span class="p">&amp</span>  <span class="p">(</span>maxIdx<span class="p">=</span><span class="p">=</span><a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">[</span>i<span class="p">]</span> <span class="p">&gt</span> maxRms<span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
          maxRms <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
          maxIdx <span class="p">=</span> i<span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <span class="k">bool</span> fl       <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">[</span>i<span class="p">]</span> <span class="p">!</span><span class="p">=</span> <a href="#kGroupNonNsId">kGroupNonNsId</a><span class="p">;</span>
        <span class="k">bool</span> chosenFl <span class="p">=</span> fl <span class="p">&amp</span><span class="p">&amp</span> i<span class="p">=</span><span class="p">=</span>maxIdx<span class="p">;</span>
        <span class="k">bool</span> otherFl  <span class="p">=</span> fl <span class="p">&amp</span><span class="p">&amp</span> i<span class="p">!</span><span class="p">=</span>maxIdx <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
        <span class="k">bool</span> cd0Fl    <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">[</span>i<span class="p">]</span><span class="p">=</span><span class="p">=</span><a href="#kGroup0NsId">kGroup0NsId</a> <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span><span class="p">!</span>otherFl<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span><span class="p">!</span>chosenFl<span class="p">)</span><span class="p">;</span>
        <span class="k">bool</span> cd1Fl    <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>chGroupV<span class="p">[</span>i<span class="p">]</span><span class="p">=</span><span class="p">=</span><a href="#kGroup1NsId">kGroup1NsId</a> <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span><span class="p">!</span>otherFl<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span>  <span class="p">(</span><span class="p">!</span>chosenFl<span class="p">)</span><span class="p">;</span>
        
        <span class="c">// gate set 0: set output gate for max chord note</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gate0BaseNsId<span class="p">+</span>i<span class="p">,</span> chosenFl <span class="p">)</span><span class="p">;</span>        
        
        <span class="c">// gate set 1: set output gate for non-max chord notes</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gate1BaseNsId<span class="p">+</span>i<span class="p">,</span> otherFl <span class="p">)</span><span class="p">;</span>                  
        
        <span class="c">// gate set 2: set output gate for non-chord notes</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gate2BaseNsId<span class="p">+</span>i<span class="p">,</span> cd0Fl <span class="p">)</span><span class="p">;</span>
        
        <span class="c">// gate set 3: set output gate for non-chord notes</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gate3BaseNsId<span class="p">+</span>i<span class="p">,</span> cd1Fl<span class="p">)</span><span class="p">;</span>
        
        <span class="c">// gate set 4: set output gate for non-chord notes</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>gate4BaseNsId<span class="p">+</span>i<span class="p">,</span> <span class="p">!</span>fl <span class="p">)</span><span class="p">;</span>
        
      <span class="p">}</span>
      
      <span class="c">// send the 'done' symbol to notify the gate receivers that the
      // new set of gates is complete</span>      
      <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kDoneNsId">kDoneNsId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>doneSymId<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// zero the RMS vector</span>
      cmVOR_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmNoteSelectClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmNoteSelectClassCons">cmNoteSelectClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmNoteSelectDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotNoteSelect&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNoteSelectAlloc">_cmDspNoteSelectAlloc</a><span class="p">,</span>
  <a href="#_cmDspNoteSelectFree">_cmDspNoteSelectFree</a><span class="p">,</span>
  <a href="#_cmDspNoteSelectReset">_cmDspNoteSelectReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNoteSelectRecv">_cmDspNoteSelectRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotChord detector.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmNoteSelectDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspNetNoteSelect : 'fluxo' transmit gate information over the UDP network.</div><pre><a name="cmDspNetNoteSelect"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kTrigNnId"></a><span class="e">kTrigNnId</span><span class="p">,</span>
  <a name="kDoneNnId"></a><span class="e">kDoneNnId</span><span class="p">,</span>
  <a name="kGateBaseNnId"></a><span class="e">kGateBaseNnId</span>
<span class="p">}</span><span class="p">;</span>


<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmNetNoteSelectDC<span class="p">;</span>

<span class="m">#define </span><a name="_cmNetNoteSelPortCnt"></a><span class="m">_cmNetNoteSelPortCnt</span><span class="m"> (10)</span>


<a name="cmDspNetNoteSelect_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspNetNoteSelect_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNetNoteSelect_t.chCnt"></a><span class="i">chCnt</span><span class="p">;</span> 
  <span class="k">unsigned</span>       <a name="cmDspNetNoteSelect_t.rmsBaseNnId"></a><span class="i">rmsBaseNnId</span><span class="p">;</span>
  
  <span class="k">unsigned</span>       <a name="cmDspNetNoteSelect_t.gateBaseNNId"></a><span class="i">gateBaseNNId</span><span class="p">[</span> <a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a> <span class="p">]</span><span class="p">;</span>
  
  
  <span class="k">bool</span><span class="p">*</span>     <a name="cmDspNetNoteSelect_t.chGateV"></a><span class="i">chGateV</span><span class="p">;</span>            <span class="c"> // chGateV[chCnt]</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span> <a name="cmDspNetNoteSelect_t.chRmsV"></a><span class="i">chRmsV</span><span class="p">;</span>             <span class="c"> // chRmsV[ chCnt ];</span>
  <span class="k">unsigned</span><span class="p">*</span> <a name="cmDspNetNoteSelect_t.portChCntV"></a><span class="i">portChCntV</span><span class="p">;</span>         <span class="c"> // portChCntV[ 10 ]</span>
  <span class="k">unsigned</span><span class="p">*</span> <a name="cmDspNetNoteSelect_t.portBaseIdV"></a><span class="i">portBaseIdV</span><span class="p">;</span>        <span class="c"> // portBaseIdV[ 10 ]</span>
  <span class="k">unsigned</span><span class="p">*</span> <a name="cmDspNetNoteSelect_t.chPortV"></a><span class="i">chPortV</span><span class="p">;</span>            <span class="c"> // chPortV[ chCnt ]</span>
  <span class="k">unsigned</span><span class="p">*</span> <a name="cmDspNetNoteSelect_t.chPortIdxV"></a><span class="i">chPortIdxV</span><span class="p">;</span>         <span class="c"> // chPortIdxV[ chCnt ]</span>
  <span class="k">unsigned</span><span class="p">*</span> <a name="cmDspNetNoteSelect_t.ncPortV"></a><span class="i">ncPortV</span><span class="p">;</span>            <span class="c"> // ncPortV[ chCnt ]</span>
  <span class="k">unsigned</span><span class="p">*</span> <a name="cmDspNetNoteSelect_t.ncPortIdxV"></a><span class="i">ncPortIdxV</span><span class="p">;</span>         <span class="c"> // ncPortIdxV[ chCnt ]</span>
  
  <span class="k">unsigned</span>       <a name="cmDspNetNoteSelect_t.count"></a><span class="i">count</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspNetNoteSelect_t.doneSymId"></a><span class="i">doneSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspNetNoteSelectAlloc_defn"></a><a name="_cmDspNetNoteSelectAlloc"></a><span class="f">_cmDspNetNoteSelectAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  
  <span class="k">unsigned</span>        chCnt         <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> label         <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> chPortRsrc    <span class="p">=</span> <span class="l">&quotnsChSelChV&quot</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>       chPortV       <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> chPortIdxRsrc <span class="p">=</span> <span class="l">&quotnsChSelChIdxV&quot</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>       chPortIdxV    <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> ncPortRsrc    <span class="p">=</span> <span class="l">&quotnsNcSelChV&quot</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>       ncPortV       <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> ncPortIdxRsrc <span class="p">=</span> <span class="l">&quotnsNcSelChIdxV&quot</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>       ncPortIdxV    <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="k">unsigned</span> i<span class="p">,</span>j<span class="p">,</span>n<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quottrig&quot</span><span class="p">,</span>    <a href="#kTrigNnId">kTrigNnId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>                  <span class="l">&quotTrigger note selection.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotdone&quot</span><span class="p">,</span>    <a href="#kDoneNnId">kDoneNnId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                   <span class="l">&quotSends 'done' after new set of outputs have been sent.&quot</span><span class="p">}</span><span class="p">,</span>
  <span class="p">}</span><span class="p">;</span>
  
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcUIntArray">cmDspRsrcUIntArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>chCnt<span class="p">,</span> <span class="p">&amp</span>chPortV<span class="p">,</span> label <span class="p">=</span> chPortRsrc<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kRsrcNotFoundDspRC">kRsrcNotFoundDspRC</a><span class="p">,</span><span class="l">&quotThe resource '%s' could not be read.&quot</span><span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcUIntArray">cmDspRsrcUIntArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>n<span class="p">,</span> <span class="p">&amp</span>chPortIdxV<span class="p">,</span> label <span class="p">=</span> chPortIdxRsrc<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kRsrcNotFoundDspRC">kRsrcNotFoundDspRC</a><span class="p">,</span><span class="l">&quotThe resource '%s' could not be read.&quot</span><span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  assert<span class="p">(</span>n <span class="p">=</span><span class="p">=</span> chCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcUIntArray">cmDspRsrcUIntArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>n<span class="p">,</span> <span class="p">&amp</span>ncPortV<span class="p">,</span> label <span class="p">=</span> ncPortRsrc<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kRsrcNotFoundDspRC">kRsrcNotFoundDspRC</a><span class="p">,</span><span class="l">&quotThe resource '%s' could not be read.&quot</span><span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  assert<span class="p">(</span>n <span class="p">=</span><span class="p">=</span> chCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcUIntArray">cmDspRsrcUIntArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>n<span class="p">,</span> <span class="p">&amp</span>ncPortIdxV<span class="p">,</span> label <span class="p">=</span> ncPortIdxRsrc<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kRsrcNotFoundDspRC">kRsrcNotFoundDspRC</a><span class="p">,</span><span class="l">&quotThe resource '%s' could not be read.&quot</span><span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  assert<span class="p">(</span>n <span class="p">=</span><span class="p">=</span> chCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> fixArgCnt     <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> rmsBaseNnId   <span class="p">=</span> <a href="#kGateBaseNnId">kGateBaseNnId</a> <span class="p">+</span> chCnt<span class="p">;</span>
  
  <span class="c">// get the count of ch's on each port</span>
  <span class="k">unsigned</span><span class="p">*</span> portChCntV  <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhAllocZ">cmLhAllocZ</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span> <span class="k">unsigned</span><span class="p">,</span> <a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a> <span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span> portBaseIdV <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhAllocZ">cmLhAllocZ</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span> <span class="k">unsigned</span><span class="p">,</span> <a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a> <span class="p">)</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span><a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a><span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the count of ch's in the ith gate output port</span>
    portChCntV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> cmVOU_Count<span class="p">(</span> chPortV<span class="p">,</span> chCnt<span class="p">,</span> i <span class="p">)</span> <span class="p">+</span> cmVOU_Count<span class="p">(</span> ncPortV<span class="p">,</span> chCnt<span class="p">,</span> i <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// ports 1 and 6 are duplicates of ports 0 and 5</span>
    <span class="k">if</span><span class="p">(</span> i <span class="p">=</span><span class="p">=</span> <span class="l">1</span> <span class="p">|</span><span class="p">|</span> i <span class="p">=</span><span class="p">=</span> <span class="l">6</span> <span class="p">)</span>
      portChCntV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> portChCntV<span class="p">[</span>i<span class="l">-1</span><span class="p">]</span><span class="p">;</span>
    
    <span class="c">// set the base port id for this port</span>
    <span class="k">if</span><span class="p">(</span> i <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span>
      portBaseIdV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> portBaseIdV<span class="p">[</span>i<span class="l">-1</span><span class="p">]</span> <span class="p">+</span> portChCntV<span class="p">[</span>i<span class="l">-1</span><span class="p">]</span><span class="p">;</span>
    <span class="k">else</span>
      portBaseIdV<span class="p">[</span> i <span class="p">]</span> <span class="p">=</span> rmsBaseNnId <span class="p">+</span> chCnt<span class="p">;</span>
    
  <span class="p">}</span>
  
  
  <span class="k">unsigned</span> argCnt  <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="p">(</span><span class="l">2</span><span class="p">*</span>chCnt<span class="p">)</span> <span class="p">+</span> cmVOU_Sum<span class="p">(</span>portChCntV<span class="p">,</span><a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>       a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">*</span> p<span class="p">;</span>
  
  <span class="c">// setup the input gate detectors and the output gain args </span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>  a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kGateBaseNnId">kGateBaseNnId</a><span class="p">,</span> chCnt<span class="p">,</span>   <span class="l">&quotgate&quot</span><span class="p">,</span>   <a href="#kGateBaseNnId">kGateBaseNnId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate input.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> rmsBaseNnId<span class="p">,</span>   chCnt<span class="p">,</span>   <span class="l">&quotrms&quot</span><span class="p">,</span>    rmsBaseNnId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotChannel RMS input&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-0&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 0 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">1</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">1</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-1&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">1</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 1 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">2</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">2</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-2&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">2</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 2 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">3</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">3</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-3&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">3</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 3 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">4</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">4</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-4&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">4</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 4 output.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">5</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">5</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-5&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">5</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 5 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">6</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">6</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-6&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">6</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 6 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">7</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">7</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-7&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">7</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 7 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">8</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">8</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-8&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">8</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 8 output.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">9</span><span class="p">]</span><span class="p">,</span> portChCntV<span class="p">[</span><span class="l">9</span><span class="p">]</span><span class="p">,</span> <span class="l">&quotgate-9&quot</span><span class="p">,</span> portBaseIdV<span class="p">[</span><span class="l">9</span><span class="p">]</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate set 9 output.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTrigNnId">kTrigNnId</a><span class="p">,</span>      false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDoneNnId">kDoneNnId</a><span class="p">,</span>  <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  
  
  p<span class="p">-</span><span class="p">&gt</span>rmsBaseNnId   <span class="p">=</span> rmsBaseNnId<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>chCnt       <span class="p">=</span> chCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chGateV     <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">bool</span><span class="p">,</span>chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chRmsV      <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">,</span>chCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>portChCntV  <span class="p">=</span> portChCntV<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>portBaseIdV <span class="p">=</span> portBaseIdV<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>doneSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotdone&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chPortV     <span class="p">=</span> chPortV<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>chPortIdxV  <span class="p">=</span> chPortIdxV<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>ncPortV     <span class="p">=</span> ncPortV<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>ncPortIdxV  <span class="p">=</span> ncPortIdxV<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGateBaseNnId">kGateBaseNnId</a><span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> rmsBaseNnId<span class="p">+</span>i<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span>   <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>    
  <span class="p">}</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span><a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a><span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>portChCntV<span class="p">[</span>i<span class="p">]</span><span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>portBaseIdV<span class="p">[</span>i<span class="p">]</span><span class="p">+</span>j<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNetNoteSelectFree_defn"></a><a name="_cmDspNetNoteSelectFree"></a><span class="f">_cmDspNetNoteSelectFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNetNoteSelectReset_defn"></a><a name="_cmDspNetNoteSelectReset"></a><span class="f">_cmDspNetNoteSelectReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  cmVOR_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNetNoteSelectRecv_defn"></a><a name="_cmDspNetNoteSelectRecv"></a><span class="f">_cmDspNetNoteSelectRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>           rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNetNoteSelect_t">cmDspNetNoteSelect_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="c">// store incoming gate  values</span>
  <span class="k">if</span><span class="p">(</span> <a href="#kGateBaseNnId">kGateBaseNnId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kGateBaseNnId">kGateBaseNnId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kGateBaseNnId">kGateBaseNnId</a> <span class="p">]</span> <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetBool">cmDsvGetBool</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    
    <span class="c">//unsigned idx = evt-&ampgtdstVarId - <a href="#kGateBaseNnId">kGateBaseNnId</a>;
    //<a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a>(ctx-&ampgtrpt,&ampquotns gate:%i %i\n&ampquot,idx, p-&ampgtchGateV[ idx ]);</span>    
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="c">// store incoming RMS values</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseNnId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseNnId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">[</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>rmsBaseNnId <span class="p">]</span> <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetReal">cmDsvGetReal</a><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>valuePtr <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c">// if a chord detection was triggered</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kTrigNnId">kTrigNnId</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> i<span class="p">;</span>
      <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> maxRms <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      <span class="k">unsigned</span> maxIdx <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">1</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <span class="c">// if this channel had an onset and is a possible chord note and is the max RMS chord note</span>
        <span class="k">if</span><span class="p">(</span>  p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span>i<span class="p">]</span> <span class="p">&amp</span><span class="p">&amp</span>  <span class="p">(</span>maxIdx<span class="p">=</span><span class="p">=</span><a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">[</span>i<span class="p">]</span> <span class="p">&gt</span> maxRms<span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
          maxRms <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
          maxIdx <span class="p">=</span> i<span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <span class="k">bool</span> chosenFl <span class="p">=</span> i<span class="p">=</span><span class="p">=</span>maxIdx<span class="p">;</span>
        <span class="k">bool</span> otherFl  <span class="p">=</span> i<span class="p">!</span><span class="p">=</span>maxIdx <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>chGateV<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
        <span class="k">bool</span> nonFl    <span class="p">=</span> chosenFl<span class="p">=</span><span class="p">=</span>false <span class="p">&amp</span><span class="p">&amp</span> otherFl<span class="p">=</span><span class="p">=</span>false<span class="p">;</span>
        <span class="k">unsigned</span> k<span class="p">;</span>
        
        <span class="c">// if this is a chord channel</span>
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>chPortV<span class="p">[</span>i<span class="p">]</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
        <span class="p">{</span>
          <span class="c">// get the port associated with this chord note</span>
          k <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>chPortV<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
          
          assert<span class="p">(</span> k<span class="p">+</span><span class="l">1</span> <span class="p">&lt</span> <a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a> <span class="p">)</span><span class="p">;</span>
          assert<span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>chPortIdxV<span class="p">[</span>i<span class="p">]</span> <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>portChCntV<span class="p">[</span>k<span class="p">]</span> <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>chPortIdxV<span class="p">[</span>i<span class="p">]</span> <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>portChCntV<span class="p">[</span>k<span class="p">+</span><span class="l">1</span><span class="p">]</span> <span class="p">)</span><span class="p">;</span>
          
          <span class="c">// set the chosen and other gate outputs based on the state of 
          // chosenFl and otherFl</span>          
          <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>portBaseIdV<span class="p">[</span> k   <span class="p">]</span> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chPortIdxV<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>chosenFl<span class="p">)</span><span class="p">;</span>
          <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>portBaseIdV<span class="p">[</span> k<span class="p">+</span><span class="l">1</span> <span class="p">]</span> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chPortIdxV<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>otherFl<span class="p">)</span><span class="p">;</span>            
        <span class="p">}</span>
        
        <span class="c">// all channels have a 'single' note channel</span>
        assert<span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>ncPortV<span class="p">[</span>i<span class="p">]</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span><span class="p">;</span>
        
        k <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>ncPortV<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
        
        assert<span class="p">(</span> k <span class="p">&lt</span> <a href="#_cmNetNoteSelPortCnt">_cmNetNoteSelPortCnt</a> <span class="p">)</span><span class="p">;</span>
        assert<span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>ncPortIdxV<span class="p">[</span>i<span class="p">]</span> <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>portChCntV<span class="p">[</span>k<span class="p">]</span> <span class="p">)</span><span class="p">;</span>
        
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>portBaseIdV<span class="p">[</span>k<span class="p">]</span> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>ncPortIdxV<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>nonFl<span class="p">)</span><span class="p">;</span>
        
      <span class="p">}</span>
      
      <span class="c">// send the 'done' symbol to notify the gate receivers that the
      // new set of gates is complete</span>      
      <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kDoneNnId">kDoneNnId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>doneSymId<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// zero the RMS vector</span>
      cmVOR_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>chRmsV<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmNetNoteSelectClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmNetNoteSelectClassCons">cmNetNoteSelectClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmNetNoteSelectDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotNetNoteSelect&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNetNoteSelectAlloc">_cmDspNetNoteSelectAlloc</a><span class="p">,</span>
  <a href="#_cmDspNetNoteSelectFree">_cmDspNetNoteSelectFree</a><span class="p">,</span>
  <a href="#_cmDspNetNoteSelectReset">_cmDspNetNoteSelectReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNetNoteSelectRecv">_cmDspNetNoteSelectRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotChord detector.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmNetNoteSelectDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspCombFilt : Comb and Inverse comb filter.</div><pre><a name="cmDspCombFilt"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassCfId"></a><span class="e">kBypassCfId</span><span class="p">,</span>
  <a name="kMinHzCfId"></a><span class="e">kMinHzCfId</span><span class="p">,</span>
  <a name="kFbFlCfId"></a><span class="e">kFbFlCfId</span><span class="p">,</span>
  <a name="kHzCfId"></a><span class="e">kHzCfId</span><span class="p">,</span>
  <a name="kAlphaCfId"></a><span class="e">kAlphaCfId</span><span class="p">,</span>
  <a name="kInCfId"></a><span class="e">kInCfId</span><span class="p">,</span>
  <a name="kOutCfId"></a><span class="e">kOutCfId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmCombFiltDC<span class="p">;</span>

<a name="cmDspCombFilt_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspCombFilt_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmCombFilt">cmCombFilt</a><span class="p">*</span>    <a name="cmDspCombFilt_t.cfp"></a><span class="i">cfp</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspCombFilt_t">cmDspCombFilt_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspCombFiltAlloc_defn"></a><a name="_cmDspCombFiltAlloc"></a><span class="f">_cmDspCombFiltAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassCfId">kBypassCfId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>   <span class="l">&quotBypass enable flag.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotminhz&quot</span><span class="p">,</span> <a href="#kMinHzCfId">kMinHzCfId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>            <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>   <span class="l">&quotMinimum frequency limit.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfb&quot</span><span class="p">,</span>    <a href="#kFbFlCfId">kFbFlCfId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>   <span class="l">&quotConfigure the filter in feedback mode.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quothz&quot</span><span class="p">,</span>    <a href="#kHzCfId">kHzCfId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>   <span class="l">&quotLowest comb frequency.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotalpha&quot</span><span class="p">,</span> <a href="#kAlphaCfId">kAlphaCfId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>   <span class="l">&quotFilter coefficent.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInCfId">kInCfId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>                <span class="l">&quotAudio input.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutCfId">kOutCfId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>                <span class="l">&quotAudio out.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span>    <span class="l">0</span><span class="p">,</span>           <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> NULL <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span> p<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>cfp <span class="p">=</span> <a href="cmProc3_h_0.html#cmCombFiltAlloc">cmCombFiltAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFbFlCfId">kFbFlCfId</a><span class="p">)</span><span class="p">,</span>
  <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMinHzCfId">kMinHzCfId</a><span class="p">)</span><span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kAlphaCfId">kAlphaCfId</a><span class="p">)</span><span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kHzCfId">kHzCfId</a><span class="p">)</span><span class="p">,</span>
  <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kBypassCfId">kBypassCfId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCombFiltFree_defn"></a><a name="_cmDspCombFiltFree"></a><span class="f">_cmDspCombFiltFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmCombFiltFree">cmCombFiltFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>cfp<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCombFiltReset_defn"></a><a name="_cmDspCombFiltReset"></a><span class="f">_cmDspCombFiltReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  rc               <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCfId">kOutCfId</a><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmCombFiltInit">cmCombFiltInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>cfp<span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFbFlCfId">kFbFlCfId</a><span class="p">)</span><span class="p">,</span>
  <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMinHzCfId">kMinHzCfId</a><span class="p">)</span><span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kAlphaCfId">kAlphaCfId</a><span class="p">)</span><span class="p">,</span> 
  <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kHzCfId">kHzCfId</a><span class="p">)</span><span class="p">,</span>
  <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassCfId">kBypassCfId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCombFiltExec_defn"></a><a name="_cmDspCombFiltExec"></a><span class="f">_cmDspCombFiltExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span>  p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">unsigned</span>          n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCfId">kOutCfId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       op <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCfId">kOutCfId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInCfId">kInCfId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmCombFiltExec">cmCombFiltExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>cfp<span class="p">,</span>ip<span class="p">,</span>op<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCombFiltRecv_defn"></a><a name="_cmDspCombFiltRecv"></a><span class="f">_cmDspCombFiltRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspCombFilt_t">cmDspCombFilt_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kHzCfId">kHzCfId</a><span class="p">:</span>
      <a href="cmProc3_h_0.html#cmCombFiltSetHz">cmCombFiltSetHz</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>cfp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="c">//printf(&ampquot%s hz:%f\n&ampquot,<a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a>(ctx-&ampgtstH,inst-&ampgtsymId),<a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a>(inst,evt-&ampgtdstVarId));</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kAlphaCfId">kAlphaCfId</a><span class="p">:</span>
      <a href="cmProc3_h_0.html#cmCombFiltSetAlpha">cmCombFiltSetAlpha</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>cfp<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kBypassCfId">kBypassCfId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>cfp<span class="p">-</span><span class="p">&gt</span>bypassFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmCombFiltClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmCombFiltClassCons">cmCombFiltClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmCombFiltDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotCombFilt&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCombFiltAlloc">_cmDspCombFiltAlloc</a><span class="p">,</span>
  <a href="#_cmDspCombFiltFree">_cmDspCombFiltFree</a><span class="p">,</span>
  <a href="#_cmDspCombFiltReset">_cmDspCombFiltReset</a><span class="p">,</span>
  <a href="#_cmDspCombFiltExec">_cmDspCombFiltExec</a><span class="p">,</span>
  <a href="#_cmDspCombFiltRecv">_cmDspCombFiltRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotComb Filter&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmCombFiltDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspScalarOp : Perform arithmetic functions on scalar values.</div><pre><a name="cmDspScalarOp"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kPortCntSoId"></a><span class="e">kPortCntSoId</span><span class="p">,</span>
  <a name="kOpSoId"></a><span class="e">kOpSoId</span><span class="p">,</span>
  <a name="kOutSoId"></a><span class="e">kOutSoId</span><span class="p">,</span>
  <a name="kBaseOpdSoId"></a><span class="e">kBaseOpdSoId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmScalarOpDC<span class="p">;</span>
<span class="k">struct</span> <span class="i">cmDspScalarOp_str</span><span class="p">;</span>

<span class="k">typedef</span> <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <span class="p">(</span><span class="p">*</span><a name="_cmDspScalarOpFunc_t"></a><span class="t">_cmDspScalarOpFunc_t</span><span class="p">)</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">)</span><span class="p">;</span>


<a name="cmDspScalarOp_t"></a><span class="k">typedef</span> <span class="k">struct</span> <a name="cmDspScalar_str"></a>cmDspScalar_str
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>          <a name="cmDspScalarOp_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="#_cmDspScalarOpFunc_t">_cmDspScalarOpFunc_t</a> <a name="cmDspScalarOp_t.func"></a><span class="i">func</span><span class="p">;</span>
  <span class="k">unsigned</span>             <a name="cmDspScalarOp_t.inPortCnt"></a><span class="i">inPortCnt</span><span class="p">;</span>
  <span class="k">bool</span>                 <a name="cmDspScalarOp_t.allActiveFl"></a><span class="i">allActiveFl</span><span class="p">;</span>                  
<span class="p">}</span> <span class="t"><a href="#cmDspScalarOp_t">cmDspScalarOp_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspScalarOpFuncMult_defn"></a><a name="_cmDspScalarOpFuncMult"></a><span class="f">_cmDspScalarOpFuncMult</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">double</span> val <span class="p">=</span> <span class="l">1.0</span><span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    val <span class="p">*</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kBaseOpdSoId">kBaseOpdSoId</a><span class="p">+</span>i <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOutSoId">kOutSoId</a><span class="p">,</span> val <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspScalarOpFuncAdd_defn"></a><a name="_cmDspScalarOpFuncAdd"></a><span class="f">_cmDspScalarOpFuncAdd</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">double</span> val <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    val <span class="p">+</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kBaseOpdSoId">kBaseOpdSoId</a><span class="p">+</span>i <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOutSoId">kOutSoId</a><span class="p">,</span> val <span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<span class="c">// var args syntax: &ampquot&ampltin_port_cnt&ampgt &ampltop_string&ampgt &ampltopd_label_0&ampgt &ampltopd_dflt_val_0&ampgt  &ampltopd_label_1&ampgt &ampltopd_dflt_val_1&ampgt ...  &ampltopd_label_n&ampgt &ampltopd_dflt_val_n&ampgt </span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspScalarOpAlloc_defn"></a><a name="_cmDspScalarOpAlloc"></a><span class="f">_cmDspScalarOpAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>  
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotcnt&quot</span><span class="p">,</span>   <a href="#kPortCntSoId">kPortCntSoId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput port count&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span>  <span class="l">&quotop&quot</span><span class="p">,</span>   <a href="#kOpSoId">kOpSoId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotOperation symbol as a string.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span>  <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutSoId">kOutSoId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>  <span class="l">&quotOperation output.&quot</span><span class="p">}</span><span class="p">,</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">*</span> p<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">2</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'ScalarOp' constructor must have a count of input ports and operation identifier string.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>           inPortCnt <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">unsigned</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span>    opIdStr   <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>           fixArgCnt <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>           argCnt    <span class="p">=</span> fixArgCnt <span class="p">+</span> inPortCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>      a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <span class="k">double</span>             dfltVal<span class="p">[</span> inPortCnt <span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span>           i<span class="p">;</span>
  <a href="#_cmDspScalarOpFunc_t">_cmDspScalarOpFunc_t</a> fp <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">bool</span> allActiveFl <span class="p">=</span> false<span class="p">;</span>
  
  <span class="c">// validate the count of input ports</span>
  <span class="k">if</span><span class="p">(</span> inPortCnt <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe 'ScalarOp' constructor input port argument must be non-zero.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> opIdStr <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> opIdStr<span class="p">[</span><span class="l">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="l">'*'</span><span class="p">:</span>
      fp <span class="p">=</span> <a href="#_cmDspScalarOpFuncMult">_cmDspScalarOpFuncMult</a><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="l">'+'</span><span class="p">:</span>
      fp <span class="p">=</span> <a href="#_cmDspScalarOpFuncAdd">_cmDspScalarOpFuncAdd</a><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>      
    <span class="p">}</span>
    
    <span class="c">// if the second character of the operator string is '$' then all input ports trigger an output</span>
    <span class="k">if</span><span class="p">(</span> strlen<span class="p">(</span> opIdStr <span class="p">)</span> <span class="p">&gt</span> <span class="l">0</span> <span class="p">&amp</span><span class="p">&amp</span> opIdStr<span class="p">[</span><span class="l">1</span><span class="p">]</span><span class="p">=</span><span class="p">=</span><span class="l">'$'</span> <span class="p">)</span>
      allActiveFl <span class="p">=</span> true<span class="p">;</span>
    
    
  <span class="p">}</span>
  
  
  
  <span class="c">// validate the operation function</span>
  <span class="k">if</span><span class="p">(</span> fp <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe 'ScalarOp' constructor operation string id '%s' did not match a known operation.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>opIdStr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// setup the fixed args</span>
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>  a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the operand label</span>
    <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> label <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span><span class="p">)</span><span class="p">;</span> 
    
    <span class="c">// get the operand default value</span>
    dfltVal<span class="p">[</span>i<span class="p">]</span>            <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// setup the arg recd</span>
    <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span>a <span class="p">+</span> fixArgCnt <span class="p">+</span> i<span class="p">,</span> label<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kBaseOpdSoId">kBaseOpdSoId</a><span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">|</span><a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span><span class="l">&quotOperand&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">2</span><span class="p">,</span>vl1<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    goto errLabel<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kBaseOpdSoId">kBaseOpdSoId</a><span class="p">+</span>i<span class="p">,</span><span class="l">0.0</span><span class="p">,</span>dfltVal<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>inPortCnt <span class="p">=</span> inPortCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>func      <span class="p">=</span> fp<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>allActiveFl <span class="p">=</span> allActiveFl<span class="p">;</span>
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
  
  errLabel<span class="p">:</span>
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> NULL<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspScalarOpReset_defn"></a><a name="_cmDspScalarOpReset"></a><span class="f">_cmDspScalarOpReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  rc               <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspScalarOpRecv_defn"></a><a name="_cmDspScalarOpRecv"></a><span class="f">_cmDspScalarOpRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspScalarOp_t">cmDspScalarOp_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kBaseOpdSoId">kBaseOpdSoId</a> <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>allActiveFl <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>func<span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmScalarOpClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmScalarOpClassCons">cmScalarOpClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmScalarOpDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotScalarOp&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspScalarOpAlloc">_cmDspScalarOpAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspScalarOpReset">_cmDspScalarOpReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspScalarOpRecv">_cmDspScalarOpRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotScalar Operations&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmScalarOpDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspGroupSel : Select one group of audio channels from a set of audio channel groups.</div><pre><a name="cmDspGroupSel"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kChCntGsId"></a><span class="e">kChCntGsId</span><span class="p">,</span>
  <a name="kGroupCntGsId"></a><span class="e">kGroupCntGsId</span><span class="p">,</span>
  <a name="kChsPerGroupGsId"></a><span class="e">kChsPerGroupGsId</span><span class="p">,</span>
  <a name="kBaseGateGsId"></a><span class="e">kBaseGateGsId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmGroupSelDC<span class="p">;</span>

<a name="cmDspGroupSel_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspGroupSel_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspGroupSel_t.chCnt"></a><span class="i">chCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspGroupSel_t.groupCnt"></a><span class="i">groupCnt</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmGroupSel">cmGroupSel</a><span class="p">*</span>  <a name="cmDspGroupSel_t.gsp"></a><span class="i">gsp</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspGroupSel_t.baseRmsGsId"></a><span class="i">baseRmsGsId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspGroupSel_t.baseOutGsId"></a><span class="i">baseOutGsId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspGroupSel_t">cmDspGroupSel_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspGroupSelAlloc_defn"></a><a name="_cmDspGroupSelAlloc"></a><span class="f">_cmDspGroupSelAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotchCnt&quot</span><span class="p">,</span>       <a href="#kChCntGsId">kChCntGsId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel count.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgroupCnt&quot</span><span class="p">,</span>    <a href="#kGroupCntGsId">kGroupCntGsId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>   <span class="l">&quotGroup count.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotchsPerGroup&quot</span><span class="p">,</span> <a href="#kChsPerGroupGsId">kChsPerGroupGsId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotChannels per group.&quot</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">2</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'GroupSel' constructor must have a channel and group count.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span> p<span class="p">;</span>
  <span class="k">unsigned</span>         i<span class="p">;</span>
  <span class="k">unsigned</span>         chCnt       <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">unsigned</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>         groupCnt    <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">unsigned</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>         outCnt      <span class="p">=</span> chCnt <span class="p">*</span> groupCnt<span class="p">;</span>
  <span class="k">unsigned</span>         fixArgCnt   <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>         baseRmsGsId <span class="p">=</span> <a href="#kBaseGateGsId">kBaseGateGsId</a> <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span>         baseOutGsId <span class="p">=</span> baseRmsGsId   <span class="p">+</span> chCnt<span class="p">;</span>
  <span class="k">unsigned</span>         argCnt      <span class="p">=</span> baseOutGsId   <span class="p">+</span> outCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>    a<span class="p">[</span> argCnt <span class="p">+</span> <span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>  a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kBaseGateGsId">kBaseGateGsId</a><span class="p">,</span> chCnt<span class="p">,</span> <span class="l">&quotgate&quot</span><span class="p">,</span>  <a href="#kBaseGateGsId">kBaseGateGsId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotChannel gate input.&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> baseRmsGsId<span class="p">,</span>   chCnt<span class="p">,</span> <span class="l">&quotrms&quot</span><span class="p">,</span>   baseRmsGsId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotChannel RMS input&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>groupCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">int</span>  labelCharCnt <span class="p">=</span> <span class="l">31</span><span class="p">;</span>
    <span class="k">char</span> label<span class="p">[</span> labelCharCnt <span class="p">+</span> <span class="l">1</span> <span class="p">]</span><span class="p">;</span>
    snprintf<span class="p">(</span>label<span class="p">,</span>labelCharCnt<span class="p">,</span><span class="l">&quotgate-%i&quot</span><span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> baseOutGsId <span class="p">+</span> <span class="p">(</span>i<span class="p">*</span>chCnt<span class="p">)</span><span class="p">,</span> chCnt<span class="p">,</span> label<span class="p">,</span> baseOutGsId <span class="p">+</span> <span class="p">(</span>i<span class="p">*</span>chCnt<span class="p">)</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>   <span class="l">&quotOutput gates&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt<span class="p">)</span><span class="p">;</span> <span class="c"> // set terminating arg. flag</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>chCnt       <span class="p">=</span> chCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>groupCnt    <span class="p">=</span> groupCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>gsp         <span class="p">=</span> <a href="cmProc3_h_0.html#cmGroupSelAlloc">cmGroupSelAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseRmsGsId <span class="p">=</span> baseRmsGsId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutGsId <span class="p">=</span> baseOutGsId<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBaseGateGsId">kBaseGateGsId</a><span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseRmsGsId<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span>   <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>outCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseOutGsId<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGroupSelFree_defn"></a><a name="_cmDspGroupSelFree"></a><span class="f">_cmDspGroupSelFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmGroupSelFree">cmGroupSelFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGroupSelReset_defn"></a><a name="_cmDspGroupSelReset"></a><span class="f">_cmDspGroupSelReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  rc               <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmGroupSelInit">cmGroupSelInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>groupCnt<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kChsPerGroupGsId">kChsPerGroupGsId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGroupSelExec_defn"></a><a name="_cmDspGroupSelExec"></a><span class="f">_cmDspGroupSelExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmProc3_h_0.html#cmGroupSelExec">cmGroupSelExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">-</span><span class="p">&gt</span>updateFl <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> i<span class="p">,</span>j<span class="p">;</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>groupCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="p">{</span>
      <a href="cmProc3_h_0.html#cmGroupSelGrp">cmGroupSelGrp</a><span class="p">*</span> gp <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">-</span><span class="p">&gt</span>groupArray <span class="p">+</span> i<span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> gp<span class="p">-</span><span class="p">&gt</span>releaseFl <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>gp<span class="p">-</span><span class="p">&gt</span>chIdxCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutGsId <span class="p">+</span> <span class="p">(</span>i<span class="p">*</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span> <span class="p">+</span> gp<span class="p">-</span><span class="p">&gt</span>chIdxArray<span class="p">[</span>j<span class="p">]</span><span class="p">,</span> false<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">if</span><span class="p">(</span> gp<span class="p">-</span><span class="p">&gt</span>createFl <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>gp<span class="p">-</span><span class="p">&gt</span>chIdxCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutGsId <span class="p">+</span> <span class="p">(</span>i<span class="p">*</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span> <span class="p">+</span> gp<span class="p">-</span><span class="p">&gt</span>chIdxArray<span class="p">[</span>j<span class="p">]</span><span class="p">,</span> true<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGroupSelRecv_defn"></a><a name="_cmDspGroupSelRecv"></a><span class="f">_cmDspGroupSelRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspGroupSel_t">cmDspGroupSel_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kChsPerGroupGsId">kChsPerGroupGsId</a> <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">-</span><span class="p">&gt</span>chsPerGroup <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kChsPerGroupGsId">kChsPerGroupGsId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">if</span><span class="p">(</span> <a href="#kBaseGateGsId">kBaseGateGsId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <span class="p">(</span><a href="#kBaseGateGsId">kBaseGateGsId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span> <span class="p">)</span>
        <a href="cmProc3_h_0.html#cmGroupSetChannelGate">cmGroupSetChannelGate</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kBaseGateGsId">kBaseGateGsId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseRmsGsId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>baseRmsGsId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">)</span> <span class="p">)</span>
        <a href="cmProc3_h_0.html#cmGroupSetChannelRMS">cmGroupSetChannelRMS</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>gsp<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>baseRmsGsId<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmGroupSelClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmGroupSelClassCons">cmGroupSelClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmGroupSelDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotGroupSel&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspGroupSelAlloc">_cmDspGroupSelAlloc</a><span class="p">,</span>
  <a href="#_cmDspGroupSelFree">_cmDspGroupSelFree</a><span class="p">,</span>
  <a href="#_cmDspGroupSelReset">_cmDspGroupSelReset</a><span class="p">,</span>
  <a href="#_cmDspGroupSelExec">_cmDspGroupSelExec</a><span class="p">,</span>
  <a href="#_cmDspGroupSelRecv">_cmDspGroupSelRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotGroup selector.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmGroupSelDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspNofM : Select N channels from a set of M channels based on their current gate states.</div><pre><a name="cmDspNofM"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kInChCntNmId"></a><span class="e">kInChCntNmId</span><span class="p">,</span>
  <a name="kOutChCntNmId"></a><span class="e">kOutChCntNmId</span><span class="p">,</span>
  <a name="kFadeTimeNmId"></a><span class="e">kFadeTimeNmId</span><span class="p">,</span>
  <a name="kBaseGateNmId"></a><span class="e">kBaseGateNmId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAudioNofM_DC<span class="p">;</span>

<a name="cmDspAudioNofM_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspAudioNofM_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAudioNofM_t.inChCnt"></a><span class="i">inChCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAudioNofM_t.outChCnt"></a><span class="i">outChCnt</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmAudioNofM">cmAudioNofM</a><span class="p">*</span>  <a name="cmDspAudioNofM_t.nmp"></a><span class="i">nmp</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAudioNofM_t.baseInNmId"></a><span class="i">baseInNmId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAudioNofM_t.baseOutNmId"></a><span class="i">baseOutNmId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAudioNofM_t.baseGainNmId"></a><span class="i">baseGainNmId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAudioNofM_Alloc_defn"></a><a name="_cmDspAudioNofM_Alloc"></a><span class="f">_cmDspAudioNofM_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">2</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'AudioNofM' constructor must given input and output channel counts.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>           inChCnt     <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">int</span>           outChCnt    <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>      baseInNmId  <span class="p">=</span> <a href="#kBaseGateNmId">kBaseGateNmId</a> <span class="p">+</span> inChCnt<span class="p">;</span>
  <span class="k">unsigned</span>      baseOutNmId <span class="p">=</span> baseInNmId    <span class="p">+</span> inChCnt<span class="p">;</span>
  <span class="k">unsigned</span>      baseGainNmId<span class="p">=</span> baseOutNmId   <span class="p">+</span> outChCnt<span class="p">;</span>
  <span class="k">unsigned</span>      i<span class="p">;</span>
  
  <a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotichs&quot</span><span class="p">,</span>  <a href="#kInChCntNmId">kInChCntNmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>            <span class="l">&quotInput channel count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotochs&quot</span><span class="p">,</span>  <a href="#kOutChCntNmId">kOutChCntNmId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>            <span class="l">&quotOutput channel count.&quot</span><span class="p">,</span> 
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quottime&quot</span><span class="p">,</span>  <a href="#kFadeTimeNmId">kFadeTimeNmId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span> <span class="l">&quotFade time in milliseconds.&quot</span><span class="p">,</span>
  inChCnt<span class="p">,</span>   <span class="l">&quotgate&quot</span><span class="p">,</span>  <a href="#kBaseGateNmId">kBaseGateNmId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotGate inputs.&quot</span><span class="p">,</span>
  inChCnt<span class="p">,</span>   <span class="l">&quotin&quot</span><span class="p">,</span>    baseInNmId<span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>          <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  outChCnt<span class="p">,</span>  <span class="l">&quotout&quot</span><span class="p">,</span>   baseOutNmId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>          <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  outChCnt<span class="p">,</span>  <span class="l">&quotgain&quot</span><span class="p">,</span>  baseGainNmId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>            <span class="l">&quotGain output&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFadeTimeNmId">kFadeTimeNmId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">25.0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>inChCnt      <span class="p">=</span> inChCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>outChCnt     <span class="p">=</span> outChCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nmp          <span class="p">=</span> <a href="cmProc3_h_0.html#cmAudioNofMAlloc">cmAudioNofMAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseInNmId   <span class="p">=</span> baseInNmId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutNmId  <span class="p">=</span> baseOutNmId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseGainNmId <span class="p">=</span> baseGainNmId<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>outChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseGainNmId <span class="p">+</span> i<span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioNofM_Free_defn"></a><a name="_cmDspAudioNofM_Free"></a><span class="f">_cmDspAudioNofM_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmAudioNofMFree">cmAudioNofMFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>nmp<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioNofM_Reset_defn"></a><a name="_cmDspAudioNofM_Reset"></a><span class="f">_cmDspAudioNofM_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc               <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>outChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutNmId<span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
    
    <a href="cmProc3_h_0.html#cmAudioNofMInit">cmAudioNofMInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>nmp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>inChCnt<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>outChCnt<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFadeTimeNmId">kFadeTimeNmId</a> <span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioNofM_Exec_defn"></a><a name="_cmDspAudioNofM_Exec"></a><span class="f">_cmDspAudioNofM_Exec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span>  p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> x<span class="p">[</span> p<span class="p">-</span><span class="p">&gt</span>inChCnt <span class="p">]</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       y<span class="p">[</span> p<span class="p">-</span><span class="p">&gt</span>outChCnt <span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span> n <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>inChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> i<span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
      n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseInNmId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
    <span class="p">{</span> assert<span class="p">(</span> n <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseInNmId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
    
    x<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseInNmId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>outChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    y<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutNmId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    
    assert<span class="p">(</span> n <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutNmId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    cmVOS_Zero<span class="p">(</span>y<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <a href="cmProc3_h_0.html#cmAudioNofMExec">cmAudioNofMExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>nmp<span class="p">,</span>x<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>inChCnt<span class="p">,</span>y<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>outChCnt<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>outChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmProc3_h_0.html#cmAudioNofM_In">cmAudioNofM_In</a><span class="p">*</span> ip <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>nmp<span class="p">-</span><span class="p">&gt</span>outArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>list<span class="p">;</span>
    <span class="k">double</span>         v  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    
    <span class="k">for</span><span class="p">(</span><span class="p">;</span> ip <span class="p">!</span><span class="p">=</span> NULL<span class="p">;</span> ip<span class="p">=</span>ip<span class="p">-</span><span class="p">&gt</span>link<span class="p">)</span>
      v <span class="p">+</span><span class="p">=</span> ip<span class="p">-</span><span class="p">&gt</span>fader<span class="p">-</span><span class="p">&gt</span>gain<span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseGainNmId <span class="p">+</span> i<span class="p">,</span>v <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioNofM_Recv_defn"></a><a name="_cmDspAudioNofM_Recv"></a><span class="f">_cmDspAudioNofM_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioNofM_t">cmDspAudioNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <a href="#kBaseGateNmId">kBaseGateNmId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span><span class="p">=</span> <a href="#kBaseGateNmId">kBaseGateNmId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>inChCnt <span class="p">)</span>
      <a href="cmProc3_h_0.html#cmAudioNofMSetChannelGate">cmAudioNofMSetChannelGate</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>nmp<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kBaseGateNmId">kBaseGateNmId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmAudioNofMClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmAudioNofMClassCons">cmAudioNofMClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAudioNofM_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAudioNofM&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAudioNofM_Alloc">_cmDspAudioNofM_Alloc</a><span class="p">,</span>
  <a href="#_cmDspAudioNofM_Free">_cmDspAudioNofM_Free</a><span class="p">,</span>
  <a href="#_cmDspAudioNofM_Reset">_cmDspAudioNofM_Reset</a><span class="p">,</span>
  <a href="#_cmDspAudioNofM_Exec">_cmDspAudioNofM_Exec</a><span class="p">,</span>
  <a href="#_cmDspAudioNofM_Recv">_cmDspAudioNofM_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAudio N of M Switch&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAudioNofM_DC<span class="p">;</span>
<span class="p">}</span>



<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspRingMod : Ring modulator.</div><pre><a name="cmDspRingMod"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInChCntRmId"></a><span class="e">kInChCntRmId</span><span class="p">,</span>
  <a name="kBypassRmId"></a><span class="e">kBypassRmId</span><span class="p">,</span>
  <a name="kGainRmId"></a><span class="e">kGainRmId</span><span class="p">,</span>
  <a name="kOutRmId"></a><span class="e">kOutRmId</span><span class="p">,</span>
  <a name="kBaseInRmId"></a><span class="e">kBaseInRmId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmRingModDC<span class="p">;</span>

<a name="cmDspRingMod_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspRingMod_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRingMod_t.inChCnt"></a><span class="i">inChCnt</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspRingMod_t">cmDspRingMod_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspRingModAlloc_defn"></a><a name="_cmDspRingModAlloc"></a><span class="f">_cmDspRingModAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'RingMod' constructor must given an input channel counts.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>           inChCnt     <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspRingMod_t">cmDspRingMod_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspRingMod_t">cmDspRingMod_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotichs&quot</span><span class="p">,</span>  <a href="#kInChCntRmId">kInChCntRmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>                <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput channel count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassRmId">kBypassRmId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotBypass enable&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotgain&quot</span><span class="p">,</span>  <a href="#kGainRmId">kGainRmId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOutput gain (default:1.0)&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutRmId">kOutRmId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>              <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  inChCnt<span class="p">,</span>   <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kBaseInRmId">kBaseInRmId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>              <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBypassRmId">kBypassRmId</a><span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGainRmId">kGainRmId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>inChCnt <span class="p">=</span> inChCnt<span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRingModReset_defn"></a><a name="_cmDspRingModReset"></a><span class="f">_cmDspRingModReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutRmId">kOutRmId</a><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRingModExec_defn"></a><a name="_cmDspRingModExec"></a><span class="f">_cmDspRingModExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc       <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspRingMod_t">cmDspRingMod_t</a><span class="p">*</span>   p        <span class="p">=</span> <span class="p">(</span><a href="#cmDspRingMod_t">cmDspRingMod_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          i<span class="p">,</span>j<span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       y        <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutRmId">kOutRmId</a><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> x0       <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseInRmId">kBaseInRmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          n        <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutRmId">kOutRmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            gain     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGainRmId">kGainRmId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">bool</span>              bypassFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassRmId">kBypassRmId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">1</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>inChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    assert<span class="p">(</span> n <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseInRmId">kBaseInRmId</a><span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">)</span><span class="p">;</span> 
    
    <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> x1 <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseInRmId">kBaseInRmId</a><span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> bypassFl <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>n<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
        y<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> x0<span class="p">[</span>j<span class="p">]</span> <span class="p">+</span> x1<span class="p">[</span>j<span class="p">]</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>n<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
        y<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> x0<span class="p">[</span>j<span class="p">]</span> <span class="p">*</span> x1<span class="p">[</span>j<span class="p">]</span> <span class="p">*</span> gain<span class="p">;</span>
    <span class="p">}</span>
    
    x0 <span class="p">=</span> y<span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRingModRecv_defn"></a><a name="_cmDspRingModRecv"></a><span class="f">_cmDspRingModRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmRingModClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmRingModClassCons">cmRingModClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmRingModDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotRingMod&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspRingModAlloc">_cmDspRingModAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspRingModReset">_cmDspRingModReset</a><span class="p">,</span>
  <a href="#_cmDspRingModExec">_cmDspRingModExec</a><span class="p">,</span>
  <a href="#_cmDspRingModRecv">_cmDspRingModRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotRing modulator&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmRingModDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspMsgDelay : Delay an arbitrary value.</div><pre><a name="cmDspMsgDelay"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kMaxCntMdId"></a><span class="e">kMaxCntMdId</span><span class="p">,</span>
  <a name="kDelayMdId"></a><span class="e">kDelayMdId</span><span class="p">,</span>
  <a name="kClearMdId"></a><span class="e">kClearMdId</span><span class="p">,</span>
  <a name="kInMdId"></a><span class="e">kInMdId</span><span class="p">,</span>
  <a name="kOutMdId"></a><span class="e">kOutMdId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmMsgDelayDC<span class="p">;</span>

<a name="cmDspMsgDelayEle_t"></a><span class="k">typedef</span> <span class="k">struct</span> <a name="cmDspMsgDelayEle_str"></a>cmDspMsgDelayEle_str
<span class="p">{</span>
  <span class="k">unsigned</span>              <a name="cmDspMsgDelayEle_t.outTimeSmp"></a><span class="i">outTimeSmp</span><span class="p">;</span>
  <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a>          <a name="cmDspMsgDelayEle_t.value"></a><span class="i">value</span><span class="p">;</span>
  <span class="k">struct</span> <a href="#cmDspMsgDelayEle_str">cmDspMsgDelayEle_str</a><span class="p">*</span> <a name="cmDspMsgDelayEle_t.link"></a><span class="i">link</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a></span><span class="p">;</span>

<a name="cmDspMsgDelay_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>         <a name="cmDspMsgDelay_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>            <a name="cmDspMsgDelay_t.maxCnt"></a><span class="i">maxCnt</span><span class="p">;</span>
  <a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">*</span> <a name="cmDspMsgDelay_t.array"></a><span class="i">array</span><span class="p">;</span>  <span class="c"> // array[maxCnt];</span>
  <a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">*</span> <a name="cmDspMsgDelay_t.avail"></a><span class="i">avail</span><span class="p">;</span>
  <a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">*</span> <a name="cmDspMsgDelay_t.active"></a><span class="i">active</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspMsgDelayAlloc_defn"></a><a name="_cmDspMsgDelayAlloc"></a><span class="f">_cmDspMsgDelayAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotmaxcnt&quot</span><span class="p">,</span>  <a href="#kMaxCntMdId">kMaxCntMdId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>              <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotMaximum count of elements in the delay&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotdelay&quot</span><span class="p">,</span>   <a href="#kDelayMdId">kDelayMdId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotDelay time in millisecond.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotclear&quot</span><span class="p">,</span>   <a href="#kClearMdId">kClearMdId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span>                <span class="l">&quotClear delay&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotin&quot</span><span class="p">,</span>      <a href="#kInMdId">kInMdId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                <span class="l">&quotMsg input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotout&quot</span><span class="p">,</span>     <a href="#kOutMdId">kOutMdId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                <span class="l">&quotMsg output&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDelayMdId">kDelayMdId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutMdId">kOutMdId</a><span class="p">,</span>   false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span> 
  
  p<span class="p">-</span><span class="p">&gt</span>maxCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMaxCntMdId">kMaxCntMdId</a><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>array  <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>maxCnt <span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgDelayFree_defn"></a><a name="_cmDspMsgDelayFree"></a><span class="f">_cmDspMsgDelayFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>array<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<span class="c">// insert a value in the delay list</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspMsgDelayInsert_defn"></a><a name="_cmDspMsgDelayInsert"></a><span class="f">_cmDspMsgDelayInsert</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">unsigned</span> delayTimeSmp<span class="p">,</span> <span class="k">const</span> <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a><span class="p">*</span> valPtr <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="c">// protect against pre-reset calls</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>avail <span class="p">=</span><span class="p">=</span> NULL <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>active <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="c">// if there are no available delay elements</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>avail <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidStateDspRC">kInvalidStateDspRC</a><span class="p">,</span><span class="l">&quotThe message delay has exhausted it's internal message store.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// we only do the simplest kind of copying to avoid allocating memory
  // TODO: fix this</span>  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvIsMtx">cmDsvIsMtx</a><span class="p">(</span>valPtr<span class="p">)</span> <span class="p">|</span><span class="p">|</span>  <a href="cmGlobal_h_0.html#cmIsFlag">cmIsFlag</a><span class="p">(</span>valPtr<span class="p">-</span><span class="p">&gt</span>flags<span class="p">,</span><a href="cmDspValue_h_0.html#kProxyDsvFl">kProxyDsvFl</a><span class="p">)</span><span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe message delay cannot yet store matrix or proxy types.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// get a pointer to the next available element</span>
  <a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">*</span> np <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>avail<span class="p">;</span>
  
  <span class="c">// remove the new ele from the avail list</span>
  p<span class="p">-</span><span class="p">&gt</span>avail <span class="p">=</span> np<span class="p">-</span><span class="p">&gt</span>link<span class="p">;</span>
  
  <span class="c">// calc the new ele's exec time</span>
  np<span class="p">-</span><span class="p">&gt</span>outTimeSmp <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">+</span> delayTimeSmp<span class="p">;</span>
  
  <span class="c">// copy the msg value into the delay line element
  // TODO: this should be a real copy that supports all types</span>  
  np<span class="p">-</span><span class="p">&gt</span>value      <span class="p">=</span> <span class="p">*</span>valPtr<span class="p">;</span>
  
  <a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">*</span> ep <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>active<span class="p">;</span>
  <a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">*</span> pp <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="c">// if the active list is empty ...</span>
  <span class="k">if</span><span class="p">(</span> ep <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// ... make the avail element the first on the list</span>
    p<span class="p">-</span><span class="p">&gt</span>active  <span class="p">=</span> np<span class="p">;</span>
    np<span class="p">-</span><span class="p">&gt</span>link   <span class="p">=</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c">// iterate through the list and find the active links which 
    // the new ele falls between based on its execution time</span>    
    <span class="k">while</span><span class="p">(</span>ep <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      <span class="c">// ep's exec time is greater than the new ele's exec time</span>
      <span class="k">if</span><span class="p">(</span> ep<span class="p">-</span><span class="p">&gt</span>outTimeSmp <span class="p">&gt</span> np<span class="p">-</span><span class="p">&gt</span>outTimeSmp <span class="p">)</span>
      <span class="p">{</span>
        
        <span class="c">// insert the new ele in the active list before 'ep'</span>
        <span class="k">if</span><span class="p">(</span> pp <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
        <span class="p">{</span>
          np<span class="p">-</span><span class="p">&gt</span>link   <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>active<span class="p">;</span>
          p<span class="p">-</span><span class="p">&gt</span>active  <span class="p">=</span> np<span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          np<span class="p">-</span><span class="p">&gt</span>link <span class="p">=</span> pp<span class="p">-</span><span class="p">&gt</span>link<span class="p">;</span>
          pp<span class="p">-</span><span class="p">&gt</span>link <span class="p">=</span> np<span class="p">;</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      
      pp <span class="p">=</span> ep<span class="p">;</span>
      ep <span class="p">=</span> ep<span class="p">-</span><span class="p">&gt</span>link<span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c">// if the new element is last on the list</span>
    <span class="k">if</span><span class="p">(</span> ep <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      assert<span class="p">(</span>pp <span class="p">!</span><span class="p">=</span> NULL <span class="p">&amp</span><span class="p">&amp</span> pp<span class="p">-</span><span class="p">&gt</span>link <span class="p">=</span><span class="p">=</span> NULL<span class="p">)</span><span class="p">;</span>
      pp<span class="p">-</span><span class="p">&gt</span>link <span class="p">=</span> np<span class="p">;</span>
      np<span class="p">-</span><span class="p">&gt</span>link <span class="p">=</span> NULL<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<span class="k">void</span> <a name="_cmDspMsgDelayClear_defn"></a><a name="_cmDspMsgDelayClear"></a><span class="f">_cmDspMsgDelayClear</span><span class="p">(</span><a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span> maxCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMaxCntMdId">kMaxCntMdId</a><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>active <span class="p">=</span> NULL<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>avail  <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="c">// put all ele's on the available list</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>maxCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>array<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>link <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>avail<span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>avail         <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>array <span class="p">+</span> i<span class="p">;</span>      
  <span class="p">}</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgDelayReset_defn"></a><a name="_cmDspMsgDelayReset"></a><span class="f">_cmDspMsgDelayReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyDefault">cmDspApplyDefault</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kDelayMdId">kDelayMdId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="#_cmDspMsgDelayClear">_cmDspMsgDelayClear</a><span class="p">(</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgDelayExec_defn"></a><a name="_cmDspMsgDelayExec"></a><span class="f">_cmDspMsgDelayExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> e <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>           rc             <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span>    p              <span class="p">=</span> <span class="p">(</span><a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>            framesPerCycle <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>            begTimeSmp     <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt <span class="p">*</span> framesPerCycle<span class="p">;</span>
  <span class="k">unsigned</span>            endTimeSmp     <span class="p">=</span> begTimeSmp <span class="p">+</span> framesPerCycle<span class="p">;</span>
  
  <span class="k">while</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>active <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>active<span class="p">-</span><span class="p">&gt</span>outTimeSmp <span class="p">&gt</span><span class="p">=</span> endTimeSmp <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    
    <a href="#cmDspMsgDelayEle_t">cmDspMsgDelayEle_t</a><span class="p">*</span> ep  <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>active<span class="p">;</span>
    
    <span class="c">// remove the element from the active list and place it on the available list.</span>
    p<span class="p">-</span><span class="p">&gt</span>active <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>active<span class="p">-</span><span class="p">&gt</span>link<span class="p">;</span> <span class="c"> // advance the active list</span>
    ep<span class="p">-</span><span class="p">&gt</span>link  <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>avail<span class="p">;</span> <span class="c"> // put the cur. element on the avail list</span>
    p<span class="p">-</span><span class="p">&gt</span>avail  <span class="p">=</span> ep<span class="p">;</span>       <span class="c"> </span>
    
    <span class="c">// output the element value</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspValueSet">cmDspValueSet</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutMdId">kOutMdId</a><span class="p">,</span><span class="p">&amp</span>ep<span class="p">-</span><span class="p">&gt</span>value<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>rc<span class="p">,</span><span class="l">&quotMessage delay output failed.&quot</span><span class="p">)</span><span class="p">;</span>      
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgDelayRecv_defn"></a><a name="_cmDspMsgDelayRecv"></a><span class="f">_cmDspMsgDelayRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMsgDelay_t">cmDspMsgDelay_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kDelayMdId">kDelayMdId</a><span class="p">:</span>
    rc <span class="p">=</span>  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kClearMdId">kClearMdId</a><span class="p">:</span>
    <a href="#_cmDspMsgDelayClear">_cmDspMsgDelayClear</a><span class="p">(</span>inst<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span>  <a href="#kInMdId">kInMdId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> delayTimeSmp <span class="p">=</span> floor<span class="p">(</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kDelayMdId">kDelayMdId</a><span class="p">)</span> <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">/</span> <span class="l">1000.0</span><span class="p">)</span><span class="p">;</span>
      rc <span class="p">=</span> <a href="#_cmDspMsgDelayInsert">_cmDspMsgDelayInsert</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span>delayTimeSmp<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmMsgDelayClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmMsgDelayClassCons">cmMsgDelayClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmMsgDelayDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotMsgDelay&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMsgDelayAlloc">_cmDspMsgDelayAlloc</a><span class="p">,</span>
  <a href="#_cmDspMsgDelayFree">_cmDspMsgDelayFree</a><span class="p">,</span>
  <a href="#_cmDspMsgDelayReset">_cmDspMsgDelayReset</a><span class="p">,</span>
  <a href="#_cmDspMsgDelayExec">_cmDspMsgDelayExec</a><span class="p">,</span>
  <a href="#_cmDspMsgDelayRecv">_cmDspMsgDelayRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotMessage Delay&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmMsgDelayDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspLine : Programmable line generator.</div><pre><a name="cmDspLine"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBegLnId"></a><span class="e">kBegLnId</span><span class="p">,</span>
  <a name="kEndLnId"></a><span class="e">kEndLnId</span><span class="p">,</span>
  <a name="kDurLnId"></a><span class="e">kDurLnId</span><span class="p">,</span>
  <a name="kCmdLnId"></a><span class="e">kCmdLnId</span><span class="p">,</span>
  <a name="kRateLnId"></a><span class="e">kRateLnId</span><span class="p">,</span>
  <a name="kOutLnId"></a><span class="e">kOutLnId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmLineDC<span class="p">;</span>

<a name="cmDspLineEle_t"></a><span class="k">typedef</span> <span class="k">struct</span> <a name="cmDspLineEle_str"></a>cmDspLineEle_str
<span class="p">{</span>
  <span class="k">unsigned</span>              <a name="cmDspLineEle_t.outTimeSmp"></a><span class="i">outTimeSmp</span><span class="p">;</span>
  <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a>          <a name="cmDspLineEle_t.value"></a><span class="i">value</span><span class="p">;</span>
  <span class="k">struct</span> <a href="#cmDspLineEle_str">cmDspLineEle_str</a><span class="p">*</span> <a name="cmDspLineEle_t.link"></a><span class="i">link</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspLineEle_t">cmDspLineEle_t</a></span><span class="p">;</span>

<a name="cmDspLine_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspLine_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspLine_t.onSymId"></a><span class="i">onSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspLine_t.offSymId"></a><span class="i">offSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspLine_t.resetSymId"></a><span class="i">resetSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspLine_t.curSmpIdx"></a><span class="i">curSmpIdx</span><span class="p">;</span>
  <span class="k">double</span>      <a name="cmDspLine_t.phase"></a><span class="i">phase</span><span class="p">;</span>
  <span class="k">bool</span>        <a name="cmDspLine_t.onFl"></a><span class="i">onFl</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspLine_t">cmDspLine_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspLineAlloc_defn"></a><a name="_cmDspLineAlloc"></a><span class="f">_cmDspLineAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspLine_t">cmDspLine_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspLine_t">cmDspLine_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotbeg&quot</span><span class="p">,</span>   <a href="#kBegLnId">kBegLnId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotBegin value.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotend&quot</span><span class="p">,</span>   <a href="#kEndLnId">kEndLnId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotEnd value.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotdur&quot</span><span class="p">,</span>   <a href="#kDurLnId">kDurLnId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotDuration (ms)&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotcmd&quot</span><span class="p">,</span>   <a href="#kCmdLnId">kCmdLnId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotCommand: on | off | reset&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotrate&quot</span><span class="p">,</span>  <a href="#kRateLnId">kRateLnId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOutput messages per second&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutLnId">kOutLnId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                <span class="l">&quotOutput&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutLnId">kOutLnId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDefaultDouble">cmDspDefaultDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kBegLnId">kBegLnId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRateLnId">kRateLnId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>onSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quoton&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>offSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotoff&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotreset&quot</span><span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLineFree_defn"></a><a name="_cmDspLineFree"></a><span class="f">_cmDspLineFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLineReset_defn"></a><a name="_cmDspLineReset"></a><span class="f">_cmDspLineReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspLine_t">cmDspLine_t</a><span class="p">*</span> p   <span class="p">=</span> <span class="p">(</span><a href="#cmDspLine_t">cmDspLine_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>curSmpIdx <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>onFl      <span class="p">=</span> false<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>phase     <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLineExec_defn"></a><a name="_cmDspLineExec"></a><span class="f">_cmDspLineExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> e <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspLine_t">cmDspLine_t</a><span class="p">*</span> p   <span class="p">=</span> <span class="p">(</span><a href="#cmDspLine_t">cmDspLine_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">unsigned</span>   sPc       <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>     beg       <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBegLnId">kBegLnId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>     end       <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kEndLnId">kEndLnId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>     rate      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kRateLnId">kRateLnId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>     ms        <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kDurLnId">kDurLnId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>     durSmpCnt <span class="p">=</span> floor<span class="p">(</span>ms <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">/</span> <span class="l">1000</span><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>     out       <span class="p">=</span> beg <span class="p">+</span> <span class="p">(</span>end <span class="p">-</span> beg<span class="p">)</span> <span class="p">*</span> p<span class="p">-</span><span class="p">&gt</span>curSmpIdx <span class="p">/</span> durSmpCnt<span class="p">;</span>
  <span class="k">double</span>     phsMax    <span class="p">=</span> rate<span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">?</span> sPc <span class="p">:</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">/</span> rate<span class="p">;</span> 
  
  <span class="c">// we can never output with a period shorter than 
  // the length of one audio buffer</span>  
  <span class="k">if</span><span class="p">(</span> phsMax <span class="p">&lt</span> sPc <span class="p">)</span>
    phsMax <span class="p">=</span> sPc<span class="p">;</span>
  
  
  <span class="k">if</span><span class="p">(</span> beg <span class="p">&lt</span> end <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> out <span class="p">&gt</span><span class="p">=</span> end <span class="p">)</span>
    <span class="p">{</span>
      out     <span class="p">=</span> end<span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">=</span> false<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> out <span class="p">&lt</span><span class="p">=</span> end <span class="p">)</span>
    <span class="p">{</span>
      out     <span class="p">=</span> end<span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">=</span> false<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>phase     <span class="p">+</span><span class="p">=</span> sPc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>phase <span class="p">&gt</span><span class="p">=</span> sPc <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutLnId">kOutLnId</a><span class="p">,</span>out<span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>phase <span class="p">-</span><span class="p">=</span> sPc<span class="p">;</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>curSmpIdx <span class="p">+</span><span class="p">=</span> sPc<span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLineRecv_defn"></a><a name="_cmDspLineRecv"></a><span class="f">_cmDspLineRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspLine_t">cmDspLine_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspLine_t">cmDspLine_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kCmdLnId">kCmdLnId</a><span class="p">:</span>
      <span class="p">{</span>
        <span class="k">unsigned</span> symId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kCmdLnId">kCmdLnId</a><span class="p">)</span><span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span> symId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">)</span>
          p<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">=</span> true<span class="p">;</span>
        <span class="k">else</span>
          <span class="k">if</span><span class="p">(</span> symId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>offSymId <span class="p">)</span>
            p<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">=</span> false<span class="p">;</span>
        <span class="k">else</span>
          <span class="k">if</span><span class="p">(</span> symId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">)</span>
        <span class="p">{</span>
          p<span class="p">-</span><span class="p">&gt</span>curSmpIdx <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
          p<span class="p">-</span><span class="p">&gt</span>onFl <span class="p">=</span> true<span class="p">;</span>
        <span class="p">}</span>
        
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmLineClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmLineClassCons">cmLineClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmLineDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotLine&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspLineAlloc">_cmDspLineAlloc</a><span class="p">,</span>
  <a href="#_cmDspLineFree">_cmDspLineFree</a><span class="p">,</span>
  <a href="#_cmDspLineReset">_cmDspLineReset</a><span class="p">,</span>
  <a href="#_cmDspLineExec">_cmDspLineExec</a><span class="p">,</span>
  <a href="#_cmDspLineRecv">_cmDspLineRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotLine&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmLineDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAdsr : ADSR envelope generator.</div><pre><a name="cmDspAdsr"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kTrigModeAdId"></a><span class="e">kTrigModeAdId</span><span class="p">,</span>
  <a name="kMinLvlAdId"></a><span class="e">kMinLvlAdId</span><span class="p">,</span>
  <a name="kDlyMsAdId"></a><span class="e">kDlyMsAdId</span><span class="p">,</span>
  <a name="kAtkMsAdId"></a><span class="e">kAtkMsAdId</span><span class="p">,</span>
  <a name="kAtkLvlAdId"></a><span class="e">kAtkLvlAdId</span><span class="p">,</span>
  <a name="kDcyMsAdId"></a><span class="e">kDcyMsAdId</span><span class="p">,</span>
  <a name="kSusLvlAdId"></a><span class="e">kSusLvlAdId</span><span class="p">,</span>
  <a name="kSusMsAdId"></a><span class="e">kSusMsAdId</span><span class="p">,</span>
  <a name="kRlsMsAdId"></a><span class="e">kRlsMsAdId</span><span class="p">,</span>
  <a name="kTScaleAdId"></a><span class="e">kTScaleAdId</span><span class="p">,</span>
  <a name="kAScaleAdId"></a><span class="e">kAScaleAdId</span><span class="p">,</span>
  <a name="kGateAdId"></a><span class="e">kGateAdId</span><span class="p">,</span>
  <a name="kRmsAdId"></a><span class="e">kRmsAdId</span><span class="p">,</span>
  <a name="kOutAdId"></a><span class="e">kOutAdId</span><span class="p">,</span>
  <a name="kCmdAdId"></a><span class="e">kCmdAdId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAdsrDC<span class="p">;</span>

<a name="cmDspAdsr_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspAdsr_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmAdsr">cmAdsr</a><span class="p">*</span>      <a name="cmDspAdsr_t.p"></a><span class="i">p</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAdsr_t">cmDspAdsr_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAdsrAlloc_defn"></a><a name="_cmDspAdsrAlloc"></a><span class="f">_cmDspAdsrAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quottrig&quot</span><span class="p">,</span>  <a href="#kTrigModeAdId">kTrigModeAdId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotTrigger mode (offset ignored).&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotmin&quot</span><span class="p">,</span>   <a href="#kMinLvlAdId">kMinLvlAdId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotMinimum level (dflt:0.0).&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotdly&quot</span><span class="p">,</span>   <a href="#kDlyMsAdId">kDlyMsAdId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotDelay milliseconds.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotatk&quot</span><span class="p">,</span>   <a href="#kAtkMsAdId">kAtkMsAdId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotAttack milliseconds.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotalvl&quot</span><span class="p">,</span>  <a href="#kAtkLvlAdId">kAtkLvlAdId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotAttack Level.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotdcy&quot</span><span class="p">,</span>   <a href="#kDcyMsAdId">kDcyMsAdId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotDecay milliseconds.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotsus&quot</span><span class="p">,</span>   <a href="#kSusLvlAdId">kSusLvlAdId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotSustain Level.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quothold&quot</span><span class="p">,</span>  <a href="#kSusMsAdId">kSusMsAdId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotSustain Ms (trig mode only).&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotrls&quot</span><span class="p">,</span>   <a href="#kRlsMsAdId">kRlsMsAdId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotRelease milliseconds.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quottscale&quot</span><span class="p">,</span><a href="#kTScaleAdId">kTScaleAdId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotTime scale.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotascale&quot</span><span class="p">,</span><a href="#kAScaleAdId">kAScaleAdId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotAmplitude scale.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotgate&quot</span><span class="p">,</span>  <a href="#kGateAdId">kGateAdId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotGate input.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotrms&quot</span><span class="p">,</span>   <a href="#kRmsAdId">kRmsAdId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotRMS input.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutAdId">kOutAdId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>               <span class="l">&quotLevel output.&quot</span><span class="p">,</span>    
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotcmd&quot</span><span class="p">,</span>   <a href="#kCmdAdId">kCmdAdId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotCommand input.&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTrigModeAdId">kTrigModeAdId</a><span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMinLvlAdId">kMinLvlAdId</a><span class="p">,</span>     <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDlyMsAdId">kDlyMsAdId</a><span class="p">,</span>     <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAtkMsAdId">kAtkMsAdId</a><span class="p">,</span>     <span class="l">0.0</span><span class="p">,</span> <span class="l">5.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAtkLvlAdId">kAtkLvlAdId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDcyMsAdId">kDcyMsAdId</a><span class="p">,</span>     <span class="l">0.0</span><span class="p">,</span> <span class="l">10.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSusLvlAdId">kSusLvlAdId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">0.8</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSusMsAdId">kSusMsAdId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">50.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRlsMsAdId">kRlsMsAdId</a><span class="p">,</span>     <span class="l">0.0</span><span class="p">,</span> <span class="l">20.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTScaleAdId">kTScaleAdId</a><span class="p">,</span>     <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAScaleAdId">kAScaleAdId</a><span class="p">,</span>     <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGateAdId">kGateAdId</a><span class="p">,</span>     false<span class="p">,</span>false<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRmsAdId">kRmsAdId</a><span class="p">,</span>       <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutAdId">kOutAdId</a><span class="p">,</span>       <span class="l">0.0</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMinLvlAdId">kMinLvlAdId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>p <span class="p">=</span> <a href="cmProc3_h_0.html#cmAdsrAlloc">cmAdsrAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span>false<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> 
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAdsrFree_defn"></a><a name="_cmDspAdsrFree"></a><span class="f">_cmDspAdsrFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmAdsrFree">cmAdsrFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAdsrReset_defn"></a><a name="_cmDspAdsrReset"></a><span class="f">_cmDspAdsrReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">bool</span>     trigFl<span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kTrigModeAdId">kTrigModeAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> minL  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kMinLvlAdId">kMinLvlAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> dlyMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kDlyMsAdId">kDlyMsAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> atkMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kAtkMsAdId">kAtkMsAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> atkL  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kAtkLvlAdId">kAtkLvlAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> dcyMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kDcyMsAdId">kDcyMsAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> susMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kSusMsAdId">kSusMsAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> susL  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kSusLvlAdId">kSusLvlAdId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> rlsMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kRlsMsAdId">kRlsMsAdId</a> <span class="p">)</span><span class="p">;</span>
    
    <a href="cmProc3_h_0.html#cmAdsrInit">cmAdsrInit</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> trigFl<span class="p">,</span> minL<span class="p">,</span> dlyMs<span class="p">,</span> atkMs<span class="p">,</span> atkL<span class="p">,</span> dcyMs<span class="p">,</span> susMs<span class="p">,</span> susL<span class="p">,</span> rlsMs <span class="p">)</span><span class="p">;</span>
    
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAdsrExec_defn"></a><a name="_cmDspAdsrExec"></a><span class="f">_cmDspAdsrExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc     <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span> p      <span class="p">=</span> <span class="p">(</span><a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">bool</span>         gateFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kGateAdId">kGateAdId</a> <span class="p">)</span><span class="p">;</span>
  <span class="c">//double       rms    = <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a>(inst,<a href="#kRmsAdId">kRmsAdId</a>);</span>
  <span class="k">double</span>       tscale <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kTScaleAdId">kTScaleAdId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>       ascale <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kAScaleAdId">kAScaleAdId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// 
  // HACK HACK HACK HACK
  // HACK HACK HACK HACK
  // HACK HACK HACK HACK  see the accompanying hack in cmProc3.c <a href="cmProc3_h_0.html#cmAdsrExec">cmAdsrExec</a>()
  // HACK HACK HACK HACK
  // HACK HACK HACK HACK
  //</span>  
  
  <span class="c">//  double db  = rms&amplt0.00001 ? -100.0 :  20.0*log10(rms);
  //  double dbMax = -15.0;
  //  double dbMin = -58.0;
  //
  //  db = <a href="cmGlobal_h_0.html#cmMin">cmMin</a>(dbMax,<a href="cmGlobal_h_0.html#cmMax">cmMax</a>(dbMin,db));
  //  double scale =  (db - dbMin) / (dbMax-dbMin);</span>  
  
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>     out    <span class="p">=</span> <a href="cmProc3_h_0.html#cmAdsrExec">cmAdsrExec</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> gateFl<span class="p">,</span> tscale<span class="p">,</span> ascale <span class="p">)</span><span class="p">;</span>
  
  rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOutAdId">kOutAdId</a><span class="p">,</span> out <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAdsrRecv_defn"></a><a name="_cmDspAdsrRecv"></a><span class="f">_cmDspAdsrRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc     <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span> p      <span class="p">=</span> <span class="p">(</span><a href="#cmDspAdsr_t">cmDspAdsr_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span>  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kCmdAdId">kCmdAdId</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmProc3_h_0.html#cmAdsrReport">cmAdsrReport</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> rc<span class="p">;</span>
  <span class="p">}</span>
  
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> v <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kTrigModeAdId">kTrigModeAdId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>trigModeFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kTrigModeAdId">kTrigModeAdId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kMinLvlAdId">kMinLvlAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetLevel">cmAdsrSetLevel</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kDlyAdsrId">kDlyAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kDlyMsAdId">kDlyMsAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetTime">cmAdsrSetTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kDlyAdsrId">kDlyAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kAtkMsAdId">kAtkMsAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetTime">cmAdsrSetTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kAtkAdsrId">kAtkAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kAtkLvlAdId">kAtkLvlAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetLevel">cmAdsrSetLevel</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kAtkAdsrId">kAtkAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kDcyMsAdId">kDcyMsAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetTime">cmAdsrSetTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kDcyAdsrId">kDcyAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSusMsAdId">kSusMsAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetTime">cmAdsrSetTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kSusAdsrId">kSusAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSusLvlAdId">kSusLvlAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetLevel">cmAdsrSetLevel</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kSusAdsrId">kSusAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kRlsMsAdId">kRlsMsAdId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmAdsrSetTime">cmAdsrSetTime</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> v<span class="p">,</span> <a href="cmProc3_h_0.html#kRlsAdsrId">kRlsAdsrId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmAdsrClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmAdsrClassCons">cmAdsrClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAdsrDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAdsr&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAdsrAlloc">_cmDspAdsrAlloc</a><span class="p">,</span>
  <a href="#_cmDspAdsrFree">_cmDspAdsrFree</a><span class="p">,</span>
  <a href="#_cmDspAdsrReset">_cmDspAdsrReset</a><span class="p">,</span>
  <a href="#_cmDspAdsrExec">_cmDspAdsrExec</a><span class="p">,</span>
  <a href="#_cmDspAdsrRecv">_cmDspAdsrRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotADSR Envelope Generator&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAdsrDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAdsr : Audio dynamics compressor.</div><pre><a name="cmDspAdsr"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassCmId"></a><span class="e">kBypassCmId</span><span class="p">,</span>
  <a name="kThreshDbCmId"></a><span class="e">kThreshDbCmId</span><span class="p">,</span>
  <a name="kRatioCmId"></a><span class="e">kRatioCmId</span><span class="p">,</span>
  <a name="kAtkMsCmId"></a><span class="e">kAtkMsCmId</span><span class="p">,</span>
  <a name="kRlsMsCmId"></a><span class="e">kRlsMsCmId</span><span class="p">,</span>
  <a name="kInGainCmId"></a><span class="e">kInGainCmId</span><span class="p">,</span>
  <a name="kOutGainCmId"></a><span class="e">kOutGainCmId</span><span class="p">,</span>
  <a name="kWndMsCmId"></a><span class="e">kWndMsCmId</span><span class="p">,</span>
  <a name="kMaxWndMsCmId"></a><span class="e">kMaxWndMsCmId</span><span class="p">,</span>
  <a name="kInCmId"></a><span class="e">kInCmId</span><span class="p">,</span>
  <a name="kOutCmId"></a><span class="e">kOutCmId</span><span class="p">,</span>
  <a name="kEnvCmId"></a><span class="e">kEnvCmId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmCompressorDC<span class="p">;</span>

<a name="cmDspCompressor_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspCompressor_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmCompressor">cmCompressor</a><span class="p">*</span> <a name="cmDspCompressor_t.p"></a><span class="i">p</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspCompressor_t">cmDspCompressor_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspCompressorAlloc_defn"></a><a name="_cmDspCompressorAlloc"></a><span class="f">_cmDspCompressorAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassCmId">kBypassCmId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotBypass enable&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotthr&quot</span><span class="p">,</span>   <a href="#kThreshDbCmId">kThreshDbCmId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotThreshold in dB.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotratio&quot</span><span class="p">,</span> <a href="#kRatioCmId">kRatioCmId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotRatio numerator.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotatk&quot</span><span class="p">,</span>   <a href="#kAtkMsCmId">kAtkMsCmId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotAttack milliseconds&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotrls&quot</span><span class="p">,</span>   <a href="#kRlsMsCmId">kRlsMsCmId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotRelease milliseconds&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotigain&quot</span><span class="p">,</span> <a href="#kInGainCmId">kInGainCmId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput gain.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotogain&quot</span><span class="p">,</span> <a href="#kOutGainCmId">kOutGainCmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotMakeup Gain&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotwnd&quot</span><span class="p">,</span>   <a href="#kWndMsCmId">kWndMsCmId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotRMS window milliseconds.&quot</span><span class="p">,</span>      
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotmaxwnd&quot</span><span class="p">,</span><a href="#kMaxWndMsCmId">kMaxWndMsCmId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>             <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotMax. RMS window milliseconds.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInCmId">kInCmId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutCmId">kOutCmId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotenv&quot</span><span class="p">,</span>   <a href="#kEnvCmId">kEnvCmId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                 <span class="l">&quotEnvelope out&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>p <span class="p">=</span> <a href="cmProc3_h_0.html#cmCompressorAlloc">cmCompressorAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBypassCmId">kBypassCmId</a><span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAtkMsCmId">kAtkMsCmId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">20.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRlsMsCmId">kRlsMsCmId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">20.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kInGainCmId">kInGainCmId</a><span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutGainCmId">kOutGainCmId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kWndMsCmId">kWndMsCmId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">200.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxWndMsCmId">kMaxWndMsCmId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1000.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kEnvCmId">kEnvCmId</a><span class="p">,</span>      <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCompressorFree_defn"></a><a name="_cmDspCompressorFree"></a><span class="f">_cmDspCompressorFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmCompressorFree">cmCompressorFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCompressorReset_defn"></a><a name="_cmDspCompressorReset"></a><span class="f">_cmDspCompressorReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCmId">kOutCmId</a><span class="p">)</span><span class="p">;</span>
    
    
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> threshDb <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kThreshDbCmId">kThreshDbCmId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> ratio    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kRatioCmId">kRatioCmId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> atkMs    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kAtkMsCmId">kAtkMsCmId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> rlsMs    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kRlsMsCmId">kRlsMsCmId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> inGain   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kInGainCmId">kInGainCmId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> outGain  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kOutGainCmId">kOutGainCmId</a> <span class="p">)</span><span class="p">;</span>    
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> wndMs    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kWndMsCmId">kWndMsCmId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> maxWndMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kMaxWndMsCmId">kMaxWndMsCmId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">bool</span>     bypassFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>  inst<span class="p">,</span> <a href="#kBypassCmId">kBypassCmId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmProc3_h_0.html#cmCompressorInit">cmCompressorInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> inGain<span class="p">,</span> maxWndMs<span class="p">,</span> wndMs<span class="p">,</span> threshDb<span class="p">,</span> ratio<span class="p">,</span> atkMs<span class="p">,</span> rlsMs<span class="p">,</span> outGain<span class="p">,</span> bypassFl <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCompressorExec_defn"></a><a name="_cmDspCompressorExec"></a><span class="f">_cmDspCompressorExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>          rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span> p    <span class="p">=</span> <span class="p">(</span><a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>        y    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCmId">kOutCmId</a><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>  x    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInCmId">kInCmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>           n    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCmId">kOutCmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> x <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmProc3_h_0.html#cmCompressorExec">cmCompressorExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>x<span class="p">,</span>y<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
    
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kEnvCmId">kEnvCmId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>gain <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCompressorRecv_defn"></a><a name="_cmDspCompressorRecv"></a><span class="f">_cmDspCompressorRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  <a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspCompressor_t">cmDspCompressor_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span>  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> v <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kThreshDbCmId">kThreshDbCmId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmCompressorSetThreshDb">cmCompressorSetThreshDb</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>v<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kRatioCmId">kRatioCmId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>ratio_num <span class="p">=</span> v<span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kAtkMsCmId">kAtkMsCmId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmCompressorSetAttackMs">cmCompressorSetAttackMs</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>v<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kRlsMsCmId">kRlsMsCmId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmCompressorSetReleaseMs">cmCompressorSetReleaseMs</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>v<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kInGainCmId">kInGainCmId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>inGain <span class="p">=</span> v<span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kOutGainCmId">kOutGainCmId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>outGain <span class="p">=</span> v<span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kWndMsCmId">kWndMsCmId</a><span class="p">:</span>
    <a href="cmProc3_h_0.html#cmCompressorSetRmsWndMs">cmCompressorSetRmsWndMs</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>v<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kBypassCmId">kBypassCmId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>bypassFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassCmId">kBypassCmId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmCompressorClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmCompressorClassCons">cmCompressorClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmCompressorDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotCompressor&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCompressorAlloc">_cmDspCompressorAlloc</a><span class="p">,</span>
  <a href="#_cmDspCompressorFree">_cmDspCompressorFree</a><span class="p">,</span>
  <a href="#_cmDspCompressorReset">_cmDspCompressorReset</a><span class="p">,</span>
  <a href="#_cmDspCompressorExec">_cmDspCompressorExec</a><span class="p">,</span>
  <a href="#_cmDspCompressorRecv">_cmDspCompressorRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotCompressor&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmCompressorDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspBiquad : Programmable Biquad EQ filter.</div><pre><a name="cmDspBiquad"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassBqId"></a><span class="e">kBypassBqId</span><span class="p">,</span>
  <a name="kModeBqId"></a><span class="e">kModeBqId</span><span class="p">,</span>
  <a name="kF0HzBqId"></a><span class="e">kF0HzBqId</span><span class="p">,</span>
  <a name="kQBqId"></a><span class="e">kQBqId</span><span class="p">,</span>
  <a name="kGainDbBqId"></a><span class="e">kGainDbBqId</span><span class="p">,</span>
  <a name="kInBqId"></a><span class="e">kInBqId</span><span class="p">,</span>
  <a name="kOutBqId"></a><span class="e">kOutBqId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmBiQuadEqDC<span class="p">;</span>

<a name="cmDspBiQuadMap_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> <span class="i">label</span><span class="p">;</span>
  <span class="k">unsigned</span>        <a name="cmDspBiQuadMap_t.mode"></a><span class="i">mode</span><span class="p">;</span>
  <span class="k">unsigned</span>        <a name="cmDspBiQuadMap_t.symbol"></a><span class="i">symbol</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspBiQuadMap_t">cmDspBiQuadMap_t</a></span><span class="p">;</span>

<a href="#cmDspBiQuadMap_t">cmDspBiQuadMap_t</a> _cmDspBiQuadMap<span class="p">[</span><span class="p">]</span> <span class="p">=</span> 
<span class="p">{</span>
  <span class="p">{</span><span class="l">&quotLP&quot</span><span class="p">,</span>    <a href="cmProc3_h_0.html#kLpfBqId">kLpfBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span><span class="l">&quotHP&quot</span><span class="p">,</span>    <a href="cmProc3_h_0.html#kHpFBqId">kHpFBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span><span class="l">&quotBP&quot</span><span class="p">,</span>    <a href="cmProc3_h_0.html#kBpfBqId">kBpfBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span><span class="l">&quotNotch&quot</span><span class="p">,</span> <a href="cmProc3_h_0.html#kNotchBqId">kNotchBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span><span class="l">&quotAP&quot</span><span class="p">,</span>    <a href="cmProc3_h_0.html#kAllpassBqId">kAllpassBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span><span class="l">&quotPeak&quot</span><span class="p">,</span>  <a href="cmProc3_h_0.html#kPeakBqId">kPeakBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span><span class="l">&quotLSh&quot</span><span class="p">,</span>   <a href="cmProc3_h_0.html#kLowShelfBqId">kLowShelfBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span><span class="l">&quotHSh&quot</span><span class="p">,</span>   <a href="cmProc3_h_0.html#kHighShelfBqId">kHighShelfBqId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span> NULL<span class="p">,</span>   <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>

<a name="cmDspBiQuadEq_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspBiQuadEq_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmBiQuadEq">cmBiQuadEq</a><span class="p">*</span>   <a name="cmDspBiQuadEq_t.p"></a><span class="i">p</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspBiQuadEqAlloc_defn"></a><a name="_cmDspBiQuadEqAlloc"></a><span class="f">_cmDspBiQuadEqAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotbypass&quot</span><span class="p">,</span><a href="#kBypassBqId">kBypassBqId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotBypass enable.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotmode&quot</span><span class="p">,</span>  <a href="#kModeBqId">kModeBqId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotMode Symbol: LP|HP|BP|AP|Notch|Pk|LSh|HSh.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotf0&quot</span><span class="p">,</span>    <a href="#kF0HzBqId">kF0HzBqId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotCenter or edge frequecy in Hz.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotQ&quot</span><span class="p">,</span>     <a href="#kQBqId">kQBqId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotQ&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotgain&quot</span><span class="p">,</span>  <a href="#kGainDbBqId">kGainDbBqId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotGain Db (Pk,LSh,Hsh only)&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInBqId">kInBqId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutBqId">kOutBqId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGainDbBqId">kGainDbBqId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>p <span class="p">=</span> <a href="cmProc3_h_0.html#cmBiQuadEqAlloc">cmBiQuadEqAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span>false<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// register the filter mode symbols</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> _cmDspBiQuadMap<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label <span class="p">!</span><span class="p">=</span> NULL<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> _cmDspBiQuadMap<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>symbol <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
      _cmDspBiQuadMap<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>symbol <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>_cmDspBiQuadMap<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBiQuadEqFree_defn"></a><a name="_cmDspBiQuadEqFree"></a><span class="f">_cmDspBiQuadEqFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmBiQuadEqFree">cmBiQuadEqFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<span class="k">unsigned</span> <a name="_cmDspBiQuadEqModeId_defn"></a><a name="_cmDspBiQuadEqModeId"></a><span class="f">_cmDspBiQuadEqModeId</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">unsigned</span> modeSymId <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> _cmDspBiQuadMap<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label<span class="p">!</span><span class="p">=</span>NULL<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> _cmDspBiQuadMap<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>symbol <span class="p">=</span><span class="p">=</span> modeSymId <span class="p">)</span>
      <span class="k">return</span> _cmDspBiQuadMap<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>mode<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe mode string '%s' is not valid.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span><a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>modeSymId<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBiQuadEqReset_defn"></a><a name="_cmDspBiQuadEqReset"></a><span class="f">_cmDspBiQuadEqReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutBqId">kOutBqId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">unsigned</span> modeSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kModeBqId">kModeBqId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> f0Hz      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kF0HzBqId">kF0HzBqId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> Q         <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kQBqId">kQBqId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> gainDb    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kGainDbBqId">kGainDbBqId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> mode      <span class="p">=</span> <a href="#_cmDspBiQuadEqModeId">_cmDspBiQuadEqModeId</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>modeSymId <span class="p">)</span><span class="p">;</span>
    <span class="k">bool</span>     bypassFl  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kBypassBqId">kBypassBqId</a> <span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> mode <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
      <a href="cmProc3_h_0.html#cmBiQuadEqInit">cmBiQuadEqInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> mode<span class="p">,</span> f0Hz<span class="p">,</span> Q<span class="p">,</span> gainDb<span class="p">,</span> bypassFl <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBiQuadEqExec_defn"></a><a name="_cmDspBiQuadEqExec"></a><span class="f">_cmDspBiQuadEqExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>          rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span> p    <span class="p">=</span> <span class="p">(</span><a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>        y    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutBqId">kOutBqId</a><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>  x    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInBqId">kInBqId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>           n    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutBqId">kOutBqId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmBiQuadEqExec">cmBiQuadEqExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>x<span class="p">,</span>y<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBiQuadEqRecv_defn"></a><a name="_cmDspBiQuadEqRecv"></a><span class="f">_cmDspBiQuadEqRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  <a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBiQuadEq_t">cmDspBiQuadEq_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span>  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>        f0Hz    <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>f0Hz<span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>        Q       <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>Q<span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>        gainDb  <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>gainDb<span class="p">;</span>
  <span class="k">unsigned</span>        mode    <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>mode<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kModeBqId">kModeBqId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>mode <span class="p">=</span> <a href="#_cmDspBiQuadEqModeId">_cmDspBiQuadEqModeId</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kModeBqId">kModeBqId</a><span class="p">)</span> <span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> v <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">;</span>
    
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kF0HzBqId">kF0HzBqId</a><span class="p">:</span>
      f0Hz <span class="p">=</span> v<span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kQBqId">kQBqId</a><span class="p">:</span>
      Q <span class="p">=</span> v<span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kGainDbBqId">kGainDbBqId</a><span class="p">:</span>
      gainDb <span class="p">=</span> v<span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kBypassBqId">kBypassBqId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>bypassFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassBqId">kBypassBqId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="p">}</span>
  <span class="p">}</span>
  
  <a href="cmProc3_h_0.html#cmBiQuadEqSet">cmBiQuadEqSet</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>mode<span class="p">,</span>f0Hz<span class="p">,</span>Q<span class="p">,</span>gainDb<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmBiQuadEqClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmBiQuadEqClassCons">cmBiQuadEqClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmBiQuadEqDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotBiQuadEq&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspBiQuadEqAlloc">_cmDspBiQuadEqAlloc</a><span class="p">,</span>
  <a href="#_cmDspBiQuadEqFree">_cmDspBiQuadEqFree</a><span class="p">,</span>
  <a href="#_cmDspBiQuadEqReset">_cmDspBiQuadEqReset</a><span class="p">,</span>
  <a href="#_cmDspBiQuadEqExec">_cmDspBiQuadEqExec</a><span class="p">,</span>
  <a href="#_cmDspBiQuadEqRecv">_cmDspBiQuadEqRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotBi-Quad EQ Filters&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmBiQuadEqDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspDistDs : Guitar style distortion effect.</div><pre><a name="cmDspDistDs"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kBypassDsId"></a><span class="e">kBypassDsId</span><span class="p">,</span>
  <a name="kInGainDsId"></a><span class="e">kInGainDsId</span><span class="p">,</span>
  <a name="kSrateDsId"></a><span class="e">kSrateDsId</span><span class="p">,</span>
  <a name="kBitsDsId"></a><span class="e">kBitsDsId</span><span class="p">,</span>
  <a name="kRectDsId"></a><span class="e">kRectDsId</span><span class="p">,</span>
  <a name="kFullDsId"></a><span class="e">kFullDsId</span><span class="p">,</span>
  <a name="kClipDbDsId"></a><span class="e">kClipDbDsId</span><span class="p">,</span>
  <a name="kOutGainDsId"></a><span class="e">kOutGainDsId</span><span class="p">,</span>
  <a name="kInDsId"></a><span class="e">kInDsId</span><span class="p">,</span>
  <a name="kOutDsId"></a><span class="e">kOutDsId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmDistDsDC<span class="p">;</span>

<a name="cmDspDistDs_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspDistDs_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc3_h_0.html#cmDistDs">cmDistDs</a><span class="p">*</span>    <a name="cmDspDistDs_t.p"></a><span class="i">p</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspDistDs_t">cmDspDistDs_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspDistDsAlloc_defn"></a><a name="_cmDspDistDsAlloc"></a><span class="f">_cmDspDistDsAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  
  <a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotbypass&quot</span><span class="p">,</span> <a href="#kBypassDsId">kBypassDsId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotBypass enable.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotigain&quot</span><span class="p">,</span>  <a href="#kInGainDsId">kInGainDsId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput gain.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotsrate&quot</span><span class="p">,</span>  <a href="#kSrateDsId">kSrateDsId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotDown-sample rate.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotbits&quot</span><span class="p">,</span>   <a href="#kBitsDsId">kBitsDsId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotBits per sample&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotrect&quot</span><span class="p">,</span>   <a href="#kRectDsId">kRectDsId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotRectify flag&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotfull&quot</span><span class="p">,</span>   <a href="#kFullDsId">kFullDsId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quot1=Full 0=Half rectify&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotclip&quot</span><span class="p">,</span>   <a href="#kClipDbDsId">kClipDbDsId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotClip dB&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotogain&quot</span><span class="p">,</span>  <a href="#kOutGainDsId">kOutGainDsId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOutput gain&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotin&quot</span><span class="p">,</span>     <a href="#kInDsId">kInDsId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>                <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotout&quot</span><span class="p">,</span>    <a href="#kOutDsId">kOutDsId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>                <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBypassDsId">kBypassDsId</a><span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kInGainDsId">kInGainDsId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSrateDsId">kSrateDsId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBitsDsId">kBitsDsId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">24.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRectDsId">kRectDsId</a><span class="p">,</span>  false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFullDsId">kFullDsId</a><span class="p">,</span>  false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kClipDbDsId">kClipDbDsId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutGainDsId">kOutGainDsId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>p <span class="p">=</span> <a href="cmProc3_h_0.html#cmDistDsAlloc">cmDistDsAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> false<span class="p">,</span> false<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> false <span class="p">)</span><span class="p">;</span> 
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDistDsFree_defn"></a><a name="_cmDspDistDsFree"></a><span class="f">_cmDspDistDsFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmProc3_h_0.html#cmDistDsFree">cmDistDsFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDistDsReset_defn"></a><a name="_cmDspDistDsReset"></a><span class="f">_cmDspDistDsReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutDsId">kOutDsId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">bool</span>     bypassFl  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kBypassDsId">kBypassDsId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> inGain    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kInGainDsId">kInGainDsId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> downSrate <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kSrateDsId">kSrateDsId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> bits      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kBitsDsId">kBitsDsId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">bool</span>     rectFl    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kRectDsId">kRectDsId</a> <span class="p">)</span><span class="p">;</span>
    <span class="k">bool</span>     fullFl    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>   inst<span class="p">,</span> <a href="#kFullDsId">kFullDsId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> clipDb    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kClipDbDsId">kClipDbDsId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> outGain   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kOutGainDsId">kOutGainDsId</a> <span class="p">)</span><span class="p">;</span>
    <a href="cmProc3_h_0.html#cmDistDsInit">cmDistDsInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> inGain<span class="p">,</span> downSrate<span class="p">,</span> bits<span class="p">,</span> rectFl<span class="p">,</span> fullFl<span class="p">,</span> clipDb<span class="p">,</span> outGain<span class="p">,</span> bypassFl <span class="p">)</span><span class="p">;</span> 
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDistDsExec_defn"></a><a name="_cmDspDistDsExec"></a><span class="f">_cmDspDistDsExec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span>    p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutDsId">kOutDsId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       y  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutDsId">kOutDsId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> x  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInDsId">kInDsId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmProc3_h_0.html#cmDistDsExec">cmDistDsExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>p<span class="p">,</span>x<span class="p">,</span>y<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDistDsRecv_defn"></a><a name="_cmDspDistDsRecv"></a><span class="f">_cmDspDistDsRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspDistDs_t">cmDspDistDs_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kInGainDsId">kInGainDsId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>inGain <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInGainDsId">kInGainDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kSrateDsId">kSrateDsId</a><span class="p">:</span>        
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>downSrate <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSrateDsId">kSrateDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kBitsDsId">kBitsDsId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>bits <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBitsDsId">kBitsDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kRectDsId">kRectDsId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>rectFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kRectDsId">kRectDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kFullDsId">kFullDsId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>fullFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFullDsId">kFullDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kClipDbDsId">kClipDbDsId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>clipDb <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kClipDbDsId">kClipDbDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kOutGainDsId">kOutGainDsId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>outGain <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutGainDsId">kOutGainDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kBypassDsId">kBypassDsId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>p<span class="p">-</span><span class="p">&gt</span>bypassFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBypassDsId">kBypassDsId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmDistDsClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmDistDsClassCons">cmDistDsClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmDistDsDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotDistDs&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspDistDsAlloc">_cmDspDistDsAlloc</a><span class="p">,</span>
  <a href="#_cmDspDistDsFree">_cmDspDistDsFree</a><span class="p">,</span>
  <a href="#_cmDspDistDsReset">_cmDspDistDsReset</a><span class="p">,</span>
  <a href="#_cmDspDistDsExec">_cmDspDistDsExec</a><span class="p">,</span>
  <a href="#_cmDspDistDsRecv">_cmDspDistDsRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotDistortion and Downsampler&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmDistDsDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspDbToLin : Convert decibel units to linear units.</div><pre><a name="cmDspDbToLin"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInDlId"></a><span class="e">kInDlId</span><span class="p">,</span>
  <a name="kOutDlId"></a><span class="e">kOutDlId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmDbToLinDC<span class="p">;</span>

<a name="cmDspDbToLin_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspDbToLin_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspDbToLin_t">cmDspDbToLin_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspDbToLinAlloc_defn"></a><a name="_cmDspDbToLinAlloc"></a><span class="f">_cmDspDbToLinAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  
  <a href="#cmDspDbToLin_t">cmDspDbToLin_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspDbToLin_t">cmDspDbToLin_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInDlId">kInDlId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotInput&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutDlId">kOutDlId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotOutput&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kInDlId">kInDlId</a><span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> <span class="l">-1000.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutDlId">kOutDlId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDbToLinReset_defn"></a><a name="_cmDspDbToLinReset"></a><span class="f">_cmDspDbToLinReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspDbToLinRecv_defn"></a><a name="_cmDspDbToLinRecv"></a><span class="f">_cmDspDbToLinRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kInDlId">kInDlId</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">double</span> db  <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMax">cmMax</a><span class="p">(</span><span class="l">0.0</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span><span class="l">100.0</span><span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInDlId">kInDlId</a><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">double</span> lin <span class="p">=</span> db<span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">?</span> <span class="l">0.0</span> <span class="p">:</span> pow<span class="p">(</span><span class="l">10.0</span><span class="p">,</span> <span class="p">(</span>db<span class="l">-100.0</span><span class="p">)</span><span class="p">/</span><span class="l">20.0</span><span class="p">)</span><span class="p">;</span>
      <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutDlId">kOutDlId</a><span class="p">,</span>lin<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmDbToLinClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmDbToLinClassCons">cmDbToLinClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmDbToLinDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotDbToLin&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspDbToLinAlloc">_cmDspDbToLinAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspDbToLinReset">_cmDspDbToLinReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspDbToLinRecv">_cmDspDbToLinRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotdB to Linear converter&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmDbToLinDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspNofM2 : Pass an N of M possible inputs to the output.</div><pre><a name="cmDspNofM2"></a>
<span class="c">// Pass any N of M inputs</span>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kInChCntNoId"></a><span class="e">kInChCntNoId</span><span class="p">,</span>
  <a name="kOutChCntNoId"></a><span class="e">kOutChCntNoId</span><span class="p">,</span>
  <a name="kXfadeMsNoId"></a><span class="e">kXfadeMsNoId</span><span class="p">,</span>
  <a name="kCmdNoId"></a><span class="e">kCmdNoId</span><span class="p">,</span>
  <a name="kSelIdxNoId"></a><span class="e">kSelIdxNoId</span><span class="p">,</span>
  <a name="kBaseGateNoId"></a><span class="e">kBaseGateNoId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmNofM_DC<span class="p">;</span>

<a name="cmDspNofM_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspNofM_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.iChCnt"></a><span class="i">iChCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.oChCnt"></a><span class="i">oChCnt</span><span class="p">;</span>
  
  <span class="k">unsigned</span><span class="p">*</span>     <a name="cmDspNofM_t.map"></a><span class="i">map</span><span class="p">;</span>             <span class="c"> // map[ oChCnt ]</span>
  <a href="cmProc3_h_0.html#cmXfader">cmXfader</a><span class="p">*</span><span class="p">*</span>    <a name="cmDspNofM_t.xf"></a><span class="i">xf</span><span class="p">;</span>              <span class="c"> // xf[ oChCnt ];</span>
  
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.cfgSymId"></a><span class="i">cfgSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.onSymId"></a><span class="i">onSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.offSymId"></a><span class="i">offSymId</span><span class="p">;</span>
  <span class="k">bool</span>          <a name="cmDspNofM_t.verboseFl"></a><span class="i">verboseFl</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseBaseInNoId"></a><span class="i">baseBaseInNoId</span><span class="p">;</span>  <span class="c"> // first data input port id</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseBaseOutNoId"></a><span class="i">baseBaseOutNoId</span><span class="p">;</span> <span class="c"> // first data output port id</span>
  
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseInFloatNoId"></a><span class="i">baseInFloatNoId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseInBoolNoId"></a><span class="i">baseInBoolNoId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseInSymNoId"></a><span class="i">baseInSymNoId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseInAudioNoId"></a><span class="i">baseInAudioNoId</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseOutFloatNoId"></a><span class="i">baseOutFloatNoId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseOutBoolNoId"></a><span class="i">baseOutBoolNoId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseOutSymNoId"></a><span class="i">baseOutSymNoId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspNofM_t.baseOutAudioNoId"></a><span class="i">baseOutAudioNoId</span><span class="p">;</span>
  
  <span class="k">bool</span> <a name="cmDspNofM_t.printFl"></a><span class="i">printFl</span><span class="p">;</span>
  
<span class="p">}</span> <span class="t"><a href="#cmDspNofM_t">cmDspNofM_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspNofM_Alloc_defn"></a><a name="_cmDspNofM_Alloc"></a><span class="f">_cmDspNofM_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">2</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'NofM' constructor must given input and output channel counts.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>      iChCnt           <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">int</span>      oChCnt           <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> oChCnt <span class="p">&gt</span> iChCnt <span class="p">)</span>
  <span class="p">{</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'NofM' output count must be less than or equal to the input count.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="k">unsigned</span> baseInFloatNoId  <span class="p">=</span> <a href="#kBaseGateNoId">kBaseGateNoId</a>    <span class="p">+</span> iChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseInBoolNoId   <span class="p">=</span> baseInFloatNoId  <span class="p">+</span> iChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseInSymNoId    <span class="p">=</span> baseInBoolNoId   <span class="p">+</span> iChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseInAudioNoId  <span class="p">=</span> baseInSymNoId    <span class="p">+</span> iChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseOutFloatNoId <span class="p">=</span> baseInAudioNoId  <span class="p">+</span> iChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseOutBoolNoId  <span class="p">=</span> baseOutFloatNoId <span class="p">+</span> oChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseOutSymNoId   <span class="p">=</span> baseOutBoolNoId  <span class="p">+</span> oChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseOutAudioNoId <span class="p">=</span> baseOutSymNoId   <span class="p">+</span> oChCnt<span class="p">;</span>
  
  <span class="k">unsigned</span>      i<span class="p">;</span>
  
  <a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotichs&quot</span><span class="p">,</span>  <a href="#kInChCntNoId">kInChCntNoId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span><span class="l">&quotInput channel count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotochs&quot</span><span class="p">,</span>  <a href="#kOutChCntNoId">kOutChCntNoId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span><span class="l">&quotOutput channel count.&quot</span><span class="p">,</span> 
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotms&quot</span><span class="p">,</span>    <a href="#kXfadeMsNoId">kXfadeMsNoId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span><span class="l">&quotAudio Cross-fade time in milliseconds.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotcmd&quot</span><span class="p">,</span>   <a href="#kCmdNoId">kCmdNoId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>      <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotCommand input.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotseli&quot</span><span class="p">,</span>  <a href="#kSelIdxNoId">kSelIdxNoId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotEnable gate at index.&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quotsel&quot</span><span class="p">,</span>   <a href="#kBaseGateNoId">kBaseGateNoId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotSelector Gate inputs.&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quotf-in&quot</span><span class="p">,</span>  baseInFloatNoId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotFloat input&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quotb-in&quot</span><span class="p">,</span>  baseInBoolNoId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotBool input&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quots-in&quot</span><span class="p">,</span>  baseInSymNoId<span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>      <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotSymbol input&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quota-in&quot</span><span class="p">,</span>  baseInAudioNoId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quotf-out&quot</span><span class="p">,</span> baseOutFloatNoId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotFloat output&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quotb-out&quot</span><span class="p">,</span> baseOutBoolNoId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotBool output&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quots-out&quot</span><span class="p">,</span> baseOutSymNoId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>      <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotSymbol output&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quota-out&quot</span><span class="p">,</span> baseOutAudioNoId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>iChCnt     <span class="p">=</span> iChCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>oChCnt     <span class="p">=</span> oChCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>map        <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">unsigned</span><span class="p">,</span>oChCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>xf         <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="cmProc3_h_0.html#cmXfader">cmXfader</a><span class="p">*</span><span class="p">,</span>oChCnt<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>cfgSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotcfg&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>onSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quoton&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>offSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotoff&quot</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>verboseFl  <span class="p">=</span> false<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>baseBaseInNoId   <span class="p">=</span>  baseInFloatNoId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseBaseOutNoId  <span class="p">=</span>  baseOutFloatNoId<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>baseInFloatNoId  <span class="p">=</span>  baseInFloatNoId<span class="p">;</span> 
  p<span class="p">-</span><span class="p">&gt</span>baseInBoolNoId   <span class="p">=</span>  baseInBoolNoId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseInSymNoId    <span class="p">=</span>  baseInSymNoId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseInAudioNoId  <span class="p">=</span>  baseInAudioNoId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutFloatNoId <span class="p">=</span>  baseOutFloatNoId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutBoolNoId  <span class="p">=</span>  baseOutBoolNoId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutSymNoId   <span class="p">=</span>  baseOutSymNoId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutAudioNoId <span class="p">=</span>  baseOutAudioNoId<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseOutFloatNoId <span class="p">+</span> i<span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseOutBoolNoId  <span class="p">+</span> i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseOutSymNoId   <span class="p">+</span> i<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmProc3_h_0.html#cmXfaderAlloc">cmXfaderAlloc</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kXfadeMsNoId">kXfadeMsNoId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">15.0</span> <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNofM_Free_defn"></a><a name="_cmDspNofM_Free"></a><span class="f">_cmDspNofM_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmProc3_h_0.html#cmXfaderFree">cmXfaderFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>map<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNofM_Reset_defn"></a><a name="_cmDspNofM_Reset"></a><span class="f">_cmDspNofM_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutAudioNoId<span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>map<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
      <span class="k">double</span> xfadeMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kXfadeMsNoId">kXfadeMsNoId</a><span class="p">)</span><span class="p">;</span>
      <a href="cmProc3_h_0.html#cmXfaderInit">cmXfaderInit</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>i<span class="p">]</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">,</span> xfadeMs <span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNofM_Exec_defn"></a><a name="_cmDspNofM_Exec"></a><span class="f">_cmDspNofM_Exec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>     i<span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> x<span class="p">[</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">]</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    x<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseInAudioNoId <span class="p">+</span> i <span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// for each valid p-&ampgtmap[] element</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> y <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutAudioNoId<span class="p">+</span> i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span>    n <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutAudioNoId<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> y <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      y <span class="p">=</span> cmVOS_Zero<span class="p">(</span>y<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>      
      <a href="cmProc3_h_0.html#cmXfaderExecAudio">cmXfaderExecAudio</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>n<span class="p">,</span>NULL<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">,</span>x<span class="p">,</span>y<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNofM_Recv_defn"></a><a name="_cmDspNofM_Recv"></a><span class="f">_cmDspNofM_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspNofM_t">cmDspNofM_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>     i<span class="p">,</span>j<span class="p">;</span>
  
  assert<span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseBaseOutNoId <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// store the incoming value</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="c">// if this is a fade time</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kXfadeMsNoId">kXfadeMsNoId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <a href="cmProc3_h_0.html#cmXfaderSetXfadeTime">cmXfaderSetXfadeTime</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>i<span class="p">]</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kXfadeMsNoId">kXfadeMsNoId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>   
    
    <span class="k">return</span> rc<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// if this is an index selector</span>
  <span class="k">if</span><span class="p">(</span> <a href="#kSelIdxNoId">kSelIdxNoId</a> <span class="p">=</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> idx<span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>idx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSelIdxNoId">kSelIdxNoId</a><span class="p">)</span><span class="p">)</span> <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe selection index ('%i') is out of the channel range, (%i).&quot</span><span class="p">,</span>idx<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">)</span><span class="p">;</span> 
    <span class="k">else</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kBaseGateNoId">kBaseGateNoId</a><span class="p">+</span>idx <span class="p">,</span> true <span class="p">)</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>verboseFl <span class="p">)</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotnom seli:%i\n&quot</span><span class="p">,</span>idx<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> rc<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// NOTE: the internal state DOES NOT CHANGE until a message arrives
  // on the 'cmd' port</span>  
  
  <span class="c">// if anything arrives on the command port - then read the gate states and rebuild the map</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kCmdNoId">kCmdNoId</a> <span class="p">)</span>
  <span class="p">{</span>
    
    <span class="k">unsigned</span> cmdSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kCmdNoId">kCmdNoId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// if cmdSymId == 'on' then turn on all selection gates</span>
    <span class="k">if</span><span class="p">(</span>cmdSymId  <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseGateNoId">kBaseGateNoId</a><span class="p">+</span>i<span class="p">,</span>true<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
      <span class="c">// if cmdSymId == 'off' then turn off all selection  gates</span>
    <span class="k">if</span><span class="p">(</span> cmdSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>offSymId <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>verboseFl <span class="p">)</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotnom: off\n&quot</span><span class="p">)</span><span class="p">;</span>
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseGateNoId">kBaseGateNoId</a><span class="p">+</span>i<span class="p">,</span>false<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
      <span class="c">// cmdSymId == '<a href="cmMain_c_0.html#print">print</a>' then <a href="cmMain_c_0.html#print">print</a> the in/out map[]</span>
    <span class="k">if</span><span class="p">(</span> cmdSymId <span class="p">=</span><span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblId">cmSymTblId</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotprint&quot</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot%i:%i &quot</span><span class="p">,</span>i<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>map<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
      <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot\n&quot</span><span class="p">)</span><span class="p">;</span>
      <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot%i usecs\n&quot</span><span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>execDurUsecs<span class="p">)</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>printFl <span class="p">=</span> <span class="p">!</span>p<span class="p">-</span><span class="p">&gt</span>printFl<span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>verboseFl <span class="p">)</span>
      <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quotNom: %s &quot</span><span class="p">,</span> inst<span class="p">-</span><span class="p">&gt</span>symId <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">?</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>inst<span class="p">-</span><span class="p">&gt</span>symId<span class="p">)</span> <span class="p">:</span> <span class="l">&quot&quot</span><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// 5/26</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>oChCnt <span class="p">)</span>
      cmVOU_Fill<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>map<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">,</span><a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// for each input </span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">,</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="p">{</span>
      
      <span class="c">// if this input is switched on</span>
      <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBaseGateNoId">kBaseGateNoId</a><span class="p">+</span>i<span class="p">)</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> j <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>oChCnt <span class="p">)</span>
        <span class="p">{</span>
          <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotTo many inputs have been turned on for %i outputs.&quot</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">)</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c">// assign input i to output j</span>
        p<span class="p">-</span><span class="p">&gt</span>map<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> i<span class="p">;</span>
        
        <span class="c">// fade in ch i and fade out all others</span>
        <a href="cmProc3_h_0.html#cmXfaderSelectOne">cmXfaderSelectOne</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>j<span class="p">]</span><span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
        
        <span class="p">+</span><span class="p">+</span>j<span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>verboseFl <span class="p">)</span>
          <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot%i &quot</span><span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
        
      <span class="p">}</span>
      <span class="k">else</span> <span class="c"> // 5/26</span>
      <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>oChCnt <span class="p">)</span>
          <span class="p">+</span><span class="p">+</span>j<span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c">// deselect all other output channels
    //for(; j&ampltp-&ampgtoChCnt; ++j)
    //{
    //  p-&ampgtmap[j] = <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a>;
    //  <a href="cmProc3_h_0.html#cmXfaderAllOff">cmXfaderAllOff</a>(p-&ampgtxf[j]);
    //}
    // 5/26</span>    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>oChCnt <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>map<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
          <a href="cmProc3_h_0.html#cmXfaderAllOff">cmXfaderAllOff</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>j<span class="p">]</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="p">;</span> j<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
      <span class="p">{</span>
        p<span class="p">-</span><span class="p">&gt</span>map<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
        <a href="cmProc3_h_0.html#cmXfaderAllOff">cmXfaderAllOff</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>xf<span class="p">[</span>j<span class="p">]</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>verboseFl <span class="p">)</span>
      <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot\n&quot</span><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// zero the audio buffers of unused output channels</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>map<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutAudioNoId<span class="p">+</span>i<span class="p">)</span><span class="p">;</span> 
    
  <span class="p">}</span>
  
  
  <span class="c">// if this is an input data event</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseBaseInNoId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseBaseOutNoId  <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the input channel this event occurred on</span>
    <span class="k">unsigned</span> iChIdx <span class="p">=</span> <span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>baseBaseInNoId<span class="p">)</span> <span class="p">%</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">;</span>
    
    <span class="c">// is iChIdx mapped to an output ...</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>map<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> iChIdx <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    
    <span class="c">// ... no - nothing else to do</span>
    <span class="k">if</span><span class="p">(</span> i<span class="p">=</span><span class="p">=</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
    
    <span class="c">// ... yes set the output ...</span>
    
    <span class="c">// double</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseInFloatNoId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseInFloatNoId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutFloatNoId <span class="p">+</span> i<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
      
    <span class="c">// bool  </span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseInBoolNoId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseInBoolNoId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutBoolNoId <span class="p">+</span> i<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>printFl<span class="p">)</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot%i %i\n&quot</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutBoolNoId <span class="p">+</span> i<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
      
    <span class="c">// symbol</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseInSymNoId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseInSymNoId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutSymNoId <span class="p">+</span> i<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmNofMClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmNofMClassCons">cmNofMClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmNofM_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotNofM&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNofM_Alloc">_cmDspNofM_Alloc</a><span class="p">,</span>
  <a href="#_cmDspNofM_Free">_cmDspNofM_Free</a><span class="p">,</span>
  <a href="#_cmDspNofM_Reset">_cmDspNofM_Reset</a><span class="p">,</span>
  <a href="#_cmDspNofM_Exec">_cmDspNofM_Exec</a><span class="p">,</span>
  <a href="#_cmDspNofM_Recv">_cmDspNofM_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotN of M Switch&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmNofM_DC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDsp1ofN : Pass 1 or N possible inputs to the output.</div><pre><a name="cmDsp1ofN"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kInChCnt1oId"></a><span class="e">kInChCnt1oId</span><span class="p">,</span>
  <a name="kInChIdx1oId"></a><span class="e">kInChIdx1oId</span><span class="p">,</span>
  <a name="kOutFloat1oId"></a><span class="e">kOutFloat1oId</span><span class="p">,</span>
  <a name="kOutBool1oId"></a><span class="e">kOutBool1oId</span><span class="p">,</span>
  <a name="kOutSym1oId"></a><span class="e">kOutSym1oId</span><span class="p">,</span>
  <a name="kOutAudio1oId"></a><span class="e">kOutAudio1oId</span><span class="p">,</span>
  <a name="kBaseInFloat1oId"></a><span class="e">kBaseInFloat1oId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cm1ofN_DC<span class="p">;</span>

<a name="cmDsp1ofN_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDsp1ofN_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.iChCnt"></a><span class="i">iChCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.oChCnt"></a><span class="i">oChCnt</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.iChIdx"></a><span class="i">iChIdx</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseBaseIn1oId"></a><span class="i">baseBaseIn1oId</span><span class="p">;</span>  <span class="c"> // first data input port id</span>
  
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseInFloat1oId"></a><span class="i">baseInFloat1oId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseInBool1oId"></a><span class="i">baseInBool1oId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseInSym1oId"></a><span class="i">baseInSym1oId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseInAudio1oId"></a><span class="i">baseInAudio1oId</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseOutFloat1oId"></a><span class="i">baseOutFloat1oId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseOutBool1oId"></a><span class="i">baseOutBool1oId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseOutSym1oId"></a><span class="i">baseOutSym1oId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDsp1ofN_t.baseOutAudio1oId"></a><span class="i">baseOutAudio1oId</span><span class="p">;</span>
  
  
<span class="p">}</span> <span class="t"><a href="#cmDsp1ofN_t">cmDsp1ofN_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDsp1ofN_Alloc_defn"></a><a name="_cmDsp1ofN_Alloc"></a><span class="f">_cmDsp1ofN_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe '1ofN' constructor must given input channel count.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>      iChCnt           <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> baseInFloat1oId  <span class="p">=</span> <a href="#kBaseInFloat1oId">kBaseInFloat1oId</a><span class="p">;</span>
  <span class="k">unsigned</span> baseInBool1oId   <span class="p">=</span> baseInFloat1oId  <span class="p">+</span> iChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseInSym1oId    <span class="p">=</span> baseInBool1oId   <span class="p">+</span> iChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseInAudio1oId  <span class="p">=</span> baseInSym1oId    <span class="p">+</span> iChCnt<span class="p">;</span>
  
  <a href="#cmDsp1ofN_t">cmDsp1ofN_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDsp1ofN_t">cmDsp1ofN_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotichs&quot</span><span class="p">,</span>  <a href="#kInChCnt1oId">kInChCnt1oId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span><span class="l">&quotInput channel count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotchidx&quot</span><span class="p">,</span> <a href="#kInChIdx1oId">kInChIdx1oId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotInput channel selector index.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotf-out&quot</span><span class="p">,</span> <a href="#kOutFloat1oId">kOutFloat1oId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotFloat output&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotb-out&quot</span><span class="p">,</span> <a href="#kOutBool1oId">kOutBool1oId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotBool output&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quots-out&quot</span><span class="p">,</span> <a href="#kOutSym1oId">kOutSym1oId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotSymbol output&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quota-out&quot</span><span class="p">,</span> <a href="#kOutAudio1oId">kOutAudio1oId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>   <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quotf-in&quot</span><span class="p">,</span>  baseInFloat1oId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotFloat input&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quotb-in&quot</span><span class="p">,</span>  baseInBool1oId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotBool input&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quots-in&quot</span><span class="p">,</span>  baseInSym1oId<span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotSymbol input&quot</span><span class="p">,</span>
  iChCnt<span class="p">,</span>    <span class="l">&quota-in&quot</span><span class="p">,</span>  baseInAudio1oId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>iChCnt     <span class="p">=</span> iChCnt<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>baseBaseIn1oId   <span class="p">=</span>  <a href="#kBaseInFloat1oId">kBaseInFloat1oId</a><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>baseInFloat1oId  <span class="p">=</span>  baseInFloat1oId<span class="p">;</span> 
  p<span class="p">-</span><span class="p">&gt</span>baseInBool1oId   <span class="p">=</span>  baseInBool1oId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseInSym1oId    <span class="p">=</span>  baseInSym1oId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseInAudio1oId  <span class="p">=</span>  baseInAudio1oId<span class="p">;</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutFloat1oId">kOutFloat1oId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutBool1oId">kOutBool1oId</a><span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutSym1oId">kOutSym1oId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp1ofN_Free_defn"></a><a name="_cmDsp1ofN_Free"></a><span class="f">_cmDsp1ofN_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp1ofN_Reset_defn"></a><a name="_cmDsp1ofN_Reset"></a><span class="f">_cmDsp1ofN_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAudio1oId">kOutAudio1oId</a><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp1ofN_Exec_defn"></a><a name="_cmDsp1ofN_Exec"></a><span class="f">_cmDsp1ofN_Exec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc     <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDsp1ofN_t">cmDsp1ofN_t</a><span class="p">*</span>      p      <span class="p">=</span> <span class="p">(</span><a href="#cmDsp1ofN_t">cmDsp1ofN_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          iChIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInChIdx1oId">kInChIdx1oId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       dp     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAudio1oId">kOutAudio1oId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> sp     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseInAudio1oId <span class="p">+</span> iChIdx <span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          n      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAudio1oId">kOutAudio1oId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> dp <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> sp <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
      cmVOS_Zero<span class="p">(</span>dp<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      cmVOS_Copy<span class="p">(</span>dp<span class="p">,</span>n<span class="p">,</span>sp<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp1ofN_Recv_defn"></a><a name="_cmDsp1ofN_Recv"></a><span class="f">_cmDsp1ofN_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDsp1ofN_t">cmDsp1ofN_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDsp1ofN_t">cmDsp1ofN_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  
  <span class="c">// ignore out of range input channel</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kInChIdx1oId">kInChIdx1oId</a> <span class="p">&amp</span><span class="p">&amp</span> <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe selector channel index %i is out of range.&quot</span><span class="p">,</span><a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span> 
  
  <span class="c">// store the incoming value</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  
  <span class="c">// if this is an input data event</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseBaseIn1oId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId  <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the input channel this event occurred on</span>
    <span class="k">unsigned</span> iChIdx <span class="p">=</span> <span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>baseBaseIn1oId<span class="p">)</span> <span class="p">%</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">;</span>
    
    <span class="c">// if the event did not arrive on the selected input channel - there is nothing else to do</span>
    <span class="k">if</span><span class="p">(</span> iChIdx <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInChIdx1oId">kInChIdx1oId</a><span class="p">)</span> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
    
    <span class="c">// The event arrived on the input channel - send it out the output</span>
    
    <span class="c">// double</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseInFloat1oId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseInFloat1oId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutFloat1oId">kOutFloat1oId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      
    <span class="c">// bool  </span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseInBool1oId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseInBool1oId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutBool1oId">kOutBool1oId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      
    <span class="c">// symbol</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseInSym1oId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseInSym1oId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutSym1oId">kOutSym1oId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cm1ofNClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cm1ofNClassCons">cm1ofNClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cm1ofN_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quot1ofN&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDsp1ofN_Alloc">_cmDsp1ofN_Alloc</a><span class="p">,</span>
  <a href="#_cmDsp1ofN_Free">_cmDsp1ofN_Free</a><span class="p">,</span>
  <a href="#_cmDsp1ofN_Reset">_cmDsp1ofN_Reset</a><span class="p">,</span>
  <a href="#_cmDsp1ofN_Exec">_cmDsp1ofN_Exec</a><span class="p">,</span>
  <a href="#_cmDsp1ofN_Recv">_cmDsp1ofN_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quot 1 of N Switch&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cm1ofN_DC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDsp1Up : Send 'true' on the selected channel and 'false' on the deselected channel.</div><pre><a name="cmDsp1Up"></a>
<span class="c">// Send a 'true' out on the selected channel.
// Send a 'false' out on the deselected channel.</span>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kChCnt1uId"></a><span class="e">kChCnt1uId</span><span class="p">,</span>
  <a name="kSel1uId"></a><span class="e">kSel1uId</span><span class="p">,</span>
  <a name="kBaseOut1uId"></a><span class="e">kBaseOut1uId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cm1Up_DC<span class="p">;</span>

<a name="cmDsp1Up_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDsp1Up_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  
<span class="p">}</span> <span class="t"><a href="#cmDsp1Up_t">cmDsp1Up_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDsp1Up_Alloc_defn"></a><a name="_cmDsp1Up_Alloc"></a><span class="f">_cmDsp1Up_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe '1Up' constructor must given output channel count.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>      chCnt       <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDsp1Up_t">cmDsp1Up_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDsp1Up_t">cmDsp1Up_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotchcnt&quot</span><span class="p">,</span>  <a href="#kChCnt1uId">kChCnt1uId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>               <span class="l">&quotOutput channel count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotsel&quot</span><span class="p">,</span>    <a href="#kSel1uId">kSel1uId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotChannel index selector.&quot</span><span class="p">,</span>
  chCnt<span class="p">,</span>     <span class="l">&quotout&quot</span><span class="p">,</span>    <a href="#kBaseOut1uId">kBaseOut1uId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>                  <span class="l">&quotGate outputs&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">unsigned</span> i<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSel1uId">kSel1uId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBaseOut1uId">kBaseOut1uId</a> <span class="p">+</span> i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp1Up_Reset_defn"></a><a name="_cmDsp1Up_Reset"></a><span class="f">_cmDsp1Up_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> chIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSel1uId">kSel1uId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> chCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChCnt1uId">kChCnt1uId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> i<span class="p">;</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseOut1uId">kBaseOut1uId</a><span class="p">+</span>i<span class="p">,</span> i <span class="p">=</span><span class="p">=</span> chIdx <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp1Up_Recv_defn"></a><a name="_cmDsp1Up_Recv"></a><span class="f">_cmDsp1Up_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kSel1uId">kSel1uId</a><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> chIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSel1uId">kSel1uId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> chCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChCnt1uId">kChCnt1uId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// turn off the previously selected channel</span>
    <span class="k">if</span><span class="p">(</span> chIdx <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">&amp</span><span class="p">&amp</span> chIdx <span class="p">&lt</span> chCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseOut1uId">kBaseOut1uId</a><span class="p">+</span>chIdx<span class="p">,</span>false<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// set the new channel index</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// get the new channel index</span>
    chIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSel1uId">kSel1uId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// send the new channel index</span>
    <span class="k">if</span><span class="p">(</span> chIdx <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">&amp</span><span class="p">&amp</span> chIdx <span class="p">&lt</span> chCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseOut1uId">kBaseOut1uId</a><span class="p">+</span>chIdx<span class="p">,</span>true<span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cm1UpClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cm1UpClassCons">cm1UpClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cm1Up_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quot1Up&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDsp1Up_Alloc">_cmDsp1Up_Alloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDsp1Up_Reset">_cmDsp1Up_Reset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDsp1Up_Recv">_cmDsp1Up_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotSet one input high and all others low.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cm1Up_DC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspGateToSym : Convert a 'true'/'false' gate to an 'on'/'off' symbol.</div><pre><a name="cmDspGateToSym"></a><span class="c">// </span>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kOnSymGsId"></a><span class="e">kOnSymGsId</span><span class="p">,</span>
  <a name="kOffSymGsId"></a><span class="e">kOffSymGsId</span><span class="p">,</span>
  <a name="kOnGsId"></a><span class="e">kOnGsId</span><span class="p">,</span>
  <a name="kOffGsId"></a><span class="e">kOffGsId</span><span class="p">,</span>
  <a name="kBothGsId"></a><span class="e">kBothGsId</span><span class="p">,</span>
  <a name="kOutGsId"></a><span class="e">kOutGsId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmGateToSym_DC<span class="p">;</span>

<a name="cmDspGateToSym_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspGateToSym_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspGateToSym_t">cmDspGateToSym_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspGateToSym_Alloc_defn"></a><a name="_cmDspGateToSym_Alloc"></a><span class="f">_cmDspGateToSym_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspGateToSym_t">cmDspGateToSym_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspGateToSym_t">cmDspGateToSym_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quoton_sym&quot</span><span class="p">,</span> <a href="#kOnSymGsId">kOnSymGsId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span><span class="l">&quot'on' symbol id (default:'on')&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quotoff_sym&quot</span><span class="p">,</span><a href="#kOffSymGsId">kOffSymGsId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span><span class="l">&quot'off' symbol id (default:'off')&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quoton&quot</span><span class="p">,</span>    <a href="#kOnGsId">kOnGsId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotOn - send out 'on' symbol when a 'true' is received.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quotoff&quot</span><span class="p">,</span>   <a href="#kOffGsId">kOffGsId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotOff - send out 'off' symbol when a 'false' is received.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quotboth&quot</span><span class="p">,</span>  <a href="#kBothGsId">kBothGsId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                <span class="l">&quotSend 'on' on 'true' and 'off' on 'false'.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutGsId">kOutGsId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>               <span class="l">&quotOutput&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">unsigned</span> onSymId  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quoton&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> offSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotoff&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOnSymGsId">kOnSymGsId</a><span class="p">,</span>  onSymId <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOffSymGsId">kOffSymGsId</a><span class="p">,</span> offSymId <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutGsId">kOutGsId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGateToSym_Reset_defn"></a><a name="_cmDspGateToSym_Reset"></a><span class="f">_cmDspGateToSym_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspGateToSym_Recv_defn"></a><a name="_cmDspGateToSym_Recv"></a><span class="f">_cmDspGateToSym_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> onSymId  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOnSymGsId">kOnSymGsId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> offSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOffSymGsId">kOffSymGsId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kOnGsId">kOnGsId</a><span class="p">:</span>
      <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOnGsId">kOnGsId</a><span class="p">)</span> <span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutGsId">kOutGsId</a><span class="p">,</span>onSymId<span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kOffGsId">kOffGsId</a><span class="p">:</span>
      <span class="k">if</span><span class="p">(</span> <span class="p">!</span><a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOffGsId">kOffGsId</a><span class="p">)</span> <span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutGsId">kOutGsId</a><span class="p">,</span>offSymId<span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kBothGsId">kBothGsId</a><span class="p">:</span>
      <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span> <a href="#kOutGsId">kOutGsId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kBothGsId">kBothGsId</a><span class="p">)</span> <span class="p">?</span> onSymId <span class="p">:</span> offSymId<span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmGateToSymClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmGateToSymClassCons">cmGateToSymClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmGateToSym_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotGateToSym&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspGateToSym_Alloc">_cmDspGateToSym_Alloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspGateToSym_Reset">_cmDspGateToSym_Reset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspGateToSym_Recv">_cmDspGateToSym_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotConvert a 'true'/'false' gate to an 'on'/'off' symbol.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmGateToSym_DC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspPortToSym : Send a pre-defined symbol every time a message arrives a given input port.</div><pre><a name="cmDspPortToSym"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kOutPtsId"></a><span class="e">kOutPtsId</span><span class="p">,</span>
  <span class="e"><a href="cmDspBuiltIn_c_0.html#kBaseInPtsId">kBaseInPtsId</a></span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmPortToSym_DC<span class="p">;</span>

<a name="cmDspPortToSym_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspPortToSym_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>   <a name="cmDspPortToSym_t.symIdArray"></a><span class="i">symIdArray</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspPortToSym_t.symIdCnt"></a><span class="i">symIdCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspPortToSym_t.baseOutPtsId"></a><span class="i">baseOutPtsId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspPortToSym_t">cmDspPortToSym_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspPortToSym_Alloc_defn"></a><a name="_cmDspPortToSym_Alloc"></a><span class="f">_cmDspPortToSym_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_list       vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'PortToSym' constructor argument list must contain at least one symbol label.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">unsigned</span>      symCnt    <span class="p">=</span> va_cnt<span class="p">;</span>
  <span class="k">unsigned</span>      argCnt    <span class="p">=</span> <span class="l">1</span> <span class="p">+</span> <span class="l">2</span><span class="p">*</span>symCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span>argCnt<span class="p">+</span><span class="l">1</span><span class="p">]</span><span class="p">;</span>
  
  <span class="k">unsigned</span><span class="p">*</span> symIdArray   <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">unsigned</span><span class="p">,</span>symCnt<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>  baseOutPtsId <span class="p">=</span> <a href="cmDspBuiltIn_c_0.html#kBaseInPtsId">kBaseInPtsId</a> <span class="p">+</span> symCnt<span class="p">;</span>
  
  <span class="c">// setup the output port arg recd</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span>args<span class="p">,</span><span class="l">&quotout&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span><a href="#kOutPtsId">kOutPtsId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span><a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span> <span class="l">&quotOutput&quot</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> i<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>symCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the symbol label</span>
    <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> symLabel <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <span class="k">char</span><span class="p">*</span><span class="p">)</span><span class="p">;</span>
    assert<span class="p">(</span> symLabel <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// register the symbol</span>
    symIdArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>symLabel<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// input port - any msg in this port will generate an output from 'out' as well as the associated output port</span>
    <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span> args<span class="p">+</span><a href="cmDspBuiltIn_c_0.html#kBaseInPtsId">kBaseInPtsId</a><span class="p">+</span>i<span class="p">,</span> symLabel<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="cmDspBuiltIn_c_0.html#kBaseInPtsId">kBaseInPtsId</a><span class="p">+</span>i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span> <a href="cmText_h_0.html#cmTsPrintfH">cmTsPrintfH</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="l">&quot%s Input.&quot</span><span class="p">,</span>symLabel<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span> args<span class="p">+</span>baseOutPtsId<span class="p">+</span>i<span class="p">,</span> symLabel<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> baseOutPtsId<span class="p">+</span>i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>    <a href="cmText_h_0.html#cmTsPrintfH">cmTsPrintfH</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="l">&quot%s Output.&quot</span><span class="p">,</span>symLabel<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span>args <span class="p">+</span> argCnt<span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspPortToSym_t">cmDspPortToSym_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspPortToSym_t">cmDspPortToSym_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>symIdCnt     <span class="p">=</span> symCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>symIdArray   <span class="p">=</span> symIdArray<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutPtsId <span class="p">=</span> baseOutPtsId<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kOutPtsId">kOutPtsId</a><span class="p">,</span><a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPortToSym_Free_defn"></a><a name="_cmDspPortToSym_Free"></a><span class="f">_cmDspPortToSym_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspPortToSym_t">cmDspPortToSym_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspPortToSym_t">cmDspPortToSym_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>symIdArray<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPortToSym_Reset_defn"></a><a name="_cmDspPortToSym_Reset"></a><span class="f">_cmDspPortToSym_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPortToSym_Recv_defn"></a><a name="_cmDspPortToSym_Recv"></a><span class="f">_cmDspPortToSym_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspPortToSym_t">cmDspPortToSym_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspPortToSym_t">cmDspPortToSym_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="c">// if a msg of any type is recieved on an input port - send out the associated symbol</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmDspBuiltIn_c_0.html#kBaseInPtsId">kBaseInPtsId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="cmDspBuiltIn_c_0.html#kBaseInPtsId">kBaseInPtsId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>symIdCnt <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> idx <span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="cmDspBuiltIn_c_0.html#kBaseInPtsId">kBaseInPtsId</a><span class="p">;</span>
    assert<span class="p">(</span> idx <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>symIdCnt <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutPtsId <span class="p">+</span> idx<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>symIdArray<span class="p">[</span>idx<span class="p">]</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutPtsId">kOutPtsId</a><span class="p">,</span>      p<span class="p">-</span><span class="p">&gt</span>symIdArray<span class="p">[</span>idx<span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmPortToSymClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmPortToSymClassCons">cmPortToSymClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmPortToSym_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotPortToSym&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPortToSym_Alloc">_cmDspPortToSym_Alloc</a><span class="p">,</span>
  <a href="#_cmDspPortToSym_Free">_cmDspPortToSym_Free</a><span class="p">,</span>
  <a href="#_cmDspPortToSym_Reset">_cmDspPortToSym_Reset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPortToSym_Recv">_cmDspPortToSym_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotIf a message of any kind is received on a port then send the symbol associated with the port.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmPortToSym_DC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspIntToSym : Send a pre-defined symbol every time a message arrives a given input port.</div><pre><a name="cmDspIntToSym"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInItsId"></a><span class="e">kInItsId</span><span class="p">,</span>
  <a name="kOutItsId"></a><span class="e">kOutItsId</span><span class="p">,</span>
  <a name="kBaseInItsId"></a><span class="e">kBaseInItsId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmIntToSym_DC<span class="p">;</span>

<a name="cmDspIntToSym_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspIntToSym_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">int</span><span class="p">*</span>        <a name="cmDspIntToSym_t.intArray"></a><span class="i">intArray</span><span class="p">;</span>
  <span class="k">unsigned</span><span class="p">*</span>   <a name="cmDspIntToSym_t.symIdArray"></a><span class="i">symIdArray</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspIntToSym_t.symIdCnt"></a><span class="i">symIdCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspIntToSym_t.baseIntItsId"></a><span class="i">baseIntItsId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspIntToSym_t.baseOutItsId"></a><span class="i">baseOutItsId</span><span class="p">;</span>
  
<span class="p">}</span> <span class="t"><a href="#cmDspIntToSym_t">cmDspIntToSym_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspIntToSym_Alloc_defn"></a><a name="_cmDspIntToSym_Alloc"></a><span class="f">_cmDspIntToSym_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_list       vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">2</span> <span class="p">|</span><span class="p">|</span> va_cnt <span class="p">%</span> <span class="l">2</span> <span class="p">!</span><span class="p">=</span><span class="l">0</span>  <span class="p">)</span>
  <span class="p">{</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'IntToSym' constructor argument list must contain at least one int/symbol pair and all pairs must be complete.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">unsigned</span>      symCnt    <span class="p">=</span> va_cnt<span class="p">/</span><span class="l">2</span><span class="p">;</span>
  <span class="k">unsigned</span>      argCnt    <span class="p">=</span> <span class="l">2</span> <span class="p">+</span> <span class="l">3</span><span class="p">*</span>symCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span>argCnt<span class="p">+</span><span class="l">1</span><span class="p">]</span><span class="p">;</span>
  
  <span class="k">unsigned</span><span class="p">*</span> symIdArray   <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">unsigned</span><span class="p">,</span>symCnt<span class="p">)</span><span class="p">;</span>
  <span class="k">int</span><span class="p">*</span>      intArray     <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">int</span><span class="p">,</span>symCnt<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>  baseIntItsId <span class="p">=</span> <a href="#kBaseInItsId">kBaseInItsId</a> <span class="p">+</span> symCnt<span class="p">;</span>  
  <span class="k">unsigned</span>  baseOutItsId <span class="p">=</span> baseIntItsId <span class="p">+</span> symCnt<span class="p">;</span>
  
  <span class="c">// setup the integer input and symbol output port arg recd</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span>args<span class="p">,</span>  <span class="l">&quotin&quot</span><span class="p">,</span>  <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kInItsId">kInItsId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a><span class="p">,</span> <span class="l">&quotInteger input&quot</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span>args<span class="p">+</span><span class="l">1</span><span class="p">,</span><span class="l">&quotout&quot</span><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kOutItsId">kOutItsId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span> <span class="l">&quotOutput&quot</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> i<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>symCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the integer value</span>
    intArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// get the symbol label</span>
    <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> symLabel <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <span class="k">char</span><span class="p">*</span><span class="p">)</span><span class="p">;</span>
    assert<span class="p">(</span> symLabel <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span><span class="p">;</span>
    
    <span class="k">unsigned</span> intLabelN <span class="p">=</span> <span class="p">(</span>symLabel<span class="p">=</span><span class="p">=</span>NULL <span class="p">?</span> <span class="l">0</span> <span class="p">:</span> strlen<span class="p">(</span>symLabel<span class="p">)</span><span class="p">)</span> <span class="p">+</span> <span class="l">5</span><span class="p">;</span>
    <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a> intLabel<span class="p">[</span> intLabelN <span class="p">]</span><span class="p">;</span>
    snprintf<span class="p">(</span>intLabel<span class="p">,</span>intLabelN<span class="p">,</span><span class="l">&quot%s%s&quot</span><span class="p">,</span> symLabel<span class="p">=</span><span class="p">=</span>NULL <span class="p">?</span> <span class="l">&quot&quot</span> <span class="p">:</span> symLabel<span class="p">,</span> <span class="l">&quot-int&quot</span> <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// register the symbol</span>
    symIdArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>symLabel<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// trigger port associated with this symbol (any msg on this port will trigger an output)</span>
    <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span> args<span class="p">+</span><a href="#kBaseInItsId">kBaseInItsId</a><span class="p">+</span>i<span class="p">,</span> symLabel<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kBaseInItsId">kBaseInItsId</a><span class="p">+</span>i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span> <a href="cmText_h_0.html#cmTsPrintfH">cmTsPrintfH</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="l">&quot%s Input.&quot</span><span class="p">,</span>symLabel<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// this port is used to set the integer value associated with this symbol</span>
    <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span> args<span class="p">+</span>baseIntItsId<span class="p">+</span>i<span class="p">,</span> intLabel<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> baseIntItsId<span class="p">+</span>i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a><span class="p">,</span>  <a href="cmText_h_0.html#cmTsPrintfH">cmTsPrintfH</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="l">&quotSet the integer value associated with %s.&quot</span><span class="p">,</span>symLabel<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// symbol output port - when ever this symbol is sent out it will go out this port as well as the 'out' port</span>
    <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span> args<span class="p">+</span>baseOutItsId<span class="p">+</span>i<span class="p">,</span> symLabel<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> baseOutItsId<span class="p">+</span>i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>    <a href="cmText_h_0.html#cmTsPrintfH">cmTsPrintfH</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="l">&quot%s Output.&quot</span><span class="p">,</span>symLabel<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    
    
  <span class="p">}</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span>args <span class="p">+</span> argCnt<span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>symIdCnt     <span class="p">=</span> symCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>intArray     <span class="p">=</span> intArray<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>symIdArray   <span class="p">=</span> symIdArray<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutItsId <span class="p">=</span> baseOutItsId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseIntItsId <span class="p">=</span> baseIntItsId<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kOutItsId">kOutItsId</a><span class="p">,</span><a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspIntToSym_Free_defn"></a><a name="_cmDspIntToSym_Free"></a><span class="f">_cmDspIntToSym_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>symIdArray<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspIntToSym_Reset_defn"></a><a name="_cmDspIntToSym_Reset"></a><span class="f">_cmDspIntToSym_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspIntToSymSendOut_defn"></a><a name="_cmDspIntToSymSendOut"></a><span class="f">_cmDspIntToSymSendOut</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">unsigned</span> idx <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  assert<span class="p">(</span> idx <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>symIdCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutItsId <span class="p">+</span> idx<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>symIdArray<span class="p">[</span>idx<span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOutItsId">kOutItsId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>symIdArray<span class="p">[</span> idx <span class="p">]</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspIntToSym_Recv_defn"></a><a name="_cmDspIntToSym_Recv"></a><span class="f">_cmDspIntToSym_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspIntToSym_t">cmDspIntToSym_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="c">// if an integer arrived at 'in'</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kInItsId">kInItsId</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    
    <span class="k">unsigned</span> i<span class="p">;</span>
    <span class="k">int</span>      intVal <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInItsId">kInItsId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>symIdCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="k">if</span><span class="p">(</span> intVal <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>intArray<span class="p">[</span>i<span class="p">]</span> <span class="p">)</span>
    <span class="p">{</span>
      rc <span class="p">=</span> <a href="#_cmDspIntToSymSendOut">_cmDspIntToSymSendOut</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> i <span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span> 
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>  
    <span class="c">// if a msg of any type is recieved on an input port - send out the associated symbol</span>
    <span class="k">if</span><span class="p">(</span> <a href="#kBaseInItsId">kBaseInItsId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kBaseInItsId">kBaseInItsId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>symIdCnt <span class="p">)</span>
    <span class="p">{</span>
      <a href="#_cmDspIntToSymSendOut">_cmDspIntToSymSendOut</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kBaseInItsId">kBaseInItsId</a> <span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
      
    <span class="c">// if this is a new interger value for this symbol</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseIntItsId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseIntItsId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>symIdCnt <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
      
      p<span class="p">-</span><span class="p">&gt</span>intArray<span class="p">[</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>baseIntItsId <span class="p">]</span> <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span> inst<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmIntToSymClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmIntToSymClassCons">cmIntToSymClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmIntToSym_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotIntToSym&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspIntToSym_Alloc">_cmDspIntToSym_Alloc</a><span class="p">,</span>
  <a href="#_cmDspIntToSym_Free">_cmDspIntToSym_Free</a><span class="p">,</span>
  <a href="#_cmDspIntToSym_Reset">_cmDspIntToSym_Reset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspIntToSym_Recv">_cmDspIntToSym_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotIf a message of any kind is received on a port then send the symbol associated with the port.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmIntToSym_DC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspRouter : Route the input value to one of multiple output ports.</div><pre><a name="cmDspRouter"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kOutChCntRtId"></a><span class="e">kOutChCntRtId</span><span class="p">,</span>
  <a name="kOutChIdxRtId"></a><span class="e">kOutChIdxRtId</span><span class="p">,</span>
  <a name="kInFloatRtId"></a><span class="e">kInFloatRtId</span><span class="p">,</span>
  <a name="kInBoolRtId"></a><span class="e">kInBoolRtId</span><span class="p">,</span>
  <a name="kInSymRtId"></a><span class="e">kInSymRtId</span><span class="p">,</span>
  <a name="kInAudioRtId"></a><span class="e">kInAudioRtId</span><span class="p">,</span>
  <a name="kBaseOutFloatRtId"></a><span class="e">kBaseOutFloatRtId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmRouter_DC<span class="p">;</span>

<a name="cmDspRouter_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspRouter_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.oChCnt"></a><span class="i">oChCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.oChIdx"></a><span class="i">oChIdx</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseBaseOutRtId"></a><span class="i">baseBaseOutRtId</span><span class="p">;</span>  <span class="c"> // first data input port id</span>
  
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseInFloatRtId"></a><span class="i">baseInFloatRtId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseInBoolRtId"></a><span class="i">baseInBoolRtId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseInSymRtId"></a><span class="i">baseInSymRtId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseInAudioRtId"></a><span class="i">baseInAudioRtId</span><span class="p">;</span>
  
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseOutFloatRtId"></a><span class="i">baseOutFloatRtId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseOutBoolRtId"></a><span class="i">baseOutBoolRtId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseOutSymRtId"></a><span class="i">baseOutSymRtId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspRouter_t.baseOutAudioRtId"></a><span class="i">baseOutAudioRtId</span><span class="p">;</span>
  
  
<span class="p">}</span> <span class="t"><a href="#cmDspRouter_t">cmDspRouter_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspRouter_Alloc_defn"></a><a name="_cmDspRouter_Alloc"></a><span class="f">_cmDspRouter_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'Router' constructor must be given an output channel count.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>      oChCnt            <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> baseOutFloatRtId  <span class="p">=</span> <a href="#kBaseOutFloatRtId">kBaseOutFloatRtId</a><span class="p">;</span>
  <span class="k">unsigned</span> baseOutBoolRtId   <span class="p">=</span> baseOutFloatRtId  <span class="p">+</span> oChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseOutSymRtId    <span class="p">=</span> baseOutBoolRtId   <span class="p">+</span> oChCnt<span class="p">;</span>
  <span class="k">unsigned</span> baseOutAudioRtId  <span class="p">=</span> baseOutSymRtId    <span class="p">+</span> oChCnt<span class="p">;</span>
  
  <a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotochs&quot</span><span class="p">,</span>   <a href="#kOutChCntRtId">kOutChCntRtId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span><span class="l">&quotOutput channel count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotsel&quot</span><span class="p">,</span>    <a href="#kOutChIdxRtId">kOutChIdxRtId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotOutput channel index selector.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotf-in&quot</span><span class="p">,</span>   <a href="#kInFloatRtId">kInFloatRtId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>     <span class="l">&quotFloat input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotb-in&quot</span><span class="p">,</span>   <a href="#kInBoolRtId">kInBoolRtId</a><span class="p">,</span>       <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>     <span class="l">&quotBool input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quots-in&quot</span><span class="p">,</span>   <a href="#kInSymRtId">kInSymRtId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>      <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>     <span class="l">&quotSymbol input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quota-in&quot</span><span class="p">,</span>   <a href="#kInAudioRtId">kInAudioRtId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>     <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quotf-out&quot</span><span class="p">,</span>  baseOutFloatRtId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>    <span class="l">&quotFloat output&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quotb-out&quot</span><span class="p">,</span>  baseOutBoolRtId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>    <span class="l">&quotBool output&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quots-out&quot</span><span class="p">,</span>  baseOutSymRtId<span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>      <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>    <span class="l">&quotSymbol output&quot</span><span class="p">,</span>
  oChCnt<span class="p">,</span>    <span class="l">&quota-out&quot</span><span class="p">,</span>  baseOutAudioRtId<span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>    <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>oChCnt     <span class="p">=</span> oChCnt<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>baseBaseOutRtId   <span class="p">=</span>  <a href="#kBaseOutFloatRtId">kBaseOutFloatRtId</a><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutFloatRtId  <span class="p">=</span>  baseOutFloatRtId<span class="p">;</span> 
  p<span class="p">-</span><span class="p">&gt</span>baseOutBoolRtId   <span class="p">=</span>  baseOutBoolRtId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutSymRtId    <span class="p">=</span>  baseOutSymRtId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseOutAudioRtId  <span class="p">=</span>  baseOutAudioRtId<span class="p">;</span>
  
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseOutFloatRtId<span class="p">+</span>i<span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseOutBoolRtId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseOutSymRtId<span class="p">+</span>i<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRouter_Free_defn"></a><a name="_cmDspRouter_Free"></a><span class="f">_cmDspRouter_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRouter_Reset_defn"></a><a name="_cmDspRouter_Reset"></a><span class="f">_cmDspRouter_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> i<span class="p">;</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutAudioRtId<span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRouter_Exec_defn"></a><a name="_cmDspRouter_Exec"></a><span class="f">_cmDspRouter_Exec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc     <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">*</span>    p      <span class="p">=</span> <span class="p">(</span><a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          oChIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutChIdxRtId">kOutChIdxRtId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       dp     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutAudioRtId <span class="p">+</span> oChIdx<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> sp     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInAudioRtId">kInAudioRtId</a> <span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          n      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutAudioRtId<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> dp <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> sp <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
      cmVOS_Zero<span class="p">(</span>dp<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      cmVOS_Copy<span class="p">(</span>dp<span class="p">,</span>n<span class="p">,</span>sp<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRouter_Recv_defn"></a><a name="_cmDspRouter_Recv"></a><span class="f">_cmDspRouter_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspRouter_t">cmDspRouter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  
  <span class="c">// ignore out of range output channel selection</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kOutChIdxRtId">kOutChIdxRtId</a> <span class="p">&amp</span><span class="p">&amp</span> <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>oChCnt <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe selector channel index %i  is out of of range.&quot</span><span class="p">,</span><a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span> 
  
  <span class="c">//  if( evt-&ampgtdstVarId == <a href="#kOutChIdxRtId">kOutChIdxRtId</a> &ampamp&ampamp <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a>(evt-&ampgtvaluePtr) &amplt p-&ampgtoChCnt )
  //  {
  //    const <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a>* symLbl = <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a>(ctx-&ampgtstH,inst-&ampgtsymId);
  //    <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a>(ctx,inst,<a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a>,&ampquotRouter: ch:%i %s\n&ampquot,<a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a>(evt-&ampgtvaluePtr),symLbl==NULL?&ampquot&ampquot:symLbl);
  //  }</span>  
  
  <span class="c">// store the incoming value</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseBaseOutRtId <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">unsigned</span> chIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutChIdxRtId">kOutChIdxRtId</a><span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kInFloatRtId">kInFloatRtId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutFloatRtId <span class="p">+</span> chIdx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInFloatRtId">kInFloatRtId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kInBoolRtId">kInBoolRtId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutBoolRtId <span class="p">+</span> chIdx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInBoolRtId">kInBoolRtId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kInSymRtId">kInSymRtId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseOutSymRtId <span class="p">+</span> chIdx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInSymRtId">kInSymRtId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmRouterClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmRouterClassCons">cmRouterClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmRouter_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotRouter&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspRouter_Alloc">_cmDspRouter_Alloc</a><span class="p">,</span>
  <a href="#_cmDspRouter_Free">_cmDspRouter_Free</a><span class="p">,</span>
  <a href="#_cmDspRouter_Reset">_cmDspRouter_Reset</a><span class="p">,</span>
  <a href="#_cmDspRouter_Exec">_cmDspRouter_Exec</a><span class="p">,</span>
  <a href="#_cmDspRouter_Recv">_cmDspRouter_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quot1 to N Router&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmRouter_DC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAvailCh : Track active an inactive processing channels.</div><pre><a name="cmDspAvailCh"></a><span class="c">//
// Purpose: AvailCh can be used to implement a channel switching circuit.
// 
// Inputs:
//   chs         - The count of channels. Constructor only argument. 
//   trig        - Any input causes the next available channel, i, to be enabled.
//                 gate[i] transmits 'true'.  In 'exclusive (0) mode all active
//                 channels are then requested to shutdown by transmitting 'false' on
//                 gate[] - only the new channel will be active.  In 'multi' (1) mode
//                 no signal is sent out the gate[].
//   dis[chCnt]  - Recieves a gate signal from an external object which indicates 
//                 when a channel is no longer active. When a 'false' is received on dis[i]
//                 the channel i is marked as available.  In 'multi' mode 'false' is 
//                 then transmitted on gate[i].
// Outputs:
//   gate[chCnt] - 'true' is transmitted when a channel is made active (see trig)
//                 'false' is transmitted to notify the channel that it should shutdown.
//                 The channel is not considered actually shutdown until dis[i]
//                 recieves a 'false'.
//   ch            The next prospective available channel is sent whenever it
//                 becomes available.  A next channel becomes available when
//                 a channel is marked as inactive via dis[i] or when
//                 a new channel is made active, via trigger, and another
//                 channel active channel exists.  Note that this channel is
//                 sent &ampquotprospectively&ampquot - possibly long before the associated
//                 gate[ch] is raised - in order to switch parameter routers away
//                 from the newly active channel and a currently in-active channel.
// Notes:
//   The gate[] output is designed to work with the gate[] input of Xfader.  When
//   availCh.gate[] goes high Xfader fades in, when availCh.gate[] goes low
//   Xfader fades out.  The dis[] channel is designed to connect from Xfader.state[].
//   Xfader.state[] goes low when a fade-out is complete, the connected AvailCh 
//   is then marked as available. </span>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kChCntAvId"></a><span class="e">kChCntAvId</span><span class="p">,</span>
  <a name="kModeAvId"></a><span class="e">kModeAvId</span><span class="p">,</span>
  <a name="kTrigAvId"></a><span class="e">kTrigAvId</span><span class="p">,</span>
  <a name="kResetAvId"></a><span class="e">kResetAvId</span><span class="p">,</span>
  <a name="kChIdxAvId"></a><span class="e">kChIdxAvId</span><span class="p">,</span>  
  <a name="kBaseDisInAvId"></a><span class="e">kBaseDisInAvId</span><span class="p">,</span>
  
  <a name="kExclusiveModeAvId"></a><span class="e">kExclusiveModeAvId</span><span class="p">=</span><span class="l">0</span><span class="p">,</span>
  <a name="kMultiModeAvId"></a><span class="e">kMultiModeAvId</span><span class="p">=</span><span class="l">1</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAvailCh_DC<span class="p">;</span>

<a name="cmDspAvailCh_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspAvailCh_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAvailCh_t.chCnt"></a><span class="i">chCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAvailCh_t.baseDisInAvId"></a><span class="i">baseDisInAvId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAvailCh_t.baseGateOutAvId"></a><span class="i">baseGateOutAvId</span><span class="p">;</span>
  <span class="k">bool</span><span class="p">*</span>         <a name="cmDspAvailCh_t.stateArray"></a><span class="i">stateArray</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAvailCh_t.nextAvailChIdx"></a><span class="i">nextAvailChIdx</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspAvailCh_t.audioCycleCnt"></a><span class="i">audioCycleCnt</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAvailCh_t">cmDspAvailCh_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAvailCh_Alloc_defn"></a><a name="_cmDspAvailCh_Alloc"></a><span class="f">_cmDspAvailCh_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'AvailCh' constructor must be given an channel count.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>     chCnt            <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> chCnt <span class="p">&lt</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe 'AvailCh' constructor must be given a positive channel count.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">unsigned</span> baseDisInAvId    <span class="p">=</span> <a href="#kBaseDisInAvId">kBaseDisInAvId</a><span class="p">;</span>
  <span class="k">unsigned</span> baseGateOutAvId  <span class="p">=</span> baseDisInAvId <span class="p">+</span> chCnt<span class="p">;</span>
  
  <a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotchs&quot</span><span class="p">,</span>    <a href="#kChCntAvId">kChCntAvId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotChannel count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotmode&quot</span><span class="p">,</span>   <a href="#kModeAvId">kModeAvId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>     <span class="l">&quotMode: 0=exclusive (dflt) 1=multi&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quottrig&quot</span><span class="p">,</span>   <a href="#kTrigAvId">kTrigAvId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>     <span class="l">&quotTrigger the unit to select the next available channel.&quot</span><span class="p">,</span> 
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotreset&quot</span><span class="p">,</span>  <a href="#kResetAvId">kResetAvId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>     <span class="l">&quotReset to default state&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotch&quot</span><span class="p">,</span>     <a href="#kChIdxAvId">kChIdxAvId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>    <span class="l">&quotCurrently selected channel.&quot</span><span class="p">,</span>
  chCnt<span class="p">,</span>     <span class="l">&quotdis&quot</span><span class="p">,</span>    baseDisInAvId<span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>     <span class="l">&quotDisable channel gate&quot</span><span class="p">,</span>
  chCnt<span class="p">,</span>     <span class="l">&quotgate&quot</span><span class="p">,</span>   baseGateOutAvId<span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>    <span class="l">&quotActive channel gate&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>chCnt     <span class="p">=</span> chCnt<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId   <span class="p">=</span>  baseDisInAvId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseGateOutAvId <span class="p">=</span>  baseGateOutAvId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx  <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>audioCycleCnt   <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="k">unsigned</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseDisInAvId<span class="p">+</span>i<span class="p">,</span>   false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> baseGateOutAvId<span class="p">+</span>i<span class="p">,</span> false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kModeAvId">kModeAvId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <a href="#kExclusiveModeAvId">kExclusiveModeAvId</a> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kChIdxAvId">kChIdxAvId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAvailCh_Free_defn"></a><a name="_cmDspAvailCh_Free"></a><span class="f">_cmDspAvailCh_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAvailCh_DoReset_defn"></a><a name="_cmDspAvailCh_DoReset"></a><span class="f">_cmDspAvailCh_DoReset</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> i<span class="p">;</span>      
  <a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  
  <span class="c">// ch 0 is the channel receiving parameters</span>
  <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kChIdxAvId">kChIdxAvId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId   <span class="p">+</span> i<span class="p">,</span> i<span class="p">=</span><span class="p">=</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="c"> // disable all channels except ch zero</span>
    <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseGateOutAvId <span class="p">+</span> i<span class="p">,</span> i<span class="p">=</span><span class="p">=</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="c"> // enable channel 0</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>audioCycleCnt  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
  
  <span class="c">// transmit reset</span>
  <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span> <a href="#kResetAvId">kResetAvId</a><span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAvailCh_Reset_defn"></a><a name="_cmDspAvailCh_Reset"></a><span class="f">_cmDspAvailCh_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="#_cmDspAvailCh_DoReset">_cmDspAvailCh_DoReset</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<span class="k">void</span> <a name="_cmDspAvailCh_SetNextAvailCh_defn"></a><a name="_cmDspAvailCh_SetNextAvailCh"></a><span class="f">_cmDspAvailCh_SetNextAvailCh</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">bool</span> warnFl<span class="p">,</span> <span class="k">const</span> <span class="k">char</span><span class="p">*</span> label <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">;</span>
  
  <span class="c">// if a valid next avail ch already exists then do nothing</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  
  <span class="c">// for each channel</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// the channel's active state is held in the 'dis' variable.</span>
    <span class="k">bool</span> activeFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId<span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// if ch[i] is the first avail inactive channel</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">!</span>activeFl <span class="p">)</span>
    <span class="p">{</span>
      p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx  <span class="p">=</span> i<span class="p">;</span>     <span class="c"> // then make it the next available channel</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    
  <span class="p">}</span>
  
  <span class="c">// if no available channels were found</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> warnFl <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidStateDspRC">kInvalidStateDspRC</a><span class="p">,</span><span class="l">&quotNo available channels exist.&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c">// Notify the external world which channel is to be used next.
    // This allows routers which are switching parameters between
    // xfade channels to switch new parameter values to go to the
    // next available channel rather than the current channel.
    // The next available channel will then be faded up with the
    // new parameters on the next trigger command.</span>    
    <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kChIdxAvId">kChIdxAvId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAvailCh_Exec_defn"></a><a name="_cmDspAvailCh_Exec"></a><span class="f">_cmDspAvailCh_Exec</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>audioCycleCnt <span class="p">+</span><span class="p">=</span> <span class="l">1</span><span class="p">;</span>
  
  <span class="c">// Setting the next available channel here solves the problem of sending the
  // first 'ch' output after the program starts executing.
  // The problem is that 'ch' should be set to 0 for the first
  // execution cycle so that parameters may be set to the initial active channel
  // during the first cycle.  After the first cycle however parameters should be
  // sent to the next channel which will be faded up.  Setting
  // 'ch' here accomplishes this without relying on an external signal.
  // Note that we wait until the second cycle because we don't know where
  // this 'availCh' will be in the execution cycle relative to other processors.
  // If it is at the beginning then other processors that might be setting
  // initial parameters will not have had a chance to run before the
  // 'ch' change.  Waiting unitl the second cycle guarantees that all the
  // other processors had at least one chance to run.</span>  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>audioCycleCnt <span class="p">=</span><span class="p">=</span> <span class="l">2</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="#_cmDspAvailCh_SetNextAvailCh">_cmDspAvailCh_SetNextAvailCh</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>true<span class="p">,</span><span class="l">&quotexec&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAvailCh_Recv_defn"></a><a name="_cmDspAvailCh_Recv"></a><span class="f">_cmDspAvailCh_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAvailCh_t">cmDspAvailCh_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">bool</span> exclModeFl  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span> <a href="#kModeAvId">kModeAvId</a> <span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="#kExclusiveModeAvId">kExclusiveModeAvId</a><span class="p">;</span>
  
  <span class="c">// if this is a reset</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kResetAvId">kResetAvId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <a href="#_cmDspAvailCh_DoReset">_cmDspAvailCh_DoReset</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// if this is a trigger</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kTrigAvId">kTrigAvId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// if no available channels were previously found</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidStateDspRC">kInvalidStateDspRC</a><span class="p">,</span><span class="l">&quotThere are no available channels to trigger.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="c">// indicate that ch[nexAvailChIdx] is no longer available</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId   <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx<span class="p">,</span> true<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// raise the gate to start the xfade.</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseGateOutAvId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx<span class="p">,</span> true<span class="p">)</span><span class="p">;</span> 
      
      <span class="k">if</span><span class="p">(</span> exclModeFl <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">unsigned</span> i<span class="p">;</span>
        <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
          <span class="k">if</span><span class="p">(</span> i<span class="p">!</span><span class="p">=</span>p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx <span class="p">&amp</span><span class="p">&amp</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId<span class="p">+</span>i<span class="p">)</span> <span class="p">)</span>
            <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseGateOutAvId<span class="p">+</span>i<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c">// invalidate nextAvailChIdx</span>
      p<span class="p">-</span><span class="p">&gt</span>nextAvailChIdx <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
      
      <span class="c">// It may be possible to know the next avail ch so try to set it here.</span>
      <a href="#_cmDspAvailCh_SetNextAvailCh">_cmDspAvailCh_SetNextAvailCh</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> false<span class="p">,</span> <span class="l">&quottrig&quot</span> <span class="p">)</span><span class="p">;</span>
      
    <span class="p">}</span>
    
    
    <span class="k">return</span> rc<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// if this is an incoming disable message.</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId<span class="p">+</span>p<span class="p">-</span><span class="p">&gt</span>chCnt <span class="p">&amp</span><span class="p">&amp</span> <a href="cmDspValue_h_0.html#cmDsvGetBool">cmDsvGetBool</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">=</span><span class="p">=</span> false<span class="p">)</span>
  <span class="p">{</span>    
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// a channel was disabled so a new channel should be available for selection</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>audioCycleCnt <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span>
      <a href="#_cmDspAvailCh_SetNextAvailCh">_cmDspAvailCh_SetNextAvailCh</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> true<span class="p">,</span> <span class="l">&quotdis&quot</span> <span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> <span class="p">!</span>exclModeFl <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseGateOutAvId <span class="p">+</span> <span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>baseDisInAvId<span class="p">)</span><span class="p">,</span> false<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmAvailChClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmAvailChClassCons">cmAvailChClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAvailCh_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAvailCh&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAvailCh_Alloc">_cmDspAvailCh_Alloc</a><span class="p">,</span>
  <a href="#_cmDspAvailCh_Free">_cmDspAvailCh_Free</a><span class="p">,</span>
  <a href="#_cmDspAvailCh_Reset">_cmDspAvailCh_Reset</a><span class="p">,</span>
  <a href="#_cmDspAvailCh_Exec">_cmDspAvailCh_Exec</a><span class="p">,</span>
  <a href="#_cmDspAvailCh_Recv">_cmDspAvailCh_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotEnable the next availabled channel&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAvailCh_DC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspPreset : Store and recall preset.  Show a preset list user interface unit.</div><pre><a name="cmDspPreset"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kGroupSymPrId"></a><span class="e">kGroupSymPrId</span><span class="p">,</span>
  <a name="kLabelPrId"></a><span class="e">kLabelPrId</span><span class="p">,</span>
  <span class="e"><a href="cmDspKr_c_0.html#kCmdPrId">kCmdPrId</a></span><span class="p">,</span>
  <a name="kDonePrId"></a><span class="e">kDonePrId</span><span class="p">,</span>
  <a name="kListPrId"></a><span class="e">kListPrId</span><span class="p">,</span>
  <a name="kSelPrId"></a><span class="e">kSelPrId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmPreset_DC<span class="p">;</span>

<a name="cmDspPreset_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspPreset_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspPreset_t.storeCmdSymId"></a><span class="i">storeCmdSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspPreset_t.recallCmdSymId"></a><span class="i">recallCmdSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>      <a name="cmDspPreset_t.doneSymId"></a><span class="i">doneSymId</span><span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a>     <a name="cmDspPreset_t.jsH"></a><span class="i">jsH</span><span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> <a name="cmDspPreset_t.np"></a><span class="i">np</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspPreset_t">cmDspPreset_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspPresetUpdateList_defn"></a><a name="_cmDspPresetUpdateList"></a><span class="f">_cmDspPresetUpdateList</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">unsigned</span> groupSymId <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="c">// initialize the JSON tree</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonInitialize">cmJsonInitialize</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotJSON preset list handle initialization failed.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// create the JSON tree root container</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonCreateObject">cmJsonCreateObject</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">,</span>NULL<span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotJSON preset list root object create failed.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>    
  <span class="p">}</span>
  
  <span class="c">// if a valid preset group symbol was given</span>
  <span class="k">if</span><span class="p">(</span> groupSymId <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the JSON list containing the preset labels and symId's for this preset group</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspSysPresetPresetJsonList">cmDspSysPresetPresetJsonList</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> groupSymId<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>jsH <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="p">{</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kSubSysFailDspRC">kSubSysFailDspRC</a><span class="p">,</span><span class="l">&quotRequest for a preset list failed.&quot</span><span class="p">)</span><span class="p">;</span>
      goto errLabel<span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c">// get a pointer to the JSON 'presetArray' array node</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>np <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonFindValue">cmJsonFindValue</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">,</span><span class="l">&quotpresetArray&quot</span><span class="p">,</span>NULL<span class="p">,</span><a href="cmJson_h_0.html#kArrayTId">kArrayTId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotPreset list is empty or synatax is not recognized.&quot</span><span class="p">)</span><span class="p">;</span>
      goto errLabel<span class="p">;</span>      
    <span class="p">}</span>
    
    <span class="c">// set the JSON list</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetJson">cmDspSetJson</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kListPrId">kListPrId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="p">{</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>rc<span class="p">,</span><span class="l">&quotPreset list set failed.&quot</span><span class="p">)</span><span class="p">;</span>
      goto errLabel<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  errLabel<span class="p">:</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPresetDoRecall_defn"></a><a name="_cmDspPresetDoRecall"></a><span class="f">_cmDspPresetDoRecall</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> groupLabel<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> presetLabel <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  
  <span class="c">// recall the preset</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span> rc <span class="p">=</span> <a href="cmDspSys_h_0.html#cmDspSysPresetRecall">cmDspSysPresetRecall</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> groupLabel<span class="p">,</span> presetLabel <span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kSubSysFailDspRC">kSubSysFailDspRC</a><span class="p">,</span><span class="l">&quotPreset recall failed for group:'%s' preset:'%s'.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>groupLabel<span class="p">)</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>presetLabel<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// send out a notification that a new preset has been loaded</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kDonePrId">kDonePrId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>doneSymId<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">// selIdx is base 1, not base 0, because it references the JSON tree rows where the
// first row contains the titles.</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPresetListSelectRecall_defn"></a><a name="_cmDspPresetListSelectRecall"></a><span class="f">_cmDspPresetListSelectRecall</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">unsigned</span> selIdx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> presetLabel<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> groupLabel<span class="p">;</span>
  <span class="k">unsigned</span>        groupSymId<span class="p">;</span>
  <span class="k">unsigned</span>        presetSymId<span class="p">;</span>
  <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> rnp<span class="p">;</span>
  
  <span class="c">// validate the JSON tree</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonIsValid">cmJsonIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">)</span> <span class="p">=</span><span class="p">=</span> false <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>np <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotPreset recall failed. The preset JSON tree does not exist.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// validate the group id</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span>groupSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kGroupSymPrId">kGroupSymPrId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span> 
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotPreset recall failed. The preset group symbol has not been set.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// validate the selection index</span>
  <span class="k">if</span><span class="p">(</span> selIdx <span class="p">&gt</span><span class="p">=</span> <a href="cmJson_h_0.html#cmJsonChildCount">cmJsonChildCount</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotPreset recall failed. The preset index: %i is out of range 0-%i&quot</span><span class="p">,</span> selIdx<span class="p">,</span> <a href="cmJson_h_0.html#cmJsonChildCount">cmJsonChildCount</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>    
  <span class="p">}</span> 
  
  <span class="c">// get the preset element</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span> rnp <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">,</span> selIdx <span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotPreset recall failed. Unable to retrieve preset JSON element.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>    
  <span class="p">}</span>
  
  <span class="c">// verify the JSON syntax</span>
  assert<span class="p">(</span> rnp<span class="p">-</span><span class="p">&gt</span>typeId<span class="p">=</span><span class="p">=</span><a href="cmJson_h_0.html#kArrayTId">kArrayTId</a> <span class="p">&amp</span><span class="p">&amp</span> <a href="cmJson_h_0.html#cmJsonChildCount">cmJsonChildCount</a><span class="p">(</span>rnp<span class="p">)</span><span class="p">=</span><span class="p">=</span><span class="l">2</span> <span class="p">&amp</span><span class="p">&amp</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>rnp<span class="p">,</span><span class="l">1</span><span class="p">)</span><span class="p">-</span><span class="p">&gt</span>typeId <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kIntTId">kIntTId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// get the preset symbol id</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonUIntValue">cmJsonUIntValue</a><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>rnp<span class="p">,</span><span class="l">1</span><span class="p">)</span><span class="p">,</span> <span class="p">&amp</span>presetSymId <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotPreset recall failed. Unable to retrieve preset symbol id.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>    
  <span class="p">}</span>
  
  <span class="c">// convert symbols to strings</span>
  groupLabel  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>groupSymId<span class="p">)</span><span class="p">;</span>
  presetLabel <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>presetSymId<span class="p">)</span><span class="p">;</span>
  
  rc <span class="p">=</span> <a href="#_cmDspPresetDoRecall">_cmDspPresetDoRecall</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span>groupLabel<span class="p">,</span>presetLabel<span class="p">)</span><span class="p">;</span>
  
  errLabel<span class="p">:</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspPreset_Alloc_defn"></a><a name="_cmDspPreset_Alloc"></a><span class="f">_cmDspPreset_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  
  <a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotsym&quot</span><span class="p">,</span>    <a href="#kGroupSymPrId">kGroupSymPrId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotPreset group symbol.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotlabel&quot</span><span class="p">,</span>  <a href="#kLabelPrId">kLabelPrId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotPreset label&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotcmd&quot</span><span class="p">,</span>    <a href="cmDspKr_c_0.html#kCmdPrId">kCmdPrId</a><span class="p">,</span>          <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                 <span class="l">&quotCommand input&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotdone&quot</span><span class="p">,</span>   <a href="#kDonePrId">kDonePrId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                 <span class="l">&quotSend 'done' symbol after preset recall.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotlist&quot</span><span class="p">,</span>   <a href="#kListPrId">kListPrId</a><span class="p">,</span>         <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kJsonDsvFl">kJsonDsvFl</a><span class="p">,</span>                <span class="l">&quotPreset list as a JSON array.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotsel&quot</span><span class="p">,</span>    <a href="#kSelPrId">kSelPrId</a><span class="p">,</span>          <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                <span class="l">&quotPreset index selection index&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>jsH            <span class="p">=</span> cmJsonNullHandle<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>np             <span class="p">=</span> NULL<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>storeCmdSymId  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotstore&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>recallCmdSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotrecall&quot</span><span class="p">)</span><span class="p">;</span> 
  p<span class="p">-</span><span class="p">&gt</span>doneSymId      <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotdone&quot</span><span class="p">)</span><span class="p">;</span> 
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDonePrId">kDonePrId</a><span class="p">,</span>false<span class="p">,</span>false<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGroupSymPrId">kGroupSymPrId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kLabelPrId">kLabelPrId</a><span class="p">,</span>    NULL<span class="p">,</span><span class="l">&quot&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> height <span class="p">=</span> <span class="l">5</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspUiMsgListCreate">cmDspUiMsgListCreate</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> height<span class="p">,</span> <a href="#kListPrId">kListPrId</a><span class="p">,</span> <a href="#kSelPrId">kSelPrId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPreset_Free_defn"></a><a name="_cmDspPreset_Free"></a><span class="f">_cmDspPreset_Free</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmJson_h_0.html#cmJsonFinalize">cmJsonFinalize</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPreset_Reset_defn"></a><a name="_cmDspPreset_Reset"></a><span class="f">_cmDspPreset_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  <a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="#_cmDspPresetUpdateList">_cmDspPresetUpdateList</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGroupSymPrId">kGroupSymPrId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPreset_Recv_defn"></a><a name="_cmDspPreset_Recv"></a><span class="f">_cmDspPreset_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspPreset_t">cmDspPreset_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kListPrId">kListPrId</a><span class="p">:</span>
    <span class="k">return</span> rc<span class="p">;</span>  <span class="c"> // we don't yet handle lists arriving by the input port</span>
    
  <span class="k">case</span> <a href="#kSelPrId">kSelPrId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="c">// sel idx is base 1 because the first row in the msg list contains the titles</span>
      <span class="k">unsigned</span>  selIdx <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="#_cmDspPresetListSelectRecall">_cmDspPresetListSelectRecall</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span>selIdx<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">)</span>
        <span class="k">return</span> rc<span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="c">// if this is a store or recall command</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="cmDspKr_c_0.html#kCmdPrId">kCmdPrId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> cmdSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="cmDspKr_c_0.html#kCmdPrId">kCmdPrId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span>  cmdSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>storeCmdSymId <span class="p">|</span><span class="p">|</span> cmdSymId<span class="p">=</span><span class="p">=</span>p<span class="p">-</span><span class="p">&gt</span>recallCmdSymId <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> groupSymId<span class="p">;</span>
      <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> groupLabel<span class="p">;</span>
      <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> presetLabel<span class="p">;</span>
      
      <span class="c">// get the group symbol</span>
      <span class="k">if</span><span class="p">(</span><span class="p">(</span>groupSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGroupSymPrId">kGroupSymPrId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe preset group symbol id is not set.&quot</span><span class="p">)</span><span class="p">;</span>
      
      <span class="c">// get the group label</span>
      <span class="k">if</span><span class="p">(</span><span class="p">(</span>groupLabel <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>groupSymId<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe preset group label was not found.&quot</span><span class="p">)</span><span class="p">;</span>
      
      <span class="c">// get the preset label</span>
      <span class="k">if</span><span class="p">(</span><span class="p">(</span> presetLabel <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kLabelPrId">kLabelPrId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">|</span><span class="p">|</span> strlen<span class="p">(</span>presetLabel<span class="p">)</span><span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe preset label was not set.&quot</span><span class="p">)</span><span class="p">;</span>
      
      <span class="c">// if this is a store command</span>
      <span class="k">if</span><span class="p">(</span> cmdSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>storeCmdSymId <span class="p">)</span>
      <span class="p">{</span>
        <span class="c">// create a new preset</span>
        <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspSys_h_0.html#cmDspSysPresetCreate">cmDspSysPresetCreate</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span>groupLabel<span class="p">,</span> presetLabel<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
          <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kSubSysFailDspRC">kSubSysFailDspRC</a><span class="p">,</span><span class="l">&quotPreset create failed for group:'%s' preset:'%s'.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>groupLabel<span class="p">)</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>presetLabel<span class="p">)</span><span class="p">)</span><span class="p">;</span>
        
        <span class="c">// update the list with the new preset</span>
        rc <span class="p">=</span>  <a href="#_cmDspPresetUpdateList">_cmDspPresetUpdateList</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> groupSymId <span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="c"> // otherwise this must be a recall command</span>
      <span class="p">{</span>
        rc <span class="p">=</span> <a href="#_cmDspPresetDoRecall">_cmDspPresetDoRecall</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span>groupLabel<span class="p">,</span> presetLabel<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmPresetClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmPresetClassCons">cmPresetClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmPreset_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotPreset&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPreset_Alloc">_cmDspPreset_Alloc</a><span class="p">,</span>
  <a href="#_cmDspPreset_Free">_cmDspPreset_Free</a><span class="p">,</span>
  <a href="#_cmDspPreset_Reset">_cmDspPreset_Reset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPreset_Recv">_cmDspPreset_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotPreset Manager&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmPreset_DC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspBcastSym : Broadcast a symbol/value to all units registered to listen for the symbol.</div><pre><a name="cmDspBcastSym"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kAttrBcId"></a><span class="e">kAttrBcId</span><span class="p">,</span>
  <a name="kMsgBcId"></a><span class="e">kMsgBcId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmBcastSym_DC<span class="p">;</span>

<a name="cmDspBcastSym_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>   <a name="cmDspBcastSym_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span> <a name="cmDspBcastSym_t.onSymId"></a><span class="i">onSymId</span><span class="p">;</span>
  <span class="k">unsigned</span> <a name="cmDspBcastSym_t.offSymId"></a><span class="i">offSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspBcastSym_t">cmDspBcastSym_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspBcastSym_Alloc_defn"></a><a name="_cmDspBcastSym_Alloc"></a><span class="f">_cmDspBcastSym_Alloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspBcastSym_t">cmDspBcastSym_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspBcastSym_t">cmDspBcastSym_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quotattr&quot</span><span class="p">,</span>  <a href="#kAttrBcId">kAttrBcId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>    <span class="l">&quotInstance which have this attribute symbol will receive the message.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>     <span class="l">&quotmsg&quot</span><span class="p">,</span>   <a href="#kMsgBcId">kMsgBcId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>    <span class="l">&quotMsg to broadcast.&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAttrBcId">kAttrBcId</a><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBcastSym_Reset_defn"></a><a name="_cmDspBcastSym_Reset"></a><span class="f">_cmDspBcastSym_Reset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBcastSym_Recv_defn"></a><a name="_cmDspBcastSym_Recv"></a><span class="f">_cmDspBcastSym_Recv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kAttrBcId">kAttrBcId</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kMsgBcId">kMsgBcId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> attrSymId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kAttrBcId">kAttrBcId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvIsSymbol">cmDsvIsSymbol</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      printf<span class="p">(</span><span class="l">&quotbcast: %i %s\n&quot</span><span class="p">,</span>attrSymId<span class="p">,</span><a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><a href="cmDspValue_h_0.html#cmDsvSymbol">cmDsvSymbol</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <a href="cmDspSys_h_0.html#cmDspSysBroadcastValue">cmDspSysBroadcastValue</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> attrSymId<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>valuePtr <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmBcastSymClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmBcastSymClassCons">cmBcastSymClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmBcastSym_DC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotBcastSym&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspBcastSym_Alloc">_cmDspBcastSym_Alloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspBcastSym_Reset">_cmDspBcastSym_Reset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspBcastSym_Recv">_cmDspBcastSym_Recv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotSet one input high and all others low.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmBcastSym_DC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspSegLine : Line segment generator.</div><pre><a name="cmDspSegLine"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kRsrcSlId"></a><span class="e">kRsrcSlId</span><span class="p">,</span>
  <a name="kCmdSlId"></a><span class="e">kCmdSlId</span><span class="p">,</span>
  <a name="kTrigSlId"></a><span class="e">kTrigSlId</span><span class="p">,</span>
  <a name="kOutSlId"></a><span class="e">kOutSlId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmSegLineDC<span class="p">;</span>


<a name="cmDspSegLine_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspSegLine_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">double</span><span class="p">*</span>     <a name="cmDspSegLine_t.x"></a><span class="i">x</span><span class="p">;</span>   <span class="c"> // x[n]</span>
  <span class="k">unsigned</span>    <a name="cmDspSegLine_t.n"></a><span class="i">n</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspSegLine_t.i"></a><span class="i">i</span><span class="p">;</span>   <span class="c"> // current segment </span>
  <span class="k">unsigned</span>    <a name="cmDspSegLine_t.m"></a><span class="i">m</span><span class="p">;</span>   <span class="c"> // cur cnt</span>
<span class="p">}</span> <span class="t"><a href="#cmDspSegLine_t">cmDspSegLine_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspSegLineAlloc_defn"></a><a name="_cmDspSegLineAlloc"></a><span class="f">_cmDspSegLineAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  
  <a href="#cmDspSegLine_t">cmDspSegLine_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspSegLine_t">cmDspSegLine_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotrsrc&quot</span><span class="p">,</span>  <a href="#kRsrcSlId">kRsrcSlId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotName of resource array.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotcmd&quot</span><span class="p">,</span>   <a href="#kCmdSlId">kCmdSlId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                 <span class="l">&quotCommand&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quottrig&quot</span><span class="p">,</span>  <a href="#kTrigSlId">kTrigSlId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span>              <span class="l">&quotTrigger&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>   <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kOutSlId">kOutSlId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>              <span class="l">&quotOutput&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <span class="c">// The array is expected to contain interleaved values:
  // cnt_0, val_0, cnt_1, val_1 .... cnt_n val_n
  // The 'cnt_x' values give the count of trigger values upon which the output will be 'val_x'.</span>  
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcDblArray">cmDspRsrcDblArray</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>n<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>x<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDefaultStrcz">cmDspDefaultStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kRsrcSlId">kRsrcSlId</a><span class="p">)</span><span class="p">,</span>NULL<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'SegLine' constructor resource array could not be read.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutSlId">kOutSlId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>n <span class="p">&gt</span><span class="p">=</span> <span class="l">2</span> <span class="p">?</span> p<span class="p">-</span><span class="p">&gt</span>x<span class="p">[</span><span class="l">1</span><span class="p">]</span> <span class="p">:</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>i <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>m <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSegLineReset_defn"></a><a name="_cmDspSegLineReset"></a><span class="f">_cmDspSegLineReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspSegLine_t">cmDspSegLine_t</a><span class="p">*</span> p   <span class="p">=</span> <span class="p">(</span><a href="#cmDspSegLine_t">cmDspSegLine_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>i <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>m <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSegLineRecv_defn"></a><a name="_cmDspSegLineRecv"></a><span class="f">_cmDspSegLineRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspSegLine_t">cmDspSegLine_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspSegLine_t">cmDspSegLine_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kTrigSlId">kTrigSlId</a><span class="p">:</span>
      <span class="p">{</span>
        <span class="k">double</span> val <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutSlId">kOutSlId</a><span class="p">)</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>i <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>n <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>m <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>x<span class="p">[</span>p<span class="p">-</span><span class="p">&gt</span>i<span class="p">]</span> <span class="p">)</span>
            p<span class="p">-</span><span class="p">&gt</span>i <span class="p">+</span><span class="p">=</span> <span class="l">2</span><span class="p">;</span>
          
          <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>i <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>n <span class="p">)</span>
          <span class="p">{</span>
            <span class="k">double</span> x0 <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>x<span class="p">[</span>p<span class="p">-</span><span class="p">&gt</span>i<span class="l">-2</span><span class="p">]</span><span class="p">;</span>
            <span class="k">double</span> y0 <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>x<span class="p">[</span>p<span class="p">-</span><span class="p">&gt</span>i<span class="l">-1</span><span class="p">]</span><span class="p">;</span>
            <span class="k">double</span> x1 <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>x<span class="p">[</span>p<span class="p">-</span><span class="p">&gt</span>i<span class="p">+</span><span class="l">0</span><span class="p">]</span><span class="p">;</span>
            <span class="k">double</span> y1 <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>x<span class="p">[</span>p<span class="p">-</span><span class="p">&gt</span>i<span class="p">+</span><span class="l">1</span><span class="p">]</span><span class="p">;</span>
            
            <span class="k">double</span> dx <span class="p">=</span> x1 <span class="p">-</span> x0<span class="p">;</span>
            <span class="k">double</span> dy <span class="p">=</span> y1 <span class="p">-</span> y0<span class="p">;</span>
            
            val <span class="p">=</span> y0 <span class="p">+</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>m <span class="p">-</span> x0<span class="p">)</span> <span class="p">*</span> dy <span class="p">/</span> dx<span class="p">;</span>
            
            printf<span class="p">(</span><span class="l">&quoti:%i m=%i x0:%f y0:%f x1:%f y1:%f : %f\n&quot</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>i<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>m<span class="p">,</span>x0<span class="p">,</span>y0<span class="p">,</span>x1<span class="p">,</span>y1<span class="p">,</span>val<span class="p">)</span><span class="p">;</span>
            
          <span class="p">}</span>
          <span class="k">else</span>
          <span class="p">{</span>
            val <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>x<span class="p">[</span>p<span class="p">-</span><span class="p">&gt</span>n<span class="l">-1</span><span class="p">]</span><span class="p">;</span>
          <span class="p">}</span>
          
          <span class="p">+</span><span class="p">+</span>p<span class="p">-</span><span class="p">&gt</span>m<span class="p">;</span>
          
        <span class="p">}</span>
        <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutSlId">kOutSlId</a><span class="p">,</span>val<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="#kCmdSlId">kCmdSlId</a><span class="p">:</span>
      p<span class="p">-</span><span class="p">&gt</span>i <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>m <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmSegLineClassCons_defn"></a><span class="f"><a href="cmDspFx_h_0.html#cmSegLineClassCons">cmSegLineClassCons</a></span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmSegLineDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotSegLine&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspSegLineAlloc">_cmDspSegLineAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspSegLineReset">_cmDspSegLineReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspSegLineRecv">_cmDspSegLineRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotSegLine&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmSegLineDC<span class="p">;</span>
<span class="p">}</span>
</pre>
</div>
<!-- End nodes -->
</div>
</body>
</html>
