<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>cmDspBuiltIn.c</title>
    <link href="cdg_code.css"    rel="stylesheet" type="text/css" media="screen" />
  </head>
  <body>
    <div class="highlight">

      <div class="license">
	<p>
	  Copyright (C) Kevin Larke 2009-2020
	</p>

	<p>
	  This file is part of libcm.
	</p>

	<p>
	  libcm is free software: you can redistribute it and/or modify it under
	  the terms of the GNU General Public License as published by the Free
	  Software Foundation, either version 3 of the License, or (at your
	  option) any later version.
	</p>

	<p>
	  libcm is distributed in the hope that it will be useful, but WITHOUT
	  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
	  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
	  for more details.
	</p>

	<p>
	  See the GNU General Public License distributed with the libcm
	  package or look here: <https://www.gnu.org/licenses/>.
	</p>


      </div>

      <hr>
<a name="cmDspBuiltIn.c"></a><!-- Begin nodes -->
<div class="cod"><div class="blk_title">cmDspBuiltIn : Built-in 'snap' processor units.</div><pre><a name="cmDspBuiltIn_c_code_0"></a>
<span class="m">#include &quot<a href="cmPrefix_h_0.html#cmPrefix.h">cmPrefix.h</a>&quot</span>
<span class="m">#include &quot<a href="cmGlobal_h_0.html#cmGlobal.h">cmGlobal.h</a>&quot</span>
<span class="m">#include &quot<a href="cmFloatTypes_h_0.html#cmFloatTypes.h">cmFloatTypes.h</a>&quot</span>
<span class="m">#include &quot<a href="cmComplexTypes_h_0.html#cmComplexTypes.h">cmComplexTypes.h</a>&quot</span>
<span class="m">#include &quot<a href="cmRpt_h_0.html#cmRpt.h">cmRpt.h</a>&quot</span>
<span class="m">#include &quot<a href="cmErr_h_0.html#cmErr.h">cmErr.h</a>&quot</span>
<span class="m">#include &quot<a href="cmCtx_h_0.html#cmCtx.h">cmCtx.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMem_h_0.html#cmMem.h">cmMem.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMallocDebug_h_0.html#cmMallocDebug.h">cmMallocDebug.h</a>&quot</span>
<span class="m">#include &quot<a href="cmLinkedHeap_h_0.html#cmLinkedHeap.h">cmLinkedHeap.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMath_h_0.html#cmMath.h">cmMath.h</a>&quot</span>
<span class="m">#include &quot<a href="cmFile_h_0.html#cmFile.h">cmFile.h</a>&quot</span>
<span class="m">#include &quot<a href="cmFileSys_h_0.html#cmFileSys.h">cmFileSys.h</a>&quot</span>
<span class="m">#include &quot<a href="cmSymTbl_h_0.html#cmSymTbl.h">cmSymTbl.h</a>&quot</span>
<span class="m">#include &quot<a href="cmJson_h_0.html#cmJson.h">cmJson.h</a>&quot</span>
<span class="m">#include &quot<a href="cmText_h_0.html#cmText.h">cmText.h</a>&quot</span>
<span class="m">#include &quot<a href="cmPrefs_h_0.html#cmPrefs.h">cmPrefs.h</a>&quot</span>
<span class="m">#include &quot<a href="cmProcObj_h_0.html#cmProcObj.h">cmProcObj.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspValue_h_0.html#cmDspValue.h">cmDspValue.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspCtx_h_0.html#cmDspCtx.h">cmDspCtx.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspClass_h_0.html#cmDspClass.h">cmDspClass.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspFx_h_0.html#cmDspFx.h">cmDspFx.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspKr_h_0.html#cmDspKr.h">cmDspKr.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMsgProtocol_h_0.html#cmMsgProtocol.h">cmMsgProtocol.h</a>&quot</span>
<span class="m">#include &quot<a href="cmThread_h_0.html#cmThread.h">cmThread.h</a>&quot</span>
<span class="m">#include &quot<a href="cmUdpPort_h_0.html#cmUdpPort.h">cmUdpPort.h</a>&quot</span>
<span class="m">#include &quot<a href="cmUdpNet_h_0.html#cmUdpNet.h">cmUdpNet.h</a>&quot</span>
<span class="m">#include &quot<a href="cmSerialPort_h_0.html#cmSerialPort.h">cmSerialPort.h</a>&quot</span>
<span class="m">#include &quot<a href="cmTime_h_0.html#cmTime.h">cmTime.h</a>&quot</span>
<span class="m">#include &quot<a href="cmAudioSys_h_0.html#cmAudioSys.h">cmAudioSys.h</a>&quot</span>
<span class="m">#include &quot<a href="cmDspSys_h_0.html#cmDspSys.h">cmDspSys.h</a>&quot</span>

<span class="m">#include &quot<a href="cmDspPreset_h_0.html#cmDspPreset.h">cmDspPreset.h</a>&quot  </span><span class="c"> // required for <a href="#cmDspNetSend">cmDspNetSend</a></span>
<span class="m">#include &quot<a href="cmDspNet_h_0.html#cmDspNet.h">cmDspNet.h</a>&quot</span>

<span class="m">#include &quot<a href="cmAudioFile_h_0.html#cmAudioFile.h">cmAudioFile.h</a>&quot</span>
<span class="m">#include &quot<a href="cmThread_h_0.html#cmThread.h">cmThread.h</a>&quot  </span><span class="c"> // used for threaded loading in wave table file mode</span>


<span class="m">#include &quot<a href="cmProcObj_h_0.html#cmProcObj.h">cmProcObj.h</a>&quot</span>
<span class="m">#include &quotcmProcTemplateMain.h&quot</span>
<span class="m">#include &quot<a href="cmProc_h_0.html#cmProc.h">cmProc.h</a>&quot</span>
<span class="m">#include &quot<a href="cmMidi_h_0.html#cmMidi.h">cmMidi.h</a>&quot</span>
<span class="m">#include &quot<a href="cmProc2_h_0.html#cmProc2.h">cmProc2.h</a>&quot</span>
<span class="m">#include &quotcmVectOpsTemplateMain.h&quot</span>
<span class="m">#include &quot<a href="cmMidiPort_h_0.html#cmMidiPort.h">cmMidiPort.h</a>&quot</span>

<span class="m">#include &quotsa/cmSaProc.h&quot</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspPrinter : Console printing unit.</div><pre><a name="cmDspPrinter"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kLblPrId"></a><span class="e">kLblPrId</span><span class="p">,</span>
  <a name="kMsPrId"></a><span class="e">kMsPrId</span><span class="p">,</span>
  <a name="kInPrId"></a><span class="e">kInPrId</span>
  
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmPrinterDC<span class="p">;</span>

<a name="cmDspPrinter_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspPrinter_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span> <a name="cmDspPrinter_t.limitCycles"></a><span class="i">limitCycles</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspPrinter_t">cmDspPrinter_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspPrinterAlloc_defn"></a><a name="_cmDspPrinterAlloc"></a><span class="f">_cmDspPrinterAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotlbl&quot</span><span class="p">,</span>  <a href="#kLblPrId">kLblPrId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotLabel&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotms&quot</span><span class="p">,</span>   <a href="#kMsPrId">kMsPrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotPeriod&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInPrId">kInPrId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span>              <span class="l">&quotInput port&quot</span>   <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspPrinter_t">cmDspPrinter_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspPrinter_t">cmDspPrinter_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMsPrId">kMsPrId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPrinterReset_defn"></a><a name="_cmDspPrinterReset"></a><span class="f">_cmDspPrinterReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspPrinter_t">cmDspPrinter_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspPrinter_t">cmDspPrinter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>limitCycles <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt<span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPrinterRecv_defn"></a><a name="_cmDspPrinterRecv"></a><span class="f">_cmDspPrinterRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspPrinter_t">cmDspPrinter_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspPrinter_t">cmDspPrinter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kInPrId">kInPrId</a> <span class="p">&amp</span><span class="p">&amp</span> ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>limitCycles <span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>limitCycles <span class="p">=</span>  ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt <span class="p">+</span> <span class="p">(</span><span class="k">unsigned</span><span class="p">)</span><span class="p">(</span><a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMsPrId">kMsPrId</a><span class="p">)</span> <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">/</span> <span class="p">(</span><span class="l">1000.0</span> <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    
    <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> lbl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kLblPrId">kLblPrId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvIsSymbol">cmDsvIsSymbol</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">)</span>
      <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot%s'%s'&quot</span><span class="p">,</span>lbl<span class="p">=</span><span class="p">=</span>NULL<span class="p">?</span><span class="l">&quot&quot</span><span class="p">:</span>lbl<span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span><a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><a href="cmDspValue_h_0.html#cmDsvSymbol">cmDsvSymbol</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      <a href="cmDspValue_h_0.html#cmDsvPrint">cmDsvPrint</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">,</span>lbl<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">)</span><span class="p">;</span>
    
    <a href="cmRpt_h_0.html#cmRptPrint">cmRptPrint</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot\n&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmPrinterClassCons_defn"></a><a name="cmPrinterClassCons"></a><span class="f">cmPrinterClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmPrinterDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotPrinter&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPrinterAlloc">_cmDspPrinterAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPrinterReset">_cmDspPrinterReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPrinterRecv">_cmDspPrinterRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotPrint the value of any event arriving at 'in'.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmPrinterDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspCounter : Counter unit.</div><pre><a name="cmDspCounter"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kMinCntId"></a><span class="e">kMinCntId</span><span class="p">,</span>
  <a name="kMaxCntId"></a><span class="e">kMaxCntId</span><span class="p">,</span>
  <a name="kIncCntId"></a><span class="e">kIncCntId</span><span class="p">,</span>
  <a name="kWrapCntId"></a><span class="e">kWrapCntId</span><span class="p">,</span>
  <a name="kResetCntId"></a><span class="e">kResetCntId</span><span class="p">,</span>
  <a name="kOutCntId"></a><span class="e">kOutCntId</span><span class="p">,</span>
  <a name="kCycCntId"></a><span class="e">kCycCntId</span><span class="p">,</span>
  <a name="kNxtCntId"></a><span class="e">kNxtCntId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmCounterDC<span class="p">;</span>

<a name="cmDspCounter_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspCounter_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">double</span>      <a name="cmDspCounter_t.val"></a><span class="i">val</span><span class="p">;</span>
  <span class="k">bool</span>        <a name="cmDspCounter_t.disableFl"></a><span class="i">disableFl</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspCounter_t">cmDspCounter_t</a></span><span class="p">;</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspCounterValidate_defn"></a><a name="_cmDspCounterValidate"></a><span class="f">_cmDspCounterValidate</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">double</span> min<span class="p">,</span> <span class="k">double</span> max<span class="p">,</span> <span class="k">double</span> inc <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> max <span class="p">&lt</span> min <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>inst<span class="p">-</span><span class="p">&gt</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe counter maximum (%f) value must be greater than the counter minimum (%f) value.&quot</span><span class="p">,</span>max<span class="p">,</span>min<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> max <span class="p">-</span> min <span class="p">&lt</span> inc <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>inst<span class="p">-</span><span class="p">&gt</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe counter increment value (%f) must be less than or equal to the maximum - minimum difference (%f).&quot</span><span class="p">,</span>inc<span class="p">,</span>max<span class="p">-</span>min<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspCounterAlloc_defn"></a><a name="_cmDspCounterAlloc"></a><span class="f">_cmDspCounterAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotmin&quot</span><span class="p">,</span>    <a href="#kMinCntId">kMinCntId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotminimum&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmax&quot</span><span class="p">,</span>    <a href="#kMaxCntId">kMaxCntId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotmaximum&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotinc&quot</span><span class="p">,</span>    <a href="#kIncCntId">kIncCntId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotincrement&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotwrap&quot</span><span class="p">,</span>   <a href="#kWrapCntId">kWrapCntId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotwrap&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotreset&quot</span><span class="p">,</span>  <a href="#kResetCntId">kResetCntId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span>                <span class="l">&quotreset&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>    <a href="#kOutCntId">kOutCntId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                <span class="l">&quotout&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotcycles&quot</span><span class="p">,</span> <a href="#kCycCntId">kCycCntId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>                <span class="l">&quotcycles&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotnext&quot</span><span class="p">,</span>   <a href="#kNxtCntId">kNxtCntId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span>                <span class="l">&quotnext&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">double</span> min <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDefaultDouble">cmDspDefaultDouble</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMinCntId">kMinCntId</a> <span class="p">)</span><span class="p">;</span>
  <span class="k">double</span> max <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDefaultDouble">cmDspDefaultDouble</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxCntId">kMaxCntId</a> <span class="p">)</span><span class="p">;</span>
  <span class="k">double</span> inc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDefaultDouble">cmDspDefaultDouble</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kIncCntId">kIncCntId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="#_cmDspCounterValidate">_cmDspCounterValidate</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> min<span class="p">,</span> max<span class="p">,</span> inc <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kWrapCntId">kWrapCntId</a><span class="p">,</span>    false<span class="p">,</span> true<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutCntId">kOutCntId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> min <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kCycCntId">kCycCntId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCounterReset_defn"></a><a name="_cmDspCounterReset"></a><span class="f">_cmDspCounterReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>val       <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMinCntId">kMinCntId</a><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>disableFl <span class="p">=</span> false<span class="p">;</span>  <span class="c"> // the default values must be ok or the constructor fails</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<span class="k">void</span> <a name="_cmDspCounterIncr_defn"></a><a name="_cmDspCounterIncr"></a><span class="f">_cmDspCounterIncr</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst  <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">*</span> p       <span class="p">=</span> <span class="p">(</span><a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">double</span>          min     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMinCntId">kMinCntId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>          max     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMaxCntId">kMaxCntId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>          inc     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kIncCntId">kIncCntId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">bool</span>            wrapFl  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspBool">cmDspBool</a><span class="p">(</span>inst<span class="p">,</span><a href="#kWrapCntId">kWrapCntId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">bool</span>            limitFl <span class="p">=</span> min <span class="p">&lt</span><span class="p">=</span> max<span class="p">;</span>
  
  <span class="c">// If min &ampgt max then no upper/lower limit is set on the value.
  // In this case the ouput will continue to increment and 
  // no 'cycle' output will be generated.</span>  
  
  <span class="c">// If wrapFl is not set then the 'cycle' output will fire
  // exactly once when the counter crosses its limit.</span>  
  
  <span class="c">// if the new value is in range then send it</span>
  <span class="k">if</span><span class="p">(</span> min <span class="p">&lt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&lt</span> max <span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOutCntId">kOutCntId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">)</span><span class="p">;</span> 
  
  
  <span class="c">// the current value is out of range and wrap flag is not set</span>
  <span class="k">if</span><span class="p">(</span> limitFl <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&lt</span> min <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&gt</span><span class="p">=</span> max<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span>wrapFl<span class="p">=</span><span class="p">=</span>false<span class="p">)</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  
  <span class="c">// do the increment</span>
  p<span class="p">-</span><span class="p">&gt</span>val <span class="p">+</span><span class="p">=</span> inc<span class="p">;</span>
  
  <span class="c">// if the new value is out of range </span>
  <span class="k">if</span><span class="p">(</span> limitFl <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&lt</span> min <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&gt</span><span class="p">=</span> max<span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// if wrapping is allowed</span>
    <span class="k">if</span><span class="p">(</span> wrapFl <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&gt</span><span class="p">=</span> max <span class="p">)</span>
        p<span class="p">-</span><span class="p">&gt</span>val <span class="p">=</span> min <span class="p">+</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>val <span class="p">-</span> max<span class="p">)</span><span class="p">;</span>   <span class="c"> // wrap to begin</span>
      <span class="k">else</span>
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">&lt</span> min <span class="p">)</span> 
          p<span class="p">-</span><span class="p">&gt</span>val <span class="p">=</span> max <span class="p">-</span> <span class="p">(</span>min <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>val<span class="p">)</span><span class="p">;</span> <span class="c"> // wrap to end</span>
    <span class="p">}</span>
    
    <span class="c">// increment the cycle counter</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kCycCntId">kCycCntId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kCycCntId">kCycCntId</a> <span class="p">)</span> <span class="p">+</span> <span class="l">1</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCounterRecv_defn"></a><a name="_cmDspCounterRecv"></a><span class="f">_cmDspCounterRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">*</span> p   <span class="p">=</span> <span class="p">(</span><a href="#cmDspCounter_t">cmDspCounter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kWrapCntId">kWrapCntId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span> evt <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kMinCntId">kMinCntId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kMaxCntId">kMaxCntId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kIncCntId">kIncCntId</a><span class="p">:</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> evt <span class="p">)</span><span class="p">;</span>
      <span class="k">double</span> min     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kMinCntId">kMinCntId</a> <span class="p">)</span><span class="p">;</span>
      <span class="k">double</span> max     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kMaxCntId">kMaxCntId</a> <span class="p">)</span><span class="p">;</span>
      <span class="k">double</span> inc     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kIncCntId">kIncCntId</a> <span class="p">)</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>disableFl   <span class="p">=</span> <span class="p">(</span>rc <span class="p">=</span> <a href="#_cmDspCounterValidate">_cmDspCounterValidate</a><span class="p">(</span>inst<span class="p">,</span> min<span class="p">,</span> max<span class="p">,</span> inc<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
      
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kNxtCntId">kNxtCntId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">!</span>p<span class="p">-</span><span class="p">&gt</span>disableFl <span class="p">)</span>
      <a href="#_cmDspCounterIncr">_cmDspCounterIncr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kResetCntId">kResetCntId</a><span class="p">:</span>  <span class="c"> // any msg on the 'reset' port causes the min value to be sent on the following 'next'</span>
    p<span class="p">-</span><span class="p">&gt</span>val <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMinCntId">kMinCntId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>



<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> <a name="cmCounterClassCons_defn"></a><a name="cmCounterClassCons"></a><span class="f">cmCounterClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmCounterDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotCounter&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCounterAlloc">_cmDspCounterAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCounterReset">_cmDspCounterReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCounterRecv">_cmDspCounterRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotCounter object. Set min =&gt max to have no limit on the value.&quot</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmCounterDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspPhasor : Ramp signal generator.</div><pre><a name="cmDspPhasor"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kMaxPhId"></a><span class="e">kMaxPhId</span><span class="p">,</span>
  <a name="kMultPhId"></a><span class="e">kMultPhId</span><span class="p">,</span>
  <a name="kPhsPhId"></a><span class="e">kPhsPhId</span><span class="p">,</span>
  <a name="kOutPhId"></a><span class="e">kOutPhId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmPhasorDC<span class="p">;</span>

<a name="cmDspPhasor_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspPhasor_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspPhasor_t">cmDspPhasor_t</a></span><span class="p">;</span>


<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspPhasorAlloc_defn"></a><a name="_cmDspPhasorAlloc"></a><span class="f">_cmDspPhasorAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> chs <span class="p">=</span> <span class="l">1</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotmax&quot</span><span class="p">,</span>  <a href="#kMaxPhId">kMaxPhId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMaximum accumulator value&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmult&quot</span><span class="p">,</span> <a href="#kMultPhId">kMultPhId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotIncrement multiplier&quot</span>  <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotphs&quot</span><span class="p">,</span>  <a href="#kPhsPhId">kPhsPhId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotNext phase value&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutPhId">kOutPhId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> chs<span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>               <span class="l">&quotAudio output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="c">// allocate the instance</span>
  <a href="#cmDspPhasor_t">cmDspPhasor_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspPhasor_t">cmDspPhasor_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// assign default values to any of the the optional arg's which may not have been set from vl.</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSample">cmDspSetDefaultSample</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxPhId">kMaxPhId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <a href="cmFloatTypes_h_0.html#cmSample_MAX">cmSample_MAX</a><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSample">cmDspSetDefaultSample</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMultPhId">kMultPhId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kPhsPhId">kPhsPhId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPhasorReset_defn"></a><a name="_cmDspPhasorReset"></a><span class="f">_cmDspPhasorReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOutPhId">kOutPhId</a> <span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPhasorExec_defn"></a><a name="_cmDspPhasorExec"></a><span class="f">_cmDspPhasorExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       bp   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutPhId">kOutPhId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ep   <span class="p">=</span> bp <span class="p">+</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutPhId">kOutPhId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a>        mult <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSample">cmDspSample</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMultPhId">kMultPhId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a>        max  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSample">cmDspSample</a><span class="p">(</span>inst<span class="p">,</span><a href="#kMaxPhId">kMaxPhId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            phs  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kPhsPhId">kPhsPhId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a>        inc  <span class="p">=</span> mult<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span><span class="p">;</span> bp<span class="p">&lt</span>ep<span class="p">;</span> <span class="p">+</span><span class="p">+</span>bp<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">while</span><span class="p">(</span> phs <span class="p">&gt</span><span class="p">=</span> max <span class="p">)</span>
      phs <span class="p">-</span><span class="p">=</span> max<span class="p">;</span>
    
    <span class="p">*</span>bp <span class="p">=</span> <span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span>phs<span class="p">;</span>
    
    phs <span class="p">+</span><span class="p">=</span> inc<span class="p">;</span>
    
  <span class="p">}</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetSample">cmDspSetSample</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kPhsPhId">kPhsPhId</a><span class="p">,</span>phs<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPhasorRecv_defn"></a><a name="_cmDspPhasorRecv"></a><span class="f">_cmDspPhasorRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kMultPhId">kMultPhId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kMaxPhId">kMaxPhId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kPhsPhId">kPhsPhId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> evt <span class="p">)</span><span class="p">;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmPhasorClassCons_defn"></a><a name="cmPhasorClassCons"></a><span class="f">cmPhasorClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmPhasorDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotPhasor&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPhasorAlloc">_cmDspPhasorAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPhasorReset">_cmDspPhasorReset</a><span class="p">,</span>
  <a href="#_cmDspPhasorExec">_cmDspPhasorExec</a><span class="p">,</span>
  <a href="#_cmDspPhasorRecv">_cmDspPhasorRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotRamp wave signal generator.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmPhasorDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspSigGen : Programmable periodic and noise signal generator.</div><pre><a name="cmDspSigGen"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kHzSgId"></a><span class="e">kHzSgId</span><span class="p">,</span>
  <a name="kShapeSgId"></a><span class="e">kShapeSgId</span><span class="p">,</span>
  <a name="kGainSgId"></a><span class="e">kGainSgId</span><span class="p">,</span>
  <a name="kOtCntSgId"></a><span class="e">kOtCntSgId</span><span class="p">,</span>
  <a name="kOutSgId"></a><span class="e">kOutSgId</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">enum</span>
<span class="p">{</span>
  <a name="kWhiteSgId"></a><span class="e">kWhiteSgId</span><span class="p">,</span> <span class="c"> // 0</span>
  <a name="kPinkSgId"></a><span class="e">kPinkSgId</span><span class="p">,</span>  <span class="c"> // 1</span>
  <a name="kSineSgId"></a><span class="e">kSineSgId</span><span class="p">,</span>  <span class="c"> // 2</span>
  <a name="kCosSgId"></a><span class="e">kCosSgId</span><span class="p">,</span>   <span class="c"> // 3</span>
  <a name="kSawSgId"></a><span class="e">kSawSgId</span><span class="p">,</span>   <span class="c"> // 4</span>
  <a name="kSqrSgId"></a><span class="e">kSqrSgId</span><span class="p">,</span>   <span class="c"> // 5</span>
  <a name="kTriSgId"></a><span class="e">kTriSgId</span><span class="p">,</span>   <span class="c"> // 6</span>
  <a name="kPulseSgId"></a><span class="e">kPulseSgId</span><span class="p">,</span> <span class="c"> // 7 </span>
  <a name="kPhasorSgId"></a><span class="e">kPhasorSgId</span> <span class="c"> // 8</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmSigGenDC<span class="p">;</span>

<a name="cmDspSigGen_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspSigGen_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>    <a name="cmDspSigGen_t.phs"></a><span class="i">phs</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a>  <a name="cmDspSigGen_t.reg"></a><span class="i">reg</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspSigGen_t">cmDspSigGen_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspSigGenAlloc_defn"></a><a name="_cmDspSigGenAlloc"></a><span class="f">_cmDspSigGenAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quothz&quot</span><span class="p">,</span>     <a href="#kHzSgId">kHzSgId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quotSignal frequency in Hertz.&quot</span>   <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotshape&quot</span><span class="p">,</span>  <a href="#kShapeSgId">kShapeSgId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quotWave shape 0=sine 1=cosine 2=white 3=pink&quot</span>   <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgain&quot</span><span class="p">,</span>   <a href="#kGainSgId">kGainSgId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quotOutput gain.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotot&quot</span><span class="p">,</span>     <a href="#kOtCntSgId">kOtCntSgId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quotOvertone count.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>    <a href="#kOutSgId">kOutSgId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotAudio output.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspSigGen_t">cmDspSigGen_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspSigGen_t">cmDspSigGen_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kHzSgId">kHzSgId</a><span class="p">,</span>    <span class="l">0.0</span><span class="p">,</span> <span class="l">1000</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kShapeSgId">kShapeSgId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOtCntSgId">kOtCntSgId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGainSgId">kGainSgId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0.9</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSigGenReset_defn"></a><a name="_cmDspSigGenReset"></a><span class="f">_cmDspSigGenReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspSigGen_t">cmDspSigGen_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspSigGen_t">cmDspSigGen_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kOutSgId">kOutSgId</a> <span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>reg <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSigGenExec_defn"></a><a name="_cmDspSigGenExec"></a><span class="f">_cmDspSigGenExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  
  <a href="#cmDspSigGen_t">cmDspSigGen_t</a><span class="p">*</span>    p     <span class="p">=</span> <span class="p">(</span><a href="#cmDspSigGen_t">cmDspSigGen_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          chIdx <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       bp    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutSgId">kOutSgId</a><span class="p">,</span>chIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          n     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutSgId">kOutSgId</a><span class="p">,</span>chIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ep    <span class="p">=</span> bp <span class="p">+</span> n<span class="p">;</span>
  <span class="k">double</span>            hz    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kHzSgId">kHzSgId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            sr    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            fact  <span class="p">=</span> <span class="l">2.0</span> <span class="p">*</span> M_PI <span class="p">*</span> hz <span class="p">/</span> sr<span class="p">;</span>
  <span class="k">int</span>               shape <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kShapeSgId">kShapeSgId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            offs  <span class="p">=</span> shape <span class="p">=</span><span class="p">=</span> <a href="#kCosSgId">kCosSgId</a> <span class="p">?</span> <span class="p">(</span><span class="p">-</span>M_PI <span class="p">/</span> <span class="l">2.0</span><span class="p">)</span> <span class="p">:</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">double</span>            gain  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGainSgId">kGainSgId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          otCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOtCntSgId">kOtCntSgId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> shape <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kWhiteSgId">kWhiteSgId</a><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> bp <span class="p">&lt</span> ep <span class="p">)</span>
      <span class="p">*</span>bp<span class="p">+</span><span class="p">+</span> <span class="p">=</span> gain <span class="p">*</span> <span class="l">2.0</span> <span class="p">*</span> <span class="p">(</span><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span>rand<span class="p">(</span><span class="p">)</span> <span class="p">/</span> RAND_MAX <span class="p">-</span> <span class="l">0.5</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPinkSgId">kPinkSgId</a><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> bp <span class="p">&lt</span> ep <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a> s <span class="p">=</span> gain <span class="p">*</span> <span class="l">2.0</span> <span class="p">*</span> <span class="p">(</span><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span>rand<span class="p">(</span><span class="p">)</span> <span class="p">/</span> RAND_MAX <span class="p">-</span> <span class="l">0.5</span><span class="p">)</span><span class="p">;</span>        
      <span class="p">*</span>bp<span class="p">+</span><span class="p">+</span> <span class="p">=</span> <span class="p">(</span>s <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>reg<span class="p">)</span><span class="p">/</span><span class="l">2</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>reg <span class="p">=</span> s<span class="p">;</span>       
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSineSgId">kSineSgId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kCosSgId">kCosSgId</a><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> bp<span class="p">&lt</span>ep <span class="p">)</span>
    <span class="p">{</span>
      <span class="p">*</span>bp<span class="p">+</span><span class="p">+</span> <span class="p">=</span> <span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span><span class="p">(</span>gain <span class="p">*</span> sin<span class="p">(</span> fact <span class="p">*</span> p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">+</span> offs <span class="p">)</span><span class="p">)</span><span class="p">;</span>
      
      p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">+</span><span class="p">=</span> <span class="l">1.0</span><span class="p">;</span>
      
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
    
  <span class="k">case</span> <a href="#kSawSgId">kSawSgId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">=</span> cmVOS_SynthSawtooth<span class="p">(</span>bp<span class="p">,</span>n<span class="p">,</span><span class="p">(</span><span class="k">unsigned</span><span class="p">)</span>p<span class="p">-</span><span class="p">&gt</span>phs<span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt<span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>bp<span class="p">,</span>n<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSqrSgId">kSqrSgId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">=</span> cmVOS_SynthSquare<span class="p">(</span>    bp<span class="p">,</span>n<span class="p">,</span><span class="p">(</span><span class="k">unsigned</span><span class="p">)</span>p<span class="p">-</span><span class="p">&gt</span>phs<span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt <span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>bp<span class="p">,</span>n<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kTriSgId">kTriSgId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">=</span> cmVOS_SynthTriangle<span class="p">(</span>  bp<span class="p">,</span>n<span class="p">,</span><span class="p">(</span><span class="k">unsigned</span><span class="p">)</span>p<span class="p">-</span><span class="p">&gt</span>phs<span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt <span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>bp<span class="p">,</span>n<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPulseSgId">kPulseSgId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">=</span> cmVOS_SynthPulseCos<span class="p">(</span>  bp<span class="p">,</span>n<span class="p">,</span><span class="p">(</span><span class="k">unsigned</span><span class="p">)</span>p<span class="p">-</span><span class="p">&gt</span>phs<span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt <span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>bp<span class="p">,</span>n<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPhasorSgId">kPhasorSgId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>phs <span class="p">=</span> cmVOS_SynthPhasor<span class="p">(</span>    bp<span class="p">,</span>n<span class="p">,</span><span class="p">(</span><span class="k">unsigned</span><span class="p">)</span>p<span class="p">-</span><span class="p">&gt</span>phs<span class="p">,</span>sr<span class="p">,</span>hz <span class="p">)</span><span class="p">;</span> 
    cmVOS_MultVS<span class="p">(</span>bp<span class="p">,</span>n<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSigGenRecv_defn"></a><a name="_cmDspSigGenRecv"></a><span class="f">_cmDspSigGenRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="#kShapeSgId">kShapeSgId</a><span class="p">:</span>
      <span class="c">//printf(&ampquot%s %i\n&ampquot,<a href="cmDspClass_h_0.html#cmDspInstLabel">cmDspInstLabel</a>(ctx,inst),<a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a>(inst,<a href="#kShapeSgId">kShapeSgId</a>));</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>



<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmSigGenClassCons_defn"></a><a name="cmSigGenClassCons"></a><span class="f">cmSigGenClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmSigGenDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotSigGen&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspSigGenAlloc">_cmDspSigGenAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspSigGenReset">_cmDspSigGenReset</a><span class="p">,</span>
  <a href="#_cmDspSigGenExec">_cmDspSigGenExec</a><span class="p">,</span>
  <a href="#_cmDspSigGenRecv">_cmDspSigGenRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotVariable frequency and waveshape signal generator.&quot</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmSigGenDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspMidiIn : MIDI input port.</div><pre><a name="cmDspMidiIn"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInDeviceMiId"></a><span class="e">kInDeviceMiId</span><span class="p">,</span>
  <a name="kInPortMiId"></a><span class="e">kInPortMiId</span><span class="p">,</span>
  <a name="kDeviceMiId"></a><span class="e">kDeviceMiId</span><span class="p">,</span>
  <a name="kPortMiId"></a><span class="e">kPortMiId</span><span class="p">,</span>
  <a name="kSmpIdxMiId"></a><span class="e">kSmpIdxMiId</span><span class="p">,</span>
  <a name="kStatusMiId"></a><span class="e">kStatusMiId</span><span class="p">,</span>
  <a name="kD0MiId"></a><span class="e">kD0MiId</span><span class="p">,</span>
  <a name="kD1MiId"></a><span class="e">kD1MiId</span><span class="p">,</span>
  <a name="kSecMiId"></a><span class="e">kSecMiId</span><span class="p">,</span>
  <a name="kNSecMiId"></a><span class="e">kNSecMiId</span>
<span class="p">}</span><span class="p">;</span>


<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmMidiInDC<span class="p">;</span>

<a name="cmDspMidiIn_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>  <a name="cmDspMidiIn_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspMidiIn_t.midiSymId"></a><span class="i">midiSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspMidiIn_t.prevSmpIdx"></a><span class="i">prevSmpIdx</span><span class="p">;</span>
  <a href="cmTime_h_0.html#cmTimeSpec_t">cmTimeSpec_t</a> <a name="cmDspMidiIn_t.prevTimeStamp"></a><span class="i">prevTimeStamp</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspMidiIn_t.inDevIdx"></a><span class="i">inDevIdx</span><span class="p">;</span>
  <span class="k">unsigned</span>     <a name="cmDspMidiIn_t.inPortIdx"></a><span class="i">inPortIdx</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspMidiIn_t">cmDspMidiIn_t</a></span><span class="p">;</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiInSetDevice_defn"></a><a name="_cmDspMidiInSetDevice"></a><span class="f">_cmDspMidiInSetDevice</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> deviceStr <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> deviceStr <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>inDevIdx <span class="p">=</span> <a href="cmMidiPort_h_0.html#cmMpDeviceNameToIndex">cmMpDeviceNameToIndex</a><span class="p">(</span>deviceStr<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe MIDI input device '%s' could not be found.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>deviceStr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>inPortIdx <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span> <span class="c"> // set the port as invalid until it is explicitely set.</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiInSetPort_defn"></a><a name="_cmDspMidiInSetPort"></a><span class="f">_cmDspMidiInSetPort</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> portStr <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> portStr <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>inDevIdx <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe MIDI input port cannot be set until the MIDI input device is set.&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>inPortIdx <span class="p">=</span> <a href="cmMidiPort_h_0.html#cmMpDevicePortNameToIndex">cmMpDevicePortNameToIndex</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>inDevIdx<span class="p">,</span><a href="cmMidiPort_h_0.html#kOutMpFl">kOutMpFl</a><span class="p">,</span>portStr<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe MIDI input port '%s' could not be found on device '%s'.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>portStr<span class="p">)</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span><a href="cmMidiPort_h_0.html#cmMpDeviceName">cmMpDeviceName</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>inDevIdx<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspMidiInAlloc_defn"></a><a name="_cmDspMidiInAlloc"></a><span class="f">_cmDspMidiInAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotindev&quot</span><span class="p">,</span>  <a href="#kInDeviceMiId">kInDeviceMiId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotListen only to this MIDI device&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotinport&quot</span><span class="p">,</span> <a href="#kInPortMiId">kInPortMiId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotListen only to this MIDI port&quot</span><span class="p">}</span><span class="p">,</span>
    
    <span class="p">{</span> <span class="l">&quotdevice&quot</span><span class="p">,</span> <a href="#kDeviceMiId">kDeviceMiId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI device&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotport&quot</span><span class="p">,</span>   <a href="#kPortMiId">kPortMiId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI device port&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsmpidx&quot</span><span class="p">,</span> <a href="#kSmpIdxMiId">kSmpIdxMiId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMessage time tag as sample index.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotstatus&quot</span><span class="p">,</span> <a href="#kStatusMiId">kStatusMiId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI status&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotd0&quot</span><span class="p">,</span>     <a href="#kD0MiId">kD0MiId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI channel message d0&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotd1&quot</span><span class="p">,</span>     <a href="#kD1MiId">kD1MiId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI channel message d1&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsec&quot</span><span class="p">,</span>    <a href="#kSecMiId">kSecMiId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotTime stamp integer seconds.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotnsec&quot</span><span class="p">,</span>   <a href="#kNSecMiId">kNSecMiId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotTime stamp fractional second (nanoseconds).&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>inDevIdx  <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>inPortIdx <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>midiSymId <span class="p">=</span>  <a href="cmDspSys_h_0.html#cmDspSysAssignInstAttrSymbolStr">cmDspSysAssignInstAttrSymbolStr</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <span class="l">&quot_midi&quot</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiInReset_defn"></a><a name="_cmDspMidiInReset"></a><span class="f">_cmDspMidiInReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><a href="#_cmDspMidiInSetDevice">_cmDspMidiInSetDevice</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInDeviceMiId">kInDeviceMiId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <a href="#_cmDspMidiInSetPort">_cmDspMidiInSetPort</a><span class="p">(</span>  ctx<span class="p">,</span>p<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInPortMiId">kInPortMiId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>prevSmpIdx <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span> 

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiInRecv_defn"></a><a name="_cmDspMidiInRecv"></a><span class="f">_cmDspMidiInRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kInDeviceMiId">kInDeviceMiId</a><span class="p">:</span>      
    <a href="#_cmDspMidiInSetDevice">_cmDspMidiInSetDevice</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> <a href="cmDspValue_h_0.html#cmDsvStrcz">cmDsvStrcz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kInPortMiId">kInPortMiId</a><span class="p">:</span>
    <a href="#_cmDspMidiInSetPort">_cmDspMidiInSetPort</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> <a href="cmDspValue_h_0.html#cmDsvStrcz">cmDsvStrcz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspMidiInRecvFunc_defn"></a><a name="_cmDspMidiInRecvFunc"></a><span class="f">_cmDspMidiInRecvFunc</span><span class="p">(</span>   <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span>  <span class="k">unsigned</span> attrSymId<span class="p">,</span> <span class="k">const</span> <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a><span class="p">*</span> value <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMidiIn_t">cmDspMidiIn_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  
  <span class="k">if</span><span class="p">(</span> attrSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>midiSymId <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmMidi_h_0.html#cmMidiPacket_t">cmMidiPacket_t</a><span class="p">*</span> pkt <span class="p">=</span> <span class="p">(</span><a href="cmMidi_h_0.html#cmMidiPacket_t">cmMidiPacket_t</a><span class="p">*</span><span class="p">)</span><span class="p">(</span>value<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>m<span class="p">.</span>u<span class="p">.</span>vp<span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> i<span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>inDevIdx<span class="p">=</span><span class="p">=</span><a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>inDevIdx<span class="p">=</span><span class="p">=</span>pkt<span class="p">-</span><span class="p">&gt</span>devIdx<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>inPortIdx<span class="p">=</span><span class="p">=</span><a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">|</span><span class="p">|</span> p<span class="p">-</span><span class="p">&gt</span>inPortIdx<span class="p">=</span><span class="p">=</span>pkt<span class="p">-</span><span class="p">&gt</span>portIdx <span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      
      <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kDeviceMiId">kDeviceMiId</a><span class="p">,</span> pkt<span class="p">-</span><span class="p">&gt</span>devIdx<span class="p">)</span><span class="p">;</span>
      <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kPortMiId">kPortMiId</a><span class="p">,</span>   pkt<span class="p">-</span><span class="p">&gt</span>portIdx<span class="p">)</span><span class="p">;</span> 
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>pkt<span class="p">-</span><span class="p">&gt</span>msgCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <a href="cmMidi_h_0.html#cmMidiMsg">cmMidiMsg</a><span class="p">*</span> m <span class="p">=</span> pkt<span class="p">-</span><span class="p">&gt</span>msgArray <span class="p">+</span> i<span class="p">;</span>
        <span class="k">unsigned</span>   deltaSmpCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>prevTimeStamp<span class="p">.</span>tv_sec<span class="p">!</span><span class="p">=</span><span class="l">0</span> <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>prevTimeStamp<span class="p">.</span>tv_nsec<span class="p">!</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
          deltaSmpCnt <span class="p">=</span> floor<span class="p">(</span><a href="cmTime_h_0.html#cmTimeElapsedMicros">cmTimeElapsedMicros</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>prevTimeStamp<span class="p">,</span><span class="p">&amp</span>m<span class="p">-</span><span class="p">&gt</span>timeStamp<span class="p">)</span> <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">/</span> <span class="l">1000000.0</span><span class="p">)</span><span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>prevSmpIdx <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
          p<span class="p">-</span><span class="p">&gt</span>prevSmpIdx <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
        <span class="k">else</span>
          p<span class="p">-</span><span class="p">&gt</span>prevSmpIdx <span class="p">+</span><span class="p">=</span> deltaSmpCnt<span class="p">;</span>
        
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kSmpIdxMiId">kSmpIdxMiId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>prevSmpIdx <span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kSecMiId">kSecMiId</a><span class="p">,</span>    m<span class="p">-</span><span class="p">&gt</span>timeStamp<span class="p">.</span>tv_sec<span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kNSecMiId">kNSecMiId</a><span class="p">,</span>   m<span class="p">-</span><span class="p">&gt</span>timeStamp<span class="p">.</span>tv_nsec<span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kD1MiId">kD1MiId</a><span class="p">,</span>     m<span class="p">-</span><span class="p">&gt</span>d1 <span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kD0MiId">kD0MiId</a><span class="p">,</span>     m<span class="p">-</span><span class="p">&gt</span>d0 <span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kStatusMiId">kStatusMiId</a><span class="p">,</span> m<span class="p">-</span><span class="p">&gt</span>status <span class="p">)</span><span class="p">;</span>
        
        p<span class="p">-</span><span class="p">&gt</span>prevTimeStamp <span class="p">=</span> m<span class="p">-</span><span class="p">&gt</span>timeStamp<span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmMidiInClassCons_defn"></a><a name="cmMidiInClassCons"></a><span class="f">cmMidiInClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmMidiInDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotMidiIn&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMidiInAlloc">_cmDspMidiInAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMidiInReset">_cmDspMidiInReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMidiInRecv">_cmDspMidiInRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMidiInRecvFunc">_cmDspMidiInRecvFunc</a><span class="p">,</span>
  <span class="l">&quotMidi input port&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmMidiInDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspMidiOut : MIDI output port.</div><pre><a name="cmDspMidiOut"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kDeviceMoId"></a><span class="e">kDeviceMoId</span><span class="p">,</span>
  <a name="kPortMoId"></a><span class="e">kPortMoId</span><span class="p">,</span>
  <a name="kStatusMoId"></a><span class="e">kStatusMoId</span><span class="p">,</span>
  <a name="kD0MoId"></a><span class="e">kD0MoId</span><span class="p">,</span>
  <a name="kD1MoId"></a><span class="e">kD1MoId</span><span class="p">,</span>
  <a name="kResetMoId"></a><span class="e">kResetMoId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmMidiOutDC<span class="p">;</span>

<a name="cmDspMidiOut_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspMidiOut_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspMidiOut_t.devIdx"></a><span class="i">devIdx</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspMidiOut_t.portIdx"></a><span class="i">portIdx</span><span class="p">;</span>
  <span class="k">bool</span>        <a name="cmDspMidiOut_t.enableFl"></a><span class="i">enableFl</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspMidiOut_t">cmDspMidiOut_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiOutSetDevice_defn"></a><a name="_cmDspMidiOutSetDevice"></a><span class="f">_cmDspMidiOutSetDevice</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> deviceStr <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> deviceStr <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>devIdx <span class="p">=</span> <a href="cmMidiPort_h_0.html#cmMpDeviceNameToIndex">cmMpDeviceNameToIndex</a><span class="p">(</span>deviceStr<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe MIDI output device '%s' could not be found.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>deviceStr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiOutSetPort_defn"></a><a name="_cmDspMidiOutSetPort"></a><span class="f">_cmDspMidiOutSetPort</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> portStr <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> portStr <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>devIdx <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe MIDI port cannot be set until the MIDI device is set.&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>portIdx <span class="p">=</span> <a href="cmMidiPort_h_0.html#cmMpDevicePortNameToIndex">cmMpDevicePortNameToIndex</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>devIdx<span class="p">,</span><a href="cmMidiPort_h_0.html#kOutMpFl">kOutMpFl</a><span class="p">,</span>portStr<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe MIDI out port '%s' could not be found on device '%s'.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>portStr<span class="p">)</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span><a href="cmMidiPort_h_0.html#cmMpDeviceName">cmMpDeviceName</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>devIdx<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspMidiOutAlloc_defn"></a><a name="_cmDspMidiOutAlloc"></a><span class="f">_cmDspMidiOutAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotdevice&quot</span><span class="p">,</span> <a href="#kDeviceMoId">kDeviceMoId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI device name&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotport&quot</span><span class="p">,</span>   <a href="#kPortMoId">kPortMoId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI port name&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotstatus&quot</span><span class="p">,</span> <a href="#kStatusMoId">kStatusMoId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI status&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotd0&quot</span><span class="p">,</span>     <a href="#kD0MoId">kD0MoId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI channel message d0&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotd1&quot</span><span class="p">,</span>     <a href="#kD1MoId">kD1MoId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI channel message d1&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotreset&quot</span><span class="p">,</span>  <a href="#kResetMoId">kResetMoId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span><span class="l">&quotAll notes off&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>devIdx  <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>portIdx <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kStatusMoId">kStatusMoId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kD0MoId">kD0MoId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kD1MoId">kD1MoId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiOutReset_defn"></a><a name="_cmDspMidiOutReset"></a><span class="f">_cmDspMidiOutReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>enableFl <span class="p">=</span> false<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><a href="#_cmDspMidiOutSetDevice">_cmDspMidiOutSetDevice</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kDeviceMoId">kDeviceMoId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    p<span class="p">-</span><span class="p">&gt</span>enableFl <span class="p">=</span> <a href="#_cmDspMidiOutSetPort">_cmDspMidiOutSetPort</a><span class="p">(</span>  ctx<span class="p">,</span>p<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kPortMoId">kPortMoId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span> 

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMidiOutRecv_defn"></a><a name="_cmDspMidiOutRecv"></a><span class="f">_cmDspMidiOutRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMidiOut_t">cmDspMidiOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kDeviceMoId">kDeviceMoId</a><span class="p">:</span>      
    <span class="k">if</span><span class="p">(</span><a href="#_cmDspMidiOutSetDevice">_cmDspMidiOutSetDevice</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> <a href="cmDspValue_h_0.html#cmDsvStrcz">cmDsvStrcz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>enableFl <span class="p">=</span> false<span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPortMoId">kPortMoId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span> <a href="#_cmDspMidiOutSetPort">_cmDspMidiOutSetPort</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> <a href="cmDspValue_h_0.html#cmDsvStrcz">cmDsvStrcz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>enableFl <span class="p">=</span> false<span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kStatusMoId">kStatusMoId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>devIdx <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>portIdx <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidIdx">cmInvalidIdx</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> status <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
      <span class="k">unsigned</span> d0     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kD0MoId">kD0MoId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">unsigned</span> d1     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kD1MoId">kD1MoId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>enableFl <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <a href="cmMidiPort_h_0.html#cmMpDeviceSend">cmMpDeviceSend</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>devIdx<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>portIdx<span class="p">,</span> status<span class="p">,</span> d0<span class="p">,</span> d1 <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmMidiPort_h_0.html#kOkMpRC">kOkMpRC</a> <span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotMIDI send failed.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kResetMoId">kResetMoId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> i<span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>enableFl <span class="p">)</span>
        <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span><a href="cmMidi_h_0.html#kMidiChCnt">kMidiChCnt</a><span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>          
        <a href="cmMidiPort_h_0.html#cmMpDeviceSend">cmMpDeviceSend</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>devIdx<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>portIdx<span class="p">,</span><a href="cmMidi_h_0.html#kCtlMdId">kCtlMdId</a><span class="p">+</span>i<span class="p">,</span><span class="l">121</span><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="c"> // reset all controllers</span>
        <a href="cmMidiPort_h_0.html#cmMpDeviceSend">cmMpDeviceSend</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>devIdx<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>portIdx<span class="p">,</span><a href="cmMidi_h_0.html#kCtlMdId">kCtlMdId</a><span class="p">+</span>i<span class="p">,</span><span class="l">123</span><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="c"> // turn all notes off</span>
        <a href="cmThread_h_0.html#cmSleepMs">cmSleepMs</a><span class="p">(</span><span class="l">15</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmMidiOutClassCons_defn"></a><a name="cmMidiOutClassCons"></a><span class="f">cmMidiOutClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmMidiOutDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotMidiOut&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMidiOutAlloc">_cmDspMidiOutAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMidiOutReset">_cmDspMidiOutReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMidiOutRecv">_cmDspMidiOutRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotMidi input port&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmMidiOutDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAudioIn : Audio input port.</div><pre><a name="cmDspAudioIn"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kChAiId"></a><span class="e">kChAiId</span><span class="p">,</span>
  <a name="kGainAiId"></a><span class="e">kGainAiId</span><span class="p">,</span>
  <a name="kOutAiId"></a><span class="e">kOutAiId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAudioInDC<span class="p">;</span>

<a name="cmDspAudioIn_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspAudioIn_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">bool</span>        <a name="cmDspAudioIn_t.errFl"></a><span class="i">errFl</span><span class="p">;</span> <span class="c"> // used to control error reporting</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAudioIn_t">cmDspAudioIn_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAudioInAlloc_defn"></a><a name="_cmDspAudioInAlloc"></a><span class="f">_cmDspAudioInAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotch&quot</span><span class="p">,</span>   <a href="#kChAiId">kChAiId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>      <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotAudio input channel index&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgain&quot</span><span class="p">,</span> <a href="#kGainAiId">kGainAiId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>      <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput gain multiplier&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutAiId">kOutAiId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>      <span class="l">1</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>              <span class="l">&quotAudio output&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspAudioIn_t">cmDspAudioIn_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspAudioIn_t">cmDspAudioIn_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kChAiId">kChAiId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGainAiId">kGainAiId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioInReset_defn"></a><a name="_cmDspAudioInReset"></a><span class="f">_cmDspAudioInReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioIn_t">cmDspAudioIn_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioIn_t">cmDspAudioIn_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>errFl           <span class="p">=</span> false<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span> 


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioInExec_defn"></a><a name="_cmDspAudioInExec"></a><span class="f">_cmDspAudioInExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span>        chIdx  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChAiId">kChAiId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>        iChCnt <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>iChCnt<span class="p">;</span>
  <a href="#cmDspAudioIn_t">cmDspAudioIn_t</a><span class="p">*</span> p      <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioIn_t">cmDspAudioIn_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">double</span>          gain   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGainAiId">kGainAiId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> chIdx <span class="p">&gt</span><span class="p">=</span> iChCnt   <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>errFl<span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe input channel index %i is invalid. Channel count:%i.&quot</span><span class="p">,</span>chIdx<span class="p">,</span>iChCnt<span class="p">)</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>errFl <span class="p">=</span> true<span class="p">;</span>
    <span class="p">}</span>
    
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAiId">kOutAiId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">//unsigned    n  = <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a>(ctx);</span>
  <span class="k">unsigned</span>    n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAiId">kOutAiId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> dp <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAiId">kOutAiId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  
  assert<span class="p">(</span> n <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAiId">kOutAiId</a><span class="p">,</span>chIdx<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  assert<span class="p">(</span>dp <span class="p">!</span><span class="p">=</span> NULL<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// if this channel is disabled then iChArray[chIdx] will be NULL</span>
  <span class="k">if</span><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>iChArray<span class="p">[</span>chIdx<span class="p">]</span><span class="p">!</span><span class="p">=</span>NULL <span class="p">)</span>
    cmVOS_MultVVS<span class="p">(</span>dp<span class="p">,</span>n<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>iChArray<span class="p">[</span>chIdx<span class="p">]</span><span class="p">,</span><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span>gain<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioInRecv_defn"></a><a name="_cmDspAudioInRecv"></a><span class="f">_cmDspAudioInRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kChAiId">kChAiId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="c">// if the exec callback was previously disabled and the new channel value is valid then re-enable the exec callback.</span>
      <span class="k">if</span><span class="p">(</span> inst<span class="p">-</span><span class="p">&gt</span>execFunc<span class="p">=</span><span class="p">=</span>NULL <span class="p">&amp</span><span class="p">&amp</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChAiId">kChAiId</a><span class="p">)</span> <span class="p">&lt</span> ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>iChCnt <span class="p">)</span>
        inst<span class="p">-</span><span class="p">&gt</span>execFunc <span class="p">=</span> <a href="#_cmDspAudioInExec">_cmDspAudioInExec</a><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kGainAiId">kGainAiId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmAudioInClassCons_defn"></a><a name="cmAudioInClassCons"></a><span class="f">cmAudioInClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAudioInDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAudioIn&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAudioInAlloc">_cmDspAudioInAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAudioInReset">_cmDspAudioInReset</a><span class="p">,</span>
  <a href="#_cmDspAudioInExec">_cmDspAudioInExec</a><span class="p">,</span>
  <a href="#_cmDspAudioInRecv">_cmDspAudioInRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotAudio output port&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAudioInDC<span class="p">;</span>
<span class="p">}</span>




<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAudioOut : Audio output port.</div><pre><a name="cmDspAudioOut"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kChAoId"></a><span class="e">kChAoId</span><span class="p">,</span>
  <a name="kGainAoId"></a><span class="e">kGainAoId</span><span class="p">,</span>
  <a name="kEnableAoId"></a><span class="e">kEnableAoId</span><span class="p">,</span>
  <a name="kInAoId"></a><span class="e">kInAoId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAudioOutDC<span class="p">;</span>

<a name="cmDspAudioOut_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspAudioOut_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspAudioOut_t.onSymId"></a><span class="i">onSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspAudioOut_t.offSymId"></a><span class="i">offSymId</span><span class="p">;</span>  
<span class="p">}</span> <span class="t"><a href="#cmDspAudioOut_t">cmDspAudioOut_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAudioOutAlloc_defn"></a><a name="_cmDspAudioOutAlloc"></a><span class="f">_cmDspAudioOutAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotch&quot</span><span class="p">,</span>    <a href="#kChAoId">kChAoId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotAudio output channel index&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgain&quot</span><span class="p">,</span>  <a href="#kGainAoId">kGainAoId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOutput gain multiplier&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotenable&quot</span><span class="p">,</span><a href="#kEnableAoId">kEnableAoId</a><span class="p">,</span><span class="l">0</span><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotEnable: on off&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>    <a href="#kInAoId">kInAoId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>      <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspAudioOut_t">cmDspAudioOut_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspAudioOut_t">cmDspAudioOut_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>offSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotoff&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>onSymId  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quoton&quot</span><span class="p">)</span><span class="p">;</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kChAoId">kChAoId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGainAoId">kGainAoId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kEnableAoId">kEnableAoId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioOutReset_defn"></a><a name="_cmDspAudioOutReset"></a><span class="f">_cmDspAudioOutReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span> 


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioOutExec_defn"></a><a name="_cmDspAudioOutExec"></a><span class="f">_cmDspAudioOutExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc       <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioOut_t">cmDspAudioOut_t</a><span class="p">*</span> p        <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioOut_t">cmDspAudioOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>         chIdx    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChAoId">kChAoId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">bool</span>             enableFl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kEnableAoId">kEnableAoId</a><span class="p">)</span> <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>onSymId<span class="p">;</span>
  <span class="k">unsigned</span>         oChCnt   <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>oChCnt<span class="p">;</span>
  <span class="k">double</span>           gain     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGainAoId">kGainAoId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> chIdx <span class="p">&gt</span><span class="p">=</span> oChCnt <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe output channel index %i is invalid. Channel count:%i.&quot</span><span class="p">,</span>chIdx<span class="p">,</span>oChCnt<span class="p">)</span><span class="p">;</span>
    inst<span class="p">-</span><span class="p">&gt</span>execFunc <span class="p">=</span> NULL<span class="p">;</span> <span class="c"> // disable callbacks - this prevents the error msg from repeating</span>
    <span class="k">return</span> rc<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> sp <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInAoId">kInAoId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> sp <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    inst<span class="p">-</span><span class="p">&gt</span>execFunc <span class="p">=</span> NULL<span class="p">;</span> <span class="c"> // if there is no connected input then disable further callbacks</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">unsigned</span> n <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  
  assert<span class="p">(</span> n <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInAoId">kInAoId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// if this channel is disabled or set to pass-through then chArray[chIdx] will be NULL</span>
  <span class="k">if</span><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>oChArray<span class="p">[</span>chIdx<span class="p">]</span> <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    cmVOS_MultVVS<span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>oChArray<span class="p">[</span>chIdx<span class="p">]</span><span class="p">,</span>n<span class="p">,</span>sp<span class="p">,</span> <span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span><span class="p">(</span>enableFl <span class="p">?</span> gain <span class="p">:</span> <span class="l">0</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioOutRecv_defn"></a><a name="_cmDspAudioOutRecv"></a><span class="f">_cmDspAudioOutRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kChAoId">kChAoId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="c">// if the exec callback was previously disabled and the new channel value is valid then re-enable the exec callback.</span>
      <span class="k">if</span><span class="p">(</span> inst<span class="p">-</span><span class="p">&gt</span>execFunc<span class="p">=</span><span class="p">=</span>NULL <span class="p">&amp</span><span class="p">&amp</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChAoId">kChAoId</a><span class="p">)</span> <span class="p">&lt</span> ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>oChCnt <span class="p">)</span>
        inst<span class="p">-</span><span class="p">&gt</span>execFunc <span class="p">=</span> <a href="#_cmDspAudioOutExec">_cmDspAudioOutExec</a><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kGainAoId">kGainAoId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kEnableAoId">kEnableAoId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmAudioOutClassCons_defn"></a><a name="cmAudioOutClassCons"></a><span class="f">cmAudioOutClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAudioOutDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAudioOut&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAudioOutAlloc">_cmDspAudioOutAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAudioOutReset">_cmDspAudioOutReset</a><span class="p">,</span>
  <a href="#_cmDspAudioOutExec">_cmDspAudioOutExec</a><span class="p">,</span>
  <a href="#_cmDspAudioOutRecv">_cmDspAudioOutRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAudio output port&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAudioOutDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAudioFileOut : Audio output port which is sent to an audio file.</div><pre><a name="cmDspAudioFileOut"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kFnAofId"></a><span class="e">kFnAofId</span><span class="p">,</span>
  <a name="kChCntAofId"></a><span class="e">kChCntAofId</span><span class="p">,</span>
  <a name="kGain0AofId"></a><span class="e">kGain0AofId</span><span class="p">,</span>
  <a name="kGain1AofId"></a><span class="e">kGain1AofId</span><span class="p">,</span>
  <a name="kIn0AofId"></a><span class="e">kIn0AofId</span><span class="p">,</span>
  <a name="kIn1AofId"></a><span class="e">kIn1AofId</span><span class="p">,</span>
  <a name="kSelAofId"></a><span class="e">kSelAofId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAudioFileOutDC<span class="p">;</span>

<a name="cmDspAudioFileOut_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspAudioFileOut_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>    <a name="cmDspAudioFileOut_t.smpBuf"></a><span class="i">smpBuf</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspAudioFileOut_t.smpCnt"></a><span class="i">smpCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspAudioFileOut_t.bits"></a><span class="i">bits</span><span class="p">;</span>
  <a href="cmAudioFile_h_0.html#cmAudioFileH_t">cmAudioFileH_t</a> <a name="cmDspAudioFileOut_t.afH"></a><span class="i">afH</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspAudioFileOut_t.openSymId"></a><span class="i">openSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspAudioFileOut_t.closeSymId"></a><span class="i">closeSymId</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> <a name="cmDspAudioFileOut_t.afn"></a><span class="i">afn</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioFileOutCreateFile_defn"></a><a name="_cmDspAudioFileOutCreateFile"></a><span class="f">_cmDspAudioFileOutCreateFile</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">unsigned</span> chCnt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>            rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span>      fn <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFnAofId">kFnAofId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span> <span class="p">)</span>
    <a href="cmAudioFile_h_0.html#cmAudioFileDelete">cmAudioFileDelete</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// if the supplied audio file name is actually a directory name then generate a file name</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmFileSys_h_0.html#cmFsIsDir">cmFsIsDir</a><span class="p">(</span>fn<span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmMallocDebug_h_0.html#cmMemPtrFree">cmMemPtrFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afn<span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> <a href="cmFileSys_h_0.html#cmFsGenFn">cmFsGenFn</a><span class="p">(</span>fn<span class="p">,</span><span class="l">&quotrecd&quot</span><span class="p">,</span><span class="l">&quotaiff&quot</span><span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afn<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmFileSys_h_0.html#kOkFsRC">kOkFsRC</a> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kFileSysFailDspRC">kFileSysFailDspRC</a><span class="p">,</span><span class="l">&quotAn output audio file name could not be generated.&quot</span><span class="p">)</span><span class="p">;</span>
    
    fn <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>afn<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH <span class="p">=</span>  <a href="cmAudioFile_h_0.html#cmAudioFileNewCreate">cmAudioFileNewCreate</a><span class="p">(</span>fn<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>bits<span class="p">,</span> chCnt<span class="p">,</span> <span class="p">&amp</span>rc<span class="p">,</span> ctx<span class="p">-</span><span class="p">&gt</span>rpt <span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">-</span><span class="p">&gt</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe output audio file '%s' create failed.&quot</span><span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAudioFileOutAlloc_defn"></a><a name="_cmDspAudioFileOutAlloc"></a><span class="f">_cmDspAudioFileOutAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotfn&quot</span><span class="p">,</span>    <a href="#kFnAofId">kFnAofId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotAudio file or directory name&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotchs&quot</span><span class="p">,</span>   <a href="#kChCntAofId">kChCntAofId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotChannel count&quot</span><span class="p">}</span><span class="p">,</span> 
    <span class="p">{</span> <span class="l">&quotgain0&quot</span><span class="p">,</span> <a href="#kGain0AofId">kGain0AofId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOutput gain 0 multiplier&quot</span><span class="p">}</span><span class="p">,</span>  
    <span class="p">{</span> <span class="l">&quotgain1&quot</span><span class="p">,</span> <a href="#kGain1AofId">kGain1AofId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOutput gain 1 multiplier&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin0&quot</span><span class="p">,</span>   <a href="#kIn0AofId">kIn0AofId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>              <span class="l">&quotAudio input 0&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin1&quot</span><span class="p">,</span>   <a href="#kIn1AofId">kIn1AofId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>              <span class="l">&quotAudio input 1&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsel&quot</span><span class="p">,</span>   <a href="#kSelAofId">kSelAofId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                               <span class="l">&quotOpen | Close&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a> chCntVal<span class="p">;</span>
  <a href="cmDspValue_h_0.html#cmDsvSetUInt">cmDsvSetUInt</a><span class="p">(</span><span class="p">&amp</span>chCntVal<span class="p">,</span><a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span><span class="l">2</span><span class="p">,</span><a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kChCntAofId">kChCntAofId</a><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefault">cmDspSetDefault</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kChCntAofId">kChCntAofId</a><span class="p">,</span> <span class="p">&amp</span>chCntVal <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGain0AofId">kGain0AofId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGain1AofId">kGain1AofId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>bits       <span class="p">=</span> <span class="l">16</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>afH        <span class="p">=</span> cmNullAudioFileH<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>openSymId  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotopen&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>closeSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotclose&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioFileOutReset_defn"></a><a name="_cmDspAudioFileOutReset"></a><span class="f">_cmDspAudioFileOutReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>            rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>             chCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChCntAofId">kChCntAofId</a><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span> 
  
  p<span class="p">-</span><span class="p">&gt</span>smpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">*</span> chCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>smpBuf <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhResizeN">cmLhResizeN</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>smpBuf<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>smpCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="c">//rc = <a href="#_cmDspAudioFileOutCreateFile">_cmDspAudioFileOutCreateFile</a>( ctx, inst, chCnt );</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span> 

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioFileOutExec_defn"></a><a name="_cmDspAudioFileOutExec"></a><span class="f">_cmDspAudioFileOutExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>            rc    <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span> p     <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span><span class="p">;</span>
  <span class="k">unsigned</span>             chCnt <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span><span class="l">2</span><span class="p">,</span><a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChCntAofId">kChCntAofId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>             smpCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>          chArray<span class="p">[</span>chCnt<span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span>             i<span class="p">,</span>j<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">!</span><a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">,</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>chCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span>          chVarId <span class="p">=</span> i <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">?</span> <a href="#kIn0AofId">kIn0AofId</a> <span class="p">:</span> <a href="#kIn1AofId">kIn1AofId</a><span class="p">;</span>     <span class="c"> // get audio buf var id for this ch</span>
    <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span>chVarId<span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> iSmpCnt <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
    <span class="p">{</span>
      chArray<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> NULL<span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a> gain <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSample">cmDspSample</a><span class="p">(</span>inst<span class="p">,</span>i<span class="p">=</span><span class="p">=</span><span class="l">0</span><span class="p">?</span><a href="#kGain0AofId">kGain0AofId</a><span class="p">:</span><a href="#kGain1AofId">kGain1AofId</a><span class="p">)</span><span class="p">;</span> <span class="c"> // get ch gain</span>
      
      chArray<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>chVarId<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>                   <span class="c"> // get incoming audio buf ptr</span>
      
      <span class="k">if</span><span class="p">(</span> gain <span class="p">!</span><span class="p">=</span> <span class="l">1.0</span> <span class="p">)</span>
        cmVOS_MultVVS<span class="p">(</span>chArray<span class="p">[</span>j<span class="p">]</span><span class="p">,</span> iSmpCnt<span class="p">,</span> chArray<span class="p">[</span>j<span class="p">]</span><span class="p">,</span> gain<span class="p">)</span><span class="p">;</span>           <span class="c"> // apply gain</span>
      
      <span class="p">+</span><span class="p">+</span>j<span class="p">;</span>                                                              <span class="c"> // incr chArray[] index</span>
      assert<span class="p">(</span> smpCnt<span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">|</span><span class="p">|</span> iSmpCnt<span class="p">=</span><span class="p">=</span>smpCnt<span class="p">)</span><span class="p">;</span>                          
      smpCnt <span class="p">=</span> iSmpCnt<span class="p">;</span>                                                 <span class="c"> // set outgoing sample count</span>
    <span class="p">}</span>
    
  <span class="p">}</span>
  
  <span class="c">// write the samples</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileWriteSample">cmAudioFileWriteSample</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">,</span> smpCnt<span class="p">,</span> j<span class="p">,</span> chArray <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmAudioFile_h_0.html#kOkAfRC">kOkAfRC</a> <span class="p">)</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">-</span><span class="p">&gt</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kFileWriteFailDspRC">kFileWriteFailDspRC</a><span class="p">,</span><span class="l">&quotAn audio output file write failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAudioFileOutRecv_defn"></a><a name="_cmDspAudioFileOutRecv"></a><span class="f">_cmDspAudioFileOutRecv</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kGain1AofId">kGain1AofId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kGain0AofId">kGain0AofId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kFnAofId">kFnAofId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    rc <span class="p">=</span> <a href="#_cmDspAudioFileOutCreateFile">_cmDspAudioFileOutCreateFile</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChCntAofId">kChCntAofId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSelAofId">kSelAofId</a><span class="p">:</span>
    <span class="p">{</span>
      <a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span> p     <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>  
      <span class="k">unsigned</span> symId <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvSymbol">cmDsvSymbol</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> symId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>openSymId <span class="p">)</span>
        rc <span class="p">=</span> <a href="#_cmDspAudioFileOutCreateFile">_cmDspAudioFileOutCreateFile</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kChCntAofId">kChCntAofId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> symId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>closeSymId <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span> <span class="p">)</span>
            <a href="cmAudioFile_h_0.html#cmAudioFileDelete">cmAudioFileDelete</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          rc <span class="p">=</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>inst<span class="p">-</span><span class="p">&gt</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotUnknown selector symbol (%i) %s.&quot</span><span class="p">,</span>symId<span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span><a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>symId<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspAudioFileOutFree_defn"></a><a name="_cmDspAudioFileOutFree"></a><span class="f">_cmDspAudioFileOutFree</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  inst<span class="p">,</span>  <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evtPtr <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span> p     <span class="p">=</span> <span class="p">(</span><a href="#cmDspAudioFileOut_t">cmDspAudioFileOut_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>  
  
  <span class="k">if</span><span class="p">(</span><a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span> <span class="p">)</span>
    <a href="cmAudioFile_h_0.html#cmAudioFileDelete">cmAudioFileDelete</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span><span class="p">;</span>
  
  <a href="cmMallocDebug_h_0.html#cmMemPtrFree">cmMemPtrFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afn<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmAudioFileOutClassCons_defn"></a><a name="cmAudioFileOutClassCons"></a><span class="f">cmAudioFileOutClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAudioFileOutDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAudioFileOut&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAudioFileOutAlloc">_cmDspAudioFileOutAlloc</a><span class="p">,</span>
  <a href="#_cmDspAudioFileOutFree">_cmDspAudioFileOutFree</a><span class="p">,</span>
  <a href="#_cmDspAudioFileOutReset">_cmDspAudioFileOutReset</a><span class="p">,</span>
  <a href="#_cmDspAudioFileOutExec">_cmDspAudioFileOutExec</a><span class="p">,</span>
  <a href="#_cmDspAudioFileOutRecv">_cmDspAudioFileOutRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAudio file output port&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAudioFileOutDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspScalar : User interface unit which represents a single scalar value.</div><pre><a name="cmDspScalar"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kTypScId"></a><span class="e">kTypScId</span><span class="p">,</span>
  <a name="kMinScId"></a><span class="e">kMinScId</span><span class="p">,</span>
  <a name="kMaxScId"></a><span class="e">kMaxScId</span><span class="p">,</span>
  <a name="kStpScId"></a><span class="e">kStpScId</span><span class="p">,</span>
  <a name="kValScId"></a><span class="e">kValScId</span><span class="p">,</span>
  <a name="kLblScId"></a><span class="e">kLblScId</span><span class="p">,</span>
  <span class="e"><a href="cmDspKr_c_0.html#kSendScId">kSendScId</a></span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmScalarDC<span class="p">;</span>

<a name="cmDspScalar_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspScalar_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspScalar_t">cmDspScalar_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspScalarAlloc_defn"></a><a name="_cmDspScalarAlloc"></a><span class="f">_cmDspScalarAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quottyp&quot</span><span class="p">,</span>  <a href="#kTypScId">kTypScId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotType&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmin&quot</span><span class="p">,</span>  <a href="#kMinScId">kMinScId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMinimum value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmax&quot</span><span class="p">,</span>  <a href="#kMaxScId">kMaxScId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMaximum value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotstep&quot</span><span class="p">,</span> <a href="#kStpScId">kStpScId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotStep value (set to 0 to ignore)&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotval&quot</span><span class="p">,</span>  <a href="#kValScId">kValScId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a><span class="p">,</span>  <span class="l">&quotCurrent value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotlbl&quot</span><span class="p">,</span>  <a href="#kLblScId">kLblScId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>                            <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotLabel&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsend&quot</span><span class="p">,</span> <a href="cmDspKr_c_0.html#kSendScId">kSendScId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span> <span class="l">&quotSend value on any msg.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspScalar_t">cmDspScalar_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspScalar_t">cmDspScalar_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTypScId">kTypScId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>   <a href="cmMsgProtocol_h_0.html#kNumberDuiId">kNumberDuiId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMinScId">kMinScId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxScId">kMaxScId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">1</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kStpScId">kStpScId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> typeId <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDefaultUInt">cmDspDefaultUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kTypScId">kTypScId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUiScalarCreate">cmDspUiScalarCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>typeId<span class="p">,</span><a href="#kMinScId">kMinScId</a><span class="p">,</span><a href="#kMaxScId">kMaxScId</a><span class="p">,</span><a href="#kStpScId">kStpScId</a><span class="p">,</span><a href="#kValScId">kValScId</a><span class="p">,</span><a href="#kLblScId">kLblScId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspScalarReset_defn"></a><a name="_cmDspScalarReset"></a><span class="f">_cmDspScalarReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspScalarRecv_defn"></a><a name="_cmDspScalarRecv"></a><span class="f">_cmDspScalarRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="cmDspKr_c_0.html#kSendScId">kSendScId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// NOT SURE IF THIS IS CORRECT OR NOT - IT SHOULD FORCE THE CURRENT VALUE TO BE 
    // SENT - THE CURRENT VALUE SHOULD ALREADY BE AT THE UI SO THERE DOESN'T SEEM
    // TO BE ANY REASON TO UPDATE IT THERE.</span>    
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kValScId">kValScId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kValScId">kValScId</a> <span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kMinScId">kMinScId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kMaxScId">kMaxScId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kStpScId">kStpScId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kValScId">kValScId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span>assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span><span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspScalarPresetRdWr_defn"></a><a name="_cmDspScalarPresetRdWr"></a><span class="f">_cmDspScalarPresetRdWr</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  inst<span class="p">,</span>  <span class="k">bool</span> storeFl <span class="p">)</span>
<span class="p">{</span> 
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspVarPresetRdWr">cmDspVarPresetRdWr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kValScId">kValScId</a><span class="p">,</span>storeFl<span class="p">)</span><span class="p">;</span> 
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmScalarClassCons_defn"></a><a name="cmScalarClassCons"></a><span class="f">cmScalarClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmScalarDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotScalar&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspScalarAlloc">_cmDspScalarAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspScalarReset">_cmDspScalarReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspScalarRecv">_cmDspScalarRecv</a><span class="p">,</span>
  <a href="#_cmDspScalarPresetRdWr">_cmDspScalarPresetRdWr</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotScalar value control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmScalarDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspText : User interface unit which allows text input.</div><pre><a name="cmDspText"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kValTxId"></a><span class="e">kValTxId</span><span class="p">,</span>
  <a name="kLblTxId"></a><span class="e">kLblTxId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmTextDC<span class="p">;</span>

<a name="cmDspText_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspText_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspText_t">cmDspText_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspTextAlloc_defn"></a><a name="_cmDspTextAlloc"></a><span class="f">_cmDspTextAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotval&quot</span><span class="p">,</span>  <a href="#kValTxId">kValTxId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a><span class="p">,</span>  <span class="l">&quotCurrent string&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotlbl&quot</span><span class="p">,</span>  <a href="#kLblTxId">kLblTxId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotLabel&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspText_t">cmDspText_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspText_t">cmDspText_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUiTextCreate">cmDspUiTextCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kValTxId">kValTxId</a><span class="p">,</span><a href="#kLblTxId">kLblTxId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspTextReset_defn"></a><a name="_cmDspTextReset"></a><span class="f">_cmDspTextReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspTextRecv_defn"></a><a name="_cmDspTextRecv"></a><span class="f">_cmDspTextRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kValTxId">kValTxId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span>assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span><span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmTextClassCons_defn"></a><a name="cmTextClassCons"></a><span class="f">cmTextClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmTextDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotText&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspTextAlloc">_cmDspTextAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspTextReset">_cmDspTextReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspTextRecv">_cmDspTextRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotText value control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmTextDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspMeter : User interface progress bar which displays the current value of a scalar variable.</div><pre><a name="cmDspMeter"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInMtId"></a><span class="e">kInMtId</span><span class="p">,</span>
  <a name="kMinMtId"></a><span class="e">kMinMtId</span><span class="p">,</span>
  <a name="kMaxMtId"></a><span class="e">kMaxMtId</span><span class="p">,</span>
  <a name="kTimeMtId"></a><span class="e">kTimeMtId</span><span class="p">,</span>
  <a name="kLblMtId"></a><span class="e">kLblMtId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmMeterDC<span class="p">;</span>

<a name="cmDspMeter_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspMeter_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspMeter_t.updSmpCnt"></a><span class="i">updSmpCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspMeter_t.lastCycleCnt"></a><span class="i">lastCycleCnt</span><span class="p">;</span>
  <span class="k">double</span>      <a name="cmDspMeter_t.value"></a><span class="i">value</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspMeter_t.cnt"></a><span class="i">cnt</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspMeter_t">cmDspMeter_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspMeterAlloc_defn"></a><a name="_cmDspMeterAlloc"></a><span class="f">_cmDspMeterAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInMtId">kInMtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotCurrent value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmin&quot</span><span class="p">,</span>  <a href="#kMinMtId">kMinMtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMinimum value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmax&quot</span><span class="p">,</span>  <a href="#kMaxMtId">kMaxMtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>  <span class="l">&quotMaximum value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quottime&quot</span><span class="p">,</span> <a href="#kTimeMtId">kTimeMtId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>  <span class="l">&quotUI update time in milliseconds (default:50)&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotlabel&quot</span><span class="p">,</span><a href="#kLblMtId">kLblMtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span> <span class="l">&quotLabel&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kInMtId">kInMtId</a><span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMinMtId">kMinMtId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxMtId">kMaxMtId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">1</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTimeMtId">kTimeMtId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">50.0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUiMeterCreate">cmDspUiMeterCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMinMtId">kMinMtId</a><span class="p">,</span><a href="#kMaxMtId">kMaxMtId</a><span class="p">,</span><a href="#kInMtId">kInMtId</a><span class="p">,</span><a href="#kLblMtId">kLblMtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMeterReset_defn"></a><a name="_cmDspMeterReset"></a><span class="f">_cmDspMeterReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">double</span> updateMs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kTimeMtId">kTimeMtId</a><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>updSmpCnt    <span class="p">=</span> floor<span class="p">(</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">*</span> updateMs <span class="p">/</span> <span class="l">1000.0</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>lastCycleCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>cnt          <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>value        <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>



<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMeterExec_defn"></a><a name="_cmDspMeterExec"></a><span class="f">_cmDspMeterExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">*</span> p        <span class="p">=</span> <span class="p">(</span><a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span> 
  <span class="k">double</span>        curVal   <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>value<span class="p">;</span>
  <span class="k">bool</span>          deltaFl  <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>cnt<span class="p">!</span><span class="p">=</span><span class="l">0</span> <span class="p">&amp</span><span class="p">&amp</span> curVal <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kInMtId">kInMtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">bool</span>          expireFl <span class="p">=</span> <span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>lastCycleCnt<span class="p">)</span> <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">&gt</span> p<span class="p">-</span><span class="p">&gt</span>updSmpCnt<span class="p">;</span>
  
  <span class="c">// if the meter value changed and the update time has expired</span>
  <span class="k">if</span><span class="p">(</span> deltaFl <span class="p">&amp</span><span class="p">&amp</span> expireFl <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInMtId">kInMtId</a><span class="p">,</span>curVal<span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>value        <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>cnt          <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>lastCycleCnt <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>cycleCnt<span class="p">;</span>
  <span class="p">}</span>  
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMeterRecv_defn"></a><a name="_cmDspMeterRecv"></a><span class="f">_cmDspMeterRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>  
  <a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMeter_t">cmDspMeter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kInMtId">kInMtId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>value <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetDouble">cmDsvGetDouble</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    <span class="p">+</span><span class="p">+</span>p<span class="p">-</span><span class="p">&gt</span>cnt<span class="p">;</span>      
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kTimeMtId">kTimeMtId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>updSmpCnt <span class="p">=</span> floor<span class="p">(</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">*</span> <a href="cmDspValue_h_0.html#cmDsvGetDouble">cmDsvGetDouble</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">/</span> <span class="l">1000.0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span> 
  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmMeterClassCons_defn"></a><a name="cmMeterClassCons"></a><span class="f">cmMeterClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmMeterDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotMeter&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMeterAlloc">_cmDspMeterAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMeterReset">_cmDspMeterReset</a><span class="p">,</span>
  <a href="#_cmDspMeterExec">_cmDspMeterExec</a><span class="p">,</span>
  <a href="#_cmDspMeterRecv">_cmDspMeterRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotMeter display.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmMeterDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspLabel : User interface unit which displays read-only text.</div><pre><a name="cmDspLabel"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInLbId"></a><span class="e">kInLbId</span><span class="p">,</span>
  <a name="kAlignLbId"></a><span class="e">kAlignLbId</span><span class="p">,</span>
  <a name="kTextLbId"></a><span class="e">kTextLbId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmLabelDC<span class="p">;</span>

<a name="cmDspLabel_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspLabel_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> <span class="i">label</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspLabel_t">cmDspLabel_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspLabelAlloc_defn"></a><a name="_cmDspLabelAlloc"></a><span class="f">_cmDspLabelAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="k">unsigned</span>  argCnt <span class="p">=</span> <span class="l">3</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>   args<span class="p">[</span>argCnt<span class="p">+</span><span class="l">1</span><span class="p">]</span><span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span>       label  <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">unsigned</span>        align  <span class="p">=</span> <a href="cmMsgProtocol_h_0.html#kLeftAlignDuiId">kLeftAlignDuiId</a><span class="p">;</span>
  va_list         vl1<span class="p">;</span>
  
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'label' constructor argument list must contain at least one argument.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// get the default label</span>
  <span class="k">const</span> <span class="k">char</span><span class="p">*</span> clabel <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <span class="k">char</span><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> clabel <span class="p">!</span><span class="p">=</span> NULL <span class="p">&amp</span><span class="p">&amp</span> strlen<span class="p">(</span>clabel<span class="p">)</span> <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    label <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhAllocStr">cmLhAllocStr</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>clabel<span class="p">)</span><span class="p">;</span>
    printf<span class="p">(</span><span class="l">&quot%s\n&quot</span><span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// if an alignment id was provided</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&gt</span> <span class="l">1</span> <span class="p">)</span>
    align <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// setup the arg. config. array.</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span>args<span class="p">+</span><span class="l">0</span><span class="p">,</span><span class="l">&quotin&quot</span><span class="p">,</span>   <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kInLbId">kInLbId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span> <span class="l">&quotInput to set label&quot</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span>args<span class="p">+</span><span class="l">1</span><span class="p">,</span><span class="l">&quotalign&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kAlignLbId">kAlignLbId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>   <span class="l">&quotJustification: 0=right 1=center 2=left&quot</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span>args<span class="p">+</span><span class="l">2</span><span class="p">,</span><span class="l">&quottext&quot</span><span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kTextLbId">kTextLbId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span><span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span>   <span class="l">&quotLabel text&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span>args <span class="p">+</span> argCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the instance</span>
  <a href="#cmDspLabel_t">cmDspLabel_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspLabel_t">cmDspLabel_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>label <span class="p">=</span> label<span class="p">;</span>
  
  <span class="c">// set the default variable values</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAlignLbId">kAlignLbId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> align<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kTextLbId">kTextLbId</a><span class="p">,</span>  NULL<span class="p">,</span> label<span class="p">=</span><span class="p">=</span>NULL <span class="p">?</span> <span class="l">&quot&quot</span> <span class="p">:</span> label <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUiLabelCreate">cmDspUiLabelCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kTextLbId">kTextLbId</a><span class="p">,</span><a href="#kAlignLbId">kAlignLbId</a><span class="p">)</span><span class="p">;</span>
  
  va_end<span class="p">(</span>vl1<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLabelFree_defn"></a><a name="_cmDspLabelFree"></a><span class="f">_cmDspLabelFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspLabel_t">cmDspLabel_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspLabel_t">cmDspLabel_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>label<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLabelReset_defn"></a><a name="_cmDspLabelReset"></a><span class="f">_cmDspLabelReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspLabelRecv_defn"></a><a name="_cmDspLabelRecv"></a><span class="f">_cmDspLabelRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="k">unsigned</span> bN <span class="p">=</span> <span class="l">128</span><span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a> b<span class="p">[</span> bN<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  
  <span class="c">// if this event is arriving on the 'in' port ...</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kInLbId">kInLbId</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="#cmDspLabel_t">cmDspLabel_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspLabel_t">cmDspLabel_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
    <span class="c">// ... then convert it to a string</span>
    <a href="cmDspValue_h_0.html#cmDsvToString">cmDsvToString</a><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>label<span class="p">,</span> b<span class="p">,</span> bN <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// and set the 'label' variable </span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetStrcz">cmDspSetStrcz</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kTextLbId">kTextLbId</a><span class="p">,</span> b <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmLabelClassCons_defn"></a><a name="cmLabelClassCons"></a><span class="f">cmLabelClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmLabelDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotLabel&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspLabelAlloc">_cmDspLabelAlloc</a><span class="p">,</span>
  <a href="#_cmDspLabelFree">_cmDspLabelFree</a><span class="p">,</span>
  <a href="#_cmDspLabelReset">_cmDspLabelReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspLabelRecv">_cmDspLabelRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotLabel control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmLabelDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspButton : User interface sends a user defined value from a graphic button press.</div><pre><a name="cmDspButton"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kTypBtId"></a><span class="e">kTypBtId</span><span class="p">,</span>
  <a name="kOutBtId"></a><span class="e">kOutBtId</span><span class="p">,</span>
  <a name="kSymBtId"></a><span class="e">kSymBtId</span><span class="p">,</span>
  <a name="kLblBtId"></a><span class="e">kLblBtId</span><span class="p">,</span>
  <a name="kInBtId"></a><span class="e">kInBtId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmButtonDC<span class="p">;</span>

<a name="cmDspButton_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspButton_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspButton_t.resetSymId"></a><span class="i">resetSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspButton_t">cmDspButton_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspButtonAlloc_defn"></a><a name="_cmDspButtonAlloc"></a><span class="f">_cmDspButtonAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  assert<span class="p">(</span> va_cnt <span class="p">&gt</span><span class="p">=</span> <span class="l">1</span> <span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> typeId <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">unsigned</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// check buttons should transmit their default values - push buttons should not.</span>
  <span class="k">unsigned</span> sendDfltFl <span class="p">=</span> typeId <span class="p">=</span><span class="p">=</span> <a href="cmMsgProtocol_h_0.html#kCheckDuiId">kCheckDuiId</a> <span class="p">?</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a> <span class="p">:</span> <span class="l">0</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quottyp&quot</span><span class="p">,</span>  <a href="#kTypBtId">kTypBtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>             <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>              <span class="l">&quotType&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutBtId">kOutBtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> sendDfltFl<span class="p">,</span> <span class="l">&quotValue&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsym&quot</span><span class="p">,</span>  <a href="#kSymBtId">kSymBtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> sendDfltFl<span class="p">,</span> <span class="l">&quotSymbol Value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotlabel&quot</span><span class="p">,</span><a href="#kLblBtId">kLblBtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>              <span class="l">&quotLabel&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInBtId">kInBtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span>                             <span class="l">&quotSimulate UI&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspButton_t">cmDspButton_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspButton_t">cmDspButton_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutBtId">kOutBtId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> typeId<span class="p">=</span><span class="p">=</span><a href="cmMsgProtocol_h_0.html#kCheckDuiId">kCheckDuiId</a> <span class="p">?</span> <span class="l">0.0</span> <span class="p">:</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSymBtId">kSymBtId</a><span class="p">,</span>        instSymId <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kLblBtId">kLblBtId</a><span class="p">,</span> NULL<span class="p">,</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>instSymId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quot_reset&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUiButtonCreate">cmDspUiButtonCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>typeId<span class="p">,</span><a href="#kOutBtId">kOutBtId</a><span class="p">,</span><a href="#kLblBtId">kLblBtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspButtonReset_defn"></a><a name="_cmDspButtonReset"></a><span class="f">_cmDspButtonReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspButtonRecv_defn"></a><a name="_cmDspButtonRecv"></a><span class="f">_cmDspButtonRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="c">// the 'in' port is the only input port 
  // but the UI sends button pushes use <a href="#kOutBtId">kOutBtId</a> - should this be changed?</span>  
  assert<span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kInBtId">kInBtId</a> <span class="p">|</span><span class="p">|</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kOutBtId">kOutBtId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// We accept all types at the 'in' port but are only interested
  // in transmitting doubles from the 'out' port.</span>  
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvCanConvertFlags">cmDsvCanConvertFlags</a><span class="p">(</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">-</span><span class="p">&gt</span>flags <span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// Redirect events which can be converted to type <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> 
    // to the output port.
    // 
    // Convert the event dest var id from the '<a href="#kInBtId">kInBtId</a>' to '<a href="#kOutBtId">kOutBtId</a>' 
    // and update the UI  with the incoming value </span>    
    <a href="cmDspClass_h_0.html#cmDspSetEventUiId">cmDspSetEventUiId</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">,</span><a href="#kOutBtId">kOutBtId</a><span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="c">// no matter what kind of msg enters the 'in' port send a symbol out the 'sym' port</span>
  <span class="k">if</span><span class="p">(</span> inst<span class="p">-</span><span class="p">&gt</span>symId <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kSymBtId">kSymBtId</a><span class="p">,</span> inst<span class="p">-</span><span class="p">&gt</span>symId <span class="p">)</span><span class="p">;</span> 
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspButtonPresetRdWr_defn"></a><a name="_cmDspButtonPresetRdWr"></a><span class="f">_cmDspButtonPresetRdWr</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  inst<span class="p">,</span>  <span class="k">bool</span> storeFl <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kTypBtId">kTypBtId</a><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmMsgProtocol_h_0.html#kCheckDuiId">kCheckDuiId</a> <span class="p">)</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarPresetRdWr">cmDspVarPresetRdWr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutBtId">kOutBtId</a><span class="p">,</span>storeFl<span class="p">)</span><span class="p">;</span> 
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspButtonSysRecvFunc_defn"></a><a name="_cmDspButtonSysRecvFunc"></a><span class="f">_cmDspButtonSysRecvFunc</span><span class="p">(</span>   <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span>  <span class="k">unsigned</span> attrSymId<span class="p">,</span> <span class="k">const</span> <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a><span class="p">*</span> value <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspButton_t">cmDspButton_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspButton_t">cmDspButton_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> attrSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kSymBtId">kSymBtId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutBtId">kOutBtId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutBtId">kOutBtId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmButtonClassCons_defn"></a><a name="cmButtonClassCons"></a><span class="f">cmButtonClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmButtonDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotButton&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspButtonAlloc">_cmDspButtonAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspButtonReset">_cmDspButtonReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspButtonRecv">_cmDspButtonRecv</a><span class="p">,</span>
  <a href="#_cmDspButtonPresetRdWr">_cmDspButtonPresetRdWr</a><span class="p">,</span>
  <a href="#_cmDspButtonSysRecvFunc">_cmDspButtonSysRecvFunc</a><span class="p">,</span>
  <span class="l">&quotButton control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmButtonDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspCheckbox : Graphic checkbox user interface unit.</div><pre><a name="cmDspCheckbox"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kLblCbId"></a><span class="e">kLblCbId</span><span class="p">,</span>
  <a name="kSym1CbId"></a><span class="e">kSym1CbId</span><span class="p">,</span>
  <a name="kSym0CbId"></a><span class="e">kSym0CbId</span><span class="p">,</span>
  <a name="kVal1CbId"></a><span class="e">kVal1CbId</span><span class="p">,</span>
  <a name="kVal0CbId"></a><span class="e">kVal0CbId</span><span class="p">,</span>
  <a name="kOutCbId"></a><span class="e">kOutCbId</span><span class="p">,</span>
  <a name="kSymCbId"></a><span class="e">kSymCbId</span><span class="p">,</span>
  <a name="kInCbId"></a><span class="e">kInCbId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmCheckboxDC<span class="p">;</span>

<a name="cmDspCheckbox_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspCheckbox_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspCheckbox_t.resetSymId"></a><span class="i">resetSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspCheckbox_t.onSymId"></a><span class="i">onSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspCheckbox_t.offSymId"></a><span class="i">offSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspCheckbox_t">cmDspCheckbox_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspCheckboxAlloc_defn"></a><a name="_cmDspCheckboxAlloc"></a><span class="f">_cmDspCheckboxAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  
  
  <span class="c">// Check buttons should transmit their default values. Set <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a> on outputs to send default values.</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotlabel&quot</span><span class="p">,</span><a href="#kLblCbId">kLblCbId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quotLabel&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsym1&quot</span><span class="p">,</span> <a href="#kSym1CbId">kSym1CbId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quot'on' symbol value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsym0&quot</span><span class="p">,</span> <a href="#kSym0CbId">kSym0CbId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quot'off' symbol value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotval1&quot</span><span class="p">,</span> <a href="#kVal1CbId">kVal1CbId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quot'on' value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotval0&quot</span><span class="p">,</span> <a href="#kVal0CbId">kVal0CbId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span>   <span class="l">&quot'off' value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutCbId">kOutCbId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a><span class="p">,</span> <span class="l">&quotValue&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsym&quot</span><span class="p">,</span>  <a href="#kSymCbId">kSymCbId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>                   <span class="p">|</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a><span class="p">,</span> <span class="l">&quotSymbol Value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInCbId">kInCbId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span>                  <span class="l">&quotSimulate UI&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspCheckbox_t">cmDspCheckbox_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspCheckbox_t">cmDspCheckbox_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quot_reset&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSym1CbId">kSym1CbId</a><span class="p">,</span> NULL<span class="p">,</span> <span class="l">&quoton&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSym0CbId">kSym0CbId</a><span class="p">,</span> NULL<span class="p">,</span> <span class="l">&quotoff&quot</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>onSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDefaultStrcz">cmDspDefaultStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kSym1CbId">kSym1CbId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>offSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDefaultStrcz">cmDspDefaultStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kSym0CbId">kSym0CbId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">bool</span> fl <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDefaultDouble">cmDspDefaultDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kOutCbId">kOutCbId</a><span class="p">)</span><span class="p">!</span><span class="p">=</span><span class="l">0</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kVal1CbId">kVal1CbId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kVal0CbId">kVal0CbId</a><span class="p">,</span> <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOutCbId">kOutCbId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kSymCbId">kSymCbId</a><span class="p">,</span>  fl <span class="p">?</span> p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">:</span> p<span class="p">-</span><span class="p">&gt</span>offSymId <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kLblCbId">kLblCbId</a><span class="p">,</span> NULL<span class="p">,</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>instSymId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUiButtonCreate">cmDspUiButtonCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmMsgProtocol_h_0.html#kCheckDuiId">kCheckDuiId</a><span class="p">,</span><a href="#kOutCbId">kOutCbId</a><span class="p">,</span><a href="#kLblCbId">kLblCbId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCheckboxReset_defn"></a><a name="_cmDspCheckboxReset"></a><span class="f">_cmDspCheckboxReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspCheckboxRecv_defn"></a><a name="_cmDspCheckboxRecv"></a><span class="f">_cmDspCheckboxRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspCheckbox_t">cmDspCheckbox_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspCheckbox_t">cmDspCheckbox_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kLblCbId">kLblCbId</a><span class="p">:</span>
    <span class="c">// TODO: we have no function for changing a UI control label.</span>
    <span class="k">return</span> rc<span class="p">;</span>
    
  <span class="k">case</span> <a href="#kVal1CbId">kVal1CbId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kVal0CbId">kVal0CbId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kSym1CbId">kSym1CbId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kSym0CbId">kSym0CbId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kSym1CbId">kSym1CbId</a> <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>onSymId    <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kSym1CbId">kSym1CbId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kSym0CbId">kSym0CbId</a> <span class="p">)</span>
      p<span class="p">-</span><span class="p">&gt</span>offSymId   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kSym0CbId">kSym0CbId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    <span class="k">return</span> rc<span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="c">// the 'in' port is the only input port 
  // but the UI button pushes use <a href="#kOutCbId">kOutCbId</a>.</span>  
  assert<span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kInCbId">kInCbId</a> <span class="p">|</span><span class="p">|</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kOutCbId">kOutCbId</a> <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// We accept all types at the 'in' port but are only interested
  // in transmitting doubles from the 'out' port and symbols from 
  // the 'sym' port.</span>  
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvCanConvertFlags">cmDsvCanConvertFlags</a><span class="p">(</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">-</span><span class="p">&gt</span>flags <span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">bool</span> checkFl <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetDouble">cmDsvGetDouble</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">!</span><span class="p">=</span><span class="l">0</span><span class="p">;</span>
    
    <span class="k">unsigned</span> valId <span class="p">=</span> checkFl <span class="p">?</span> <a href="#kVal1CbId">kVal1CbId</a>  <span class="p">:</span> <a href="#kVal0CbId">kVal0CbId</a><span class="p">;</span>
    <span class="k">unsigned</span> symId <span class="p">=</span> checkFl <span class="p">?</span> p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">:</span> p<span class="p">-</span><span class="p">&gt</span>offSymId<span class="p">;</span>
    
    
    <span class="c">// Redirect events which can be converted to type <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> 
    // to the output port.
    // 
    // Convert the event dest var id from the '<a href="#kInCbId">kInCbId</a>' to '<a href="#kOutCbId">kOutCbId</a>' 
    // and update the UI  with the incoming value </span>    
    <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a> e<span class="p">;</span>
    <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a> v<span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspEvtCopy">cmDspEvtCopy</a><span class="p">(</span><span class="p">&amp</span>e<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    e<span class="p">.</span>valuePtr <span class="p">=</span> <span class="p">&amp</span>v<span class="p">;</span>
    <a href="cmDspValue_h_0.html#cmDsvSetDouble">cmDsvSetDouble</a><span class="p">(</span><span class="p">&amp</span>v<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>valId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetEventUiId">cmDspSetEventUiId</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">,</span><a href="#kOutCbId">kOutCbId</a><span class="p">)</span><span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kSymCbId">kSymCbId</a><span class="p">,</span> symId<span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspCheckboxPresetRdWr_defn"></a><a name="_cmDspCheckboxPresetRdWr"></a><span class="f">_cmDspCheckboxPresetRdWr</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  inst<span class="p">,</span>  <span class="k">bool</span> storeFl <span class="p">)</span>
<span class="p">{</span> 
  <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspVarPresetRdWr">cmDspVarPresetRdWr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCbId">kOutCbId</a><span class="p">,</span>storeFl<span class="p">)</span><span class="p">;</span> 
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspCheckboxSysRecvFunc_defn"></a><a name="_cmDspCheckboxSysRecvFunc"></a><span class="f">_cmDspCheckboxSysRecvFunc</span><span class="p">(</span>   <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span>  <span class="k">unsigned</span> attrSymId<span class="p">,</span> <span class="k">const</span> <a href="cmDspValue_h_0.html#cmDspValue_t">cmDspValue_t</a><span class="p">*</span> value <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspCheckbox_t">cmDspCheckbox_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspCheckbox_t">cmDspCheckbox_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> attrSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kSymCbId">kSymCbId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>resetSymId <span class="p">)</span><span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutCbId">kOutCbId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutCbId">kOutCbId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmCheckboxClassCons_defn"></a><a name="cmCheckboxClassCons"></a><span class="f">cmCheckboxClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmCheckboxDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotCheckbox&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCheckboxAlloc">_cmDspCheckboxAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCheckboxReset">_cmDspCheckboxReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspCheckboxRecv">_cmDspCheckboxRecv</a><span class="p">,</span>
  <a href="#_cmDspCheckboxPresetRdWr">_cmDspCheckboxPresetRdWr</a><span class="p">,</span>
  <a href="#_cmDspCheckboxSysRecvFunc">_cmDspCheckboxSysRecvFunc</a><span class="p">,</span>
  <span class="l">&quotCheckbox control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmCheckboxDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspReorder : Collect inputs in any order and transmit them in a defined order.</div><pre><a name="cmDspReorder"></a>
<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmReorderDC<span class="p">;</span>

<a name="cmDspReorder_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspReorder_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspReorder_t.portCnt"></a><span class="i">portCnt</span><span class="p">;</span>       <span class="c"> // count of input ports and count of output ports</span>
  <span class="k">unsigned</span><span class="p">*</span>   <a name="cmDspReorder_t.execFlArray"></a><span class="i">execFlArray</span><span class="p">;</span>   <span class="c"> // execFlArray[portCnt] - true for ports which should cause obj to generate output</span>
  <span class="k">unsigned</span><span class="p">*</span>   <a name="cmDspReorder_t.orderArray"></a><span class="i">orderArray</span><span class="p">;</span>    <span class="c"> // orderArray[portCnt] - port output order map</span>
  
<span class="p">}</span> <span class="t"><a href="#cmDspReorder_t">cmDspReorder_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspReorderAlloc_defn"></a><a name="_cmDspReorderAlloc"></a><span class="f">_cmDspReorderAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotReorder objects must have arguments.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// the first argument is the count of input ports (which is also the count of output ports)</span>
  <span class="k">int</span> portCnt <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> portCnt <span class="p">&lt</span> <span class="l">2</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotReorder objects must have at least 2 ports.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span>portCnt<span class="p">*</span><span class="l">2</span><span class="p">+</span><span class="l">1</span><span class="p">]</span><span class="p">;</span>
  <span class="k">unsigned</span>      i<span class="p">;</span>
  <span class="k">int</span>           maxLabelCharCnt <span class="p">=</span> <span class="l">15</span><span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a>      label<span class="p">[</span> maxLabelCharCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  
  label<span class="p">[</span>maxLabelCharCnt<span class="p">]</span> <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>portCnt<span class="p">*</span><span class="l">2</span><span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    snprintf<span class="p">(</span>label<span class="p">,</span>maxLabelCharCnt<span class="p">,</span><span class="l">&quot%s-%i&quot</span><span class="p">,</span> <span class="p">(</span>i<span class="p">&lt</span>portCnt<span class="p">?</span><span class="l">&quotin&quot</span><span class="p">:</span><span class="l">&quotout&quot</span><span class="p">)</span><span class="p">,</span> i<span class="p">%</span>portCnt<span class="p">)</span><span class="p">;</span>
    
    <span class="k">unsigned</span> symId  <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    
    args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>symId<span class="p">)</span><span class="p">;</span>  
    args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>constId <span class="p">=</span> i<span class="p">;</span>
    args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>rn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>cn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>flags   <span class="p">=</span> <span class="p">(</span>i<span class="p">&lt</span>portCnt <span class="p">?</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">:</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">)</span> <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">;</span>
    args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>doc     <span class="p">=</span>  i<span class="p">&lt</span>portCnt <span class="p">?</span> <span class="l">&quotAny input&quot</span> <span class="p">:</span> <span class="l">&quotAny output&quot</span><span class="p">;</span>
  <span class="p">}</span>
  
  memset<span class="p">(</span>args<span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspReorder_t">cmDspReorder_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspReorder_t">cmDspReorder_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>orderArray <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhAllocZ">cmLhAllocZ</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="k">unsigned</span><span class="p">,</span>portCnt<span class="p">*</span><span class="l">2</span><span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>execFlArray <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>orderArray <span class="p">+</span> portCnt<span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>portCnt     <span class="p">=</span> portCnt<span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> va_cnt<span class="l">-1</span> <span class="p">&lt</span> portCnt <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe reorder constructor must contain an output order map.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>portCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <span class="k">int</span> order <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span> order <span class="p">&gt</span><span class="p">=</span> portCnt <span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe port order index %i is outside the valid range of 0-%i.&quot</span><span class="p">,</span>order<span class="p">,</span>portCnt<span class="l">-1</span><span class="p">)</span><span class="p">;</span>
        <span class="k">else</span>
          p<span class="p">-</span><span class="p">&gt</span>orderArray<span class="p">[</span> order <span class="p">]</span> <span class="p">=</span> i<span class="p">;</span>
        
      <span class="p">}</span>
      
      va_cnt <span class="p">-</span><span class="p">=</span> portCnt<span class="p">+</span><span class="l">1</span><span class="p">;</span>
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>va_cnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="p">{</span>
        <span class="k">int</span> execPortIdx <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span> execPortIdx <span class="p">&gt</span><span class="p">=</span> portCnt <span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe port exec index %i is outside the valid range of 0-%i.&quot</span><span class="p">,</span>execPortIdx<span class="p">,</span>portCnt<span class="l">-1</span><span class="p">)</span><span class="p">;</span>
        <span class="k">else</span>
          p<span class="p">-</span><span class="p">&gt</span>execFlArray<span class="p">[</span> execPortIdx <span class="p">]</span> <span class="p">=</span> true<span class="p">;</span>
      <span class="p">}</span>
      
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspReorderFree_defn"></a><a name="_cmDspReorderFree"></a><span class="f">_cmDspReorderFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspReorder_t">cmDspReorder_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspReorder_t">cmDspReorder_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>orderArray<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspReorderRecv_defn"></a><a name="_cmDspReorderRecv"></a><span class="f">_cmDspReorderRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspReorder_t">cmDspReorder_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspReorder_t">cmDspReorder_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>portCnt <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>execFlArray<span class="p">[</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">]</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> i<span class="p">;</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>portCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span>          inVarId  <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>orderArray<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
      <span class="k">unsigned</span>          outVarId <span class="p">=</span> inVarId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>portCnt<span class="p">;</span>
      <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspVar_t">cmDspVar_t</a><span class="p">*</span> varPtr   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarIdToCPtr">cmDspVarIdToCPtr</a><span class="p">(</span>inst<span class="p">,</span> inVarId <span class="p">)</span><span class="p">;</span>
      
      assert<span class="p">(</span>varPtr <span class="p">!</span><span class="p">=</span> NULL<span class="p">)</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspValueSet">cmDspValueSet</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> outVarId<span class="p">,</span> <span class="p">&amp</span>varPtr<span class="p">-</span><span class="p">&gt</span>value<span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>        
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmReorderClassCons_defn"></a><a name="cmReorderClassCons"></a><span class="f">cmReorderClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmReorderDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotReorder&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspReorderAlloc">_cmDspReorderAlloc</a><span class="p">,</span>
  <a href="#_cmDspReorderFree">_cmDspReorderFree</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspReorderRecv">_cmDspReorderRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotReorder value control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmReorderDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspFname : User interface file or directory name input unit.</div><pre><a name="cmDspFname"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kDirFnId"></a><span class="e">kDirFnId</span><span class="p">,</span>
  <a name="kPatFnId"></a><span class="e">kPatFnId</span><span class="p">,</span>
  <a name="kValFnId"></a><span class="e">kValFnId</span><span class="p">,</span>
  <a name="kSendFnId"></a><span class="e">kSendFnId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmFnameDC<span class="p">;</span>

<a name="cmDspFname_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspFname_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspFname_t">cmDspFname_t</a></span><span class="p">;</span>

<span class="c">// Pattern string for HTML and image files:
//   &ampquotHTML Files (*.html)\tImage Files (*.{bmp,gif,jpg,png})&ampquot</span>

<span class="c">// The va_list must include 3 args: 
// A pointer to a string referning to a default filename or directory or NULL.
// A pointer to a string referring to a pattern string or NULL.
// A bool to set the 'dirFl'.</span>
<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspFnameAlloc_defn"></a><a name="_cmDspFnameAlloc"></a><span class="f">_cmDspFnameAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotdir&quot</span><span class="p">,</span>  <a href="#kDirFnId">kDirFnId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span> <span class="l">&quotDir=true Filename=false&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotpat&quot</span><span class="p">,</span>  <a href="#kPatFnId">kPatFnId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span> <span class="l">&quotFile pattern string (e.g. HTML Files (*.html)\tImage Files (*.{bmp,gif,jpg,png}))&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kValFnId">kValFnId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span> <span class="l">&quotCurrent file or directory name.&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsend&quot</span><span class="p">,</span> <a href="#kSendFnId">kSendFnId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span> <span class="l">&quotSend file name on any msg.&quot</span><span class="p">}</span><span class="p">,</span>
    
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspFname_t">cmDspFname_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspFname_t">cmDspFname_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDirFnId">kDirFnId</a><span class="p">,</span>  false<span class="p">,</span> false<span class="p">)</span><span class="p">;</span>  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kPatFnId">kPatFnId</a><span class="p">,</span>  NULL<span class="p">,</span>  <span class="l">&quotAll Files (*.*)&quot</span><span class="p">)</span><span class="p">;</span>  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kValFnId">kValFnId</a><span class="p">,</span>  NULL<span class="p">,</span>  <a href="cmFileSys_h_0.html#cmFsUserDir">cmFsUserDir</a><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspUiFnameCreate">cmDspUiFnameCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kValFnId">kValFnId</a><span class="p">,</span><a href="#kPatFnId">kPatFnId</a><span class="p">,</span><a href="#kDirFnId">kDirFnId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspFnameReset_defn"></a><a name="_cmDspFnameReset"></a><span class="f">_cmDspFnameReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspFnameRecv_defn"></a><a name="_cmDspFnameRecv"></a><span class="f">_cmDspFnameRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kSendFnId">kSendFnId</a><span class="p">:</span>
    <a href="cmDspClass_h_0.html#cmDspSetStrcz">cmDspSetStrcz</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kValFnId">kValFnId</a><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kValFnId">kValFnId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kDirFnId">kDirFnId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kPatFnId">kPatFnId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kValFnId">kValFnId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span>assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span><span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmFnameClassCons_defn"></a><a name="cmFnameClassCons"></a><span class="f">cmFnameClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmFnameDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotFname&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspFnameAlloc">_cmDspFnameAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspFnameReset">_cmDspFnameReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspFnameRecv">_cmDspFnameRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotFile or directory chooser control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmFnameDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspMsgList : User interface list unit.</div><pre><a name="cmDspMsgList"></a>
<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmMsgListDC<span class="p">;</span>

<a name="cmDspMsgList_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>     <a name="cmDspMsgList_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a>       <a name="cmDspMsgList_t.jsH"></a><span class="i">jsH</span><span class="p">;</span>         <span class="c"> // current JSON tree</span>
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span>   <a name="cmDspMsgList_t.np"></a><span class="i">np</span><span class="p">;</span>          <span class="c"> // ptr to JSON array</span>
  <span class="k">unsigned</span>        <a name="cmDspMsgList_t.colCnt"></a><span class="i">colCnt</span><span class="p">;</span>      <span class="c"> // number of elements in the JSON sub-arrays (rows)</span>
  <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a>       <a name="cmDspMsgList_t.dfltJsH"></a><span class="i">dfltJsH</span><span class="p">;</span>     <span class="c"> // default JSON tree (the default JSON array node ptr (np) is stored in the var array but we must also maintain the assoc'd JSON handle othwerwise the pointer will not be
                                // valid)</span>  
  <span class="k">unsigned</span><span class="p">*</span>       <a name="cmDspMsgList_t.typeIdArray"></a><span class="i">typeIdArray</span><span class="p">;</span> <span class="c"> // JSON types for each column size: typeIdArray[ colCnt ]</span>
  <span class="k">unsigned</span>        <a name="cmDspMsgList_t.symColCnt"></a><span class="i">symColCnt</span><span class="p">;</span>   <span class="c"> // same as number of elements of typeIdArray[] == <a href="cmJson_h_0.html#kStringTId">kStringTId</a></span>
  <span class="k">unsigned</span>        <a name="cmDspMsgList_t.symRowCnt"></a><span class="i">symRowCnt</span><span class="p">;</span>   <span class="c"> // same as <a href="cmJson_h_0.html#cmJsonChildCount">cmJsonChildCount</a>(p-&ampgtnp)</span>
  <span class="k">unsigned</span><span class="p">*</span>       <a name="cmDspMsgList_t.symM"></a><span class="i">symM</span><span class="p">;</span>        <span class="c"> // symM[symRowCnt,symColCnt] symbol matrix</span>
<span class="p">}</span> <span class="t"><a href="#cmDspMsgList_t">cmDspMsgList_t</a></span><span class="p">;</span>

<span class="c">// create a matrix to hold the symbol id's associated with any string values</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgListLoadSymbolMtx_defn"></a><a name="_cmDspMsgListLoadSymbolMtx"></a><span class="f">_cmDspMsgListLoadSymbolMtx</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> p <span class="p">)</span>
<span class="p">{</span>
  assert<span class="p">(</span><a href="cmJson_h_0.html#cmJsonIsArray">cmJsonIsArray</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> i<span class="p">,</span>j<span class="p">,</span>k<span class="p">;</span>
  
  <span class="c">// remove any existing symbols</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>symM <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>symColCnt<span class="p">*</span>p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>symM<span class="p">[</span>i<span class="p">]</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
        <a href="cmSymTbl_h_0.html#cmSymTblRemove">cmSymTblRemove</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>symM<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// reallocate the symbol matrix</span>
  p<span class="p">-</span><span class="p">&gt</span>symRowCnt <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonChildCount">cmJsonChildCount</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>symM      <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhResizeN">cmLhResizeN</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="k">unsigned</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>symM<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">*</span>p<span class="p">-</span><span class="p">&gt</span>symColCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// for each row in the JSON array</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> cnp <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// for each column in row whose data type is a string</span>
    <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">,</span>k<span class="p">=</span><span class="l">0</span><span class="p">;</span> k<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>symColCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>typeIdArray<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> vnp <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>cnp<span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
      <span class="k">unsigned</span>            idx <span class="p">=</span> k<span class="p">*</span>p<span class="p">-</span><span class="p">&gt</span>symRowCnt <span class="p">+</span> i<span class="p">;</span>
      <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span>     text<span class="p">;</span>
      
      <span class="c">// register the string with the symbol table</span>
      <span class="k">if</span><span class="p">(</span><span class="p">(</span>text <span class="p">=</span> vnp<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>stringVal<span class="p">)</span> <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
        p<span class="p">-</span><span class="p">&gt</span>symM<span class="p">[</span> idx <span class="p">]</span> <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>text<span class="p">)</span><span class="p">;</span>
      <span class="k">else</span>
        p<span class="p">-</span><span class="p">&gt</span>symM<span class="p">[</span> idx <span class="p">]</span> <span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">;</span>
      
      <span class="p">+</span><span class="p">+</span>k<span class="p">;</span>        
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<span class="c">// Load a JSON file and set the supplied <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a> handle.</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgListLoadFile_defn"></a><a name="_cmDspMsgListLoadFile"></a><span class="f">_cmDspMsgListLoadFile</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmErr_h_0.html#cmErr_t">cmErr_t</a><span class="p">*</span> err<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> rsrcLabel<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn<span class="p">,</span> <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a><span class="p">*</span> hp<span class="p">,</span> <span class="k">unsigned</span><span class="p">*</span> colCntPtr<span class="p">,</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span><span class="p">*</span> npp <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>           rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>     <span class="c"> </span>
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span>       np  <span class="p">=</span> NULL<span class="p">;</span>         <span class="c"> </span>
  <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a>           jsH <span class="p">=</span> cmJsonNullHandle<span class="p">;</span>  <span class="c"> </span>
  
  <span class="p">*</span>hp         <span class="p">=</span> cmJsonNullHandle<span class="p">;</span>
  <span class="p">*</span>colCntPtr  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="p">*</span>npp        <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="c">// if no file name was given ...</span>
  <span class="k">if</span><span class="p">(</span> fn<span class="p">=</span><span class="p">=</span>NULL <span class="p">|</span><span class="p">|</span> strlen<span class="p">(</span>fn<span class="p">)</span><span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    jsH <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>rsrcJsH<span class="p">;</span> <span class="c"> // ... use the rsrc file</span>
    
    <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonIsValid">cmJsonIsValid</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rsrcJsH<span class="p">)</span> <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
      <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotNo JSON cfg resource exists for this DSP program.&quot</span><span class="p">)</span><span class="p">;</span>
    
    fn  <span class="p">=</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonInitializeFromFile">cmJsonInitializeFromFile</a><span class="p">(</span><span class="p">&amp</span>jsH<span class="p">,</span>fn<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
      <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list JSON file load failed on '%s'.&quot</span><span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// find the array named by rsrcLabel</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>np <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonFindValue">cmJsonFindValue</a><span class="p">(</span>jsH<span class="p">,</span>rsrcLabel<span class="p">,</span>NULL<span class="p">,</span><a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL<span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list JSON tree does not have an array named '%s'.&quot</span><span class="p">,</span>rsrcLabel<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// be sure the msg list really is an array</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonIsArray">cmJsonIsArray</a><span class="p">(</span>np<span class="p">)</span> <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list JSON element named '%s' is not an array.&quot</span><span class="p">,</span> rsrcLabel<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> fn <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    fn <span class="p">=</span> <span class="l">&quot&ltresource file&gt&quot</span><span class="p">;</span>
  
  <span class="c">// count of elements in the array</span>
  <span class="k">unsigned</span> n <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonChildCount">cmJsonChildCount</a><span class="p">(</span>np<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> m <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">,</span>j<span class="p">;</span>
  
  <span class="c">// for each line in the array</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>n<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> cnp<span class="p">;</span>
    
    <span class="c">// get the ith sub-array (row)</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>cnp <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>np<span class="p">,</span>i<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      <span class="c">// verify that it is an array</span>
      <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonIsArray">cmJsonIsArray</a><span class="p">(</span>cnp <span class="p">)</span> <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
        <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list JSON element in '%s' at index %i is not an array.&quot</span><span class="p">,</span>fn<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// track the number of elements (columns) per row</span>
      <span class="k">unsigned</span> q <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonChildCount">cmJsonChildCount</a><span class="p">(</span>cnp<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// if this is the first row then use it to set the valid column count</span>
      <span class="k">if</span><span class="p">(</span> i<span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
        m   <span class="p">=</span> q<span class="p">;</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> m <span class="p">!</span><span class="p">=</span> q <span class="p">)</span>
          <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list sub-array at index %i has a different number of elements than the preceding sub-arrays in '%s'.&quot</span><span class="p">,</span>i<span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="c">//
  // determine and validate the column types
  //</span>  
  
  <span class="k">unsigned</span> typeIdArray<span class="p">[</span>m<span class="p">]</span><span class="p">;</span>
  
  <span class="c">// for each row</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>n<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> cnp <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>np<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// for each column</span>
    <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>m<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
    <span class="p">{</span>
      <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> sap    <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>cnp<span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
      <span class="k">unsigned</span>            typeId <span class="p">=</span> sap<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">&amp</span> <a href="cmJson_h_0.html#kMaskTId">kMaskTId</a><span class="p">;</span>
      
      <span class="c">// the first row sets the expected type id for each column</span>
      <span class="k">switch</span><span class="p">(</span>i<span class="p">)</span>
      <span class="p">{</span>
      <span class="k">case</span> <span class="l">0</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> typeId <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a> <span class="p">)</span>
          <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe first row of a msg list (%s) file must contain string elements which set the colum labels.&quot</span><span class="p">,</span>rsrcLabel<span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">case</span> <span class="l">1</span><span class="p">:</span>
        typeIdArray<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> typeId<span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">default</span><span class="p">:</span>
        <span class="p">{</span>
          <span class="c">// if the type is a string then it can only 
          // match if the column is a string or null 
          // so we assume an error</span>          
          <span class="k">if</span><span class="p">(</span> typeId <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a> <span class="p">)</span>
            rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">;</span>
          
          <span class="k">switch</span><span class="p">(</span>typeIdArray<span class="p">[</span>j<span class="p">]</span><span class="p">)</span>
          <span class="p">{</span>
          <span class="k">case</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a><span class="p">:</span>            
            <span class="k">if</span><span class="p">(</span> typeId <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a> <span class="p">&amp</span><span class="p">&amp</span> typeId <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kNullTId">kNullTId</a><span class="p">)</span>
              <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list element at row index %i column index %i cannot be converted to a string in '%s'.&quot</span><span class="p">,</span>i<span class="p">,</span>j<span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
            
            rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span> <span class="c"> // clear the assummed error</span>
            <span class="k">break</span><span class="p">;</span>
            
          <span class="k">case</span> <a href="cmJson_h_0.html#kNullTId">kNullTId</a><span class="p">:</span>   <span class="c"> // null can be converted to anything</span>
            typeIdArray<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> typeId<span class="p">;</span> 
            <span class="k">break</span><span class="p">;</span>
            
          <span class="k">case</span> <a href="cmJson_h_0.html#kIntTId">kIntTId</a><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> typeId <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kRealTId">kRealTId</a> <span class="p">)</span>    <span class="c"> // ints may be promoted to reals</span>
              typeIdArray<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> <a href="cmJson_h_0.html#kRealTId">kRealTId</a><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
            
          <span class="k">case</span> <a href="cmJson_h_0.html#kRealTId">kRealTId</a><span class="p">:</span>
            <span class="k">break</span><span class="p">;</span>
            
          <span class="k">case</span> <a href="cmJson_h_0.html#kFalseTId">kFalseTId</a><span class="p">:</span>
          <span class="k">case</span> <a href="cmJson_h_0.html#kTrueTId">kTrueTId</a><span class="p">:</span> <span class="c"> // bools may be promoted to ints or reals</span>
            <span class="k">if</span><span class="p">(</span> typeId <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kIntTId">kIntTId</a> <span class="p">|</span><span class="p">|</span> typeId <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kRealTId">kRealTId</a> <span class="p">)</span>
              typeIdArray<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> typeId<span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
            
          <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list element at row index %i column index %i is not a string,int,real,bool, or null type in '%s'.&quot</span><span class="p">,</span>i<span class="p">,</span>j<span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
            
          <span class="p">}</span>
          
          <span class="k">if</span><span class="p">(</span> rc <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
            <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe string msg list element at row index %i column index %i cannot be converted to the column type in '%s'.&quot</span><span class="p">,</span>i<span class="p">,</span>j<span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
        <span class="p">}</span> <span class="c"> // end dflt</span>
      <span class="p">}</span> <span class="c"> // end switch</span>
    <span class="p">}</span> <span class="c"> // end row</span>
  <span class="p">}</span> <span class="c"> // end list</span>
  
  
  <span class="c">// VERY TRICKY - store the column type id's in the label columns type id.
  // This is stupid but safe because the column type id's are known to be set to <a href="cmJson_h_0.html#kStringTId">kStringTId</a>.</span>  
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> lnp <span class="p">=</span> np<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>childPtr<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>childPtr<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>m<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">,</span>lnp<span class="p">=</span>lnp<span class="p">-</span><span class="p">&gt</span>siblingPtr<span class="p">)</span>
    lnp<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">=</span> typeIdArray<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
  
  <span class="p">*</span>hp        <span class="p">=</span> fn<span class="p">=</span><span class="p">=</span>NULL <span class="p">?</span> cmJsonNullHandle <span class="p">:</span> jsH<span class="p">;</span>
  <span class="p">*</span>npp       <span class="p">=</span> np<span class="p">;</span>
  <span class="p">*</span>colCntPtr <span class="p">=</span> m<span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<span class="c">// use the JSON list labels to setup the <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> records associated with each msg output var.</span>
<a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> <a name="_cmDspMsgListCons_defn"></a><a name="_cmDspMsgListCons"></a><span class="f">_cmDspMsgListCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a><span class="p">*</span> args<span class="p">,</span> <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a> jsH<span class="p">,</span> <span class="k">unsigned</span> colCnt<span class="p">,</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> np<span class="p">,</span> <span class="k">unsigned</span> typeIdArray<span class="p">[</span><span class="p">]</span><span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> i<span class="p">,</span>j<span class="p">;</span>
  <span class="k">unsigned</span> fixedArgCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label <span class="p">!</span><span class="p">=</span> NULL<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="p">+</span><span class="p">+</span>fixedArgCnt<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> a<span class="p">[</span> fixedArgCnt <span class="p">+</span> colCnt <span class="p">+</span> <span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  
  <span class="c">// copy the fixed arg's into the first fixedArgCnt ele's of a[]</span>
  <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>fixedArgCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
    a<span class="p">[</span>j<span class="p">]</span> <span class="p">=</span> args<span class="p">[</span>j<span class="p">]</span><span class="p">;</span>
  
  <span class="c">// remove the label row from the JSON array</span>
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> lnp <span class="p">=</span> np<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>childPtr<span class="p">;</span>  <span class="c"> // store the pointer to the label row</span>
  <span class="c">//np-&ampgtu.childPtr    = lnp-&ampgtsiblingPtr; // remove the labels from the array </span>
  
  <span class="c">// for each column</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>colCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">,</span><span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> lp <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElement">cmJsonArrayElement</a><span class="p">(</span>lnp<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// store a pointer to the label</span>
    a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>label   <span class="p">=</span> lp<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>stringVal<span class="p">;</span>
    a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>constId <span class="p">=</span> j<span class="p">;</span>
    a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>rn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>cn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags   <span class="p">=</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">;</span>
    a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc     <span class="p">=</span> <span class="l">&quotMsg output&quot</span><span class="p">;</span>
    
    typeIdArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> lp<span class="p">-</span><span class="p">&gt</span>typeId<span class="p">;</span>
    
    <span class="c">// convert the JSON type to a DSV type</span>
    <span class="k">switch</span><span class="p">(</span> lp<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kNullTId">kNullTId</a><span class="p">:</span>   a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">|</span><span class="p">=</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kIntTId">kIntTId</a><span class="p">:</span>    a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">|</span><span class="p">=</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kRealTId">kRealTId</a><span class="p">:</span>   a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">|</span><span class="p">=</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kTrueTId">kTrueTId</a><span class="p">:</span>   a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">|</span><span class="p">=</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kFalseTId">kFalseTId</a><span class="p">:</span>  a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">|</span><span class="p">=</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a><span class="p">:</span> a<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">|</span><span class="p">=</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">;</span>    <span class="k">break</span><span class="p">;</span> <span class="c"> // strings are treated as symbols (UInt)</span>
      
    <span class="k">default</span><span class="p">:</span>
      <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c">// undo the tricky bit with the label types</span>
    lp<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// set the null sentinel at the end of the arg array</span>
  memset<span class="p">(</span>a <span class="p">+</span> j<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">(</span><a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span><span class="p">)</span><a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgListReload_defn"></a><a name="_cmDspMsgListReload"></a><span class="f">_cmDspMsgListReload</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> rsrcLabel<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc     <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a>     jsH    <span class="p">=</span> cmJsonNullHandle<span class="p">;</span>
  <span class="k">unsigned</span>      colCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> np     <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="c">// load the file</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="#_cmDspMsgListLoadFile">_cmDspMsgListLoadFile</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">.</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span>rsrcLabel<span class="p">,</span>fn<span class="p">,</span><span class="p">&amp</span>jsH<span class="p">,</span><span class="p">&amp</span>colCnt<span class="p">,</span><span class="p">&amp</span>np<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list file '%s' load failed.&quot</span><span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// verify that the col count is correct</span>
  <span class="k">if</span><span class="p">(</span> colCnt <span class="p">!</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>colCnt <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe column count (%i) of msg list file '%s does not match the msg list column count %i.&quot</span><span class="p">,</span>colCnt<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>colCnt<span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">unsigned</span>      fixArgCnt <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">.</span>varCnt <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>colCnt<span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> lnp       <span class="p">=</span> np<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>childPtr<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>childPtr<span class="p">;</span>
  <span class="k">unsigned</span>      i<span class="p">,</span>j<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">,</span>j<span class="p">=</span>fixArgCnt<span class="p">;</span> i<span class="p">&lt</span>colCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">,</span><span class="p">+</span><span class="p">+</span>j<span class="p">,</span> lnp<span class="p">=</span>lnp<span class="p">-</span><span class="p">&gt</span>siblingPtr<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> labelStr <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">.</span>varArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>symId<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// the labels of the new file must match the labels of the previous file</span>
    <span class="k">if</span><span class="p">(</span> strcmp<span class="p">(</span>lnp<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>stringVal<span class="p">,</span>labelStr<span class="p">)</span> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list file '%s' label '%s' does not match the msg list label '%s' in column index %i.&quot</span><span class="p">,</span>fn<span class="p">,</span>labelStr<span class="p">,</span>lnp<span class="p">-</span><span class="p">&gt</span>u<span class="p">.</span>stringVal<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// if the msg column is a string ....</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">.</span>varArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">&amp</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="c">// ... then the file column must also be a string or null</span>
      <span class="k">if</span><span class="p">(</span> lnp<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a> <span class="p">&amp</span><span class="p">&amp</span> np<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kNullTId">kNullTId</a> <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe data type of msg list file '%s' column index %i  must be a string or null.&quot</span><span class="p">,</span>fn<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="c"> // otherwie if the msg column is a number ...</span>
    <span class="p">{</span>
      <span class="c">// ... then the file type can't be a string</span>
      <span class="k">if</span><span class="p">(</span> lnp<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a> <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe data type of msg list file '%s' column index %i cannot be a string.&quot</span><span class="p">,</span>fn<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// TODO: maybe there are other type conversions to check for here.</span>
    <span class="p">}</span>
    
    <span class="c">// reset the typeid of the labels 
    // (this is a cleanup from the tricky bit at the end of _cmDspListLoadFile())</span>    
    lnp<span class="p">-</span><span class="p">&gt</span>typeId <span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonIsValid">cmJsonIsValid</a><span class="p">(</span> jsH <span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmGlobal_h_0.html#cmHandlesAreNotEqual">cmHandlesAreNotEqual</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>dfltJsH<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> <a href="cmGlobal_h_0.html#cmHandlesAreNotEqual">cmHandlesAreNotEqual</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>rsrcJsH<span class="p">)</span> <span class="p">)</span>
      <a href="cmJson_h_0.html#cmJsonFinalize">cmJsonFinalize</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">)</span><span class="p">;</span>
    
    p<span class="p">-</span><span class="p">&gt</span>jsH <span class="p">=</span> jsH<span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>np  <span class="p">=</span> np<span class="p">;</span>
    
    <a href="#_cmDspMsgListLoadSymbolMtx">_cmDspMsgListLoadSymbolMtx</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>


<span class="k">enum</span>
<span class="p">{</span>
  <a name="kRsrcMlId"></a><span class="e">kRsrcMlId</span><span class="p">,</span>
  <a name="kFnMlId"></a><span class="e">kFnMlId</span><span class="p">,</span>
  <a name="kSelMlId"></a><span class="e">kSelMlId</span><span class="p">,</span>
  <a name="kListMlId"></a><span class="e">kListMlId</span><span class="p">,</span>
  <a name="kCntMlId"></a><span class="e">kCntMlId</span><span class="p">,</span>
  <a name="kOutBaseMlId"></a><span class="e">kOutBaseMlId</span>  <span class="c"> // identify the first output port</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspMsgListAlloc_defn"></a><a name="_cmDspMsgListAlloc"></a><span class="f">_cmDspMsgListAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_list       vl2<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotrsrc&quot</span><span class="p">,</span> <a href="#kRsrcMlId">kRsrcMlId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span>  <span class="l">&quotMsg list resource label&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfn&quot</span><span class="p">,</span>   <a href="#kFnMlId">kFnMlId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span>  <span class="l">&quotMsg list file name&quot</span>   <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotsel&quot</span><span class="p">,</span>  <a href="#kSelMlId">kSelMlId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>  <span class="l">&quotCurrent selection index&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotlist&quot</span><span class="p">,</span> <a href="#kListMlId">kListMlId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span>                <a href="cmDspValue_h_0.html#kJsonDsvFl">kJsonDsvFl</a><span class="p">,</span>  <span class="l">&quotMsg list data as a JSON array&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotcnt&quot</span><span class="p">,</span>  <a href="#kCntMlId">kCntMlId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">,</span>  <span class="l">&quotCount of elements.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  va_copy<span class="p">(</span>vl2<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe message list constructor must contain at least two arguments.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> rsrcLabel <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <span class="k">char</span><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn        <span class="p">=</span> va_cnt<span class="p">&gt</span><span class="l">1</span> <span class="p">?</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <span class="k">char</span><span class="p">*</span><span class="p">)</span> <span class="p">:</span> NULL<span class="p">;</span>
  <span class="k">unsigned</span>        colCnt    <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonH_t">cmJsonH_t</a>       jsH       <span class="p">=</span> cmJsonNullHandle<span class="p">;</span>
  <a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> p<span class="p">;</span>
  <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span>   np<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc<span class="p">;</span>
  
  <span class="c">// be sure the rsrc label contains a valid string</span>
  <span class="k">if</span><span class="p">(</span> rsrcLabel<span class="p">=</span><span class="p">=</span>NULL <span class="p">|</span><span class="p">|</span> strlen<span class="p">(</span>rsrcLabel<span class="p">)</span><span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotNo msg list resource label was given.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// load and validate the JSON file</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="#_cmDspMsgListLoadFile">_cmDspMsgListLoadFile</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span>rsrcLabel<span class="p">,</span>fn<span class="p">,</span><span class="p">&amp</span>jsH<span class="p">,</span><span class="p">&amp</span>colCnt<span class="p">,</span><span class="p">&amp</span>np<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> i<span class="p">;</span>
    <span class="k">unsigned</span> typeIdArray<span class="p">[</span>colCnt<span class="p">]</span><span class="p">;</span>
    
    <span class="c">// allocate the instance</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="#_cmDspMsgListCons">_cmDspMsgListCons</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>storeSymId<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>args<span class="p">,</span>jsH<span class="p">,</span>colCnt<span class="p">,</span> np<span class="p">,</span> typeIdArray<span class="p">,</span> va_cnt<span class="p">,</span> vl2 <span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      p<span class="p">-</span><span class="p">&gt</span>jsH         <span class="p">=</span> jsH<span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>np          <span class="p">=</span> np<span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>dfltJsH     <span class="p">=</span> jsH<span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>colCnt      <span class="p">=</span> colCnt<span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>typeIdArray <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhAllocZ">cmLhAllocZ</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span> <span class="k">unsigned</span><span class="p">,</span> colCnt <span class="p">)</span><span class="p">;</span>
      memcpy<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>typeIdArray<span class="p">,</span>typeIdArray<span class="p">,</span><span class="k">sizeof</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>typeIdArray<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">*</span>colCnt<span class="p">)</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>symColCnt   <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      
      <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>colCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>typeIdArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a> <span class="p">)</span>
          <span class="p">+</span><span class="p">+</span>p<span class="p">-</span><span class="p">&gt</span>symColCnt<span class="p">;</span>
      
      <a href="#_cmDspMsgListLoadSymbolMtx">_cmDspMsgListLoadSymbolMtx</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span> <span class="p">(</span><a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span><span class="p">)</span>p<span class="p">,</span> <a href="#kSelMlId">kSelMlId</a> <span class="p">)</span> <span class="p">&gt</span> p<span class="p">-</span><span class="p">&gt</span>symRowCnt <span class="p">)</span>
        <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe default msgList selection index %i greater than the count of elements %i.&quot</span><span class="p">,</span><a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span> <span class="p">(</span><a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span><span class="p">)</span>p<span class="p">,</span> <a href="#kSelMlId">kSelMlId</a> <span class="p">)</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">)</span><span class="p">;</span>     
      
      <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRsrcMlId">kRsrcMlId</a><span class="p">,</span>NULL<span class="p">,</span> rsrcLabel<span class="p">)</span><span class="p">;</span> <span class="c"> // rsrc label </span>
      <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFnMlId">kFnMlId</a><span class="p">,</span>  NULL<span class="p">,</span> fn<span class="p">)</span><span class="p">;</span>        <span class="c"> // file name var</span>
      <a href="cmDspClass_h_0.html#cmDspSetDefaultJson">cmDspSetDefaultJson</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>  <a href="#kListMlId">kListMlId</a><span class="p">,</span>NULL<span class="p">,</span> np<span class="p">)</span><span class="p">;</span>        <span class="c"> // default tree</span>
      <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>  <a href="#kSelMlId">kSelMlId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>     <span class="l">0</span><span class="p">)</span><span class="p">;</span>        <span class="c"> // selection</span>
      <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>  <a href="#kCntMlId">kCntMlId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>    p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// if there is only one column then signal the UI to create a menu button rather
      // than a list by setting the height to zero.</span>      
      <span class="k">unsigned</span> height <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>colCnt <span class="p">=</span><span class="p">=</span> <span class="l">1</span> <span class="p">?</span> <span class="l">0</span> <span class="p">:</span> <span class="l">5</span><span class="p">;</span>
      
      <span class="c">// create the list UI element</span>
      <a href="cmDspClass_h_0.html#cmDspUiMsgListCreate">cmDspUiMsgListCreate</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> height<span class="p">,</span> <a href="#kListMlId">kListMlId</a><span class="p">,</span> <a href="#kSelMlId">kSelMlId</a> <span class="p">)</span><span class="p">;</span>
      
      <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  errLabel<span class="p">:</span>
  <span class="k">return</span> NULL<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgListFree_defn"></a><a name="_cmDspMsgListFree"></a><span class="f">_cmDspMsgListFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  
  <span class="c">// be careful not release the ctx-&ampgtrsrcJsH handle if is happens to be the p-&ampgtdflJsH</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonIsValid">cmJsonIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>dfltJsH<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> <a href="cmGlobal_h_0.html#cmHandlesAreNotEqual">cmHandlesAreNotEqual</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>dfltJsH<span class="p">)</span>  <span class="p">&amp</span><span class="p">&amp</span> <a href="cmGlobal_h_0.html#cmHandlesAreNotEqual">cmHandlesAreNotEqual</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>dfltJsH<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>rsrcJsH<span class="p">)</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonFinalize">cmJsonFinalize</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>dfltJsH<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotJSON default tree finalize failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// be careful not to release the ctx-&ampgtrsrcJsH handle if it happens to be the p-&ampgtjsH</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonIsValid">cmJsonIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>jsH<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> <a href="cmGlobal_h_0.html#cmHandlesAreNotEqual">cmHandlesAreNotEqual</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>dfltJsH<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>rsrcJsH<span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmJson_h_0.html#cmJsonFinalize">cmJsonFinalize</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>jsH <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotJSON finalization failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>typeIdArray<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>typeIdArray <span class="p">=</span> NULL<span class="p">;</span>
  
  <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>symM<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>symM <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgListReset_defn"></a><a name="_cmDspMsgListReset"></a><span class="f">_cmDspMsgListReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgOnSel_defn"></a><a name="_cmDspMsgOnSel"></a><span class="f">_cmDspMsgOnSel</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">unsigned</span> rowIdx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">unsigned</span> i<span class="p">,</span>j<span class="p">;</span>
  <span class="k">unsigned</span>      symId<span class="p">;</span>
  <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> cnp <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">,</span>rowIdx<span class="p">)</span><span class="p">;</span>
  
  assert<span class="p">(</span> cnp <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// for each output variable (column)</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">,</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>colCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span>            varId <span class="p">=</span> <a href="#kOutBaseMlId">kOutBaseMlId</a> <span class="p">+</span> i<span class="p">;</span>            <span class="c"> // variable id</span>
    <span class="k">const</span> <a href="cmJson_h_0.html#cmJsonNode_t">cmJsonNode_t</a><span class="p">*</span> np    <span class="p">=</span> <a href="cmJson_h_0.html#cmJsonArrayElementC">cmJsonArrayElementC</a><span class="p">(</span>cnp<span class="p">,</span>i<span class="p">)</span><span class="p">;</span>  <span class="c"> // json row array</span>
    assert<span class="p">(</span> np <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span><span class="p">;</span>
    
    <span class="k">switch</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>typeIdArray<span class="p">[</span>i<span class="p">]</span> <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kNullTId">kNullTId</a><span class="p">:</span> 
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmJson_h_0.html#kIntTId">kIntTId</a><span class="p">:</span>   
      <span class="p">{</span>
        <span class="k">int</span> v<span class="p">;</span>
        <span class="k">if</span><span class="p">(</span>  <a href="cmJson_h_0.html#cmJsonIntValue">cmJsonIntValue</a><span class="p">(</span>np<span class="p">,</span><span class="p">&amp</span>v<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
        <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
        
        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetInt">cmDspSetInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">,</span>v<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmJson_h_0.html#kRealTId">kRealTId</a><span class="p">:</span>
      <span class="p">{</span>
        <span class="k">double</span> v<span class="p">;</span>
        <span class="k">if</span><span class="p">(</span>  <a href="cmJson_h_0.html#cmJsonRealValue">cmJsonRealValue</a><span class="p">(</span>np<span class="p">,</span><span class="p">&amp</span>v<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
        <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
        
        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">,</span>v<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmJson_h_0.html#kTrueTId">kTrueTId</a><span class="p">:</span>
    <span class="k">case</span> <a href="cmJson_h_0.html#kFalseTId">kFalseTId</a><span class="p">:</span>
      <span class="p">{</span>
        <span class="k">bool</span> v<span class="p">;</span>
        <span class="k">if</span><span class="p">(</span>  <a href="cmJson_h_0.html#cmJsonBoolValue">cmJsonBoolValue</a><span class="p">(</span>np<span class="p">,</span><span class="p">&amp</span>v<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmJson_h_0.html#kOkJsRC">kOkJsRC</a> <span class="p">)</span>
        <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
        
        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetBool">cmDspSetBool</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">,</span>v<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmJson_h_0.html#kStringTId">kStringTId</a><span class="p">:</span>
      <span class="p">{</span>
        assert<span class="p">(</span> j <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>symColCnt <span class="p">)</span><span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span><span class="p">(</span>symId <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>symM<span class="p">[</span> <span class="p">(</span>j<span class="p">*</span>p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">)</span> <span class="p">+</span> rowIdx <span class="p">]</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a> <span class="p">)</span>
          <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">,</span>symId <span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
        
        <span class="p">+</span><span class="p">+</span>j<span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">default</span><span class="p">:</span>
      <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
      
    <span class="p">}</span> <span class="c"> // end switch</span>
  <span class="p">}</span> <span class="c"> // end for</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspMsgListRecv_defn"></a><a name="_cmDspMsgListRecv"></a><span class="f">_cmDspMsgListRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc    <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> p     <span class="p">=</span> <span class="p">(</span><a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
    
  <span class="k">case</span> <a href="#kRsrcMlId">kRsrcMlId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn        <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFnMlId">kFnMlId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> rsrcLabel <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvStrz">cmDsvStrz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> rsrcLabel <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="#_cmDspMsgListReload">_cmDspMsgListReload</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span>rsrcLabel<span class="p">,</span>fn<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
          <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kJsonFailDspRC">kJsonFailDspRC</a><span class="p">,</span><span class="l">&quotThe msg list file '%s' load failed.&quot</span><span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
        
        <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetJson">cmDspSetJson</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kListMlId">kListMlId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>np<span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kSelMlId">kSelMlId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kCntMlId">kCntMlId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kFnMlId">kFnMlId</a><span class="p">:</span>
    <span class="c">// Store the new file name.
    // A new file will not be loaded until the next rsrc label is received.</span>    
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span> 
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kListMlId">kListMlId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSelMlId">kSelMlId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">unsigned</span>      rowIdx <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
      
      assert<span class="p">(</span> rowIdx <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>symRowCnt<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// set the current selection variable</span>
      <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
        rc <span class="p">=</span> <a href="#_cmDspMsgOnSel">_cmDspMsgOnSel</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span>rowIdx<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span> <span class="c"> // end case</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>  <a name="_cmDspMsgListPresetRdWr_defn"></a><a name="_cmDspMsgListPresetRdWr"></a><span class="f">_cmDspMsgListPresetRdWr</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  inst<span class="p">,</span>  <span class="k">bool</span> storeFl <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspMsgList_t">cmDspMsgList_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarPresetRdWr">cmDspVarPresetRdWr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kSelMlId">kSelMlId</a><span class="p">,</span>storeFl<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">!</span>storeFl <span class="p">)</span>
      rc <span class="p">=</span> <a href="#_cmDspMsgOnSel">_cmDspMsgOnSel</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kSelMlId">kSelMlId</a><span class="p">)</span> <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmMsgListClassCons_defn"></a><a name="cmMsgListClassCons"></a><span class="f">cmMsgListClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmMsgListDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotMsgList&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMsgListAlloc">_cmDspMsgListAlloc</a><span class="p">,</span>
  <a href="#_cmDspMsgListFree">_cmDspMsgListFree</a><span class="p">,</span>
  <a href="#_cmDspMsgListReset">_cmDspMsgListReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspMsgListRecv">_cmDspMsgListRecv</a><span class="p">,</span>
  <a href="#_cmDspMsgListPresetRdWr">_cmDspMsgListPresetRdWr</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotMessage list selection control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmMsgListDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspWavetable : Programmable wavetable unit.</div><pre><a name="cmDspWavetable"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kLenWtId"></a><span class="e">kLenWtId</span><span class="p">,</span>
  <a name="kShapeWtId"></a><span class="e">kShapeWtId</span><span class="p">,</span>
  <a name="kFnWtId"></a><span class="e">kFnWtId</span><span class="p">,</span>
  <a name="kLoopWtId"></a><span class="e">kLoopWtId</span><span class="p">,</span>
  <a name="kBegWtId"></a><span class="e">kBegWtId</span><span class="p">,</span>
  <a name="kEndWtId"></a><span class="e">kEndWtId</span><span class="p">,</span>
  <a name="kChWtId"></a><span class="e">kChWtId</span><span class="p">,</span>
  <a name="kCmdWtId"></a><span class="e">kCmdWtId</span><span class="p">,</span>
  <a name="kOtWtId"></a><span class="e">kOtWtId</span><span class="p">,</span>
  <a name="kGainWtId"></a><span class="e">kGainWtId</span><span class="p">,</span>
  <a name="kPhsWtId"></a><span class="e">kPhsWtId</span><span class="p">,</span>
  <a name="kOutWtId"></a><span class="e">kOutWtId</span><span class="p">,</span>
  <a name="kCntWtId"></a><span class="e">kCntWtId</span><span class="p">,</span>
  <a name="kFIdxWtId"></a><span class="e">kFIdxWtId</span><span class="p">,</span>
  <a name="kDoneWtId"></a><span class="e">kDoneWtId</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">enum</span>
<span class="p">{</span>
  <a name="kSilenceWtId"></a><span class="e">kSilenceWtId</span><span class="p">,</span> <span class="c"> // 0</span>
  <a name="kFileWtId"></a><span class="e">kFileWtId</span><span class="p">,</span>    <span class="c"> // 1</span>
  <a name="kWhiteWtId"></a><span class="e">kWhiteWtId</span><span class="p">,</span>   <span class="c"> // 2</span>
  <a name="kPinkWtId"></a><span class="e">kPinkWtId</span><span class="p">,</span>    <span class="c"> // 3</span>
  <a name="kSineWtId"></a><span class="e">kSineWtId</span><span class="p">,</span>    <span class="c"> // 4</span>
  <a name="kCosWtId"></a><span class="e">kCosWtId</span><span class="p">,</span>     <span class="c"> // 5</span>
  <a name="kSqrWtId"></a><span class="e">kSqrWtId</span><span class="p">,</span>     <span class="c"> // 6</span>
  <a name="kTriWtId"></a><span class="e">kTriWtId</span><span class="p">,</span>     <span class="c"> // 7</span>
  <a name="kSawWtId"></a><span class="e">kSawWtId</span><span class="p">,</span>     <span class="c"> // 8</span>
  <a name="kPulseWtId"></a><span class="e">kPulseWtId</span><span class="p">,</span>   <span class="c"> // 9</span>
  <a name="kImpulseWtId"></a><span class="e">kImpulseWtId</span><span class="p">,</span> <span class="c"> // 10 </span>
  <a name="kPhasorWtId"></a><span class="e">kPhasorWtId</span><span class="p">,</span>  <span class="c"> // 11</span>
  <a name="kShapeWtCnt"></a><span class="e">kShapeWtCnt</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmWaveTableDC<span class="p">;</span>

<a name="cmDspWaveTable_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>    <a name="cmDspWaveTable_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>    <a name="cmDspWaveTable_t.wt"></a><span class="i">wt</span><span class="p">;</span>            <span class="c"> // wave table memory</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.wti"></a><span class="i">wti</span><span class="p">;</span>           <span class="c"> // next location to write samples into the wavetable</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.wtn"></a><span class="i">wtn</span><span class="p">;</span>           <span class="c"> // count of empty samples (avail for writing over) in the wavetable.</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.fi"></a><span class="i">fi</span><span class="p">;</span>            <span class="c"> // absolute index into the file of the next sample to read</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.fn"></a><span class="i">fn</span><span class="p">;</span>            <span class="c"> // length of the file in samples</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.cfi"></a><span class="i">cfi</span><span class="p">;</span>           <span class="c"> // absolute index into the file of the beginning of the current audio vector</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.cfn"></a><span class="i">cfn</span><span class="p">;</span>           <span class="c"> // when cfi &ampgt= cfn and doneFl is set then the 'done' msg is sent</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.loopCnt"></a><span class="i">loopCnt</span><span class="p">;</span>       <span class="c"> // current loop count</span>
  <span class="k">bool</span>           <a name="cmDspWaveTable_t.doneFl"></a><span class="i">doneFl</span><span class="p">;</span>        <span class="c"> // the wave table source is exhausted </span>
  <a href="cmAudioFile_h_0.html#cmAudioFileH_t">cmAudioFileH_t</a> <a name="cmDspWaveTable_t.afH"></a><span class="i">afH</span><span class="p">;</span>           <span class="c"> // current audio file handle</span>
  <span class="k">int</span>            <a name="cmDspWaveTable_t.nxtBegSmpIdx"></a><span class="i">nxtBegSmpIdx</span><span class="p">;</span>  <span class="c"> // the beg/end sample index to use with the next filename to arrive at port 'fn'</span>
  <span class="k">int</span>            <a name="cmDspWaveTable_t.nxtEndSmpIdx"></a><span class="i">nxtEndSmpIdx</span><span class="p">;</span>  <span class="c"> </span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.nxtChIdx"></a><span class="i">nxtChIdx</span><span class="p">;</span>
  <a href="cmThread_h_0.html#cmThreadH_t">cmThreadH_t</a>    <a name="cmDspWaveTable_t.thH"></a><span class="i">thH</span><span class="p">;</span>
  <span class="k">bool</span>           <a name="cmDspWaveTable_t.loadFileFl"></a><span class="i">loadFileFl</span><span class="p">;</span>
  <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span>    <a name="cmDspWaveTable_t.ctx"></a><span class="i">ctx</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a>     <a name="cmDspWaveTable_t.phsOffs"></a><span class="i">phsOffs</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a>     <a name="cmDspWaveTable_t.phsLast"></a><span class="i">phsLast</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.onSymId"></a><span class="i">onSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.offSymId"></a><span class="i">offSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.doneSymId"></a><span class="i">doneSymId</span><span class="p">;</span>
  <span class="k">bool</span>           <a name="cmDspWaveTable_t.useThreadFl"></a><span class="i">useThreadFl</span><span class="p">;</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.minAfIndexRptCnt"></a><span class="i">minAfIndexRptCnt</span><span class="p">;</span> <span class="c"> // min count of audio samples between transmitting the current audio file index</span>
  <span class="k">unsigned</span>       <a name="cmDspWaveTable_t.afIndexRptCnt"></a><span class="i">afIndexRptCnt</span><span class="p">;</span>    <span class="c"> // current audio file sample index count</span>
<span class="p">}</span> <span class="t"><a href="#cmDspWaveTable_t">cmDspWaveTable_t</a></span><span class="p">;</span>

<span class="k">bool</span> <a name="_cmDspWaveTableThreadFunc"></a><span class="f"><a href="#_cmDspWaveTableThreadFunc_defn">_cmDspWaveTableThreadFunc</a></span><span class="p">(</span> <span class="k">void</span><span class="p">*</span> param<span class="p">)</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspWaveTableAlloc_defn"></a><a name="_cmDspWaveTableAlloc"></a><span class="f">_cmDspWaveTableAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotlen&quot</span><span class="p">,</span>    <a href="#kLenWtId">kLenWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotWave table length in samples&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotshape&quot</span><span class="p">,</span>  <a href="#kShapeWtId">kShapeWtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotWave shape 0=silent 1=file 2=white 3=pink 4=sine, 5=cos 6=sqr 7=tri 8=saw 9=pulse 10=impulse 11=phasor&quot</span>   <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfn&quot</span><span class="p">,</span>     <a href="#kFnWtId">kFnWtId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOptional audio file name&quot</span>     <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotloop&quot</span><span class="p">,</span>   <a href="#kLoopWtId">kLoopWtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quot-1=loop forever  &gt0=loop count (dflt:-1)&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotbeg&quot</span><span class="p">,</span>    <a href="#kBegWtId">kBegWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotFile begin sample index&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotend&quot</span><span class="p">,</span>    <a href="#kEndWtId">kEndWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotFile end sample index (-1=play all)&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotch&quot</span><span class="p">,</span>     <a href="#kChWtId">kChWtId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotFile channel index 0=left, 1=right&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotcmd&quot</span><span class="p">,</span>    <a href="#kCmdWtId">kCmdWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotCommand: on off&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotot&quot</span><span class="p">,</span>     <a href="#kOtWtId">kOtWtId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotOvertone count&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotgain&quot</span><span class="p">,</span>   <a href="#kGainWtId">kGainWtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">|</span><a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotGain&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotphs&quot</span><span class="p">,</span>    <a href="#kPhsWtId">kPhsWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>            <span class="l">&quotDriving phase&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>    <a href="#kOutWtId">kOutWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>            <span class="l">&quotAudio output&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotcnt&quot</span><span class="p">,</span>    <a href="#kCntWtId">kCntWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a><span class="p">,</span>                 <span class="l">&quotLoop count event.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfidx&quot</span><span class="p">,</span>   <a href="#kFIdxWtId">kFIdxWtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">,</span>                <span class="l">&quotCurrent audio file index.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotdone&quot</span><span class="p">,</span>   <a href="#kDoneWtId">kDoneWtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">,</span>                 <span class="l">&quot'done' sent after last loop.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// get the filename given in the va_list (or NULL if no filename was given)</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDefaultStrcz">cmDspDefaultStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFnWtId">kFnWtId</a><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>offSymId         <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotoff&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>onSymId          <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quoton&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>doneSymId        <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterStaticSymbol">cmSymTblRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><span class="l">&quotdone&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">double</span>  adCurFileIdxRptPeriodMs <span class="p">=</span> <span class="l">100.0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>minAfIndexRptCnt <span class="p">=</span> floor<span class="p">(</span>adCurFileIdxRptPeriodMs <span class="p">*</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">/</span> <span class="l">1000.0</span><span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kLenWtId">kLenWtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>    <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kShapeWtId">kShapeWtId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span>    <a href="#kSilenceWtId">kSilenceWtId</a>  <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFnWtId">kFnWtId</a><span class="p">,</span>    NULL<span class="p">,</span> fn <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultInt">cmDspSetDefaultInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kLoopWtId">kLoopWtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>    <span class="l">-1</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultInt">cmDspSetDefaultInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBegWtId">kBegWtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>     <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultInt">cmDspSetDefaultInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kEndWtId">kEndWtId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span>    <span class="l">-1</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kChWtId">kChWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>     <span class="l">0</span> <span class="p">)</span><span class="p">;</span>  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kCmdWtId">kCmdWtId</a><span class="p">,</span>   p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOtWtId">kOtWtId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span>     <span class="l">5</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kGainWtId">kGainWtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>     <span class="l">1.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kFIdxWtId">kFIdxWtId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>     <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>useThreadFl <span class="p">=</span> false<span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableFree_defn"></a><a name="_cmDspWaveTableFree"></a><span class="f">_cmDspWaveTableFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmThread_h_0.html#cmThreadIsValid">cmThreadIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>thH<span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmThread_h_0.html#cmThreadDestroy">cmThreadDestroy</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>thH<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmThread_h_0.html#kOkThRC">kOkThRC</a> <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kThreadFailDspRC">kThreadFailDspRC</a><span class="p">,</span><span class="l">&quotThe wavetable file reader thread failed to close.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span> <span class="p">)</span>
    <a href="cmAudioFile_h_0.html#cmAudioFileDelete">cmAudioFileDelete</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span><span class="p">;</span>
  
  <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<span class="c">// Read the next block of 'rdSmpCnt' samples starting at the absolute file index 'p-&ampgtfi'
// into wt[rdSmpCnt].
// If the end of the file segment marked by absolute file indexes 'begSmpIdx' to 'endSmpIdx'
// is encountered in the middle of the requested block and the wave table is in loop
// mode then the the function will automatically begin reading from the begining of the
// file segment.  If the end of the file segment is encountered and the wave table is not
// in loop mode then the empty portion of wt[] will be set to zero.</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableReadBlock_defn"></a><a name="_cmDspWaveTableReadBlock"></a><span class="f">_cmDspWaveTableReadBlock</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p<span class="p">,</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> wt<span class="p">,</span> <span class="k">unsigned</span> rdSmpCnt<span class="p">,</span> <span class="k">unsigned</span> chIdx<span class="p">,</span> <span class="k">int</span> begSmpIdx<span class="p">,</span> <span class="k">int</span> endSmpIdx<span class="p">,</span> <span class="k">int</span> maxLoopCnt  <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span>    actFrmCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">unsigned</span>    chCnt     <span class="p">=</span> <span class="l">1</span><span class="p">;</span>
  <span class="k">unsigned</span>    fn        <span class="p">=</span> endSmpIdx <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>fi <span class="p">+</span> <span class="l">1</span><span class="p">;</span> <span class="c"> // count of samples between p-&ampgtfi and endSmpIdx</span>
  <span class="k">unsigned</span>    n0        <span class="p">=</span> rdSmpCnt<span class="p">;</span>
  <span class="k">unsigned</span>    n1        <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="c">// if the requested sample count will go past the end of the file segment</span>
  <span class="k">if</span><span class="p">(</span> rdSmpCnt <span class="p">&gt</span> fn <span class="p">)</span>
  <span class="p">{</span>
    n1  <span class="p">=</span> rdSmpCnt <span class="p">-</span> fn<span class="p">;</span>
    n0  <span class="p">=</span> rdSmpCnt <span class="p">-</span> n1<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// if we don't have a valid file yet - then </span>
  <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span> <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
  <span class="p">{</span>
    cmVOS_Zero<span class="p">(</span>wt<span class="p">,</span>n0<span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// read the first block of samples</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileReadSample">cmAudioFileReadSample</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">,</span> n0<span class="p">,</span> chIdx<span class="p">,</span> chCnt<span class="p">,</span> <span class="p">&amp</span>wt<span class="p">,</span> <span class="p">&amp</span>actFrmCnt <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmAudioFile_h_0.html#kOkAfRC">kOkAfRC</a> <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotAn error occured while reading the wave table file.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// BUG BUG BUG
  // This assertion will fail if the file beg/end markers are not legal given the file length.
  // An error msg would be more appropriate.</span>  
  assert<span class="p">(</span> actFrmCnt <span class="p">=</span><span class="p">=</span> n0 <span class="p">)</span><span class="p">;</span>
  
  <span class="c">// increment the wave table pointer</span>
  wt     <span class="p">+</span><span class="p">=</span> n0<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>fi  <span class="p">+</span><span class="p">=</span> n0<span class="p">;</span>
  
  <span class="c">// if n1 != 0 then we have encountered the end of the file segment</span>
  <span class="k">if</span><span class="p">(</span> n1 <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="p">+</span><span class="p">+</span>p<span class="p">-</span><span class="p">&gt</span>loopCnt<span class="p">;</span>
    
    <span class="c">// send the loop count event</span>
    <a href="cmDspClass_h_0.html#cmDspSetInt">cmDspSetInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kCntWtId">kCntWtId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>loopCnt<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// if we have played all the requested loops</span>
    <span class="k">if</span><span class="p">(</span> maxLoopCnt <span class="p">!</span><span class="p">=</span> <span class="l">-1</span> <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>loopCnt <span class="p">&gt</span><span class="p">=</span> maxLoopCnt <span class="p">)</span>
    <span class="p">{</span>
      p<span class="p">-</span><span class="p">&gt</span>doneFl <span class="p">=</span> true<span class="p">;</span>
      cmVOS_Zero<span class="p">(</span>wt<span class="p">,</span>n1<span class="p">)</span><span class="p">;</span>   <span class="c"> // zero to the end of the buffer</span>
      
      p<span class="p">-</span><span class="p">&gt</span>cfn <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>cfi <span class="p">+</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">(</span><a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span><span class="p">)</span>p<span class="p">,</span><a href="#kLenWtId">kLenWtId</a><span class="p">)</span> <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>wtn <span class="p">-</span> n0<span class="p">;</span>
      assert<span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>cfn <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>cfi <span class="p">)</span><span class="p">;</span>
      
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="c">// seek to the first sample indicated by the 'beg' variable</span>
      <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileSeek">cmAudioFileSeek</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">,</span>begSmpIdx<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmAudioFile_h_0.html#kOkAfRC">kOkAfRC</a> <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotSeeking failed on the wave table file.&quot</span><span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
      
      <span class="c">// read the second block of samples</span>
      <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileReadSample">cmAudioFileReadSample</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">,</span> n1<span class="p">,</span> chIdx<span class="p">,</span> chCnt<span class="p">,</span> <span class="p">&amp</span>wt<span class="p">,</span> <span class="p">&amp</span>actFrmCnt <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmAudioFile_h_0.html#kOkAfRC">kOkAfRC</a> <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotAn error occured while reading the wave table file.&quot</span><span class="p">)</span><span class="p">;</span>
      
      assert<span class="p">(</span> actFrmCnt <span class="p">=</span><span class="p">=</span> n1 <span class="p">)</span><span class="p">;</span>
      
      <span class="c">// reset the file index tracker</span>
      p<span class="p">-</span><span class="p">&gt</span>fi  <span class="p">=</span> begSmpIdx <span class="p">+</span> n1<span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>cfi <span class="p">=</span> begSmpIdx<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableReadAudioFile_defn"></a><a name="_cmDspWaveTableReadAudioFile"></a><span class="f">_cmDspWaveTableReadAudioFile</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">unsigned</span> wtSmpCnt<span class="p">,</span> <span class="k">unsigned</span> rdSmpCnt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span>    n0        <span class="p">=</span> rdSmpCnt<span class="p">;</span>
  <span class="k">unsigned</span>    n1        <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">int</span>         begSmpIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kBegWtId">kBegWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">int</span>         endSmpIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kEndWtId">kEndWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>    chIdx     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kChWtId">kChWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">int</span>         maxLoopCnt<span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kLoopWtId">kLoopWtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> endSmpIdx <span class="p">&lt</span> begSmpIdx <span class="p">)</span>
    endSmpIdx <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>fn<span class="l">-1</span><span class="p">;</span>
  
  <span class="c">// if this read will wrap to the beginning of the wave table</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>wti <span class="p">+</span> rdSmpCnt <span class="p">&gt</span> wtSmpCnt <span class="p">)</span>
  <span class="p">{</span>
    n0 <span class="p">=</span> wtSmpCnt <span class="p">-</span> p<span class="p">-</span><span class="p">&gt</span>wti<span class="p">;</span>  <span class="c"> // count of samples to read into the end of p-&ampgtwt[]</span>
    n1 <span class="p">=</span> rdSmpCnt <span class="p">-</span> n0<span class="p">;</span>      <span class="c"> // count of samples to read into the beg of p-&ampgtwt[]</span>
  <span class="p">}</span>
  
  assert<span class="p">(</span>n1<span class="p">&lt</span>wtSmpCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// the first read always starts at p-&ampgtwt + p-&ampgtwti</span>
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>doneFl <span class="p">)</span>
    cmVOS_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>wti<span class="p">,</span>n0<span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">if</span><span class="p">(</span> <a href="#_cmDspWaveTableReadBlock">_cmDspWaveTableReadBlock</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">+</span>p<span class="p">-</span><span class="p">&gt</span>wti<span class="p">,</span> n0<span class="p">,</span> chIdx<span class="p">,</span> begSmpIdx<span class="p">,</span>endSmpIdx<span class="p">,</span>maxLoopCnt  <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotAn error occured while reading the wave table file.&quot</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>wtn <span class="p">-</span><span class="p">=</span> n0<span class="p">;</span>   <span class="c"> // decrease the count of available samples</span>
  p<span class="p">-</span><span class="p">&gt</span>wti <span class="p">+</span><span class="p">=</span> n0<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> n1 <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// the second read always starts at the beginning of the wave table</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>doneFl <span class="p">)</span>
      cmVOS_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>n1<span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">if</span><span class="p">(</span> <a href="#_cmDspWaveTableReadBlock">_cmDspWaveTableReadBlock</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span> n1<span class="p">,</span> chIdx<span class="p">,</span> begSmpIdx<span class="p">,</span>endSmpIdx<span class="p">,</span>maxLoopCnt  <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
        <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotAn error occured while reading the wave table file.&quot</span><span class="p">)</span><span class="p">;</span>
    
    p<span class="p">-</span><span class="p">&gt</span>wtn <span class="p">-</span><span class="p">=</span> n1<span class="p">;</span>  <span class="c"> // decrease the count of available samples</span>
    p<span class="p">-</span><span class="p">&gt</span>wti <span class="p">=</span> n1<span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="c">//p-&ampgtwtn -= rdSmpCnt;   // decrease the count of available samples</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableInitAudioFile_defn"></a><a name="_cmDspWaveTableInitAudioFile"></a><span class="f">_cmDspWaveTableInitAudioFile</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="cmAudioFile_h_0.html#cmAudioFileH_t">cmAudioFileH_t</a>    afH<span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmRC_t">cmRC_t</a>            afRC<span class="p">;</span>
  <a href="cmAudioFile_h_0.html#cmAudioFileInfo_t">cmAudioFileInfo_t</a> afInfo<span class="p">;</span>
  
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn       <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFnWtId">kFnWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>        wtSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kLenWtId">kLenWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">int</span>             begSmpIdx<span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kBegWtId">kBegWtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// if the file name is valid</span>
  <span class="k">if</span><span class="p">(</span> fn <span class="p">=</span><span class="p">=</span> NULL <span class="p">|</span><span class="p">|</span> strlen<span class="p">(</span>fn<span class="p">)</span><span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotAudio file loading was requested for the wave table but no file name was given.&quot</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// open the audio file</span>
  afH <span class="p">=</span> <a href="cmAudioFile_h_0.html#cmAudioFileNewOpen">cmAudioFileNewOpen</a><span class="p">(</span>fn<span class="p">,</span><span class="p">&amp</span>afInfo<span class="p">,</span><span class="p">&amp</span>afRC<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// check for file open errors</span>
  <span class="k">if</span><span class="p">(</span> afRC <span class="p">!</span><span class="p">=</span> <a href="cmAudioFile_h_0.html#kOkAfRC">kOkAfRC</a> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span>  <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe audio file '%s' could not be opened. ('%s').&quot</span><span class="p">,</span>fn<span class="p">,</span><a href="cmAudioFile_h_0.html#cmAudioFileErrorMsg">cmAudioFileErrorMsg</a><span class="p">(</span>afRC<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// if the file opened but is invalid</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileIsValid">cmAudioFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span> <span class="p">)</span>
    <a href="cmAudioFile_h_0.html#cmAudioFileDelete">cmAudioFileDelete</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>afH<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// seek to the first sample indicated by the 'beg' variable</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmAudioFile_h_0.html#cmAudioFileSeek">cmAudioFileSeek</a><span class="p">(</span>afH<span class="p">,</span>begSmpIdx<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmAudioFile_h_0.html#kOkAfRC">kOkAfRC</a> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotSeeking failed on the audio file '%s'.&quot</span><span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
    goto errLabel<span class="p">;</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>afH <span class="p">=</span> afH<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>fi  <span class="p">=</span> begSmpIdx<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>cfi <span class="p">=</span> begSmpIdx<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>fn  <span class="p">=</span> afInfo<span class="p">.</span>frameCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>wti <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>wtn <span class="p">=</span> wtSmpCnt<span class="p">;</span>
  
  <span class="c">// read the first block of samples</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc<span class="p">=</span> <a href="#_cmDspWaveTableReadAudioFile">_cmDspWaveTableReadAudioFile</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span>wtSmpCnt<span class="p">,</span>wtSmpCnt<span class="p">)</span><span class="p">)</span><span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    goto errLabel<span class="p">;</span>
  
  <span class="c">//printf(&ampquotWt:%s %i %i\n&ampquot,fn,begSmpIdx,<a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a>(&ampampp-&ampgtinst,<a href="#kEndWtId">kEndWtId</a>));</span>
  
  <span class="c">// set the shape param to <a href="#kFileWtId">kFileWtId</a>
  //if((rc= <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a>(ctx,&ampampp-&ampgtinst,<a href="#kShapeWtId">kShapeWtId</a>,<a href="#kFileWtId">kFileWtId</a>)) != <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> )
  //  goto errLabel;</span>  
  
  errLabel<span class="p">:</span>
  
  <span class="k">if</span><span class="p">(</span> rc <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kShapeWtId">kShapeWtId</a><span class="p">,</span><a href="#kSilenceWtId">kSilenceWtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<span class="k">bool</span> <a name="_cmDspWaveTableThreadFunc_defn"></a><span class="f"><a href="#_cmDspWaveTableThreadFunc">_cmDspWaveTableThreadFunc</a></span><span class="p">(</span> <span class="k">void</span><span class="p">*</span> param<span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span><span class="p">)</span>param<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>loadFileFl <span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>loadFileFl <span class="p">=</span> false<span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> <a href="#_cmDspWaveTableInitAudioFile">_cmDspWaveTableInitAudioFile</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">,</span>p<span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="p">{</span>
      p<span class="p">-</span><span class="p">&gt</span>phsOffs <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>phsLast<span class="p">;</span>
      <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kShapeWtId">kShapeWtId</a><span class="p">,</span><a href="#kFileWtId">kFileWtId</a><span class="p">)</span><span class="p">;</span>
      
    <span class="p">}</span>
    
    <a href="cmThread_h_0.html#cmThreadPause">cmThreadPause</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>thH<span class="p">,</span><a href="cmThread_h_0.html#kPauseThFl">kPauseThFl</a><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> true<span class="p">;</span>
<span class="p">}</span>

<span class="c">// Files are loaded via a background thread.</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableStartFileLoadThread_defn"></a><a name="_cmDspWaveTableStartFileLoadThread"></a><span class="f">_cmDspWaveTableStartFileLoadThread</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> fn <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>loadFileFl <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidStateDspRC">kInvalidStateDspRC</a><span class="p">,</span><span class="l">&quotThe audio file '%s' was not loaded because another file is in the process of being loaded.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>fn<span class="p">)</span><span class="p">)</span><span class="p">;</span>  
  
  <span class="k">if</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>useThreadFl <span class="p">&amp</span><span class="p">&amp</span> <a href="cmThread_h_0.html#cmThreadIsValid">cmThreadIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>thH<span class="p">)</span> <span class="p">=</span><span class="p">=</span> false<span class="p">)</span>
    <a href="cmThread_h_0.html#cmThreadCreate">cmThreadCreate</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>thH<span class="p">,</span><a href="#_cmDspWaveTableThreadFunc">_cmDspWaveTableThreadFunc</a><span class="p">,</span>p<span class="p">,</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>useThreadFl <span class="p">&amp</span><span class="p">&amp</span> <a href="cmThread_h_0.html#cmThreadIsValid">cmThreadIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>thH<span class="p">)</span> <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidStateDspRC">kInvalidStateDspRC</a><span class="p">,</span><span class="l">&quotThe audio file '%s' was not loaded because the audio load thread is invalid.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>fn<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>loadFileFl <span class="p">=</span> true<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>ctx        <span class="p">=</span> ctx<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kShapeWtId">kShapeWtId</a><span class="p">,</span><a href="#kSilenceWtId">kSilenceWtId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetStrcz">cmDspSetStrcz</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFnWtId">kFnWtId</a><span class="p">,</span>fn<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>useThreadFl <span class="p">=</span><span class="p">=</span> false <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// use non-threaded load</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="#_cmDspWaveTableInitAudioFile">_cmDspWaveTableInitAudioFile</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kVarNotValidDspRC">kVarNotValidDspRC</a><span class="p">,</span><span class="l">&quotThe audio file '%s' was not loaded.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>fn<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    p<span class="p">-</span><span class="p">&gt</span>phsOffs <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>phsLast<span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kShapeWtId">kShapeWtId</a><span class="p">,</span><a href="#kFileWtId">kFileWtId</a><span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>loadFileFl <span class="p">=</span> false<span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c">// use threaded load - this works but it isn't really thread safe</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmThread_h_0.html#cmThreadPause">cmThreadPause</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>thH<span class="p">,</span><span class="l">0</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmThread_h_0.html#kOkThRC">kOkThRC</a> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kThreadFailDspRC">kThreadFailDspRC</a><span class="p">,</span><span class="l">&quotThe audio file '%s' was not loaded because audio thread enable failed.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>fn<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<span class="c">// This function is called whenever the source mode variable changes (or a new file name arrives)</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableCreateTable_defn"></a><a name="_cmDspWaveTableCreateTable"></a><span class="f">_cmDspWaveTableCreateTable</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc       <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">unsigned</span>  shapeId  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kShapeWtId">kShapeWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>  wtSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kLenWtId">kLenWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>  otCnt    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kOtWtId">kOtWtId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a> gain    <span class="p">=</span> <span class="l">0.9</span><span class="p">;</span>
  <span class="k">double</span>     hz      <span class="p">=</span> <span class="l">1.0</span><span class="p">;</span>
  <span class="k">double</span>     sr      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  
  assert<span class="p">(</span> wtSmpCnt <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>wt <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    p<span class="p">-</span><span class="p">&gt</span>wt           <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhResizeNZ">cmLhResizeNZ</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
    cmVOS_Zero<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>wtn          <span class="p">=</span> wtSmpCnt<span class="p">;</span>  <span class="c"> // all samples in the wt are avail for filling</span>
  p<span class="p">-</span><span class="p">&gt</span>wti          <span class="p">=</span> <span class="l">0</span><span class="p">;</span>         <span class="c"> // beginning with the first sample</span>
  p<span class="p">-</span><span class="p">&gt</span>loopCnt      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>         <span class="c"> // we are starting from a new source so set the loop cnt to 0</span>
  p<span class="p">-</span><span class="p">&gt</span>doneFl       <span class="p">=</span> false<span class="p">;</span>     <span class="c"> // and the doneFl to false</span>
  
  assert<span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>wt <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> shapeId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kSilenceWtId">kSilenceWtId</a><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kFileWtId">kFileWtId</a><span class="p">:</span>
    printf<span class="p">(</span><span class="l">&quotLoading:%i %i %s\n&quot</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nxtBegSmpIdx<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nxtEndSmpIdx<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFnWtId">kFnWtId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    rc <span class="p">=</span> <a href="#_cmDspWaveTableStartFileLoadThread">_cmDspWaveTableStartFileLoadThread</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFnWtId">kFnWtId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kWhiteWtId">kWhiteWtId</a><span class="p">:</span>
    cmVOS_Random<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="p">-</span>gain<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPinkWtId">kPinkWtId</a><span class="p">:</span>
    cmVOS_SynthPinkNoise<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSineWtId">kSineWtId</a><span class="p">:</span>
    cmVOS_SynthSine<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span>sr<span class="p">,</span>hz<span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kCosWtId">kCosWtId</a><span class="p">:</span>
    cmVOS_SynthCosine<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span>sr<span class="p">,</span>hz<span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSawWtId">kSawWtId</a><span class="p">:</span>
    cmVOS_SynthSawtooth<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt<span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kSqrWtId">kSqrWtId</a><span class="p">:</span>
    cmVOS_SynthSquare<span class="p">(</span>    p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt <span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kTriWtId">kTriWtId</a><span class="p">:</span>
    cmVOS_SynthTriangle<span class="p">(</span>  p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt <span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPulseWtId">kPulseWtId</a><span class="p">:</span>
    cmVOS_SynthPulseCos<span class="p">(</span>  p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span>sr<span class="p">,</span>hz<span class="p">,</span>otCnt <span class="p">)</span><span class="p">;</span>
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPhasorWtId">kPhasorWtId</a><span class="p">:</span>
    cmVOS_SynthPhasor<span class="p">(</span>    p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span>sr<span class="p">,</span>hz <span class="p">)</span><span class="p">;</span> 
    cmVOS_MultVS<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">,</span>wtSmpCnt<span class="p">,</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
    
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableReset_defn"></a><a name="_cmDspWaveTableReset"></a><span class="f">_cmDspWaveTableReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutWtId">kOutWtId</a><span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>nxtBegSmpIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kBegWtId">kBegWtId</a><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nxtEndSmpIdx <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kEndWtId">kEndWtId</a><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>nxtChIdx     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kChWtId">kChWtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="#_cmDspWaveTableCreateTable">_cmDspWaveTableCreateTable</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableExec_defn"></a><a name="_cmDspWaveTableExec"></a><span class="f">_cmDspWaveTableExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>         rc       <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> phsV     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kPhsWtId">kPhsWtId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> phsV <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    inst<span class="p">-</span><span class="p">&gt</span>execFunc <span class="p">=</span> NULL<span class="p">;</span> <span class="c"> // disable this instance because it has no input</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  
  <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p        <span class="p">=</span> <span class="p">(</span><a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">unsigned</span>          mode     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kCmdWtId">kCmdWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          srcId    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kShapeWtId">kShapeWtId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> mode <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>offSymId <span class="p">|</span><span class="p">|</span> srcId <span class="p">=</span><span class="p">=</span> <a href="#kSilenceWtId">kSilenceWtId</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutWtId">kOutWtId</a><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       outV     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutWtId">kOutWtId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          outCnt   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutWtId">kOutWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          wtSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kLenWtId">kLenWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>            gain     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kGainWtId">kGainWtId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          i<span class="p">;</span>
  
  <span class="c">// for each output sample</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>outCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the wave table location
    //unsigned x = fmodf(phsV[i] - p-&ampgtphsOffs,wtSmpCnt);</span>    
    <span class="k">unsigned</span> x <span class="p">=</span> fmodf<span class="p">(</span>phsV<span class="p">[</span>i<span class="p">]</span><span class="p">,</span>wtSmpCnt<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// if the wt loctn is passed the end of the table
    //
    //if( x &ampgt= wtSmpCnt )
    //{
    //  offs += wtSmpCnt;
    //  x    -= wtSmpCnt;
    //}
    //</span>    
    <span class="c">//    </span>
    
    outV<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> gain <span class="p">*</span> p<span class="p">-</span><span class="p">&gt</span>wt<span class="p">[</span>x<span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>phsLast <span class="p">=</span> phsV<span class="p">[</span>outCnt<span class="l">-1</span><span class="p">]</span><span class="p">;</span>
  
  <span class="c">// if we are reading from a file ...</span>
  <span class="k">if</span><span class="p">(</span> srcId <span class="p">=</span><span class="p">=</span> <a href="#kFileWtId">kFileWtId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> rdSmpCnt <span class="p">=</span> <span class="l">8192</span><span class="p">;</span> <span class="c"> // file read block sample count</span>
    
    p<span class="p">-</span><span class="p">&gt</span>wtn <span class="p">+</span><span class="p">=</span> outCnt<span class="p">;</span>
    
    <span class="c">// ... and there are rdSmpCnt avail locations in the wave table</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>wtn <span class="p">&gt</span><span class="p">=</span> rdSmpCnt <span class="p">)</span>
      rc <span class="p">=</span>  <a href="#_cmDspWaveTableReadAudioFile">_cmDspWaveTableReadAudioFile</a><span class="p">(</span>ctx<span class="p">,</span> p<span class="p">,</span> wtSmpCnt<span class="p">,</span> rdSmpCnt <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// send the current audio file index</span>
    <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>doneFl <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>cfi <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>cfn <span class="p">&amp</span><span class="p">&amp</span> p<span class="p">-</span><span class="p">&gt</span>cfn <span class="p">&lt</span><span class="p">=</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>cfi <span class="p">+</span> outCnt<span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kFIdxWtId">kFIdxWtId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>cfn<span class="p">)</span><span class="p">;</span>
      <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kDoneWtId">kDoneWtId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>doneSymId<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>afIndexRptCnt <span class="p">&gt</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>minAfIndexRptCnt <span class="p">)</span>
      <span class="p">{</span>
        p<span class="p">-</span><span class="p">&gt</span>afIndexRptCnt <span class="p">-</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>minAfIndexRptCnt<span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kFIdxWtId">kFIdxWtId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>cfi<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    p<span class="p">-</span><span class="p">&gt</span>afIndexRptCnt <span class="p">+</span><span class="p">=</span> outCnt<span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>cfi           <span class="p">+</span><span class="p">=</span> outCnt<span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspWaveTableRecv_defn"></a><a name="_cmDspWaveTableRecv"></a><span class="f">_cmDspWaveTableRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspWaveTable_t">cmDspWaveTable_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kFnWtId">kFnWtId</a><span class="p">:</span> <span class="c"> // a new file name arrived - this automatically switches the source mode to <a href="#kFileWtId">kFileWtId</a></span>
    <span class="p">{</span>
      <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvStrz">cmDsvStrz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span> 
      
      <span class="k">if</span><span class="p">(</span> <a href="cmFileSys_h_0.html#cmFsIsFile">cmFsIsFile</a><span class="p">(</span> fn <span class="p">)</span><span class="p">=</span><span class="p">=</span>false <span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quot'%s' does not exist.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>fn<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>                       <span class="c"> // set the file name variable</span>
        <a href="cmDspClass_h_0.html#cmDspSetInt">cmDspSetInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBegWtId">kBegWtId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nxtBegSmpIdx<span class="p">)</span><span class="p">;</span>    <span class="c"> // set the beg/end smp idx var's from the stored nxtBeg/EndSmpIdx values</span>
        <a href="cmDspClass_h_0.html#cmDspSetInt">cmDspSetInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kEndWtId">kEndWtId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>nxtEndSmpIdx<span class="p">)</span><span class="p">;</span>    <span class="c"> </span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kChWtId">kChWtId</a><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>nxtChIdx<span class="p">)</span><span class="p">;</span>       <span class="c"> </span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kShapeWtId">kShapeWtId</a><span class="p">,</span><a href="#kFileWtId">kFileWtId</a><span class="p">)</span><span class="p">;</span>       <span class="c"> // switch to file mode </span>
        rc <span class="p">=</span> <a href="#_cmDspWaveTableCreateTable">_cmDspWaveTableCreateTable</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>            <span class="c"> // reload the wavetable</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kBegWtId">kBegWtId</a><span class="p">:</span>
    <span class="c">// store for next incoming file name msg</span>
    p<span class="p">-</span><span class="p">&gt</span>nxtBegSmpIdx <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetInt">cmDsvGetInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kEndWtId">kEndWtId</a><span class="p">:</span>
    <span class="c">// store for next incoming file name msg</span>
    p<span class="p">-</span><span class="p">&gt</span>nxtEndSmpIdx <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetInt">cmDsvGetInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kChWtId">kChWtId</a><span class="p">:</span>
    <span class="c">// store for next incoming file name msg</span>
    p<span class="p">-</span><span class="p">&gt</span>nxtChIdx <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kShapeWtId">kShapeWtId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvGetUInt">cmDsvGetUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">&lt</span> <a href="#kShapeWtCnt">kShapeWtCnt</a> <span class="p">)</span>
    <span class="p">{</span>
      <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>            <span class="c"> // switch modes</span>
      rc <span class="p">=</span> <a href="#_cmDspWaveTableCreateTable">_cmDspWaveTableCreateTable</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span> <span class="c"> // reload the wavetable</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kLenWtId">kLenWtId</a><span class="p">:</span> <span class="c"> // we don't support table size changes </span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kPhsWtId">kPhsWtId</a><span class="p">:</span>    
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kCmdWtId">kCmdWtId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span>inst<span class="p">,</span><a href="#kCmdWtId">kCmdWtId</a><span class="p">)</span> <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>onSymId <span class="p">)</span>
      <span class="p">{</span>
        <span class="c">//rc = <a href="#_cmDspWaveTableReset">_cmDspWaveTableReset</a>(ctx,inst, evt );</span>
        rc <span class="p">=</span>  <a href="#_cmDspWaveTableCreateTable">_cmDspWaveTableCreateTable</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
        
        <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kCmdWtId">kCmdWtId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>onSymId<span class="p">)</span><span class="p">;</span>
        p<span class="p">-</span><span class="p">&gt</span>phsOffs <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
        p<span class="p">-</span><span class="p">&gt</span>phsLast <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kOtWtId">kOtWtId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      rc <span class="p">=</span> <a href="#_cmDspWaveTableCreateTable">_cmDspWaveTableCreateTable</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span> <span class="c"> // reload the wavetable</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kGainWtId">kGainWtId</a><span class="p">:</span>
    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>



<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmWaveTableClassCons_defn"></a><a name="cmWaveTableClassCons"></a><span class="f">cmWaveTableClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmWaveTableDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotWaveTable&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspWaveTableAlloc">_cmDspWaveTableAlloc</a><span class="p">,</span>
  <a href="#_cmDspWaveTableFree">_cmDspWaveTableFree</a><span class="p">,</span>
  <a href="#_cmDspWaveTableReset">_cmDspWaveTableReset</a><span class="p">,</span>
  <a href="#_cmDspWaveTableExec">_cmDspWaveTableExec</a><span class="p">,</span>
  <a href="#_cmDspWaveTableRecv">_cmDspWaveTableRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotVariable frequency and waveshape signal generator.&quot</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmWaveTableDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspSprintf : Printf like string formatting unit.</div><pre><a name="cmDspSprintf"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kFmtSpId"></a><span class="e">kFmtSpId</span><span class="p">,</span>
  <a name="kOutSpId"></a><span class="e">kOutSpId</span><span class="p">,</span>
  <a name="kInSpId"></a><span class="e">kInSpId</span><span class="p">,</span>
  
  <a name="kSprintfLabelCharCnt"></a><span class="e">kSprintfLabelCharCnt</span> <span class="p">=</span> <span class="l">15</span><span class="p">,</span>
  <a name="kSprintfDocCharCnt"></a><span class="e">kSprintfDocCharCnt</span>   <span class="p">=</span> <span class="l">31</span><span class="p">,</span>
  <a name="kSprintfBufCharCnt"></a><span class="e">kSprintfBufCharCnt</span>   <span class="p">=</span> <span class="l">1023</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmSprintfDC<span class="p">;</span>

<a name="cmDspSprintfFmt_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="k">unsigned</span>  <a name="cmDspSprintfFmt_t.flags"></a><span class="i">flags</span><span class="p">;</span>  <span class="c"> // dsv type id for this fmt conversion or 0 if it is a literal string</span>
  <span class="k">unsigned</span>  <a name="cmDspSprintfFmt_t.fsi"></a><span class="i">fsi</span><span class="p">;</span> <span class="c"> // index into the fmt string where the fmt starts (always points to an '%' char)</span>
  <span class="k">unsigned</span>  <a name="cmDspSprintfFmt_t.fsn"></a><span class="i">fsn</span><span class="p">;</span> <span class="c"> // length of the format string </span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a>  <span class="i">label</span><span class="p">[</span> <a href="#kSprintfLabelCharCnt">kSprintfLabelCharCnt</a><span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a>  <a name="cmDspSprintfFmt_t.doc"></a><span class="i">doc</span><span class="p">[</span>   <a href="#kSprintfDocCharCnt">kSprintfDocCharCnt</a><span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspSprintfFmt_t">cmDspSprintfFmt_t</a></span><span class="p">;</span>

<a name="cmDspSprintf_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>        <a name="cmDspSprintf_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a>           <a name="cmDspSprintf_t.buf"></a><span class="i">buf</span><span class="p">[</span> <a href="#kSprintfBufCharCnt">kSprintfBufCharCnt</a><span class="p">+</span><span class="l">1</span><span class="p">]</span><span class="p">;</span> <span class="c"> // output string buffer</span>
  <span class="k">unsigned</span>           <a name="cmDspSprintf_t.inCnt"></a><span class="i">inCnt</span><span class="p">;</span>       <span class="c"> // count conversion spec's in the fmtStr[]</span>
  <a href="#cmDspSprintfFmt_t">cmDspSprintfFmt_t</a><span class="p">*</span> <a name="cmDspSprintf_t.fmtArray"></a><span class="i">fmtArray</span><span class="p">;</span>    <span class="c"> // fmtArray[inCnt] </span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span>          <a name="cmDspSprintf_t.fmtStr"></a><span class="i">fmtStr</span><span class="p">;</span>      <span class="c"> // C-style printf format string.</span>
<span class="p">}</span> <span class="t"><a href="#cmDspSprintf_t">cmDspSprintf_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmSprintfGetInputCnt_defn"></a><a name="_cmSprintfGetInputCnt"></a><span class="f">_cmSprintfGetInputCnt</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fmt<span class="p">,</span> <span class="k">unsigned</span><span class="p">*</span> inCntPtr <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> i<span class="p">,</span>n<span class="p">;</span>
  <span class="k">unsigned</span> inCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> fmt<span class="p">=</span><span class="p">=</span> NULL <span class="p">|</span><span class="p">|</span> <span class="p">(</span>n<span class="p">=</span>strlen<span class="p">(</span>fmt<span class="p">)</span><span class="p">)</span><span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotEmpty format string.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>n<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// handle the escape character</span>
    <span class="k">if</span><span class="p">(</span> fmt<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <span class="p">'</span><span class="p">\</span><span class="p">\</span><span class="p">'</span> <span class="p">)</span>
      <span class="p">+</span><span class="p">+</span>i<span class="p">;</span> <span class="c"> // for now we will just skip the next character</span>
    <span class="k">else</span>
      <span class="k">if</span><span class="p">(</span> fmt<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <span class="l">'%'</span> <span class="p">)</span>
        <span class="p">+</span><span class="p">+</span>inCnt<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="p">*</span>inCntPtr <span class="p">=</span> inCnt<span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmSprintfGetInputTypes_defn"></a><a name="_cmSprintfGetInputTypes"></a><span class="f">_cmSprintfGetInputTypes</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fmt<span class="p">,</span> <a href="#cmDspSprintfFmt_t">cmDspSprintfFmt_t</a> fmtArray<span class="p">[</span><span class="p">]</span><span class="p">,</span> <span class="k">unsigned</span> inCnt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> i<span class="p">,</span>j<span class="p">,</span>n<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> fmt<span class="p">=</span><span class="p">=</span> NULL <span class="p">|</span><span class="p">|</span> <span class="p">(</span>n<span class="p">=</span>strlen<span class="p">(</span>fmt<span class="p">)</span><span class="p">)</span><span class="p">=</span><span class="p">=</span><span class="l">0</span> <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotEmpty format string.&quot</span><span class="p">)</span><span class="p">;</span>
  
  n <span class="p">=</span> strlen<span class="p">(</span>fmt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">,</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>n<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// handle the escape character</span>
    <span class="k">if</span><span class="p">(</span> fmt<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <span class="p">'</span><span class="p">\</span><span class="p">\</span><span class="p">'</span> <span class="p">)</span>
      <span class="p">+</span><span class="p">+</span>i<span class="p">;</span> <span class="c"> // for now we will just skip the next character</span>
    <span class="k">else</span>
      <span class="k">if</span><span class="p">(</span> fmt<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span><span class="p">=</span> <span class="l">'%'</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> fn<span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="p">(</span>fn <span class="p">=</span> strcspn<span class="p">(</span>fmt<span class="p">+</span>i<span class="p">,</span><span class="l">&quotdiouxXfeEgGcs&quot</span><span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
        <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotInvalid format string on input conversion at index:%i.&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
      
      <span class="p">+</span><span class="p">+</span>fn<span class="p">;</span>
      
      fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>fsi <span class="p">=</span> i<span class="p">;</span>
      fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>fsn <span class="p">=</span> fn<span class="p">;</span>
      
      snprintf<span class="p">(</span>fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>label<span class="p">,</span><a href="#kSprintfLabelCharCnt">kSprintfLabelCharCnt</a><span class="p">,</span><span class="l">&quotin-%i&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
      
      fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>label<span class="p">[</span><a href="#kSprintfLabelCharCnt">kSprintfLabelCharCnt</a><span class="p">]</span><span class="p">=</span><span class="l">0</span><span class="p">;</span>
      fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc<span class="p">[</span><a href="#kSprintfDocCharCnt">kSprintfDocCharCnt</a><span class="p">]</span> <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      
      <span class="k">switch</span><span class="p">(</span> fmt<span class="p">[</span> i <span class="p">+</span> fn <span class="p">-</span> <span class="l">1</span> <span class="p">]</span> <span class="p">)</span>
      <span class="p">{</span>
      <span class="k">case</span> <span class="l">'d'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'i'</span><span class="p">:</span>
        fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">=</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a><span class="p">;</span>
        snprintf<span class="p">(</span>fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc<span class="p">,</span><a href="#kSprintfDocCharCnt">kSprintfDocCharCnt</a><span class="p">,</span><span class="l">&quotInteger input %i.&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">case</span> <span class="l">'o'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'u'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'x'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'X'</span><span class="p">:</span>
        fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">=</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">;</span>
        snprintf<span class="p">(</span>fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc<span class="p">,</span><a href="#kSprintfDocCharCnt">kSprintfDocCharCnt</a><span class="p">,</span><span class="l">&quotUnsigned input %i.&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">case</span> <span class="l">'f'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'e'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'E'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'g'</span><span class="p">:</span>
      <span class="k">case</span> <span class="l">'G'</span><span class="p">:</span>
        fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">=</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">;</span>
        snprintf<span class="p">(</span>fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc<span class="p">,</span><a href="#kSprintfDocCharCnt">kSprintfDocCharCnt</a><span class="p">,</span><span class="l">&quotDouble input %i.&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">case</span> <span class="l">'c'</span><span class="p">:</span>
        fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">=</span> <a href="cmDspValue_h_0.html#kUCharDsvFl">kUCharDsvFl</a><span class="p">;</span>
        snprintf<span class="p">(</span>fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc<span class="p">,</span><a href="#kSprintfDocCharCnt">kSprintfDocCharCnt</a><span class="p">,</span><span class="l">&quotUnsigned char input %i.&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">case</span> <span class="l">'s'</span><span class="p">:</span>
        fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags <span class="p">=</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">;</span>
        snprintf<span class="p">(</span>fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc<span class="p">,</span><a href="#kSprintfDocCharCnt">kSprintfDocCharCnt</a><span class="p">,</span><span class="l">&quotString input %i.&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
        
      <span class="k">default</span><span class="p">:</span>
        <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
        
      <span class="p">}</span>
      
      i <span class="p">+</span><span class="p">=</span> fn <span class="p">-</span> <span class="l">1</span><span class="p">;</span>
      
      <span class="p">+</span><span class="p">+</span>j<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>  
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmSprintfLoadFormat_defn"></a><a name="_cmSprintfLoadFormat"></a><span class="f">_cmSprintfLoadFormat</span><span class="p">(</span><a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span><span class="p">*</span> pp<span class="p">,</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span><span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>          rc<span class="p">;</span>
  <span class="k">unsigned</span>           i<span class="p">,</span>j<span class="p">;</span>
  va_list            vl2<span class="p">;</span>
  <span class="k">unsigned</span>           inCnt       <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">unsigned</span>           fixedArgCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span>    p           <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span>    fmt         <span class="p">=</span> NULL<span class="p">;</span> 
  <a href="#cmDspSprintfFmt_t">cmDspSprintfFmt_t</a><span class="p">*</span> fmtArray    <span class="p">=</span> NULL<span class="p">;</span>
  
  va_copy<span class="p">(</span>vl2<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="p">*</span>pp <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span>
    fmt <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <span class="k">char</span><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">|</span><span class="p">|</span> fmt <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotExpected the format string as the first argument.&quot</span><span class="p">)</span><span class="p">;</span>
  
  
  <span class="c">// calc the number of fixed args</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> args<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label <span class="p">!</span><span class="p">=</span> NULL<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <span class="p">+</span><span class="p">+</span>fixedArgCnt<span class="p">;</span>
  
  <span class="c">// calc the count of input args</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="#_cmSprintfGetInputCnt">_cmSprintfGetInputCnt</a><span class="p">(</span>ctx<span class="p">,</span> classPtr<span class="p">,</span> fmt<span class="p">,</span> <span class="p">&amp</span>inCnt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> inCnt <span class="p">&gt</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    fmtArray <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhAllocZ">cmLhAllocZ</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span> <a href="#cmDspSprintfFmt_t">cmDspSprintfFmt_t</a><span class="p">,</span> inCnt <span class="p">)</span><span class="p">;</span>
    
    rc <span class="p">=</span> <a href="#_cmSprintfGetInputTypes">_cmSprintfGetInputTypes</a><span class="p">(</span>ctx<span class="p">,</span> classPtr<span class="p">,</span> fmt<span class="p">,</span> fmtArray<span class="p">,</span> inCnt <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> rc <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span>      argCnt <span class="p">=</span> fixedArgCnt <span class="p">+</span> inCnt<span class="p">;</span>
    <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> argArray<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
    
    <span class="c">// copy in fixed args</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>fixedArgCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      argArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> args<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
    
    <span class="c">// calc input args</span>
    <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>argCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">,</span><span class="p">+</span><span class="p">+</span>j<span class="p">)</span>
    <span class="p">{</span>
      argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label   <span class="p">=</span> fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>label<span class="p">;</span>
      argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>constId <span class="p">=</span> i<span class="p">;</span>
      argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>rn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>cn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
      argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>flags   <span class="p">=</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>flags<span class="p">;</span>
      argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>doc     <span class="p">=</span> fmtArray<span class="p">[</span>j<span class="p">]</span><span class="p">.</span>doc<span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c">// set the sentinel arg to all zeros</span>
    memset<span class="p">(</span>argArray <span class="p">+</span> argCnt<span class="p">,</span><span class="l">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>argArray<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl2<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      <span class="c">// make a copy of the format string - we need to be sure that it is in
      // r/w memory in order that <a href="#_cmDspSprintfGenString">_cmDspSprintfGenString</a>() can write to it</span>      
      p<span class="p">-</span><span class="p">&gt</span>fmtStr <span class="p">=</span> <a href="cmLinkedHeap_h_0.html#cmLhResizeN">cmLhResizeN</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>fmtStr<span class="p">,</span>strlen<span class="p">(</span>fmt<span class="p">)</span><span class="p">+</span><span class="l">1</span><span class="p">)</span><span class="p">;</span>
      strcpy<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fmtStr<span class="p">,</span>fmt<span class="p">)</span><span class="p">;</span>
      
      
      <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>fmtArray<span class="p">)</span><span class="p">;</span>
      p<span class="p">-</span><span class="p">&gt</span>fmtArray <span class="p">=</span> fmtArray<span class="p">;</span>
      
      p<span class="p">-</span><span class="p">&gt</span>inCnt <span class="p">=</span> inCnt<span class="p">;</span>
      memset<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">,</span><span class="l">0</span><span class="p">,</span><a href="#kSprintfBufCharCnt">kSprintfBufCharCnt</a><span class="p">+</span><span class="l">1</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="p">*</span>pp <span class="p">=</span> p<span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmErr_h_0.html#cmErrLastRC">cmErrLastRC</a><span class="p">(</span><span class="p">&amp</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">)</span> <span class="p">!</span><span class="p">=</span>  <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>fmtArray<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSprintfGenString_defn"></a><a name="_cmDspSprintfGenString"></a><span class="f">_cmDspSprintfGenString</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span> p <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>   rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="k">unsigned</span>    fsi <span class="p">=</span> <span class="l">0</span><span class="p">;</span>                   <span class="c"> // format string index</span>
  <span class="k">unsigned</span>    i   <span class="p">=</span> <span class="l">0</span><span class="p">;</span>                   <span class="c"> // fmtArray[] index</span>
  <span class="k">unsigned</span>    bi  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>                   <span class="c"> // string buffer index</span>
  <span class="k">unsigned</span>    bn  <span class="p">=</span> <a href="#kSprintfBufCharCnt">kSprintfBufCharCnt</a><span class="p">;</span>  <span class="c"> // available char's in the string buffer</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span>   fmt <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>fmtStr<span class="p">;</span>
  <span class="k">unsigned</span>    fn  <span class="p">=</span> strlen<span class="p">(</span>fmt<span class="p">)</span><span class="p">+</span><span class="l">1</span><span class="p">;</span>
  
  <span class="c">// for each </span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>inCnt <span class="p">&amp</span><span class="p">&amp</span> bn<span class="p">&gt</span><span class="l">0</span><span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <a href="#cmDspSprintfFmt_t">cmDspSprintfFmt_t</a><span class="p">*</span> f      <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>fmtArray <span class="p">+</span> i<span class="p">;</span>
    <span class="k">unsigned</span>                 varId  <span class="p">=</span> <a href="#kInSpId">kInSpId</a> <span class="p">+</span> i<span class="p">;</span>
    <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspVar_t">cmDspVar_t</a><span class="p">*</span>        varPtr <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarIdToCPtr">cmDspVarIdToCPtr</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> varId<span class="p">)</span><span class="p">;</span>
    
    assert<span class="p">(</span>varPtr <span class="p">!</span><span class="p">=</span> NULL<span class="p">)</span><span class="p">;</span>
    
    <span class="c">// if there are literal char's to copy prior to the format</span>
    <span class="k">if</span><span class="p">(</span> fsi <span class="p">&lt</span> f<span class="p">-</span><span class="p">&gt</span>fsi <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> cn <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span>f<span class="p">-</span><span class="p">&gt</span>fsi<span class="p">-</span>fsi<span class="p">,</span>bn<span class="p">)</span><span class="p">;</span>
      strncpy<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">+</span>bi<span class="p">,</span>fmt<span class="p">+</span>fsi<span class="p">,</span>cn<span class="p">)</span><span class="p">;</span>
      bn  <span class="p">-</span><span class="p">=</span> cn<span class="p">;</span>
      fsi <span class="p">+</span><span class="p">=</span> cn<span class="p">;</span>
      bi  <span class="p">+</span><span class="p">=</span> cn<span class="p">;</span>
    <span class="p">}</span> 
    
    <span class="k">if</span><span class="p">(</span> bn <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
    <span class="p">{</span>
      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe internal string buffer is too small.&quot</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">unsigned</span> pn <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    <span class="k">char</span>     c  <span class="p">=</span> fmt<span class="p">[</span> f<span class="p">-</span><span class="p">&gt</span>fsi <span class="p">+</span> f<span class="p">-</span><span class="p">&gt</span>fsn <span class="p">]</span><span class="p">;</span>
    
    <span class="c">// zero terminate the format string for this input</span>
    fmt<span class="p">[</span> f<span class="p">-</span><span class="p">&gt</span>fsi <span class="p">+</span> f<span class="p">-</span><span class="p">&gt</span>fsn<span class="p">]</span> <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    
    <span class="c">// if the conversion fmt is for a string then the <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a> will be set
    // which will prevent the switch() from working - so clear the sym flag here.</span>    
    <span class="k">unsigned</span> flags <span class="p">=</span> <a href="cmGlobal_h_0.html#cmClrFlag">cmClrFlag</a><span class="p">(</span>f<span class="p">-</span><span class="p">&gt</span>flags<span class="p">,</span><a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">switch</span><span class="p">(</span>flags<span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <a href="cmDspValue_h_0.html#kUCharDsvFl">kUCharDsvFl</a><span class="p">:</span>
      <span class="c">// not implemented - need to implment a uchar variable type or
      // assume a one character strz.</span>      
      assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a><span class="p">:</span>        
      pn <span class="p">=</span> snprintf<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">+</span>bi<span class="p">,</span>bn<span class="p">,</span>fmt <span class="p">+</span> fsi<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInt">cmDspInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a><span class="p">:</span>
      pn <span class="p">=</span> snprintf<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">+</span>bi<span class="p">,</span>bn<span class="p">,</span>fmt <span class="p">+</span> fsi<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">:</span>
      pn <span class="p">=</span> snprintf<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">+</span>bi<span class="p">,</span>bn<span class="p">,</span>fmt <span class="p">+</span> fsi<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">:</span>
      <span class="k">if</span><span class="p">(</span> <a href="cmDspClass_h_0.html#cmDspIsSymbol">cmDspIsSymbol</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">)</span> <span class="p">)</span>
        pn <span class="p">=</span> snprintf<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">+</span>bi<span class="p">,</span>bn<span class="p">,</span>fmt <span class="p">+</span> fsi<span class="p">,</span> <a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span><a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSymbol">cmDspSymbol</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">else</span>
        pn <span class="p">=</span> snprintf<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">+</span>bi<span class="p">,</span>bn<span class="p">,</span>fmt <span class="p">+</span> fsi<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span>varId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">default</span><span class="p">:</span>
      <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c">// restore the char written over by the termination zero</span>
    fmt<span class="p">[</span> f<span class="p">-</span><span class="p">&gt</span>fsi <span class="p">+</span> f<span class="p">-</span><span class="p">&gt</span>fsn<span class="p">]</span> <span class="p">=</span> c<span class="p">;</span>
    
    assert<span class="p">(</span>pn<span class="p">&lt</span><span class="p">=</span>bn<span class="p">)</span><span class="p">;</span>
    bn  <span class="p">-</span><span class="p">=</span> pn<span class="p">;</span>
    bi  <span class="p">+</span><span class="p">=</span> pn<span class="p">;</span>
    fsi <span class="p">+</span><span class="p">=</span> f<span class="p">-</span><span class="p">&gt</span>fsn<span class="p">;</span>
    
  <span class="p">}</span>  
  
  <span class="c">// if there is literal text in the format string after the last conversion spec.</span>
  <span class="k">if</span><span class="p">(</span> fsi <span class="p">&lt</span> fn <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> cn <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span>fn<span class="p">-</span>fsi<span class="p">,</span>bn<span class="p">)</span><span class="p">;</span>
    strncpy<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">+</span>bi<span class="p">,</span>fmt<span class="p">+</span>fsi<span class="p">,</span>cn<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspSprintfAlloc_defn"></a><a name="_cmDspSprintfAlloc"></a><span class="f">_cmDspSprintfAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotfmt&quot</span><span class="p">,</span>    <a href="#kFmtSpId">kFmtSpId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotFormat string&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>    <a href="#kOutSpId">kOutSpId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span>                <span class="l">&quotOutput string&quot</span> <span class="p">}</span><span class="p">,</span>               
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span> p <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <a href="#_cmSprintfLoadFormat">_cmSprintfLoadFormat</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">,</span> ctx<span class="p">,</span> classPtr<span class="p">,</span> instSymId<span class="p">,</span> id<span class="p">,</span> storeSymId<span class="p">,</span> args<span class="p">,</span> va_cnt<span class="p">,</span> vl <span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
  <span class="k">return</span> NULL<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSprintfFree_defn"></a><a name="_cmDspSprintfFree"></a><span class="f">_cmDspSprintfFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>fmtArray<span class="p">)</span><span class="p">;</span>
  <a href="cmLinkedHeap_h_0.html#cmLhFree">cmLhFree</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>fmtStr<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>fmtArray<span class="p">=</span>NULL<span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSprintfReset_defn"></a><a name="_cmDspSprintfReset"></a><span class="f">_cmDspSprintfReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspSprintfRecv_defn"></a><a name="_cmDspSprintfRecv"></a><span class="f">_cmDspSprintfRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc<span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspSprintf_t">cmDspSprintf_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="#kInSpId">kInSpId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kInSpId">kInSpId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>inCnt <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="c">//if( evt-&ampgtdstVarId == <a href="#kInSpId">kInSpId</a> )</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="#_cmDspSprintfGenString">_cmDspSprintfGenString</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspSetStrcz">cmDspSetStrcz</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutSpId">kOutSpId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>buf<span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmSprintfClassCons_defn"></a><a name="cmSprintfClassCons"></a><span class="f">cmSprintfClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmSprintfDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotSprintf&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspSprintfAlloc">_cmDspSprintfAlloc</a><span class="p">,</span>
  <a href="#_cmDspSprintfFree">_cmDspSprintfFree</a><span class="p">,</span>
  <a href="#_cmDspSprintfReset">_cmDspSprintfReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspSprintfRecv">_cmDspSprintfRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotString formatter.&quot</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmSprintfDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAMix : Audio mixer.</div><pre><a name="cmDspAMix"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kOutAmId"></a><span class="e">kOutAmId</span><span class="p">,</span>
  <a name="kBaseInAmId"></a><span class="e">kBaseInAmId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAMixDC<span class="p">;</span>

<a name="cmDspAMix_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspAMix_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspAMix_t.inPortCnt"></a><span class="i">inPortCnt</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspAMix_t.baseGainId"></a><span class="i">baseGainId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspAMix_t.baseMuteId"></a><span class="i">baseMuteId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAMix_t">cmDspAMix_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAMixAlloc_defn"></a><a name="_cmDspAMixAlloc"></a><span class="f">_cmDspAMixAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'AMix' constructor must have a count of input ports.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// args:
  // &ampltinPortCnt&ampgt  &ampltgain0&ampgt, &ampltgain1&ampgt  (the default gains are optional)</span>  
  
  <span class="k">unsigned</span>      i<span class="p">;</span>
  <span class="k">int</span>           inPortCnt    <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>      baseGainAmId <span class="p">=</span> <a href="#kBaseInAmId">kBaseInAmId</a> <span class="p">+</span> inPortCnt<span class="p">;</span>
  <span class="k">unsigned</span>      baseMuteAmId <span class="p">=</span> baseGainAmId <span class="p">+</span> inPortCnt<span class="p">;</span>
  <span class="k">double</span>        dfltGain<span class="p">[</span> inPortCnt <span class="p">]</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">=</span><span class="p">=</span> <span class="l">1</span> <span class="p">)</span>
    cmVOD_Fill<span class="p">(</span>dfltGain<span class="p">,</span>inPortCnt<span class="p">,</span><span class="l">1.0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">=</span><span class="p">=</span> <span class="l">2</span> <span class="p">)</span>
  <span class="p">{</span>
    dfltGain<span class="p">[</span><span class="l">0</span><span class="p">]</span> <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>
    cmVOD_Fill<span class="p">(</span>dfltGain<span class="p">+</span><span class="l">1</span><span class="p">,</span>inPortCnt<span class="l">-1</span><span class="p">,</span>dfltGain<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">=</span><span class="p">=</span> inPortCnt <span class="p">+</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
      dfltGain<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe mix argument list must contain no default gain values, one default gain value, or all default gain values.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  
  <a href="#cmDspAMix_t">cmDspAMix_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspAMix_t">cmDspAMix_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>         <span class="l">&quotout&quot</span><span class="p">,</span>  <a href="#kOutAmId">kOutAmId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>           <span class="l">&quotAudio output&quot</span><span class="p">,</span>
  inPortCnt<span class="p">,</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kBaseInAmId">kBaseInAmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>           <span class="l">&quotAudio input&quot</span><span class="p">,</span>
  inPortCnt<span class="p">,</span> <span class="l">&quotgain&quot</span><span class="p">,</span> baseGainAmId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>             <span class="l">&quotGain input&quot</span><span class="p">,</span>
  inPortCnt<span class="p">,</span> <span class="l">&quotmute&quot</span><span class="p">,</span> baseMuteAmId<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kBoolDsvFl">kBoolDsvFl</a><span class="p">,</span>               <span class="l">&quotMute input&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  
  p<span class="p">-</span><span class="p">&gt</span>inPortCnt  <span class="p">=</span> inPortCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">=</span> baseGainAmId<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseMuteId <span class="p">=</span> baseMuteAmId<span class="p">;</span>
  
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">+</span> i<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span>   dfltGain<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>    
    <a href="cmDspClass_h_0.html#cmDspSetDefaultBool">cmDspSetDefaultBool</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseMuteId <span class="p">+</span> i<span class="p">,</span>   false<span class="p">,</span> false <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c">//
  //  // read any default gain settings 
  //  --va_cnt;
  //  for(i=0; i&ampltinPortCnt; ++i)
  //  {
  //    // if excplicit gains are not given then default to 1.0.
  //    double dflt = 1.0; 
  //    if( i &amplt va_cnt )
  //      dflt = va_arg(vl,double);
  //
  //    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a>(   ctx, &ampampp-&ampgtinst, p-&ampgtbaseGainId + i,   0.0,   dflt);
  //  }
  //
  //</span>  
  <span class="c">//  </span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
  
  
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAMixReset_defn"></a><a name="_cmDspAMixReset"></a><span class="f">_cmDspAMixReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>       rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAmId">kOutAmId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span> 


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAMixExec_defn"></a><a name="_cmDspAMixExec"></a><span class="f">_cmDspAMixExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAMix_t">cmDspAMix_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAMix_t">cmDspAMix_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>     i<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAmId">kOutAmId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span>    n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAmId">kOutAmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> dp <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kOutAmId">kOutAmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> sp <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseInAmId">kBaseInAmId</a><span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> sp <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">double</span>            gain <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseGainId<span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
      cmVOS_MultSumVVS<span class="p">(</span>dp<span class="p">,</span>n<span class="p">,</span>sp<span class="p">,</span><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span>gain<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAMixRecv_defn"></a><a name="_cmDspAMixRecv"></a><span class="f">_cmDspAMixRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspAMix_t">cmDspAMix_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspAMix_t">cmDspAMix_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>inPortCnt <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
    <span class="c">//printf(&ampquotrcv:%i %f\n&ampquot,evt-&ampgtdstVarId,<a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a>(inst,evt-&ampgtdstVarId));</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmAMixClassCons_defn"></a><a name="cmAMixClassCons"></a><span class="f">cmAMixClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAMixDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAMix&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAMixAlloc">_cmDspAMixAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAMixReset">_cmDspAMixReset</a><span class="p">,</span>
  <a href="#_cmDspAMixExec">_cmDspAMixExec</a><span class="p">,</span>
  <a href="#_cmDspAMixRecv">_cmDspAMixRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAudio mixer&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAMixDC<span class="p">;</span>
<span class="p">}</span> 

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspASplit : Audio splitter with individual gain control.</div><pre><a name="cmDspASplit"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInAsId"></a><span class="e">kInAsId</span><span class="p">,</span>
  <a name="kBaseOutAsId"></a><span class="e">kBaseOutAsId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmASplitDC<span class="p">;</span>

<a name="cmDspASplit_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspASplit_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspASplit_t.outPortCnt"></a><span class="i">outPortCnt</span><span class="p">;</span> 
  <span class="k">unsigned</span>    <a name="cmDspASplit_t.baseGainId"></a><span class="i">baseGainId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspASplit_t">cmDspASplit_t</a></span><span class="p">;</span>

<span class="c">// A splitter has one audio input port and multiple audio output ports.
// A gain input is automatically provided for each output port.</span>
<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspASplitAlloc_defn"></a><a name="_cmDspASplitAlloc"></a><span class="f">_cmDspASplitAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>  <a href="#kInAsId">kInAsId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span>      <span class="l">0</span><span class="p">,</span>  <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>              <span class="l">&quotAudio input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'ASplit' constructor must have a count of input ports.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// args:
  // &ampltoutPortCnt&ampgt  &ampltgain0&ampgt, &ampltgain1&ampgt  (the default gains are optional)</span>  
  
  <span class="k">unsigned</span>      i<span class="p">,</span>j<span class="p">,</span>k<span class="p">;</span>
  <span class="k">int</span>           outPortCnt    <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>      fixArgCnt    <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span> <span class="p">-</span> <span class="l">1</span><span class="p">;</span>
  <span class="k">unsigned</span>      argCnt       <span class="p">=</span> fixArgCnt <span class="p">+</span> <span class="l">2</span><span class="p">*</span>outPortCnt <span class="p">+</span> <span class="l">1</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> argArray<span class="p">[</span> argCnt <span class="p">]</span><span class="p">;</span>
  <span class="k">int</span>           labelCharCnt <span class="p">=</span> <span class="l">15</span><span class="p">;</span>
  <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a>      label<span class="p">[</span> labelCharCnt <span class="p">+</span> <span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  label<span class="p">[</span>labelCharCnt<span class="p">]</span>        <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  
  <span class="c">// </span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>fixArgCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    argArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> args<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
  
  <span class="c">// define the audio output port specifications</span>
  <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">,</span>k<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>outPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">,</span><span class="p">+</span><span class="p">+</span>j<span class="p">,</span><span class="p">+</span><span class="p">+</span>k<span class="p">)</span>
  <span class="p">{</span>
    snprintf<span class="p">(</span>label<span class="p">,</span>labelCharCnt<span class="p">,</span><span class="l">&quotout-%i&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> symId      <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>symId<span class="p">)</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>constId <span class="p">=</span> <a href="#kBaseOutAsId">kBaseOutAsId</a> <span class="p">+</span> k<span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>rn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>cn      <span class="p">=</span> <span class="l">1</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>flags   <span class="p">=</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>doc     <span class="p">=</span> <span class="l">&quotAudio Input&quot</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// define the gain input specifications</span>
  <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>outPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">,</span><span class="p">+</span><span class="p">+</span>j<span class="p">,</span><span class="p">+</span><span class="p">+</span>k<span class="p">)</span>
  <span class="p">{</span>
    snprintf<span class="p">(</span>label<span class="p">,</span>labelCharCnt<span class="p">,</span><span class="l">&quotgain-%i&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> symId      <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>symId<span class="p">)</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>constId <span class="p">=</span> <a href="#kBaseOutAsId">kBaseOutAsId</a> <span class="p">+</span> k<span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>rn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>cn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>flags   <span class="p">=</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>doc     <span class="p">=</span> <span class="l">&quotGain input&quot</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// set the NULL end-of-arg-array sentinel</span>
  memset<span class="p">(</span>argArray <span class="p">+</span> i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span>argArray<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>argArray<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>outPortCnt  <span class="p">=</span> outPortCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">=</span> <a href="#kBaseOutAsId">kBaseOutAsId</a> <span class="p">+</span> outPortCnt<span class="p">;</span>
  
  <span class="c">// read any default gain settings </span>
  <span class="p">-</span><span class="p">-</span>va_cnt<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>outPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">double</span> dflt <span class="p">=</span> <span class="l">1.0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> i <span class="p">&lt</span> va_cnt <span class="p">)</span>
      dflt <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">double</span><span class="p">)</span><span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">+</span> i<span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span>   dflt<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspASplitReset_defn"></a><a name="_cmDspASplitReset"></a><span class="f">_cmDspASplitReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">int</span>            i<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>outPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseOutAsId">kBaseOutAsId</a><span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span> 


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspASplitExec_defn"></a><a name="_cmDspASplitExec"></a><span class="f">_cmDspASplitExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>     i<span class="p">;</span>
  
  <span class="k">unsigned</span>          n  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseOutAsId">kBaseOutAsId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> sp <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInAsId">kInAsId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>outPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       dp   <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseOutAsId">kBaseOutAsId</a><span class="p">+</span>i<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">double</span>            gain <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>baseGainId<span class="p">+</span>i<span class="p">)</span><span class="p">;</span>
    cmVOS_MultVVS<span class="p">(</span>dp<span class="p">,</span>n<span class="p">,</span>sp<span class="p">,</span><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">)</span>gain<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspASplitRecv_defn"></a><a name="_cmDspASplitRecv"></a><span class="f">_cmDspASplitRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspASplit_t">cmDspASplit_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>baseGainId <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>outPortCnt <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmASplitClassCons_defn"></a><a name="cmASplitClassCons"></a><span class="f">cmASplitClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmASplitDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotASplit&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspASplitAlloc">_cmDspASplitAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspASplitReset">_cmDspASplitReset</a><span class="p">,</span>
  <a href="#_cmDspASplitExec">_cmDspASplitExec</a><span class="p">,</span>
  <a href="#_cmDspASplitRecv">_cmDspASplitRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAudio splitter&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmASplitDC<span class="p">;</span>
<span class="p">}</span> 

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspAMeter : Audio level meter.</div><pre><a name="cmDspAMeter"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInAmId"></a><span class="e">kInAmId</span><span class="p">,</span>
  <a name="kMinAmId"></a><span class="e">kMinAmId</span><span class="p">,</span>
  <a name="kMaxAmId"></a><span class="e">kMaxAmId</span><span class="p">,</span>
  <a name="kValAmId"></a><span class="e">kValAmId</span><span class="p">,</span> <span class="c"> // meter value</span>
  <a name="kLblAmId"></a><span class="e">kLblAmId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<span class="m">#define </span><a name="cmDspMeter_MIN"></a><span class="m">cmDspMeter_MIN</span><span class="m"> (-100)</span>
<span class="m">#define </span><a name="cmDspMeter_MAX"></a><span class="m">cmDspMeter_MAX</span><span class="m"> (0)</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmAMeterDC<span class="p">;</span>

<a name="cmDspAMeter_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspAMeter_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspAMeter_t.bufN"></a><span class="i">bufN</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspAMeter_t.idx"></a><span class="i">idx</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>    <a name="cmDspAMeter_t.sum"></a><span class="i">sum</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>    <a name="cmDspAMeter_t.val"></a><span class="i">val</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspAMeter_t">cmDspAMeter_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspAMeterAlloc_defn"></a><a name="_cmDspAMeterAlloc"></a><span class="f">_cmDspAMeterAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInAmId">kInAmId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>     <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotAudio input&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmin&quot</span><span class="p">,</span>  <a href="#kMinAmId">kMinAmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotMinimum value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotmax&quot</span><span class="p">,</span>  <a href="#kMaxAmId">kMaxAmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotMaximum value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotval&quot</span><span class="p">,</span>  <a href="#kValAmId">kValAmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotMeter value&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotlabel&quot</span><span class="p">,</span><a href="#kLblAmId">kLblAmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a><span class="p">,</span>    <span class="l">&quotLabel.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspAMeter_t">cmDspAMeter_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspAMeter_t">cmDspAMeter_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">double</span>   updateMs <span class="p">=</span> <span class="l">100</span><span class="p">;</span>
  <span class="k">double</span>   sr       <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> spc      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>bufN           <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMax">cmMax</a><span class="p">(</span><span class="l">1</span><span class="p">,</span>floor<span class="p">(</span>updateMs <span class="p">*</span> sr<span class="p">/</span> <span class="p">(</span><span class="l">1000.0</span> <span class="p">*</span> spc<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kValAmId">kValAmId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span>  <a href="#cmDspMeter_MIN">cmDspMeter_MIN</a><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMinAmId">kMinAmId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span>  <a href="#cmDspMeter_MIN">cmDspMeter_MIN</a><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMaxAmId">kMaxAmId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span>  <a href="#cmDspMeter_MAX">cmDspMeter_MAX</a><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUiMeterCreate">cmDspUiMeterCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kMinAmId">kMinAmId</a><span class="p">,</span><a href="#kMaxAmId">kMaxAmId</a><span class="p">,</span><a href="#kValAmId">kValAmId</a><span class="p">,</span><a href="#kLblAmId">kLblAmId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAMeterReset_defn"></a><a name="_cmDspAMeterReset"></a><span class="f">_cmDspAMeterReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAMeter_t">cmDspAMeter_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspAMeter_t">cmDspAMeter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="c">//<a href="cmDspClass_h_0.html#cmDspZeroAudioBuf">cmDspZeroAudioBuf</a>(ctx,inst,<a href="#kInAmId">kInAmId</a>);</span>
  
  p<span class="p">-</span><span class="p">&gt</span>idx <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>sum <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>val <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspAMeterExec_defn"></a><a name="_cmDspAMeterExec"></a><span class="f">_cmDspAMeterExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspAMeter_t">cmDspAMeter_t</a><span class="p">*</span>    p     <span class="p">=</span> <span class="p">(</span><a href="#cmDspAMeter_t">cmDspAMeter_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          n     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInAmId">kInAmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> sp    <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInAmId">kInAmId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> sp <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    inst<span class="p">-</span><span class="p">&gt</span>execFunc <span class="p">=</span> NULL<span class="p">;</span> <span class="c"> // if there is no connected input then disable further callbacks</span>
    <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <span class="p">}</span>
  
  p<span class="p">-</span><span class="p">&gt</span>sum <span class="p">+</span><span class="p">=</span> cmVOS_SquaredSum<span class="p">(</span>sp<span class="p">,</span>n<span class="p">)</span><span class="p">;</span>
  <span class="p">+</span><span class="p">+</span>p<span class="p">-</span><span class="p">&gt</span>idx<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>idx <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>bufN <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>     coeff <span class="p">=</span> <span class="l">0.7</span><span class="p">;</span>
    <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a>     rms   <span class="p">=</span> sqrt<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>sum<span class="p">/</span><span class="p">(</span>n<span class="p">*</span>p<span class="p">-</span><span class="p">&gt</span>bufN<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    p<span class="p">-</span><span class="p">&gt</span>idx <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>sum <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    
    p<span class="p">-</span><span class="p">&gt</span>val <span class="p">=</span> rms <span class="p">&gt</span> p<span class="p">-</span><span class="p">&gt</span>val <span class="p">?</span> rms <span class="p">:</span> <span class="p">(</span>rms<span class="p">*</span><span class="p">(</span><span class="l">1.0</span><span class="p">-</span>coeff<span class="p">)</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>val<span class="p">*</span>coeff<span class="p">)</span><span class="p">;</span>
    
    <span class="k">double</span> db <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMax">cmMax</a><span class="p">(</span><a href="#cmDspMeter_MIN">cmDspMeter_MIN</a><span class="p">,</span><a href="cmGlobal_h_0.html#cmMin">cmMin</a><span class="p">(</span><a href="#cmDspMeter_MAX">cmDspMeter_MAX</a><span class="p">,</span><span class="l">20.0</span> <span class="p">*</span> log10<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>val<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kValAmId">kValAmId</a><span class="p">,</span> db<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmAMeterClassCons_defn"></a><a name="cmAMeterClassCons"></a><span class="f">cmAMeterClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmAMeterDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotAMeter&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAMeterAlloc">_cmDspAMeterAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspAMeterReset">_cmDspAMeterReset</a><span class="p">,</span>
  <a href="#_cmDspAMeterExec">_cmDspAMeterExec</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotAudio meter display.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmAMeterDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspTextFile : Create text files which can be read by the Octave function cmTextFile.m.</div><pre><a name="cmDspTextFile"></a>
<span class="c">//
//
//  Read files created by this object with the Octave function cmTextFile().
//
//</span>

<span class="k">enum</span>
<span class="p">{</span>
  <a name="kCntTfId"></a><span class="e">kCntTfId</span><span class="p">,</span>
  <a name="kFnTfId"></a><span class="e">kFnTfId</span><span class="p">,</span>
  <a name="kBaseTfId"></a><span class="e">kBaseTfId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmTextFileDC<span class="p">;</span>

<a name="cmDspTextFile_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspTextFile_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">int</span>         <a name="cmDspTextFile_t.inPortCnt"></a><span class="i">inPortCnt</span><span class="p">;</span>
  <a href="cmFile_h_0.html#cmFileH_t">cmFileH_t</a>   <a name="cmDspTextFile_t.fH"></a><span class="i">fH</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspTextFile_t">cmDspTextFile_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspTextFileAlloc_defn"></a><a name="_cmDspTextFileAlloc"></a><span class="f">_cmDspTextFileAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotcnt&quot</span><span class="p">,</span>  <a href="#kCntTfId">kCntTfId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput port count&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfn&quot</span><span class="p">,</span>   <a href="#kFnTfId">kFnTfId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotFile name&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe text file object must be given a input port count argument.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span> i<span class="p">,</span>j<span class="p">;</span>
  <span class="k">int</span>             inPortCnt    <span class="p">=</span> va_arg<span class="p">(</span>vl1<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>        fixArgCnt    <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span> <span class="p">-</span> <span class="l">1</span><span class="p">;</span>
  <span class="k">unsigned</span>        argCnt       <span class="p">=</span> fixArgCnt <span class="p">+</span> inPortCnt <span class="p">+</span> <span class="l">1</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>   argArray<span class="p">[</span> argCnt <span class="p">]</span><span class="p">;</span>
  
  
  <span class="k">if</span><span class="p">(</span> inPortCnt <span class="p">&lt</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe text file input port count  must be a positive integer.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// </span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>fixArgCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    argArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> args<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
  
  <span class="c">// define the input port specifications</span>
  <span class="k">for</span><span class="p">(</span>j<span class="p">=</span><span class="l">0</span><span class="p">;</span> j<span class="p">&lt</span>inPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>j<span class="p">,</span><span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="k">int</span>             labelCharCnt <span class="p">=</span> <span class="l">15</span><span class="p">;</span>
    <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a>        label<span class="p">[</span> labelCharCnt <span class="p">+</span> <span class="l">1</span> <span class="p">]</span><span class="p">;</span>
    label<span class="p">[</span>labelCharCnt<span class="p">]</span>        <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    
    snprintf<span class="p">(</span>label<span class="p">,</span>labelCharCnt<span class="p">,</span><span class="l">&quotin-%i&quot</span><span class="p">,</span>j<span class="p">)</span><span class="p">;</span>
    <span class="k">unsigned</span> symId      <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblRegisterSymbol">cmSymTblRegisterSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>label<span class="p">)</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>label   <span class="p">=</span> <a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span>symId<span class="p">)</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>constId <span class="p">=</span> <a href="#kBaseTfId">kBaseTfId</a> <span class="p">+</span> j<span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>rn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>cn      <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>flags   <span class="p">=</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">;</span>
    argArray<span class="p">[</span>i<span class="p">]</span><span class="p">.</span>doc     <span class="p">=</span> <span class="l">&quotData input&quot</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c">// set the NULL end-of-arg-array sentinel</span>
  memset<span class="p">(</span>argArray <span class="p">+</span> i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span>argArray<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  
  <a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>argArray<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>inPortCnt  <span class="p">=</span> inPortCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>fH         <span class="p">=</span> cmFileNullHandle<span class="p">;</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspTextFileFree_defn"></a><a name="_cmDspTextFileFree"></a><span class="f">_cmDspTextFileFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmFile_h_0.html#cmFileClose">cmFileClose</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>fH<span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>inst<span class="p">-</span><span class="p">&gt</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span> <a href="cmDspClass_h_0.html#kInstFinalFailDspRC">kInstFinalFailDspRC</a><span class="p">,</span> <span class="l">&quotText file close failed.&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspTextFileReset_defn"></a><a name="_cmDspTextFileReset"></a><span class="f">_cmDspTextFileReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc  <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> fn <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspStrcz">cmDspStrcz</a><span class="p">(</span>inst<span class="p">,</span><a href="#kFnTfId">kFnTfId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmFile_h_0.html#cmFileOpen">cmFileOpen</a><span class="p">(</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>fH<span class="p">,</span> fn<span class="p">,</span> <a href="cmFile_h_0.html#kWriteFileFl">kWriteFileFl</a><span class="p">,</span> ctx<span class="p">-</span><span class="p">&gt</span><a href="cmProcObj_h_0.html#cmCtx">cmCtx</a><span class="p">-</span><span class="p">&gt</span>err<span class="p">.</span>rpt <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmFile_h_0.html#kOkFileRC">kOkFileRC</a> <span class="p">)</span>
    rc <span class="p">=</span> <a href="cmErr_h_0.html#cmErrMsg">cmErrMsg</a><span class="p">(</span><span class="p">&amp</span>inst<span class="p">-</span><span class="p">&gt</span>classPtr<span class="p">-</span><span class="p">&gt</span>err<span class="p">,</span> <a href="cmDspClass_h_0.html#kInstResetFailDspRC">kInstResetFailDspRC</a><span class="p">,</span> <span class="l">&quotText file open failed.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspTextFileRecv_defn"></a><a name="_cmDspTextFileRecv"></a><span class="f">_cmDspTextFileRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">*</span>    p     <span class="p">=</span> <span class="p">(</span><a href="#cmDspTextFile_t">cmDspTextFile_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmFile_h_0.html#cmFileIsValid">cmFileIsValid</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fH<span class="p">)</span> <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&gt</span><span class="p">=</span> <a href="#kBaseTfId">kBaseTfId</a> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">double</span> secs <span class="p">=</span> ctx<span class="p">-</span><span class="p">&gt</span>ctx<span class="p">-</span><span class="p">&gt</span>begSmpIdx <span class="p">/</span> <a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">;</span>
    <a href="cmFile_h_0.html#cmFilePrintf">cmFilePrintf</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fH<span class="p">,</span><span class="l">&quot%f %f %i &quot</span><span class="p">,</span> secs<span class="p">,</span> secs<span class="p">,</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">-</span><a href="#kBaseTfId">kBaseTfId</a><span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> <a href="cmGlobal_h_0.html#cmIsFlag">cmIsFlag</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">-</span><span class="p">&gt</span>flags<span class="p">,</span><a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a><span class="p">)</span> <span class="p">)</span>
      <a href="cmFile_h_0.html#cmFilePrintf">cmFilePrintf</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fH<span class="p">,</span><span class="l">&quot%s\n&quot</span><span class="p">,</span> <a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span><a href="cmSymTbl_h_0.html#cmSymTblLabel">cmSymTblLabel</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>stH<span class="p">,</span><a href="cmDspValue_h_0.html#cmDsvSymbol">cmDsvSymbol</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      <a href="cmFile_h_0.html#cmFilePrintf">cmFilePrintf</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>fH<span class="p">,</span><span class="l">&quot%f\n&quot</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmTextFileClassCons_defn"></a><a name="cmTextFileClassCons"></a><span class="f">cmTextFileClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmTextFileDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotTextFile&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspTextFileAlloc">_cmDspTextFileAlloc</a><span class="p">,</span>
  <a href="#_cmDspTextFileFree">_cmDspTextFileFree</a><span class="p">,</span>
  <a href="#_cmDspTextFileReset">_cmDspTextFileReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspTextFileRecv">_cmDspTextFileRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotTime tagged text file.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmTextFileDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspArray : Read in a symbol/value list from a resource and selectively transmit values.</div><pre><a name="cmDspArray"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kRsrcArId"></a><span class="e">kRsrcArId</span><span class="p">,</span>
  <a name="kCmdArId"></a><span class="e">kCmdArId</span><span class="p">,</span>
  <a name="kIdxArId"></a><span class="e">kIdxArId</span><span class="p">,</span>
  <a name="kValArId"></a><span class="e">kValArId</span><span class="p">,</span>
  <a name="kCntArId"></a><span class="e">kCntArId</span><span class="p">,</span>
  <a name="kDoneArId"></a><span class="e">kDoneArId</span><span class="p">,</span>
  <a name="kBaseOutArId"></a><span class="e">kBaseOutArId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmArrayDC<span class="p">;</span>

<a name="cmDspArray_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspArray_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspArray_t.cnt"></a><span class="i">cnt</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>   <a name="cmDspArray_t.array"></a><span class="i">array</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspArray_t.printSymId"></a><span class="i">printSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspArray_t.sendSymId"></a><span class="i">sendSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspArray_t.cntSymId"></a><span class="i">cntSymId</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspArray_t.doneSymId"></a><span class="i">doneSymId</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspArray_t">cmDspArray_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspArrayAlloc_defn"></a><a name="_cmDspArrayAlloc"></a><span class="f">_cmDspArrayAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe array object must be given a 'rsrc' parameter.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> rsrcStr    <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>        outPortCnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">*</span>       array      <span class="p">=</span> NULL<span class="p">;</span>
  <span class="k">unsigned</span>        doneSymId  <span class="p">=</span> <a href="cmDspSys_h_0.html#cmDspSysRegisterStaticSymbol">cmDspSysRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span><span class="l">&quotdone&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>        i<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> rsrcStr <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe array object 'rsrc' parameter appears to be missing.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="k">if</span><span class="p">(</span> <a href="cmDspSys_h_0.html#cmDspRsrcRealArray">cmDspRsrcRealArray</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <span class="p">&amp</span>outPortCnt<span class="p">,</span> <span class="p">&amp</span>array<span class="p">,</span> rsrcStr<span class="p">,</span> NULL <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe array resource '%s' could not be read.&quot</span><span class="p">,</span><a href="cmGlobal_h_0.html#cmStringNullGuard">cmStringNullGuard</a><span class="p">(</span>rsrcStr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <a href="#cmDspArray_t">cmDspArray_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspArray_t">cmDspArray_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotrsrc&quot</span><span class="p">,</span>  <a href="#kRsrcArId">kRsrcArId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span>    <span class="l">&quotArray data resource label.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotcmd&quot</span><span class="p">,</span>   <a href="#kCmdArId">kCmdArId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                   <span class="l">&quotCommand: send | print | count.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotidx&quot</span><span class="p">,</span>   <a href="#kIdxArId">kIdxArId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a><span class="p">,</span>                   <span class="l">&quotSend value at index out 'val' port.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotval&quot</span><span class="p">,</span>   <a href="#kValArId">kValArId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>                  <span class="l">&quotIndex output value.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotcnt&quot</span><span class="p">,</span>   <a href="#kCntArId">kCntArId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>                  <span class="l">&quotCount output value.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotdone&quot</span><span class="p">,</span>  <a href="#kDoneArId">kDoneArId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kSymDsvFl">kSymDsvFl</a>    <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>                  <span class="l">&quot'done' after last send.&quot</span><span class="p">,</span>
  outPortCnt<span class="p">,</span> <span class="l">&quotout&quot</span><span class="p">,</span>   <a href="#kBaseOutArId">kBaseOutArId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kSendDfltDsvFl">kSendDfltDsvFl</a><span class="p">,</span> <span class="l">&quotIndividual real value outputs.&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kValArId">kValArId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kCntArId">kCntArId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> outPortCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultSymbol">cmDspSetDefaultSymbol</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDoneArId">kDoneArId</a><span class="p">,</span> doneSymId<span class="p">)</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>outPortCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kBaseOutArId">kBaseOutArId</a><span class="p">+</span>i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> array<span class="p">[</span>i<span class="p">]</span> <span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>array      <span class="p">=</span> array<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>cnt        <span class="p">=</span> outPortCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>sendSymId  <span class="p">=</span> <a href="cmDspSys_h_0.html#cmDspSysRegisterStaticSymbol">cmDspSysRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span><span class="l">&quotsend&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>printSymId <span class="p">=</span> <a href="cmDspSys_h_0.html#cmDspSysRegisterStaticSymbol">cmDspSysRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span><span class="l">&quotprint&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>cntSymId   <span class="p">=</span> <a href="cmDspSys_h_0.html#cmDspSysRegisterStaticSymbol">cmDspSysRegisterStaticSymbol</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span><span class="l">&quotcount&quot</span><span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>doneSymId  <span class="p">=</span> doneSymId<span class="p">;</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspArrayReset_defn"></a><a name="_cmDspArrayReset"></a><span class="f">_cmDspArrayReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspArray_t">cmDspArray_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspArray_t">cmDspArray_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc<span class="p">;</span>
  
  <span class="c">// send 'out' values and then 'done' value</span>
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kDoneArId">kDoneArId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>doneSymId<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspArrayRecv_defn"></a><a name="_cmDspArrayRecv"></a><span class="f">_cmDspArrayRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>     rc<span class="p">;</span>
  <a href="#cmDspArray_t">cmDspArray_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspArray_t">cmDspArray_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kCmdArId">kCmdArId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> i<span class="p">;</span>
      <span class="k">unsigned</span> cmdSymId <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvSymbol">cmDsvSymbol</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span> cmdSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>printSymId <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>cnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
          <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot%f &quot</span><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>array<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
        <a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>rpt<span class="p">,</span><span class="l">&quot\n&quot</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
        <span class="k">if</span><span class="p">(</span> cmdSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>sendSymId <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>cnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
          <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kBaseOutArId">kBaseOutArId</a><span class="p">+</span>i<span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>array<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
        <a href="cmDspClass_h_0.html#cmDspSetSymbol">cmDspSetSymbol</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kDoneArId">kDoneArId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>doneSymId<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
        <span class="k">if</span><span class="p">(</span> cmdSymId <span class="p">=</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>cntSymId <span class="p">)</span>
      <span class="p">{</span>
        <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kCntArId">kCntArId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>cnt<span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kIdxArId">kIdxArId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">unsigned</span> idx <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvUInt">cmDsvUInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> idx <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>cnt <span class="p">)</span>
        <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kValArId">kValArId</a><span class="p">,</span>p<span class="p">-</span><span class="p">&gt</span>array<span class="p">[</span>idx<span class="p">]</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmArrayClassCons_defn"></a><a name="cmArrayClassCons"></a><span class="f">cmArrayClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmArrayDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotArray&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspArrayAlloc">_cmDspArrayAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspArrayReset">_cmDspArrayReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspArrayRecv">_cmDspArrayRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotTime tagged text file.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmArrayDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspPitchCvt : Convert between MIDI,scientific pitch, and pitch ratio values.</div><pre><a name="cmDspPitchCvt"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kMidiPcId"></a><span class="e">kMidiPcId</span><span class="p">,</span>
  <a name="kHzPcId"></a><span class="e">kHzPcId</span><span class="p">,</span>
  <a name="kOffsPcId"></a><span class="e">kOffsPcId</span><span class="p">,</span>
  <a name="kStrPcId"></a><span class="e">kStrPcId</span><span class="p">,</span>
  <a name="kRatioPcId"></a><span class="e">kRatioPcId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmPitchCvtDC<span class="p">;</span>

<a name="cmDspPitchCvt_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspPitchCvt_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">int</span>         <a name="cmDspPitchCvt_t.midi"></a><span class="i">midi</span><span class="p">;</span>
  <span class="k">double</span>      <a name="cmDspPitchCvt_t.hz"></a><span class="i">hz</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspPitchCvt_t">cmDspPitchCvt_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspPitchCvtAlloc_defn"></a><a name="_cmDspPitchCvtAlloc"></a><span class="f">_cmDspPitchCvtAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_cnt <span class="p">=</span> <span class="l">0</span><span class="p">;</span> <span class="c"> // ignore an errant arguments</span>
  
  <a href="#cmDspPitchCvt_t">cmDspPitchCvt_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAllocV">cmDspInstAllocV</a><span class="p">(</span><a href="#cmDspPitchCvt_t">cmDspPitchCvt_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotmidi&quot</span><span class="p">,</span>  <a href="#kMidiPcId">kMidiPcId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotMIDI pitch value input.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quothz&quot</span><span class="p">,</span>    <a href="#kHzPcId">kHzPcId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotHz pitch value.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotoffs&quot</span><span class="p">,</span>  <a href="#kOffsPcId">kOffsPcId</a><span class="p">,</span>    <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kOptArgDsvFl">kOptArgDsvFl</a><span class="p">,</span> <span class="l">&quotSemitone offset.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotstr&quot</span><span class="p">,</span>   <a href="#kStrPcId">kStrPcId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>                           <span class="l">&quotPitch string output.&quot</span><span class="p">,</span>
  <span class="l">1</span><span class="p">,</span>          <span class="l">&quotratio&quot</span><span class="p">,</span> <a href="#kRatioPcId">kRatioPcId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a><span class="p">,</span>                           <span class="l">&quotOffset as a ratio&quot</span><span class="p">,</span>
  <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kMidiPcId">kMidiPcId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kHzPcId">kHzPcId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kOffsPcId">kOffsPcId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultStrcz">cmDspSetDefaultStrcz</a><span class="p">(</span>  ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kStrPcId">kStrPcId</a><span class="p">,</span>  NULL<span class="p">,</span> <span class="l">&quot&quot</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRatioPcId">kRatioPcId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPitchCvtReset_defn"></a><a name="_cmDspPitchCvtReset"></a><span class="f">_cmDspPitchCvtReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPitchCvtOutput_defn"></a><a name="_cmDspPitchCvtOutput"></a><span class="f">_cmDspPitchCvtOutput</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspPitchCvt_t">cmDspPitchCvt_t</a><span class="p">*</span> p <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">=</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
  <span class="k">double</span>       offs <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span> inst<span class="p">,</span> <a href="#kOffsPcId">kOffsPcId</a> <span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>     midi <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMax">cmMax</a><span class="p">(</span><span class="l">0</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>midi <span class="p">+</span> rint<span class="p">(</span>offs<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>       ratio<span class="p">=</span> pow<span class="p">(</span><span class="l">2.0</span><span class="p">,</span>offs<span class="p">/</span><span class="l">12.0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">double</span>       hz   <span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>hz <span class="p">*</span> ratio<span class="p">;</span>
  
  <span class="c">//<a href="cmRpt_h_0.html#cmRptPrintf">cmRptPrintf</a>(ctx-&ampgtrpt,&ampquot%i %i %f %f\n&ampquot,offs,midi,hz,p-&ampgthz);</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetStrcz">cmDspSetStrcz</a><span class="p">(</span>  ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kStrPcId">kStrPcId</a><span class="p">,</span>  <a href="cmMidi_h_0.html#cmMidiToSciPitch">cmMidiToSciPitch</a><span class="p">(</span>midi<span class="p">,</span>NULL<span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetUInt">cmDspSetUInt</a><span class="p">(</span>   ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kMidiPcId">kMidiPcId</a><span class="p">,</span> midi<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kHzPcId">kHzPcId</a><span class="p">,</span>   hz<span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDouble">cmDspSetDouble</a><span class="p">(</span> ctx<span class="p">,</span> inst<span class="p">,</span> <a href="#kRatioPcId">kRatioPcId</a><span class="p">,</span> ratio <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspPitchCvtRecv_defn"></a><a name="_cmDspPitchCvtRecv"></a><span class="f">_cmDspPitchCvtRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>        rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspPitchCvt_t">cmDspPitchCvt_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspPitchCvt_t">cmDspPitchCvt_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kMidiPcId">kMidiPcId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>midi <span class="p">=</span> <a href="cmGlobal_h_0.html#cmMax">cmMax</a><span class="p">(</span><span class="l">0</span><span class="p">,</span><a href="cmDspValue_h_0.html#cmDsvGetInt">cmDsvGetInt</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>hz   <span class="p">=</span> <a href="cmMath_h_0.html#cmMidiToHz">cmMidiToHz</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>midi<span class="p">)</span><span class="p">;</span>
    rc      <span class="p">=</span> <a href="#_cmDspPitchCvtOutput">_cmDspPitchCvtOutput</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kHzPcId">kHzPcId</a><span class="p">:</span>
    p<span class="p">-</span><span class="p">&gt</span>hz   <span class="p">=</span> <a href="cmDspValue_h_0.html#cmDsvGetDouble">cmDsvGetDouble</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>midi <span class="p">=</span> <a href="cmMath_h_0.html#cmHzToMidi">cmHzToMidi</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>hz<span class="p">)</span><span class="p">;</span>
    rc      <span class="p">=</span> <a href="#_cmDspPitchCvtOutput">_cmDspPitchCvtOutput</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kOffsPcId">kOffsPcId</a><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span> inst<span class="p">,</span> evt <span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
      rc <span class="p">=</span> <a href="#_cmDspPitchCvtOutput">_cmDspPitchCvtOutput</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmPitchCvtClassCons_defn"></a><a name="cmPitchCvtClassCons"></a><span class="f">cmPitchCvtClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmPitchCvtDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotPitchCvt&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPitchCvtAlloc">_cmDspPitchCvtAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPitchCvtReset">_cmDspPitchCvtReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspPitchCvtRecv">_cmDspPitchCvtRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotTime tagged text file.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmPitchCvtDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspBinMtx : Create a file which can be read by the Octave function readBinFile.m.</div><pre><a name="cmDspBinMtx"></a>

<span class="k">enum</span>
<span class="p">{</span>
  <a name="kCntBmId"></a><span class="e">kCntBmId</span><span class="p">,</span>
  <a name="kFnBmId"></a><span class="e">kFnBmId</span><span class="p">,</span>
  <a name="kBaseBmId"></a><span class="e">kBaseBmId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmBinMtxFileDC<span class="p">;</span>

<a name="cmDspBinMtxFile_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a>     <a name="cmDspBinMtxFile_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">int</span>             <a name="cmDspBinMtxFile_t.inPortCnt"></a><span class="i">inPortCnt</span><span class="p">;</span>
  <a href="cmProc2_h_0.html#cmBinMtxFile_t">cmBinMtxFile_t</a><span class="p">*</span> <a name="cmDspBinMtxFile_t.bmfp"></a><span class="i">bmfp</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a> <span class="p">*</span>      <a name="cmDspBinMtxFile_t.valArray"></a><span class="i">valArray</span><span class="p">;</span>     <span class="c"> // valArray[ inPortCnt ]</span>
<span class="p">}</span> <span class="t"><a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspBinMtxFileAlloc_defn"></a><a name="_cmDspBinMtxFileAlloc"></a><span class="f">_cmDspBinMtxFileAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span> 
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotcnt&quot</span><span class="p">,</span>  <a href="#kCntBmId">kCntBmId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kIntDsvFl">kIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotInput port count&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotfn&quot</span><span class="p">,</span>   <a href="#kFnBmId">kFnBmId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kStrzDsvFl">kStrzDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotFile name&quot</span><span class="p">}</span><span class="p">,</span>
  <span class="p">}</span><span class="p">;</span>
  
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe binary matrix file object must be given a input port count argument.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  va_list vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">int</span>                inPortCnt <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">int</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>           fixArgCnt <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>args<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span>args<span class="p">[</span><span class="l">0</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>           argCnt    <span class="p">=</span> fixArgCnt <span class="p">+</span> inPortCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a>      a<span class="p">[</span> argCnt<span class="p">+</span><span class="l">1</span> <span class="p">]</span><span class="p">;</span>
  <a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span> p         <span class="p">=</span> NULL<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> inPortCnt <span class="p">&lt</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kInvalidArgDspRC">kInvalidArgDspRC</a><span class="p">,</span><span class="l">&quotThe binary matrix file must be a positive integer.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgCopy">cmDspArgCopy</a><span class="p">(</span>  a<span class="p">,</span> argCnt<span class="p">,</span> <span class="l">0</span><span class="p">,</span> args<span class="p">,</span> fixArgCnt <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupN">cmDspArgSetupN</a><span class="p">(</span>ctx<span class="p">,</span> a<span class="p">,</span> argCnt<span class="p">,</span> <a href="#kBaseBmId">kBaseBmId</a><span class="p">,</span> inPortCnt<span class="p">,</span> <span class="l">&quotin&quot</span><span class="p">,</span> <a href="#kBaseBmId">kBaseBmId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span> <span class="l">&quotinput ports&quot</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span> a<span class="p">+</span>argCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>a<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl1<span class="p">)</span><span class="p">)</span> <span class="p">=</span><span class="p">=</span> NULL <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>bmfp      <span class="p">=</span> <a href="cmProc2_h_0.html#cmBinMtxFileAlloc">cmBinMtxFileAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> NULL <span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>inPortCnt <span class="p">=</span> inPortCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>valArray  <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><a href="cmFloatTypes_h_0.html#cmReal_t">cmReal_t</a><span class="p">,</span>inPortCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinMtxFileOpen_defn"></a><a name="_cmDspBinMtxFileOpen"></a><span class="f">_cmDspBinMtxFileOpen</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>          rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>bmfp <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// finalize the current file</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmProc2_h_0.html#cmBinMtxFileFinal">cmBinMtxFileFinal</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>bmfp<span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
      <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kFileCloseFailDspRC">kFileCloseFailDspRC</a><span class="p">,</span><span class="l">&quotFile close failed.&quot</span><span class="p">)</span><span class="p">;</span>
    
    <span class="c">// open a new one</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmProc2_h_0.html#cmBinMtxFileInit">cmBinMtxFileInit</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>bmfp<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspDefaultStrcz">cmDspDefaultStrcz</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kFnBmId">kFnBmId</a><span class="p">)</span> <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a><span class="p">)</span>
      rc                                                                  <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kFileOpenFailDspRC">kFileOpenFailDspRC</a><span class="p">,</span><span class="l">&quotFile open failed.&quot</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinMtxFileFree_defn"></a><a name="_cmDspBinMtxFileFree"></a><span class="f">_cmDspBinMtxFileFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmProc2_h_0.html#cmBinMtxFileFree">cmBinMtxFileFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>bmfp<span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>valArray<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinMtxFileReset_defn"></a><a name="_cmDspBinMtxFileReset"></a><span class="f">_cmDspBinMtxFileReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="#_cmDspBinMtxFileOpen">_cmDspBinMtxFileOpen</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinMtxFileExec_defn"></a><a name="_cmDspBinMtxFileExec"></a><span class="f">_cmDspBinMtxFileExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>          rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <span class="c">// write the file</span>
  <span class="k">if</span><span class="p">(</span> <a href="cmProc2_h_0.html#cmBinMtxFileIsValid">cmBinMtxFileIsValid</a><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>bmfp <span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <a href="cmProc2_h_0.html#cmBinMtxFileExecR">cmBinMtxFileExecR</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>bmfp<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>valArray<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>inPortCnt <span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmGlobal_h_0.html#cmOkRC">cmOkRC</a> <span class="p">)</span>
      <span class="k">return</span> <a href="cmDspClass_h_0.html#cmDspInstErr">cmDspInstErr</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="cmDspClass_h_0.html#kFileWriteFailDspRC">kFileWriteFailDspRC</a><span class="p">,</span><span class="l">&quotFile write failure.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>
<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinMtxFileRecv_defn"></a><a name="_cmDspBinMtxFileRecv"></a><span class="f">_cmDspBinMtxFileRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>          rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinMtxFile_t">cmDspBinMtxFile_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="c">// new file name - create new output file</span>
  <span class="k">if</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">=</span><span class="p">=</span> <a href="#kFnBmId">kFnBmId</a> <span class="p">)</span>
  <span class="p">{</span>
    rc <span class="p">=</span> <a href="#_cmDspBinMtxFileOpen">_cmDspBinMtxFileOpen</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="c">// new value - store in p-&ampgtvalArray[]</span>
  <span class="k">if</span><span class="p">(</span> <a href="#kBaseBmId">kBaseBmId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kBaseBmId">kBaseBmId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>inPortCnt <span class="p">)</span>
  <span class="p">{</span>
    p<span class="p">-</span><span class="p">&gt</span>valArray<span class="p">[</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kBaseBmId">kBaseBmId</a> <span class="p">]</span> <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmBinMtxFileClassCons_defn"></a><a name="cmBinMtxFileClassCons"></a><span class="f">cmBinMtxFileClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmBinMtxFileDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotBinMtxFile&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspBinMtxFileAlloc">_cmDspBinMtxFileAlloc</a><span class="p">,</span>
  <a href="#_cmDspBinMtxFileFree">_cmDspBinMtxFileFree</a><span class="p">,</span>
  <a href="#_cmDspBinMtxFileReset">_cmDspBinMtxFileReset</a><span class="p">,</span>
  <a href="#_cmDspBinMtxFileExec">_cmDspBinMtxFileExec</a><span class="p">,</span>
  <a href="#_cmDspBinMtxFileRecv">_cmDspBinMtxFileRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotTime tagged text file.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmBinMtxFileDC<span class="p">;</span>
<span class="p">}</span>


<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspShiftBuf : Real-time shift buffer.</div><pre><a name="cmDspShiftBuf"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kHopMsSbId"></a><span class="e">kHopMsSbId</span><span class="p">,</span>
  <a name="kWndFactSbId"></a><span class="e">kWndFactSbId</span><span class="p">,</span>
  <a name="kInSbId"></a><span class="e">kInSbId</span><span class="p">,</span>
  <a name="kOutSbId"></a><span class="e">kOutSbId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmShiftBufDC<span class="p">;</span>

<a name="cmDspShiftBuf_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspShiftBuf_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmProc_h_0.html#cmShiftBuf">cmShiftBuf</a><span class="p">*</span> <a name="cmDspShiftBuf_t.sbp"></a><span class="i">sbp</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a></span><span class="p">;</span>

<span class="k">void</span> <a name="_cmDspShiftBufSetup_defn"></a><a name="_cmDspShiftBufSetup"></a><span class="f">_cmDspShiftBufSetup</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span> p <span class="p">)</span>
<span class="p">{</span>
  <span class="k">double</span>   hopMs     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kHopMsSbId">kHopMsSbId</a><span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> hopSmpCnt <span class="p">=</span> lround<span class="p">(</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span> <span class="p">*</span> hopMs <span class="p">/</span> <span class="l">1000.0</span> <span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span> wndSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kWndFactSbId">kWndFactSbId</a><span class="p">)</span> <span class="p">*</span> hopSmpCnt<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>sbp <span class="p">=</span><span class="p">=</span> NULL <span class="p">|</span><span class="p">|</span> hopSmpCnt <span class="p">!</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>hopSmpCnt <span class="p">|</span><span class="p">|</span> wndSmpCnt <span class="p">!</span><span class="p">=</span> p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>wndSmpCnt <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmProc_h_0.html#cmShiftBufFree">cmShiftBufFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">)</span><span class="p">;</span>
    p<span class="p">-</span><span class="p">&gt</span>sbp <span class="p">=</span> <a href="cmProc_h_0.html#cmShiftBufAlloc">cmShiftBufAlloc</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span> NULL<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> wndSmpCnt<span class="p">,</span> hopSmpCnt <span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspShiftBufAlloc_defn"></a><a name="_cmDspShiftBufAlloc"></a><span class="f">_cmDspShiftBufAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span> 
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quothopMs&quot</span><span class="p">,</span>     <a href="#kHopMsSbId">kHopMsSbId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotHop size on milliseconds&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotwndFact&quot</span><span class="p">,</span>   <a href="#kWndFactSbId">kWndFactSbId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a>   <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotCount of hops contained in each output buffer.&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>        <a href="#kInSbId">kInSbId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotAudio input&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout&quot</span><span class="p">,</span>       <a href="#kOutSbId">kOutSbId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span> <span class="l">&quotAudio output&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="c">// Note: by setting the column count of the output audio variable to zero
  // we prevent it from being automatically assigned vector memory.</span>  
  
  <a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspShiftBufFree_defn"></a><a name="_cmDspShiftBufFree"></a><span class="f">_cmDspShiftBufFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmProc_h_0.html#cmShiftBufFree">cmShiftBufFree</a><span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspShiftBufReset_defn"></a><a name="_cmDspShiftBufReset"></a><span class="f">_cmDspShiftBufReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  
  <a href="#_cmDspShiftBufSetup">_cmDspShiftBufSetup</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspShiftBufRecv_defn"></a><a name="_cmDspShiftBufRecv"></a><span class="f">_cmDspShiftBufRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span> 
  <a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>dstVarId<span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kHopMsSbId">kHopMsSbId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kWndFactSbId">kWndFactSbId</a><span class="p">:</span>
    <a href="#_cmDspShiftBufSetup">_cmDspShiftBufSetup</a><span class="p">(</span> ctx<span class="p">,</span> p <span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspShiftBufExec_defn"></a><a name="_cmDspShiftBufExec"></a><span class="f">_cmDspShiftBufExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span>  p      <span class="p">=</span> <span class="p">(</span><a href="#cmDspShiftBuf_t">cmDspShiftBuf_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">unsigned</span>          sn     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBufSmpCount">cmDspAudioBufSmpCount</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInSbId">kInSbId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> sp     <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kInSbId">kInSbId</a><span class="p">,</span><span class="l">0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVar_t">cmDspVar_t</a><span class="p">*</span>       varPtr <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarIdToPtr">cmDspVarIdToPtr</a><span class="p">(</span>inst<span class="p">,</span><a href="#kOutSbId">kOutSbId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <a href="cmProc_h_0.html#cmShiftBufExec">cmShiftBufExec</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">,</span> sp<span class="p">,</span> sn <span class="p">)</span> <span class="p">)</span>
    <a href="cmDspValue_h_0.html#cmDsvSetSampleMtx">cmDsvSetSampleMtx</a><span class="p">(</span>  <span class="p">&amp</span>varPtr<span class="p">-</span><span class="p">&gt</span>value<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>outV<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>sbp<span class="p">-</span><span class="p">&gt</span>outN<span class="p">,</span> <span class="l">1</span><span class="p">)</span><span class="p">;</span>
  <span class="k">else</span>
    <a href="cmDspValue_h_0.html#cmDsvSetSampleMtx">cmDsvSetSampleMtx</a><span class="p">(</span>  <span class="p">&amp</span>varPtr<span class="p">-</span><span class="p">&gt</span>value<span class="p">,</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmShiftBufClassCons_defn"></a><a name="cmShiftBufClassCons"></a><span class="f">cmShiftBufClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmShiftBufDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotShiftBuf&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspShiftBufAlloc">_cmDspShiftBufAlloc</a><span class="p">,</span>
  <a href="#_cmDspShiftBufFree">_cmDspShiftBufFree</a><span class="p">,</span>
  <a href="#_cmDspShiftBufReset">_cmDspShiftBufReset</a><span class="p">,</span>
  <a href="#_cmDspShiftBufExec">_cmDspShiftBufExec</a><span class="p">,</span>
  <a href="#_cmDspShiftBufRecv">_cmDspShiftBufRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotTime tagged text file.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmShiftBufDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspNetSend : Transmit a value to a remote 'snap' host over the 'snap' UDP network.</div><pre><a name="cmDspNetSend"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kInNsId"></a><span class="e">kInNsId</span>
  
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmNetSendDC<span class="p">;</span>

<a name="cmDspNetSend_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspNetSend_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <a href="cmDspNet_h_0.html#_cmDspSrcConn_t">_cmDspSrcConn_t</a><span class="p">*</span> <a name="cmDspNetSend_t.srcConnPtr"></a><span class="i">srcConnPtr</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspNetSend_t">cmDspNetSend_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspNetSendAlloc_defn"></a><a name="_cmDspNetSendAlloc"></a><span class="f">_cmDspNetSendAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span> 
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>   <a href="#kInNsId">kInNsId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span> <span class="l">&quotInput port&quot</span>   <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  assert<span class="p">(</span> va_cnt <span class="p">=</span><span class="p">=</span> <span class="l">1</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspNet_h_0.html#_cmDspSrcConn_t">_cmDspSrcConn_t</a><span class="p">*</span> srcConnPtr <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><a href="cmDspNet_h_0.html#_cmDspSrcConn_t">_cmDspSrcConn_t</a><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  assert<span class="p">(</span> srcConnPtr <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspNetSend_t">cmDspNetSend_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspNetSend_t">cmDspNetSend_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>srcConnPtr <span class="p">=</span> srcConnPtr<span class="p">;</span>
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNetSendReset_defn"></a><a name="_cmDspNetSendReset"></a><span class="f">_cmDspNetSendReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspNetSendRecv_defn"></a><a name="_cmDspNetSendRecv"></a><span class="f">_cmDspNetSendRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspNetSend_t">cmDspNetSend_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspNetSend_t">cmDspNetSend_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">return</span> <a href="cmDspNet_h_0.html#_cmDspSysNetSendEvent">_cmDspSysNetSendEvent</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>srcConnPtr<span class="p">-</span><span class="p">&gt</span>dstNetNodeId<span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>srcConnPtr<span class="p">-</span><span class="p">&gt</span>dstId<span class="p">,</span> evt <span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmNetSendClassCons_defn"></a><a name="cmNetSendClassCons"></a><span class="f">cmNetSendClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmNetSendDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotNetSend&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNetSendAlloc">_cmDspNetSendAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNetSendReset">_cmDspNetSendReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspNetSendRecv">_cmDspNetSendRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotPrint the value of any event arriving at 'in'.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmNetSendDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspRsrWr : Set a 'snap' resource value.</div><pre><a name="cmDspRsrWr"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kBaseInPtsId"></a><span class="e">kBaseInPtsId</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmRsrcWrDC<span class="p">;</span>

<a name="cmDspRsrcWr_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspRsrcWr_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  <span class="k">char</span><span class="p">*</span><span class="p">*</span>      <a name="cmDspRsrcWr_t.pathArray"></a><span class="i">pathArray</span><span class="p">;</span>
  <span class="k">unsigned</span>    <a name="cmDspRsrcWr_t.pathCnt"></a><span class="i">pathCnt</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspRsrcWr_t">cmDspRsrcWr_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspRsrcWrAlloc_defn"></a><a name="_cmDspRsrcWrAlloc"></a><span class="f">_cmDspRsrcWrAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  va_list       vl1<span class="p">;</span>
  va_copy<span class="p">(</span>vl1<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> va_cnt <span class="p">&lt</span> <span class="l">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <a href="cmDspClass_h_0.html#cmDspClassErr">cmDspClassErr</a><span class="p">(</span>ctx<span class="p">,</span>classPtr<span class="p">,</span><a href="cmDspClass_h_0.html#kVarArgParseFailDspRC">kVarArgParseFailDspRC</a><span class="p">,</span><span class="l">&quotThe 'RsrcWr' constructor argument list must contain at least one resource path specificiation.&quot</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">unsigned</span>      pathCnt    <span class="p">=</span> va_cnt<span class="p">;</span>
  <span class="k">unsigned</span>      argCnt    <span class="p">=</span> pathCnt<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span>argCnt<span class="p">+</span><span class="l">1</span><span class="p">]</span><span class="p">;</span>
  
  <span class="k">char</span><span class="p">*</span><span class="p">*</span>       pathArray   <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocZ">cmMemAllocZ</a><span class="p">(</span><span class="k">char</span><span class="p">*</span><span class="p">,</span>pathCnt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">unsigned</span> i<span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>pathCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
  <span class="p">{</span>
    <span class="c">// get the path</span>
    <span class="k">const</span> <a href="cmGlobal_h_0.html#cmChar_t">cmChar_t</a><span class="p">*</span> pathLabel <span class="p">=</span> va_arg<span class="p">(</span>vl<span class="p">,</span><span class="k">const</span> <span class="k">char</span><span class="p">*</span><span class="p">)</span><span class="p">;</span>
    assert<span class="p">(</span> pathLabel <span class="p">!</span><span class="p">=</span> NULL <span class="p">)</span><span class="p">;</span>
    
    <span class="c">// store the path name</span>
    pathArray<span class="p">[</span>i<span class="p">]</span> <span class="p">=</span> <a href="cmMallocDebug_h_0.html#cmMemAllocStr">cmMemAllocStr</a><span class="p">(</span>pathLabel<span class="p">)</span><span class="p">;</span>
    
    <a href="cmDspClass_h_0.html#cmDspArgSetup">cmDspArgSetup</a><span class="p">(</span>ctx<span class="p">,</span> args<span class="p">+</span><a href="#kBaseInPtsId">kBaseInPtsId</a><span class="p">+</span>i<span class="p">,</span> pathLabel<span class="p">,</span> <a href="cmGlobal_h_0.html#cmInvalidId">cmInvalidId</a><span class="p">,</span> <a href="#kBaseInPtsId">kBaseInPtsId</a><span class="p">+</span>i<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kTypeDsvMask">kTypeDsvMask</a><span class="p">,</span> <a href="cmText_h_0.html#cmTsPrintfH">cmTsPrintfH</a><span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>lhH<span class="p">,</span><span class="l">&quot%s Input.&quot</span><span class="p">,</span>pathLabel<span class="p">)</span> <span class="p">)</span><span class="p">;</span>
    
  <span class="p">}</span>
  
  <a href="cmDspClass_h_0.html#cmDspArgSetupNull">cmDspArgSetupNull</a><span class="p">(</span>args <span class="p">+</span> argCnt<span class="p">)</span><span class="p">;</span>
  
  <a href="#cmDspRsrcWr_t">cmDspRsrcWr_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspRsrcWr_t">cmDspRsrcWr_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span><span class="l">0</span><span class="p">,</span>vl1<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>pathCnt     <span class="p">=</span> pathCnt<span class="p">;</span>
  p<span class="p">-</span><span class="p">&gt</span>pathArray   <span class="p">=</span> pathArray<span class="p">;</span>
  
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRsrcWrFree_defn"></a><a name="_cmDspRsrcWrFree"></a><span class="f">_cmDspRsrcWrFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspRsrcWr_t">cmDspRsrcWr_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspRsrcWr_t">cmDspRsrcWr_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <span class="k">int</span> i<span class="p">;</span>
  <span class="k">for</span><span class="p">(</span>i<span class="p">=</span><span class="l">0</span><span class="p">;</span> i<span class="p">&lt</span>p<span class="p">-</span><span class="p">&gt</span>pathCnt<span class="p">;</span> <span class="p">+</span><span class="p">+</span>i<span class="p">)</span>
    <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>pathArray<span class="p">[</span>i<span class="p">]</span><span class="p">)</span><span class="p">;</span>
  <a href="cmMallocDebug_h_0.html#cmMemFree">cmMemFree</a><span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>pathArray<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRsrcWrReset_defn"></a><a name="_cmDspRsrcWrReset"></a><span class="f">_cmDspRsrcWrReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspRsrcWrRecv_defn"></a><a name="_cmDspRsrcWrRecv"></a><span class="f">_cmDspRsrcWrRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspRsrcWr_t">cmDspRsrcWr_t</a><span class="p">*</span> p <span class="p">=</span> <span class="p">(</span><a href="#cmDspRsrcWr_t">cmDspRsrcWr_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  
  <span class="c">// if a msg of any type is recieved on an input port - send out the associated symbol</span>
  <span class="k">if</span><span class="p">(</span> <a href="#kBaseInPtsId">kBaseInPtsId</a> <span class="p">&lt</span><span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&amp</span><span class="p">&amp</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">&lt</span> <a href="#kBaseInPtsId">kBaseInPtsId</a> <span class="p">+</span> p<span class="p">-</span><span class="p">&gt</span>pathCnt <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">unsigned</span> idx <span class="p">=</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">-</span> <a href="#kBaseInPtsId">kBaseInPtsId</a><span class="p">;</span>
    assert<span class="p">(</span> idx <span class="p">&lt</span> p<span class="p">-</span><span class="p">&gt</span>pathCnt <span class="p">)</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span> <a href="cmDspValue_h_0.html#cmDsvIsStrz">cmDsvIsStrz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      rc <span class="p">=</span> <a href="cmDspSys_h_0.html#cmDspRsrcWriteString">cmDspRsrcWriteString</a><span class="p">(</span> ctx<span class="p">-</span><span class="p">&gt</span>dspH<span class="p">,</span> <a href="cmDspValue_h_0.html#cmDsvStrz">cmDsvStrz</a><span class="p">(</span>evt<span class="p">-</span><span class="p">&gt</span>valuePtr<span class="p">)</span><span class="p">,</span> p<span class="p">-</span><span class="p">&gt</span>pathArray<span class="p">[</span>idx<span class="p">]</span><span class="p">,</span> NULL <span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmRsrcWrClassCons_defn"></a><a name="cmRsrcWrClassCons"></a><span class="f">cmRsrcWrClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmRsrcWrDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotRsrcWr&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspRsrcWrAlloc">_cmDspRsrcWrAlloc</a><span class="p">,</span>
  <a href="#_cmDspRsrcWrFree">_cmDspRsrcWrFree</a><span class="p">,</span>
  <a href="#_cmDspRsrcWrReset">_cmDspRsrcWrReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspRsrcWrRecv">_cmDspRsrcWrRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quotSet the value of a resource variable.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmRsrcWrDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDspBinEnc : HRTF binaural encoder.</div><pre><a name="cmDspBinEnc"></a>
<span class="k">enum</span>
<span class="p">{</span>
  <a name="kModeBeId"></a><span class="e">kModeBeId</span><span class="p">,</span>
  <a name="kAzimBeId"></a><span class="e">kAzimBeId</span><span class="p">,</span>
  <a name="kElevBeId"></a><span class="e">kElevBeId</span><span class="p">,</span>
  <a name="kDistBeId"></a><span class="e">kDistBeId</span><span class="p">,</span>
  <a name="kAudioInBeId"></a><span class="e">kAudioInBeId</span><span class="p">,</span>
  <a name="kAudioOut0BeId"></a><span class="e">kAudioOut0BeId</span><span class="p">,</span>
  <a name="kAudioOut1BeId"></a><span class="e">kAudioOut1BeId</span>
<span class="p">}</span><span class="p">;</span>

<a name="cmDspBinEnc_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDspBinEnc_t.inst"></a><span class="i">inst</span><span class="p">;</span>
  cmBinEnc<span class="p">*</span>   <a name="cmDspBinEnc_t.bep"></a><span class="i">bep</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDspBinEnc_t">cmDspBinEnc_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cmBeDC<span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDspBinEncAlloc_defn"></a><a name="_cmDspBinEncAlloc"></a><span class="f">_cmDspBinEncAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotmode&quot</span><span class="p">,</span>    <a href="#kModeBeId">kModeBeId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kUIntDsvFl">kUIntDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kReqArgDsvFl">kReqArgDsvFl</a><span class="p">,</span> <span class="l">&quotMode&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotazim&quot</span><span class="p">,</span>    <a href="#kAzimBeId">kAzimBeId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>              <span class="l">&quotAzimuth&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotelev&quot</span><span class="p">,</span>    <a href="#kElevBeId">kElevBeId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>              <span class="l">&quotElevation&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotdist&quot</span><span class="p">,</span>    <a href="#kDistBeId">kDistBeId</a><span class="p">,</span>        <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>              <span class="l">&quotDistance&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotin&quot</span><span class="p">,</span>      <a href="#kAudioInBeId">kAudioInBeId</a><span class="p">,</span>     <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kInDsvFl">kInDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>            <span class="l">&quotAudio Input&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout0&quot</span><span class="p">,</span>    <a href="#kAudioOut0BeId">kAudioOut0BeId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>            <span class="l">&quotAudio Output 0&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotout1&quot</span><span class="p">,</span>    <a href="#kAudioOut1BeId">kAudioOut1BeId</a><span class="p">,</span>   <span class="l">0</span><span class="p">,</span> <span class="l">1</span><span class="p">,</span>   <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a> <span class="p">|</span> <a href="cmDspValue_h_0.html#kAudioBufDsvFl">kAudioBufDsvFl</a><span class="p">,</span>            <span class="l">&quotAudio Output 1&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultUInt">cmDspSetDefaultUInt</a><span class="p">(</span>   ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kModeBeId">kModeBeId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAzimBeId">kAzimBeId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kElevBeId">kElevBeId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span> ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kDistBeId">kDistBeId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0.0</span> <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinEncFree_defn"></a><a name="_cmDspBinEncFree"></a><span class="f">_cmDspBinEncFree</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  <a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  
  cmBinEncFree<span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>bep<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinEncSetup_defn"></a><a name="_cmDspBinEncSetup"></a><span class="f">_cmDspBinEncSetup</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span> p <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> rc           <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  cmBinEncFree<span class="p">(</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>bep<span class="p">)</span><span class="p">;</span>
  
  p<span class="p">-</span><span class="p">&gt</span>bep <span class="p">=</span> cmBinEncAlloc<span class="p">(</span>ctx<span class="p">-</span><span class="p">&gt</span>cmProcCtx<span class="p">,</span>NULL<span class="p">,</span><a href="cmDspClass_h_0.html#cmDspSampleRate">cmDspSampleRate</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspSamplesPerCycle">cmDspSamplesPerCycle</a><span class="p">(</span>ctx<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinEncReset_defn"></a><a name="_cmDspBinEncReset"></a><span class="f">_cmDspBinEncReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span>   p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>    rc<span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="p">(</span>rc <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">)</span> <span class="p">!</span><span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">return</span> <a href="#_cmDspBinEncSetup">_cmDspBinEncSetup</a><span class="p">(</span>ctx<span class="p">,</span>p<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinEncExec_defn"></a><a name="_cmDspBinEncExec"></a><span class="f">_cmDspBinEncExec</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <span class="k">unsigned</span>          iChIdx  <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <span class="k">const</span> <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span> ip      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kAudioInBeId">kAudioInBeId</a><span class="p">,</span>iChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          iSmpCnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kAudioInBeId">kAudioInBeId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// if no connected</span>
  <span class="k">if</span><span class="p">(</span> iSmpCnt <span class="p">=</span><span class="p">=</span> <span class="l">0</span> <span class="p">)</span>
    <span class="k">return</span> rc<span class="p">;</span>
  
  <span class="k">unsigned</span>          oChIdx   <span class="p">=</span> <span class="l">0</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       o0p      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kAudioOut0BeId">kAudioOut0BeId</a><span class="p">,</span>oChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          oSmp0Cnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kAudioOut0BeId">kAudioOut0BeId</a><span class="p">)</span><span class="p">;</span>
  <a href="cmFloatTypes_h_0.html#cmSample_t">cmSample_t</a><span class="p">*</span>       o1p      <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspAudioBuf">cmDspAudioBuf</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span><a href="#kAudioOut1BeId">kAudioOut1BeId</a><span class="p">,</span>oChIdx<span class="p">)</span><span class="p">;</span>
  <span class="k">unsigned</span>          oSmp1Cnt <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspVarRows">cmDspVarRows</a><span class="p">(</span>inst<span class="p">,</span><a href="#kAudioOut0BeId">kAudioOut0BeId</a><span class="p">)</span><span class="p">;</span>
  
  assert<span class="p">(</span> iSmpCnt<span class="p">=</span><span class="p">=</span>oSmp0Cnt <span class="p">&amp</span><span class="p">&amp</span> iSmpCnt<span class="p">=</span><span class="p">=</span>oSmp1Cnt <span class="p">)</span><span class="p">;</span>
  
  cmBinEncExec<span class="p">(</span> p<span class="p">-</span><span class="p">&gt</span>bep<span class="p">,</span> ip<span class="p">,</span> o0p<span class="p">,</span> o1p<span class="p">,</span> iSmpCnt <span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDspBinEncRecv_defn"></a><a name="_cmDspBinEncRecv"></a><span class="f">_cmDspBinEncRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span> p  <span class="p">=</span> <span class="p">(</span><a href="#cmDspBinEnc_t">cmDspBinEnc_t</a><span class="p">*</span><span class="p">)</span>inst<span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a>      rc <span class="p">=</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">switch</span><span class="p">(</span> evt<span class="p">-</span><span class="p">&gt</span>dstVarId <span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <a href="#kModeBeId">kModeBeId</a><span class="p">:</span>
    cmBinEncSetMode<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>bep<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspUInt">cmDspUInt</a><span class="p">(</span>inst<span class="p">,</span><a href="#kModeBeId">kModeBeId</a><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <a href="#kAzimBeId">kAzimBeId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kElevBeId">kElevBeId</a><span class="p">:</span>
  <span class="k">case</span> <a href="#kDistBeId">kDistBeId</a><span class="p">:</span>
    <span class="p">{</span>
      <span class="k">float</span> azim <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kAzimBeId">kAzimBeId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">float</span> elev <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kElevBeId">kElevBeId</a><span class="p">)</span><span class="p">;</span>
      <span class="k">float</span> dist <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspDouble">cmDspDouble</a><span class="p">(</span>inst<span class="p">,</span><a href="#kDistBeId">kDistBeId</a><span class="p">)</span><span class="p">;</span>
      cmBinEncSetLoc<span class="p">(</span>p<span class="p">-</span><span class="p">&gt</span>bep<span class="p">,</span> azim<span class="p">,</span> elev<span class="p">,</span> dist <span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">default</span><span class="p">:</span>
    <span class="p">{</span> assert<span class="p">(</span><span class="l">0</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> rc<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cmBinEncClassCons_defn"></a><a name="cmBinEncClassCons"></a><span class="f">cmBinEncClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cmBeDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quotBinauralEnc&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDspBinEncAlloc">_cmDspBinEncAlloc</a><span class="p">,</span>
  <a href="#_cmDspBinEncFree">_cmDspBinEncFree</a><span class="p">,</span>
  <a href="#_cmDspBinEncReset">_cmDspBinEncReset</a><span class="p">,</span>
  <a href="#_cmDspBinEncExec">_cmDspBinEncExec</a><span class="p">,</span>
  <a href="#_cmDspBinEncRecv">_cmDspBinEncRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>NULL<span class="p">,</span>
  <span class="l">&quotBinaural filter.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cmBeDC<span class="p">;</span>
<span class="p">}</span>

<span class="c"><hr id="hr1"></span></pre>
</div>
<div class="cod"><div class="blk_title">cmDsp2d : Two dimension graphic user interface controller.</div><pre><a name="cmDsp2d"></a><span class="k">enum</span>
<span class="p">{</span>
  <a name="kX2dId"></a><span class="e">kX2dId</span><span class="p">,</span>
  <a name="kY2dId"></a><span class="e">kY2dId</span><span class="p">,</span>
  <a name="kRadius2dId"></a><span class="e">kRadius2dId</span><span class="p">,</span>
  <a name="kAngle2dId"></a><span class="e">kAngle2dId</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a> _cm2dDC<span class="p">;</span>

<a name="cmDsp2d_t"></a><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a> <a name="cmDsp2d_t.inst"></a><span class="i">inst</span><span class="p">;</span>
<span class="p">}</span> <span class="t"><a href="#cmDsp2d_t">cmDsp2d_t</a></span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span>  <a name="_cmDsp2dAlloc_defn"></a><a name="_cmDsp2dAlloc"></a><span class="f">_cmDsp2dAlloc</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span> classPtr<span class="p">,</span> <span class="k">unsigned</span> storeSymId<span class="p">,</span> <span class="k">unsigned</span> instSymId<span class="p">,</span> <span class="k">unsigned</span> id<span class="p">,</span> <span class="k">unsigned</span> va_cnt<span class="p">,</span> va_list vl <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspVarArg_t">cmDspVarArg_t</a> args<span class="p">[</span><span class="p">]</span> <span class="p">=</span>
  <span class="p">{</span>
    <span class="p">{</span> <span class="l">&quotx&quot</span><span class="p">,</span>     <a href="#kX2dId">kX2dId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotX coordinate&quot</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quoty&quot</span><span class="p">,</span>     <a href="#kY2dId">kY2dId</a><span class="p">,</span>      <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotY coordinate&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotradius&quot</span><span class="p">,</span><a href="#kRadius2dId">kRadius2dId</a><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotRadius&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> <span class="l">&quotangle&quot</span><span class="p">,</span> <a href="#kAngle2dId">kAngle2dId</a><span class="p">,</span>  <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <a href="cmDspValue_h_0.html#kOutDsvFl">kOutDsvFl</a>  <span class="p">|</span> <a href="cmDspValue_h_0.html#kDoubleDsvFl">kDoubleDsvFl</a><span class="p">,</span>  <span class="l">&quotAngle&quot</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span> NULL<span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span><span class="p">,</span> <span class="l">0</span> <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  
  <a href="#cmDsp2d_t">cmDsp2d_t</a><span class="p">*</span> p <span class="p">=</span> <a href="cmDspClass_h_0.html#cmDspInstAlloc">cmDspInstAlloc</a><span class="p">(</span><a href="#cmDsp2d_t">cmDsp2d_t</a><span class="p">,</span>ctx<span class="p">,</span>classPtr<span class="p">,</span>args<span class="p">,</span>instSymId<span class="p">,</span>id<span class="p">,</span>storeSymId<span class="p">,</span>va_cnt<span class="p">,</span>vl<span class="p">)</span><span class="p">;</span>
  
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kX2dId">kX2dId</a><span class="p">,</span>       <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kY2dId">kY2dId</a><span class="p">,</span>       <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kRadius2dId">kRadius2dId</a><span class="p">,</span>  <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  <a href="cmDspClass_h_0.html#cmDspSetDefaultDouble">cmDspSetDefaultDouble</a><span class="p">(</span>ctx<span class="p">,</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span> <a href="#kAngle2dId">kAngle2dId</a><span class="p">,</span>   <span class="l">0.0</span><span class="p">,</span> <span class="l">0.0</span><span class="p">)</span><span class="p">;</span>
  
  <span class="c">// create the UI control</span>
  <a href="cmDspClass_h_0.html#cmDspUi2dCreate">cmDspUi2dCreate</a><span class="p">(</span>ctx<span class="p">,</span><span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">,</span><a href="#kX2dId">kX2dId</a><span class="p">,</span><a href="#kY2dId">kY2dId</a><span class="p">,</span><a href="#kRadius2dId">kRadius2dId</a><span class="p">,</span><a href="#kAngle2dId">kAngle2dId</a><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>p<span class="p">-</span><span class="p">&gt</span>inst<span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp2dReset_defn"></a><a name="_cmDsp2dReset"></a><span class="f">_cmDsp2dReset</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspApplyAllDefaults">cmDspApplyAllDefaults</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>

<a href="cmDspClass_h_0.html#cmDspRC_t">cmDspRC_t</a> <a name="_cmDsp2dRecv_defn"></a><a name="_cmDsp2dRecv"></a><span class="f">_cmDsp2dRecv</span><span class="p">(</span><a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx<span class="p">,</span> <a href="cmDspClass_h_0.html#cmDspInst_t">cmDspInst_t</a><span class="p">*</span> inst<span class="p">,</span> <span class="k">const</span> <a href="cmDspClass_h_0.html#cmDspEvt_t">cmDspEvt_t</a><span class="p">*</span> evt <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspSetEvent">cmDspSetEvent</a><span class="p">(</span>ctx<span class="p">,</span>inst<span class="p">,</span>evt<span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <a href="cmDspClass_h_0.html#kOkDspRC">kOkDspRC</a><span class="p">;</span>
<span class="p">}</span>


<a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span>  <a name="cm2dClassCons_defn"></a><a name="cm2dClassCons"></a><span class="f">cm2dClassCons</span><span class="p">(</span> <a href="cmDspCtx_h_0.html#cmDspCtx_t">cmDspCtx_t</a><span class="p">*</span> ctx <span class="p">)</span>
<span class="p">{</span>
  <a href="cmDspClass_h_0.html#cmDspClassSetup">cmDspClassSetup</a><span class="p">(</span><span class="p">&amp</span>_cm2dDC<span class="p">,</span>ctx<span class="p">,</span><span class="l">&quottwod&quot</span><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDsp2dAlloc">_cmDsp2dAlloc</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDsp2dReset">_cmDsp2dReset</a><span class="p">,</span>
  NULL<span class="p">,</span>
  <a href="#_cmDsp2dRecv">_cmDsp2dRecv</a><span class="p">,</span>
  NULL<span class="p">,</span>
  NULL<span class="p">,</span>
  <span class="l">&quot2d value control.&quot</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">&amp</span>_cm2dDC<span class="p">;</span>
<span class="p">}</span></pre>
</div>
<div class="cod"><pre><a name="cmDspBuiltIn_c_code_1"></a>
<a href="cmDspClass_h_0.html#cmDspClassConsFunc_t">cmDspClassConsFunc_t</a> _cmDspClassBuiltInArray<span class="p">[</span><span class="p">]</span> <span class="p">=</span> 
<span class="p">{</span>
  <a href="#cmPrinterClassCons">cmPrinterClassCons</a><span class="p">,</span>
  <a href="#cmCounterClassCons">cmCounterClassCons</a><span class="p">,</span>
  
  <a href="#cmPhasorClassCons">cmPhasorClassCons</a><span class="p">,</span>
  <a href="#cmMidiOutClassCons">cmMidiOutClassCons</a><span class="p">,</span>
  <a href="#cmMidiInClassCons">cmMidiInClassCons</a><span class="p">,</span>
  <a href="#cmAudioInClassCons">cmAudioInClassCons</a><span class="p">,</span>
  <a href="#cmAudioOutClassCons">cmAudioOutClassCons</a><span class="p">,</span>
  <a href="#cmAudioFileOutClassCons">cmAudioFileOutClassCons</a><span class="p">,</span>
  <a href="#cmSigGenClassCons">cmSigGenClassCons</a><span class="p">,</span>
  
  <a href="#cmScalarClassCons">cmScalarClassCons</a><span class="p">,</span>
  <a href="#cmTextClassCons">cmTextClassCons</a><span class="p">,</span>
  <a href="#cmMeterClassCons">cmMeterClassCons</a><span class="p">,</span>
  <a href="#cmLabelClassCons">cmLabelClassCons</a><span class="p">,</span>
  <a href="#cmButtonClassCons">cmButtonClassCons</a><span class="p">,</span>
  <a href="#cmCheckboxClassCons">cmCheckboxClassCons</a><span class="p">,</span>
  
  <a href="#cmReorderClassCons">cmReorderClassCons</a><span class="p">,</span>
  <a href="#cmFnameClassCons">cmFnameClassCons</a><span class="p">,</span>
  <a href="#cmMsgListClassCons">cmMsgListClassCons</a><span class="p">,</span>
  <a href="#cmWaveTableClassCons">cmWaveTableClassCons</a><span class="p">,</span>
  
  <a href="#cmSprintfClassCons">cmSprintfClassCons</a><span class="p">,</span>
  <a href="#cmAMixClassCons">cmAMixClassCons</a><span class="p">,</span>
  <a href="#cmASplitClassCons">cmASplitClassCons</a><span class="p">,</span>
  <a href="#cmAMeterClassCons">cmAMeterClassCons</a><span class="p">,</span>
  <a href="#cmTextFileClassCons">cmTextFileClassCons</a><span class="p">,</span>
  <a href="#cmBinMtxFileClassCons">cmBinMtxFileClassCons</a><span class="p">,</span>
  <a href="#cmArrayClassCons">cmArrayClassCons</a><span class="p">,</span>
  <a href="#cmPitchCvtClassCons">cmPitchCvtClassCons</a><span class="p">,</span>
  
  <a href="#cmShiftBufClassCons">cmShiftBufClassCons</a><span class="p">,</span>
  <a href="#cmNetSendClassCons">cmNetSendClassCons</a><span class="p">,</span>
  <a href="#cmRsrcWrClassCons">cmRsrcWrClassCons</a><span class="p">,</span>
  <a href="#cmBinEncClassCons">cmBinEncClassCons</a><span class="p">,</span>
  <a href="#cm2dClassCons">cm2dClassCons</a><span class="p">,</span>
  
  <a href="cmDspFx_h_0.html#cmDelayClassCons">cmDelayClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmPShiftClassCons">cmPShiftClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmLoopRecdClassCons">cmLoopRecdClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmRectifyClassCons">cmRectifyClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmGateDetectClassCons">cmGateDetectClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmAutoGainClassCons">cmAutoGainClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmEnvFollowClassCons">cmEnvFollowClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmXfaderClassCons">cmXfaderClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmChCfgClassCons">cmChCfgClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmChordDetectClassCons">cmChordDetectClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmFaderClassCons">cmFaderClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmNoteSelectClassCons">cmNoteSelectClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmNetNoteSelectClassCons">cmNetNoteSelectClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmCombFiltClassCons">cmCombFiltClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmScalarOpClassCons">cmScalarOpClassCons</a><span class="p">,</span>
  
  <a href="cmDspFx_h_0.html#cmGroupSelClassCons">cmGroupSelClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmAudioNofMClassCons">cmAudioNofMClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmRingModClassCons">cmRingModClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmMsgDelayClassCons">cmMsgDelayClassCons</a><span class="p">,</span>
  
  <a href="cmDspFx_h_0.html#cmLineClassCons">cmLineClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmAdsrClassCons">cmAdsrClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmCompressorClassCons">cmCompressorClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmBiQuadEqClassCons">cmBiQuadEqClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmDistDsClassCons">cmDistDsClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmDbToLinClassCons">cmDbToLinClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmMtDelayClassCons">cmMtDelayClassCons</a><span class="p">,</span>
  
  <a href="cmDspFx_h_0.html#cmNofMClassCons">cmNofMClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cm1ofNClassCons">cm1ofNClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cm1UpClassCons">cm1UpClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmGateToSymClassCons">cmGateToSymClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmPortToSymClassCons">cmPortToSymClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmIntToSymClassCons">cmIntToSymClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmRouterClassCons">cmRouterClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmAvailChClassCons">cmAvailChClassCons</a><span class="p">,</span>
  
  <a href="cmDspFx_h_0.html#cmPresetClassCons">cmPresetClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmBcastSymClassCons">cmBcastSymClassCons</a><span class="p">,</span>
  <a href="cmDspFx_h_0.html#cmSegLineClassCons">cmSegLineClassCons</a><span class="p">,</span>
  
  <a href="cmDspKr_h_0.html#cmKrClassCons">cmKrClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmKr2ClassCons">cmKr2ClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmTimeLineClassCons">cmTimeLineClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmScoreClassCons">cmScoreClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmMidiFilePlayClassCons">cmMidiFilePlayClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmScFolClassCons">cmScFolClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmScModClassCons">cmScModClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmGSwitchClassCons">cmGSwitchClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmScaleRangeClassCons">cmScaleRangeClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmActiveMeasClassCons">cmActiveMeasClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmAmSyncClassCons">cmAmSyncClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmNanoMapClassCons">cmNanoMapClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmPicadaeClassCons">cmPicadaeClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmRecdPlayClassCons">cmRecdPlayClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmGoertzelClassCons">cmGoertzelClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmSyncRecdClassCons">cmSyncRecdClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmTakeSeqBldrClassCons">cmTakeSeqBldrClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmTakeSeqRendClassCons">cmTakeSeqRendClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmReflectCalcClassCons">cmReflectCalcClassCons</a><span class="p">,</span>
  <a href="cmDspKr_h_0.html#cmEchoCancelClassCons">cmEchoCancelClassCons</a><span class="p">,</span>
  NULL<span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<a href="cmDspClass_h_0.html#cmDspClassConsFunc_t">cmDspClassConsFunc_t</a> <a name="cmDspClassGetBuiltIn_defn"></a><span class="f"><a href="cmDspBuiltIn_h_0.html#cmDspClassGetBuiltIn">cmDspClassGetBuiltIn</a></span><span class="p">(</span> <span class="k">unsigned</span> index <span class="p">)</span>
<span class="p">{</span>
  <span class="k">unsigned</span> n <span class="p">=</span> <span class="k">sizeof</span><span class="p">(</span>_cmDspClassBuiltInArray<span class="p">)</span><span class="p">/</span><span class="k">sizeof</span><span class="p">(</span><a href="cmDspClass_h_0.html#cmDspClass_t">cmDspClass_t</a><span class="p">*</span><span class="p">)</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> index <span class="p">&gt</span><span class="p">=</span> n <span class="p">)</span>
    <span class="k">return</span> NULL<span class="p">;</span>
  
  <span class="k">return</span> _cmDspClassBuiltInArray<span class="p">[</span>index<span class="p">]</span><span class="p">;</span>
<span class="p">}</span></pre>
</div>
<!-- End nodes -->
</div>
</body>
</html>
